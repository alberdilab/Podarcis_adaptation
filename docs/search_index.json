[["index.html", "AlberdiLab | Martin-Bideguren et al. 2025 Study title to be added Chapter 1 Introduction 1.1 Prepare the R environment", " AlberdiLab | Martin-Bideguren et al. 2025 Study title to be added Garazi Martin-Bideguren1,Carlos Cabido2, Kevin Kohl3, Antton Alberdi4 and Ostaizka Aizpurua5 Last update: 2025-03-31 Chapter 1 Introduction This webbook contains all the code used for data analysis in study of the individual-level metagenomic data of Podarcis muralis and Podarcis liolepis lizards from different environments during an experimental setup. 1.1 Prepare the R environment 1.1.1 Environment To reproduce all the analyses locally, clone this repository in your computer using: RStudio &gt; New Project &gt; Version Control &gt; Git And indicating the following git repository: https://github.com/alberdilab/Podarcis_adaptation.git Once the R project has been created, follow the instructions and code chunks shown in this webbook. 1.1.2 Libraries The following R packages are required for the data analysis. # Base library(R.utils) library(knitr) library(tidyverse) library(devtools) library(tinytable) library(janitor) library(readxl) # For tree handling library(ape) library(phyloseq) library(phytools) # For plotting library(ggplot2) library(ggrepel) library(ggpubr) library(ggnewscale) library(gridExtra) library(ggtreeExtra) library(ggtree) library(ggh4x) library(rstatix) library(ggpmisc) # For statistics library(spaa) library(vegan) library(Rtsne) library(geiger) library(hilldiv2) library(distillR) library(broom.mixed) library(corrplot) library(nlme) library(pairwiseAdonis) library(lme4) library(emmeans) library(UpSetR) library(ANCOMBC) University of Copenhagen, garazi.bideguren@sund.ku.dk↩︎ Sociedad de Ciencias Aranzadi-Departamento de Herpetología, ccabido@aranzadi.eus↩︎ University of Pittsburgh, kkohl78@gmail.com↩︎ University of Copenhagen, antton.alberdi@sund.ku.dk↩︎ University of Copenhagen, ostaizka.aizpurua@sund.ku.dk↩︎ "],["prepare-data.html", "Chapter 2 Prepare data 2.1 Load data 2.2 Create working objects 2.3 Filtering 2.4 Load data statistics 2.5 Prepare color scheme 2.6 Wrap working objects", " Chapter 2 Prepare data 2.1 Load data Load the original data files outputted by the bioinformatic pipeline. 2.1.1 Sample metadata sample_metadata &lt;- read_tsv(&quot;data/metadata.tsv&quot;) %&gt;% mutate(time_point = sub(&quot;^\\\\d+_&quot;, &quot;&quot;, time_point)) %&gt;% filter(!time_point %in% c(&quot;Antibiotics&quot;,&quot;Transplant1&quot;, &quot;Transplant2&quot;)) %&gt;% filter(individual!=&quot;LI1_2nd_6&quot;) %&gt;% mutate(time_point=str_remove_all(time_point, &quot;Post-&quot;)) 2.1.2 Read counts read_counts_raw &lt;- read_tsv(&quot;data/genome.count.tsv&quot;) %&gt;% rename(genome=1) #Transformation of read_counts to combine data from both sequence rounds merge_and_rename &lt;- function(read_counts_raw) { read_counts_raw %&gt;% # Gather the columns into long format pivot_longer(cols = -genome, names_to = &quot;col&quot;) %&gt;% # Extract prefix mutate(prefix = gsub(&quot;^(.*?)_.*&quot;, &quot;\\\\1&quot;, col)) %&gt;% # Group by prefix and genome, then summarize group_by(prefix, genome) %&gt;% summarize(value = sum(value)) %&gt;% # Spread the data back to wide format pivot_wider(names_from = prefix, values_from = value) } read_counts &lt;- merge_and_rename(read_counts_raw) %&gt;% select(c(&quot;genome&quot;,sample_metadata$Tube_code)) 2.1.3 Genome base hits genome_hits_raw &lt;- read_tsv(&quot;data/genome.covered_bases.tsv&quot;) %&gt;% rename(genome=1) #Transformation of genome_hits to combine data from both sequence rounds merge_and_rename &lt;- function(genome_hits_raw) { genome_hits_raw %&gt;% # Gather the columns into long format pivot_longer(cols = -genome, names_to = &quot;col&quot;) %&gt;% # Extract prefix mutate(prefix = gsub(&quot;^(.*?)_.*&quot;, &quot;\\\\1&quot;, col)) %&gt;% # Group by prefix and genome, then summarize group_by(prefix, genome) %&gt;% summarize(value = sum(value)) %&gt;% # Spread the data back to wide format pivot_wider(names_from = prefix, values_from = value) } genome_hits &lt;- merge_and_rename(genome_hits_raw)%&gt;% select(c(&quot;genome&quot;,sample_metadata$Tube_code)) 2.1.4 Genome taxonomy genome_taxonomy &lt;- read_tsv(&quot;data/gtdbtk.summary.tsv&quot;) %&gt;% select(mag_id = user_genome, classification) %&gt;% separate( classification, into = c(&quot;domain&quot;, &quot;phylum&quot;, &quot;class&quot;, &quot;order&quot;, &quot;family&quot;, &quot;genus&quot;, &quot;species&quot;), sep = &quot;;&quot;) %&gt;% rename(genome=1) 2.1.5 Genome quality genome_quality &lt;- read_tsv(&quot;data/quality_report.tsv&quot;) %&gt;% select( genome = Name, completeness = Completeness, contamination = Contamination, length = Genome_Size, gc = GC_Content ) genome_quality&lt;-genome_quality %&gt;% mutate (genome=str_remove_all(genome,&quot;.fa&quot;)) #Filter MAGs with over 70% completeness and less than 10% contamination genome_quality &lt;- genome_quality %&gt;% filter(completeness &gt; 70 &amp; contamination &lt; 10) 2.1.6 Genome tree genome_tree &lt;- read_tree(&quot;data/gtdbtk.backbone.bac120.classify.tree&quot;) genome_tree$tip.label &lt;- str_replace_all(genome_tree$tip.label,&quot;&#39;&quot;, &quot;&quot;) #remove single quotes in MAG names #Filter genome_taxonomy to keep MAGs with over 70% completeness and less than 10% contamination genome_taxonomy &lt;- genome_taxonomy %&gt;% semi_join(genome_quality, by = &quot;genome&quot;) genome_tree &lt;- keep.tip(genome_tree, tip=genome_taxonomy$genome) # keep only MAG tips 2.1.7 Genome annotations genome_annotations &lt;- read_tsv(&quot;data/annotations.tsv.xz&quot;) %&gt;% rename(gene=1, genome=2, contig=3) #Filter only the MAGs with over 70% completeness and less than 10% contamination genome_annotations &lt;- genome_annotations %&gt;% semi_join(genome_quality, by = &quot;genome&quot;) 2.2 Create working objects Transform the original data files into working objects for downstream analyses. 2.2.1 Merge genome taxonomy and quality genome_metadata &lt;- genome_taxonomy %&gt;% inner_join(genome_quality,by=join_by(genome==genome)) #join quality 2.2.2 Calculate genome coverage #Filter genome_hits for the MAGs with over 70% completeness and less than 10% contamination genome_hits &lt;- genome_hits %&gt;% semi_join(genome_quality, by = &quot;genome&quot;) genome_coverage &lt;- genome_hits %&gt;% mutate(across(where(is.numeric), ~ ./genome_metadata$length)) 2.3 Filtering Two samples are removed from the analysis due to their low sequencing depth. #Counts_raw columns_to_exclude &lt;- c(&quot;AD91&quot;, &quot;AC85&quot;) # Columns to exclude (&quot;AD16&quot;,&quot;AD23&quot;, &quot;AD25&quot;, ) read_counts &lt;- read_counts %&gt;% select(-columns_to_exclude) #Coverage_table genome_coverage &lt;- genome_coverage %&gt;% select(-columns_to_exclude) #Metadata sample_metadata &lt;- sample_metadata %&gt;% filter(Tube_code %in% colnames(read_counts)) 2.3.1 Filter reads by coverage #Filter read_counts for the MAGs with over 70% completeness and less than 10% contamination read_counts &lt;- read_counts %&gt;% semi_join(genome_quality, by = &quot;genome&quot;) min_coverage=0.3 read_counts_filt &lt;- genome_coverage %&gt;% mutate(across(where(is.numeric), ~ ifelse(. &gt; min_coverage, 1, 0))) %&gt;% mutate(across(-1, ~ . * read_counts[[cur_column()]])) 2.3.2 Transform reads into genome counts readlength=150 genome_counts &lt;- read_counts %&gt;% mutate(across(where(is.numeric), ~ . / (genome_metadata$length / readlength) )) readlength=150 genome_counts_filt &lt;- read_counts_filt %&gt;% mutate(across(where(is.numeric), ~ . / (genome_metadata$length / readlength) )) 2.3.3 Distill annotations into GIFTs genome_gifts &lt;- distill(genome_annotations,GIFT_db,genomecol=2,annotcol=c(9,10,19), verbosity=F) 2.4 Load data statistics 2.4.1 Raw reads raw_reads &lt;- &quot;data/multiqc_general_stats_2.txt&quot; %&gt;% read_tsv() %&gt;% select( sample = Sample, raw_reads = `total_sequences` ) %&gt;% mutate(sample_prefix = str_extract(sample, &quot;^[^_]+&quot;)) %&gt;% group_by(sample_prefix) %&gt;% summarize(raw_reads = sum(raw_reads, na.rm = TRUE)) %&gt;% rename(sample = sample_prefix) %&gt;% mutate(sample = str_remove(sample, &quot;^fastp \\\\|\\\\s*&quot;)) %&gt;% filter(sample %in% sample_metadata$Tube_code) 2.4.2 Quality-filtered reads fastp_reads &lt;- &quot;data/multiqc_general_stats.txt&quot; %&gt;% read_tsv() %&gt;% select( sample = Sample, trimmed_reads = `total_sequences` ) %&gt;% mutate(sample_prefix = str_extract(sample, &quot;^[^_]+&quot;)) %&gt;% group_by(sample_prefix) %&gt;% summarize(trimmed_reads = sum(trimmed_reads, na.rm = TRUE)) %&gt;% rename(sample = sample_prefix) %&gt;% filter(!str_detect(sample, &quot;nonlizard \\\\|&quot;)) %&gt;% filter(!str_detect(sample, &quot;lizard \\\\|&quot;)) %&gt;% filter(!str_detect(sample, &quot;refseq500 \\\\|&quot;)) %&gt;% mutate(sample = str_remove(sample, &quot;^fastp \\\\|\\\\s*&quot;)) %&gt;% filter(sample %in% sample_metadata$Tube_code) 2.4.3 Host-mapped reads host_mapped &lt;- &quot;data/multiqc_general_stats.txt&quot; %&gt;% read_tsv() %&gt;% filter(str_detect(Sample, &quot;lizard&quot;)) %&gt;% select( sample = Sample, host_mapped = `reads_mapped`, mapping_total = `raw_total_sequences` ) %&gt;% mutate( host_unmapped = mapping_total - host_mapped ) %&gt;% filter(!is.na(host_mapped)) %&gt;% separate( col = sample, into = c(&quot;host_name&quot;, &quot;sample&quot;), sep = &quot; \\\\| &quot; ) %&gt;% rename(mapped = host_mapped, unmapped = host_unmapped) %&gt;% select(-mapping_total) %&gt;% pivot_longer(-host_name:-sample) %&gt;% mutate( name = str_glue(&quot;{name}_{host_name}&quot;) ) %&gt;% select(-host_name) %&gt;% pivot_wider() %&gt;% mutate(sample = str_extract(sample, &quot;^[^_]+&quot;)) %&gt;% group_by(sample) %&gt;% summarize( mapped_lizard = sum(mapped_lizard), unmapped_lizard = sum(unmapped_lizard) ) %&gt;% filter(sample %in% sample_metadata$Tube_code) 2.4.4 Prokaryotic fraction singlem &lt;- &quot;data/singleM.tsv&quot; %&gt;% read_tsv() %&gt;% distinct() %&gt;% mutate( sample = sample %&gt;% str_remove_all(&quot;_1$&quot;), read_fraction = read_fraction %&gt;% str_remove(&quot;%&quot;) %&gt;% as.numeric(), read_fraction = read_fraction / 100 ) %&gt;% select( sample, singlem_prokaryotic_bases = bacterial_archaeal_bases, singlem_metagenome_size = metagenome_size, singlem_read_fraction = read_fraction, ) %&gt;% mutate(sample_prefix = str_extract(sample, &quot;^[^_]+&quot;)) %&gt;% group_by(sample_prefix) %&gt;% summarize( singlem_prokaryotic_bases = sum(singlem_prokaryotic_bases), singlem_metagenome_size = sum(singlem_metagenome_size), singlem_read_fraction = mean(singlem_read_fraction) ) %&gt;% rename(sample = sample_prefix)%&gt;% filter(sample %in% sample_metadata$Tube_code) 2.4.5 MAG-mapped reads mag_mapping &lt;- read_tsv(&quot;data/contig.count.tsv.xz&quot;) %&gt;% pivot_longer(-sequence_id) %&gt;% summarise(value = sum(value), .by = &quot;name&quot;) %&gt;% rename(sample = name, mapped_mags = value) %&gt;% mutate(sample_prefix = str_extract(sample, &quot;^[^_]+&quot;)) %&gt;% group_by(sample_prefix) %&gt;% summarize( mapped_mags = sum(mapped_mags) ) %&gt;% rename(sample = sample_prefix)%&gt;% filter(sample %in% sample_metadata$Tube_code) 2.4.6 Wrap data statistics data_stats &lt;- raw_reads %&gt;% left_join(fastp_reads) %&gt;% left_join(host_mapped) %&gt;% left_join(singlem) %&gt;% left_join(mag_mapping) data_stats &lt;- data_stats %&gt;% filter(!str_detect(sample, &quot;nonlizard \\\\|&quot;)) %&gt;% filter(!str_detect(sample, &quot;lizard \\\\|&quot;)) %&gt;% filter(!str_detect(sample, &quot;refseq500 \\\\|&quot;)) 2.5 Prepare color scheme AlberdiLab projects use unified color schemes developed for the Earth Hologenome Initiative, to facilitate figure interpretation. phylum_colors &lt;- read_tsv(&quot;https://raw.githubusercontent.com/earthhologenome/EHI_taxonomy_colour/main/ehi_phylum_colors.tsv&quot;) %&gt;% right_join(genome_metadata, by=join_by(phylum == phylum)) %&gt;% arrange(match(genome, genome_tree$tip.label)) %&gt;% select(phylum, colors) %&gt;% unique() %&gt;% arrange(phylum) %&gt;% pull(colors, name=phylum) 2.6 Wrap working objects All working objects are wrapped into a single Rdata object to facilitate downstream usage. save(sample_metadata, genome_metadata, read_counts, genome_counts, genome_counts_filt, genome_tree, genome_gifts, phylum_colors, data_stats, file = &quot;data/data_27022025.Rdata&quot;) "],["data-statistics.html", "Chapter 3 Data statistics 3.1 Sequencing reads statistics 3.2 DNA fractions 3.3 Recovered microbial fraction", " Chapter 3 Data statistics load(&quot;data/data_27022025.Rdata&quot;) 3.1 Sequencing reads statistics data_stats$raw_reads %&gt;% sum() [1] 3335496930 data_stats$raw_reads %&gt;% mean() [1] 31466952 data_stats$raw_reads %&gt;% sd() [1] 14473977 3.2 DNA fractions #Overall data_stats %&gt;% mutate(mapped_perc=mapped_mags/trimmed_reads) %&gt;% summarise(mean=mean(mapped_perc),sd=sd(mapped_perc)) # A tibble: 1 × 2 mean sd &lt;dbl&gt; &lt;dbl&gt; 1 0.471 0.140 data_stats %&gt;% mutate( low_quality = raw_reads - trimmed_reads, unmapped_reads = trimmed_reads - mapped_lizard - mapped_mags ) %&gt;% select(sample, low_quality, mapped_lizard, mapped_mags, unmapped_reads) %&gt;% pivot_longer(-sample) %&gt;% mutate(name=factor(name,levels=c(&quot;low_quality&quot;,&quot;mapped_lizard&quot;,&quot;unmapped_reads&quot;,&quot;mapped_mags&quot;))) %&gt;% left_join(., sample_metadata, by = join_by(sample == Tube_code)) %&gt;% filter(!is.na(time_point)) %&gt;% ggplot(aes(x = sample, y = value, fill = name)) + geom_bar(stat = &quot;identity&quot;, position = &quot;fill&quot;) + scale_fill_manual(name=&quot;Sequence type&quot;, breaks=c(&quot;low_quality&quot;,&quot;mapped_lizard&quot;,&quot;unmapped_reads&quot;,&quot;mapped_mags&quot;), labels=c(&quot;Low quality&quot;,&quot;Mapped to host&quot;,&quot;Unmapped&quot;,&quot;Mapped to MAGs&quot;), values=c(&quot;#CCCCCC&quot;, &quot;#bcdee1&quot;, &quot;#d8b8a3&quot;,&quot;#93655c&quot;))+ facet_grid(~time_point, scales = &quot;free&quot;, labeller = labeller(time_point=c(&quot;0_Wild&quot;=&quot;Wild&quot;, &quot;1_Acclimation&quot;=&quot;Acclimation&quot;, &quot;2_Antibiotics&quot;=&quot;Antibiotics&quot;, &quot;3_Transplant1&quot;=&quot;Transplant1&quot;, &quot;4_Transplant2&quot;=&quot;Transplant2&quot;, &quot;5_Post-FMT1&quot;=&quot;Post1&quot;, &quot;6_Post-FMT2&quot;=&quot;Post2&quot;))) + theme_minimal() + theme(axis.text.x = element_text(angle = 90, hjust = 1, size=0)) + labs(y=&quot;DNA sequence fraction&quot;,x=&quot;Samples&quot;) 3.3 Recovered microbial fraction data_stats %&gt;% mutate( unmapped_reads = trimmed_reads - mapped_lizard - mapped_mags, mag_proportion = mapped_mags / (mapped_mags + unmapped_reads), singlem_read_fraction = singlem_read_fraction ) %&gt;% select(sample, mag_proportion, singlem_read_fraction) %&gt;% mutate( mag_proportion = if_else(singlem_read_fraction == 0, 0, mag_proportion), singlem_read_fraction = if_else(singlem_read_fraction == 0, NA, singlem_read_fraction), singlem_read_fraction = if_else(singlem_read_fraction &lt; mag_proportion, NA, singlem_read_fraction), singlem_read_fraction = if_else(singlem_read_fraction &gt; 1, 1, singlem_read_fraction) ) %&gt;% pivot_longer(-sample, names_to = &quot;proportion&quot;, values_to = &quot;value&quot;) %&gt;% mutate( proportion = factor( proportion, levels = c(&quot;mag_proportion&quot;, &quot;singlem_read_fraction&quot;) ) ) %&gt;% left_join(., sample_metadata, by = join_by(sample == Tube_code)) %&gt;% filter(!is.na(time_point)) %&gt;% ggplot(aes(x = sample, y = value, color = proportion)) + geom_line(aes(group = sample), color = &quot;#f8a538&quot;) + geom_point() + scale_color_manual(name=&quot;Proportion&quot;, breaks=c(&quot;mag_proportion&quot;,&quot;singlem_read_fraction&quot;), labels=c(&quot;Recovered&quot;,&quot;Estimated&quot;), values=c(&quot;#52e1e8&quot;, &quot;#876b53&quot;))+ theme_minimal() + facet_grid(~time_point, scales = &quot;free&quot;, space=&quot;free&quot;, labeller = labeller(time_point=c(&quot;0_Wild&quot;=&quot;Wild&quot;, &quot;1_Acclimation&quot;=&quot;Acclimation&quot;, &quot;2_Antibiotics&quot;=&quot;Antibiotics&quot;, &quot;3_Transplant1&quot;=&quot;Transplant1&quot;, &quot;4_Transplant2&quot;=&quot;Transplant2&quot;, &quot;5_Post-FMT1&quot;=&quot;Post1&quot;, &quot;6_Post-FMT2&quot;=&quot;Post2&quot;)))+ labs(y = &quot;Samples&quot;, x = &quot;Prokaryotic fraction&quot;) + scale_y_continuous(limits = c(0, 1)) + theme( axis.text.y = element_text(size = 4), axis.text.x = element_text( angle = 90, vjust = 0.5, hjust = 1, size = 0), legend.position = &quot;right&quot; ) 3.3.1 Domain-adjusted mapping rate (DAMR) data_stats %&gt;% mutate( unmapped_reads = trimmed_reads - mapped_lizard - mapped_mags, mag_proportion = mapped_mags / (mapped_mags + unmapped_reads), singlem_read_fraction = singlem_read_fraction ) %&gt;% mutate(damr=pmin(1, mag_proportion/singlem_read_fraction)) %&gt;% left_join(sample_metadata[c(1,7, 10)], by = join_by(sample == Tube_code)) %&gt;% filter(!is.na(time_point)) %&gt;% select(sample,damr, time_point, type) %&gt;% #group_by(type) %&gt;% #summarise(mean=mean(damr),sd=sd(damr)) %&gt;% tt() .table td.tinytable_css_bthm4sp69ffrgeadcr6c, .table th.tinytable_css_bthm4sp69ffrgeadcr6c { border-bottom: solid #d3d8dc 0.1em; } .table td.tinytable_css_24dgw84cqczbtxpmp1fy, .table th.tinytable_css_24dgw84cqczbtxpmp1fy { border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; } sample damr time_point type AC79 1.0000000 Acclimation Control AC80 1.0000000 Acclimation Treatment AC81 0.9813013 Acclimation Treatment AC82 0.7490771 Acclimation Treatment AC83 1.0000000 Acclimation Control AC84 1.0000000 Acclimation Control AC86 0.8800275 Acclimation Control AC87 0.9672854 Acclimation Treatment AC88 0.3142108 Acclimation Control AC89 0.9338962 Acclimation Treatment AC90 1.0000000 Acclimation Control AC91 1.0000000 Acclimation Control AC92 1.0000000 Acclimation Control AC93 1.0000000 Acclimation Treatment AC94 0.9159348 Acclimation Treatment AC95 0.9239904 Acclimation Treatment AC96 0.9425962 Acclimation Treatment AC97 0.9394886 Acclimation Hot_control AC98 1.0000000 Acclimation Hot_control AC99 1.0000000 Acclimation Hot_control AD01 1.0000000 Acclimation Hot_control AD02 1.0000000 Acclimation Hot_control AD03 1.0000000 Acclimation Hot_control AD04 0.8896057 Acclimation Hot_control AD05 1.0000000 Acclimation Hot_control AD07 0.9515379 Acclimation Hot_control AD74 0.9017271 FMT1 Control AD75 1.0000000 FMT1 Treatment AD76 0.9862581 FMT1 Treatment AD77 0.8963376 FMT1 Treatment AD78 1.0000000 FMT1 Treatment AD79 1.0000000 FMT1 Control AD80 0.8808155 FMT1 Treatment AD81 1.0000000 FMT1 Control AD82 1.0000000 FMT1 Control AD83 1.0000000 FMT1 Treatment AD84 1.0000000 FMT1 Treatment AD85 1.0000000 FMT1 Control AD86 0.9889084 FMT1 Control AD87 1.0000000 FMT1 Control AD88 1.0000000 FMT1 Treatment AD89 0.9562489 FMT1 Control AD90 1.0000000 FMT1 Control AD93 1.0000000 FMT1 Hot_control AD94 0.7947750 FMT1 Hot_control AD95 0.9506977 FMT1 Hot_control AD96 0.9171413 FMT1 Hot_control AD97 0.9257685 FMT1 Hot_control AD98 0.9048349 FMT1 Hot_control AD99 0.9966152 FMT1 Hot_control AE01 1.0000000 FMT1 Hot_control AE02 1.0000000 FMT1 Hot_control AE04 1.0000000 FMT2 Treatment AE05 1.0000000 FMT2 Treatment AE06 1.0000000 FMT2 Control AE07 0.7797794 FMT2 Control AE08 1.0000000 FMT2 Control AE09 1.0000000 FMT2 Control AE91 0.9259146 FMT2 Treatment AE92 1.0000000 FMT2 Control AE93 1.0000000 FMT2 Control AE94 0.9152960 FMT2 Treatment AE95 1.0000000 FMT2 Treatment AE96 0.7786112 FMT2 Treatment AE97 0.9365037 FMT2 Control AE98 1.0000000 FMT2 Control AE99 0.8513354 FMT2 Treatment AF01 0.9046369 FMT2 Treatment AF02 1.0000000 FMT2 Control AF03 0.9030087 FMT2 Treatment AF04 1.0000000 FMT2 Hot_control AF05 1.0000000 FMT2 Hot_control AF06 1.0000000 FMT2 Hot_control AF07 0.9526443 FMT2 Hot_control AF08 1.0000000 FMT2 Hot_control AF09 1.0000000 FMT2 Hot_control AF10 0.9716162 FMT2 Hot_control AF11 0.9654152 FMT2 Hot_control AF13 0.8818742 FMT2 Hot_control AFU87 0.8810513 Wild Control AFU88 0.8317800 Wild Treatment AFU91 0.8923699 Wild Treatment AFU92 0.8094776 Wild Treatment AFU93 0.8517368 Wild Control AFU94 0.8325385 Wild Treatment AFU95 0.8419270 Wild Treatment AFU96 0.8326820 Wild Control AFU97 0.8107271 Wild Treatment AFU98 0.7506522 Wild Control AFU99 0.8582371 Wild Treatment AFV01 0.9331539 Wild Treatment AFV02 0.8316460 Wild Treatment AFV03 0.8752591 Wild Control AFV04 0.9180285 Wild Control AFV05 1.0000000 Wild Control AFV06 1.0000000 Wild Control AFV07 0.8460805 Wild Control AFV08 0.7497043 Wild Hot_control AFV09 0.5412999 Wild Hot_control AFV10 0.8002499 Wild Hot_control AFV11 0.8225298 Wild Hot_control AFV12 0.7925988 Wild Hot_control AFV14 0.8106269 Wild Hot_control AFV15 0.9691106 Wild Hot_control AFV16 0.8218990 Wild Hot_control AFV17 0.8091152 Wild Hot_control "],["mag-catalogue.html", "Chapter 4 MAG catalogue 4.1 Genome phylogeny 4.2 Genome quality 4.3 Functional overview 4.4 Functional ordination", " Chapter 4 MAG catalogue load(&quot;data/data.Rdata&quot;) 4.1 Genome phylogeny # Generate the phylum color heatmap phylum_heatmap &lt;- read_tsv(&quot;https://raw.githubusercontent.com/earthhologenome/EHI_taxonomy_colour/main/ehi_phylum_colors.tsv&quot;) %&gt;% right_join(genome_metadata, by=join_by(phylum == phylum)) %&gt;% arrange(match(genome, genome_tree$tip.label)) %&gt;% select(genome,phylum) %&gt;% mutate(phylum = factor(phylum, levels = unique(phylum))) %&gt;% column_to_rownames(var = &quot;genome&quot;) # Generate basal tree circular_tree &lt;- force.ultrametric(genome_tree, method=&quot;extend&quot;) %&gt;% # extend to ultrametric for the sake of visualisation ggtree(., layout=&quot;fan&quot;, open.angle=10, size=0.5) *************************************************************** * Note: * * force.ultrametric does not include a formal method to * * ultrametricize a tree &amp; should only be used to coerce * * a phylogeny that fails is.ultrametric due to rounding -- * * not as a substitute for formal rate-smoothing methods. * *************************************************************** # Add phylum ring circular_tree &lt;- gheatmap(circular_tree, phylum_heatmap, offset=0.55, width=0.1, colnames=FALSE) + scale_fill_manual(values=phylum_colors) + geom_tiplab2(size=1, hjust=-0.1) + theme(legend.position = &quot;none&quot;, plot.margin = margin(0, 0, 0, 0), panel.margin = margin(0, 0, 0, 0)) # Flush color scale to enable a new color scheme in the next ring circular_tree &lt;- circular_tree + new_scale_fill() # Add completeness ring circular_tree &lt;- circular_tree + new_scale_fill() + scale_fill_gradient(low = &quot;#d1f4ba&quot;, high = &quot;#f4baba&quot;) + geom_fruit( data=genome_metadata, geom=geom_bar, mapping = aes(x=completeness, y=genome, fill=contamination), offset = 0.55, orientation=&quot;y&quot;, stat=&quot;identity&quot;) # Add genome-size ring circular_tree &lt;- circular_tree + new_scale_fill() + scale_fill_manual(values = &quot;#cccccc&quot;) + geom_fruit( data=genome_metadata, geom=geom_bar, mapping = aes(x=length, y=genome), offset = 0.05, orientation=&quot;y&quot;, stat=&quot;identity&quot;) # Add text circular_tree &lt;- circular_tree + annotate(&#39;text&#39;, x=3.4, y=0, label=&#39; Phylum&#39;, family=&#39;ArialMT&#39;, size=3.5) + annotate(&#39;text&#39;, x=4.2, y=0, label=&#39; Genome quality&#39;, family=&#39;ArialMT&#39;, size=3.5) + annotate(&#39;text&#39;, x=4.7, y=0, label=&#39; Genome size&#39;, family=&#39;ArialMT&#39;, size=3.5) #Plot circular tree circular_tree %&gt;% open_tree(30) %&gt;% rotate_tree(90) 4.2 Genome quality genome_metadata$completeness %&gt;% mean() [1] 92.98658 genome_metadata$completeness %&gt;% sd() [1] 7.170467 genome_metadata$contamination %&gt;% mean() [1] 2.154888 genome_metadata$contamination %&gt;% sd() [1] 2.194372 #Generate quality biplot genome_biplot &lt;- genome_metadata %&gt;% select(c(genome,domain,phylum,completeness,contamination,length)) %&gt;% arrange(match(genome, rev(genome_tree$tip.label))) %&gt;% #sort MAGs according to phylogenetic tree ggplot(aes(x=completeness,y=contamination,size=length,color=phylum)) + geom_point(alpha=0.7) + ylim(c(10,0)) + scale_color_manual(values=phylum_colors) + labs(y= &quot;Contamination&quot;, x = &quot;Completeness&quot;) + theme_classic() + theme(legend.position = &quot;none&quot;) #Generate contamination boxplot genome_contamination &lt;- genome_metadata %&gt;% ggplot(aes(y=contamination)) + ylim(c(10,0)) + geom_boxplot(colour = &quot;#999999&quot;, fill=&quot;#cccccc&quot;) + theme_void() + theme(legend.position = &quot;none&quot;, axis.title.x = element_blank(), axis.title.y = element_blank(), axis.text.y=element_blank(), axis.ticks.y=element_blank(), axis.text.x=element_blank(), axis.ticks.x=element_blank(), plot.margin = unit(c(0, 0, 0.40, 0),&quot;inches&quot;)) #add bottom-margin (top, right, bottom, left) #Generate completeness boxplot genome_completeness &lt;- genome_metadata %&gt;% ggplot(aes(x=completeness)) + xlim(c(50,100)) + geom_boxplot(colour = &quot;#999999&quot;, fill=&quot;#cccccc&quot;) + theme_void() + theme(legend.position = &quot;none&quot;, axis.title.x = element_blank(), axis.title.y = element_blank(), axis.text.y=element_blank(), axis.ticks.y=element_blank(), axis.text.x=element_blank(), axis.ticks.x=element_blank(), plot.margin = unit(c(0, 0, 0, 0.50),&quot;inches&quot;)) #add left-margin (top, right, bottom, left) #Render composite figure grid.arrange(grobs = list(genome_completeness,genome_biplot,genome_contamination), layout_matrix = rbind(c(1,1,1,1,1,1,1,1,1,1,1,4), c(2,2,2,2,2,2,2,2,2,2,2,3), c(2,2,2,2,2,2,2,2,2,2,2,3), c(2,2,2,2,2,2,2,2,2,2,2,3), c(2,2,2,2,2,2,2,2,2,2,2,3), c(2,2,2,2,2,2,2,2,2,2,2,3), c(2,2,2,2,2,2,2,2,2,2,2,3), c(2,2,2,2,2,2,2,2,2,2,2,3), c(2,2,2,2,2,2,2,2,2,2,2,3), c(2,2,2,2,2,2,2,2,2,2,2,3), c(2,2,2,2,2,2,2,2,2,2,2,3), c(2,2,2,2,2,2,2,2,2,2,2,3))) 4.3 Functional overview # Aggregate basal GIFT into elements function_table &lt;- genome_gifts %&gt;% to.elements(., GIFT_db) # Generate basal tree function_tree &lt;- force.ultrametric(genome_tree, method=&quot;extend&quot;) %&gt;% ggtree(., size = 0.3) *************************************************************** * Note: * * force.ultrametric does not include a formal method to * * ultrametricize a tree &amp; should only be used to coerce * * a phylogeny that fails is.ultrametric due to rounding -- * * not as a substitute for formal rate-smoothing methods. * *************************************************************** #Add phylum colors next to the tree tips function_tree &lt;- gheatmap(function_tree, phylum_heatmap, offset=0, width=0.1, colnames=FALSE) + scale_fill_manual(values=phylum_colors) + labs(fill=&quot;Phylum&quot;) #Reset fill scale to use a different colour profile in the heatmap function_tree &lt;- function_tree + new_scale_fill() #Add functions heatmap function_tree &lt;- gheatmap(function_tree, function_table, offset=0.5, width=3.5, colnames=FALSE) + vexpand(.08) + coord_cartesian(clip = &quot;off&quot;) + scale_fill_gradient(low = &quot;#f4f4f4&quot;, high = &quot;steelblue&quot;, na.value=&quot;white&quot;) + labs(fill=&quot;GIFT&quot;) #Reset fill scale to use a different colour profile in the heatmap function_tree &lt;- function_tree + new_scale_fill() # Add completeness barplots function_tree &lt;- function_tree + geom_fruit(data=genome_metadata, geom=geom_bar, grid.params=list(axis=&quot;x&quot;, text.size=2, nbreak = 1), axis.params=list(vline=TRUE), mapping = aes(x=length, y=genome, fill=completeness), offset = 3.8, orientation=&quot;y&quot;, stat=&quot;identity&quot;) + scale_fill_gradient(low = &quot;#cf8888&quot;, high = &quot;#a2cc87&quot;) + labs(fill=&quot;Genome\\ncompleteness&quot;) function_tree 4.4 Functional ordination # Generate the tSNE ordination tSNE_function &lt;- Rtsne(X=function_table, dims = 2, check_duplicates = FALSE) # Plot the ordination function_ordination &lt;- tSNE_function$Y %&gt;% as.data.frame() %&gt;% mutate(genome=rownames(function_table)) %&gt;% inner_join(genome_metadata, by=&quot;genome&quot;) %&gt;% rename(tSNE1=&quot;V1&quot;, tSNE2=&quot;V2&quot;) %&gt;% select(genome,phylum,tSNE1,tSNE2, length) %&gt;% ggplot(aes(x = tSNE1, y = tSNE2, color = phylum, size=length))+ geom_point(shape=16, alpha=0.7) + scale_color_manual(values=phylum_colors) + theme_minimal() + labs(color=&quot;Phylum&quot;, size=&quot;Genome size&quot;) + guides(color = guide_legend(override.aes = list(size = 5))) # enlarge Phylum dots in legend function_ordination "],["community-composition.html", "Chapter 5 Community composition 5.1 Taxonomy overview 5.2 Taxonomy boxplot", " Chapter 5 Community composition load(&quot;data/data_27022025.Rdata&quot;) 5.1 Taxonomy overview 5.1.1 Stacked barplot # Merge data frames based on sample # transplants_metadata &lt;- sample_metadata %&gt;% # mutate(Tube_code = str_remove_all(Tube_code, &quot;_a&quot;)) # transplants_metadata$newID &lt;- paste(transplants_metadata$Tube_code, # &quot;_&quot;, # transplants_metadata$individual) merged_data &lt;- genome_counts_filt %&gt;% mutate_at(vars(-genome), ~ . / sum(.)) %&gt;% #apply TSS normalisation pivot_longer(-genome, names_to = &quot;sample&quot;, values_to = &quot;count&quot;) %&gt;% #reduce to minimum number of columns left_join(., genome_metadata, by = join_by(genome == genome)) %&gt;% #append genome metadata left_join(., sample_metadata, by = join_by(sample == Tube_code)) %&gt;% #append sample metadata filter(count &gt; 0) #filter 0 counts ggplot(merged_data, aes( x = sample, y = count, fill = phylum, group = phylum )) + #grouping enables keeping the same sorting of taxonomic units geom_bar(stat = &quot;identity&quot;, colour = &quot;white&quot;, linewidth = 0.1) + #plot stacked bars with white borders scale_fill_manual(values = phylum_colors) + facet_nested(. ~ time_point + type , scales = &quot;free&quot;) + #facet per day and treatment guides(fill = guide_legend(ncol = 1)) + labs(fill = &quot;Phylum&quot;, y = &quot;Relative abundance&quot;, x = &quot;Sample&quot;) + theme( axis.text.x = element_text( angle = 45, hjust = 1, size = 0 ), strip.text.x = element_text( size = 14, colour = &quot;black&quot;, face = &quot;bold&quot; ), strip.background = element_rect(fill =&quot;lightgrey&quot;), axis.title = element_text(size = 18, face = &quot;bold&quot;), panel.background = element_blank(), legend.title = element_text(size = 20, face = &quot;bold&quot;), legend.text = element_text(size = 16) ) 5.1.1.1 Wild samples merged_data %&gt;% filter(time_point==&quot;Wild&quot;) %&gt;% ggplot(aes(x=sample,y=count, fill=phylum, group=phylum)) + #grouping enables keeping the same sorting of taxonomic units geom_bar(stat=&quot;identity&quot;, colour=&quot;white&quot;, linewidth=0.1) + #plot stacked bars with white borders scale_fill_manual(values=phylum_colors) + facet_nested(. ~ Population, scales=&quot;free&quot;) + #facet per day and treatment guides(fill = guide_legend(ncol = 1)) + labs(fill=&quot;Phylum&quot;,y = &quot;Relative abundance&quot;,x=&quot;Sample&quot;)+ theme( axis.text.x = element_text( angle = 45, hjust = 1, size = 0 ), strip.text.x = element_text( size = 14, colour = &quot;black&quot;, face = &quot;bold&quot; ), axis.title = element_text(size = 18, face = &quot;bold&quot;), panel.background = element_blank(), strip.background = element_rect(fill =&quot;lightgrey&quot;), legend.title = element_text(size = 20, face = &quot;bold&quot;), legend.text = element_text(size = 16) ) 5.1.2 Phylum relative abundances phylum_summary &lt;- genome_counts_filt %&gt;% mutate_at(vars(-genome),~./sum(.)) %&gt;% #apply TSS normalisation pivot_longer(-genome, names_to = &quot;sample&quot;, values_to = &quot;count&quot;) %&gt;% left_join(sample_metadata, by = join_by(sample == Tube_code)) %&gt;% left_join(genome_metadata, by = join_by(genome == genome)) %&gt;% group_by(sample,phylum) %&gt;% summarise(relabun=sum(count)) 5.1.2.1 Cold and wet population phylum_summary %&gt;% left_join(sample_metadata, by = join_by(sample == Tube_code)) %&gt;% group_by(phylum, Population) %&gt;% filter(Population==&quot;Cold_wet&quot; &amp; time_point==&quot;Wild&quot;) %&gt;% summarise(total_mean=mean(relabun*100, na.rm=T), total_sd=sd(relabun*100, na.rm=T)) %&gt;% filter(total_mean!=0) %&gt;% mutate(total=str_c(round(total_mean,2),&quot;±&quot;,round(total_sd,2))) %&gt;% arrange(-total_mean) %&gt;% dplyr::select(phylum,total) %&gt;% tt() .table td.tinytable_css_twryaonijenkqui5n5gu, .table th.tinytable_css_twryaonijenkqui5n5gu { border-bottom: solid #d3d8dc 0.1em; } .table td.tinytable_css_dodw7ejfgmh3n88tu7ru, .table th.tinytable_css_dodw7ejfgmh3n88tu7ru { border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; } phylum total p__Bacteroidota 41.93±15.4 p__Bacillota_A 33.96±16.7 p__Bacillota 5.73±4.73 p__Campylobacterota 5.39±4.64 p__Verrucomicrobiota 4.36±3.06 p__Pseudomonadota 3.75±3.76 p__Desulfobacterota 2.31±1.6 p__Bacillota_C 0.85±0.82 p__Cyanobacteriota 0.64±0.83 p__Bacillota_B 0.5±0.77 p__Fusobacteriota 0.37±1.28 p__Spirochaetota 0.12±0.35 p__Actinomycetota 0.09±0.22 5.1.2.2 Hot and dry population phylum_summary %&gt;% left_join(sample_metadata, by = join_by(sample == Tube_code)) %&gt;% group_by(phylum, Population) %&gt;% filter(Population==&quot;Hot_dry&quot; &amp; time_point==&quot;Wild&quot;) %&gt;% summarise(total_mean=mean(relabun*100, na.rm=T), total_sd=sd(relabun*100, na.rm=T)) %&gt;% filter(total_mean!=0) %&gt;% mutate(total=str_c(round(total_mean,2),&quot;±&quot;,round(total_sd,2))) %&gt;% arrange(-total_mean) %&gt;% dplyr::select(phylum,total) %&gt;% tt() .table td.tinytable_css_81ofbmpjgx45i0s3hte6, .table th.tinytable_css_81ofbmpjgx45i0s3hte6 { border-bottom: solid #d3d8dc 0.1em; } .table td.tinytable_css_4hxrcqpyjma3opltok33, .table th.tinytable_css_4hxrcqpyjma3opltok33 { border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; } phylum total p__Bacillota_A 33.9±16.17 p__Bacteroidota 27.63±17.64 p__Campylobacterota 13.53±20.98 p__Pseudomonadota 10.92±9.94 p__Bacillota 6.09±7.66 p__Spirochaetota 2.66±2.78 p__Desulfobacterota 1.69±1.85 p__Fusobacteriota 1.34±1.73 p__Bacillota_B 0.76±0.73 p__Bacillota_C 0.73±0.5 p__Cyanobacteriota 0.52±0.65 p__Chlamydiota 0.12±0.18 p__Verrucomicrobiota 0.06±0.1 p__Elusimicrobiota 0.05±0.14 5.2 Taxonomy boxplot 5.2.1 Family family_summary &lt;- genome_counts_filt %&gt;% mutate_at(vars(-genome),~./sum(.)) %&gt;% #apply TSS normalisation pivot_longer(-genome, names_to = &quot;sample&quot;, values_to = &quot;count&quot;) %&gt;% #reduce to minimum number of columns left_join(sample_metadata, by = join_by(sample == Tube_code)) %&gt;% #append sample metadata left_join(., genome_metadata, by = join_by(genome == genome)) %&gt;% #append genome metadata group_by(sample,family) %&gt;% summarise(relabun=sum(count)) family_arrange &lt;- family_summary %&gt;% group_by(family) %&gt;% summarise(mean=sum(relabun)) %&gt;% arrange(-mean) %&gt;% select(family) %&gt;% pull() family_summary %&gt;% left_join(genome_metadata %&gt;% select(family,phylum) %&gt;% unique(),by=join_by(family==family)) %&gt;% left_join(sample_metadata,by=join_by(sample==Tube_code)) %&gt;% filter(family %in% family_arrange[1:20]) %&gt;% mutate(family=factor(family,levels=rev(family_arrange[1:20]))) %&gt;% filter(relabun &gt; 0) %&gt;% ggplot(aes(x=relabun, y=family, group=family, color=phylum)) + scale_color_manual(values=phylum_colors[-8]) + geom_jitter(alpha=0.5) + facet_grid(.~type)+ theme_minimal() + labs(y=&quot;Family&quot;, x=&quot;Relative abundance&quot;, color=&quot;Phylum&quot;) 5.2.2 Genus genus_summary &lt;- genome_counts_filt %&gt;% mutate_at(vars(-genome),~./sum(.)) %&gt;% #apply TSS nornalisation pivot_longer(-genome, names_to = &quot;sample&quot;, values_to = &quot;count&quot;) %&gt;% #reduce to minimum number of columns left_join(sample_metadata, by = join_by(sample == Tube_code)) %&gt;% #append sample metadata left_join(genome_metadata, by = join_by(genome == genome)) %&gt;% #append genome metadata group_by(sample,genus) %&gt;% summarise(relabun=sum(count)) %&gt;% filter(genus != &quot;g__&quot;) genus_arrange &lt;- genus_summary %&gt;% group_by(genus) %&gt;% summarise(mean=sum(relabun)) %&gt;% filter(genus != &quot;g__&quot;)%&gt;% arrange(-mean) %&gt;% select(genus) %&gt;% mutate(genus= sub(&quot;^g__&quot;, &quot;&quot;, genus)) %&gt;% pull() genus_summary %&gt;% left_join(genome_metadata %&gt;% select(genus,phylum) %&gt;% unique(),by=join_by(genus==genus)) %&gt;% left_join(sample_metadata,by=join_by(sample==Tube_code)) %&gt;% mutate(genus= sub(&quot;^g__&quot;, &quot;&quot;, genus)) %&gt;% filter(genus %in% genus_arrange[1:20]) %&gt;% mutate(genus=factor(genus,levels=rev(genus_arrange[1:20]))) %&gt;% filter(relabun &gt; 0) %&gt;% ggplot(aes(x=relabun, y=genus, group=genus, color=phylum)) + scale_color_manual(values=phylum_colors[-c(3,4,6,8)]) + geom_jitter(alpha=0.5) + facet_grid(.~type)+ theme_minimal() + labs(y=&quot;Genus&quot;, x=&quot;Relative abundance&quot;, color=&quot;Phylum&quot;) "],["calculations.html", "Chapter 6 Calculations 6.1 Alpha diversity 6.2 Beta diversity 6.3 Phyloseq object 6.4 Functional data", " Chapter 6 Calculations load(&quot;data/data_27022025.Rdata&quot;) load(&quot;data/beta_27022025.Rdata&quot;) load(&quot;data/calculations_28022025.Rdata&quot;) 6.1 Alpha diversity # Calculate Hill numbers richness &lt;- genome_counts_filt %&gt;% column_to_rownames(var = &quot;genome&quot;) %&gt;% dplyr::select(where(~ !all(. == 0))) %&gt;% hilldiv(., q = 0) %&gt;% t() %&gt;% as.data.frame() %&gt;% dplyr::rename(richness = 1) %&gt;% rownames_to_column(var = &quot;sample&quot;) neutral &lt;- genome_counts_filt %&gt;% column_to_rownames(var = &quot;genome&quot;) %&gt;% dplyr::select(where(~ !all(. == 0))) %&gt;% hilldiv(., q = 1) %&gt;% t() %&gt;% as.data.frame() %&gt;% dplyr::rename(neutral = 1) %&gt;% rownames_to_column(var = &quot;sample&quot;) phylogenetic &lt;- genome_counts_filt %&gt;% column_to_rownames(var = &quot;genome&quot;) %&gt;% dplyr::select(where(~ !all(. == 0))) %&gt;% hilldiv(., q = 1, tree = genome_tree) %&gt;% t() %&gt;% as.data.frame() %&gt;% dplyr::rename(phylogenetic = 1) %&gt;% rownames_to_column(var = &quot;sample&quot;) # Merge all metrics alpha_div &lt;- richness %&gt;% full_join(neutral, by = join_by(sample == sample)) %&gt;% full_join(phylogenetic, by = join_by(sample == sample)) 6.2 Beta diversity beta_q0n &lt;- genome_counts_filt %&gt;% column_to_rownames(., &quot;genome&quot;) %&gt;% hillpair(., q = 0) beta_q1n &lt;- genome_counts_filt %&gt;% column_to_rownames(., &quot;genome&quot;) %&gt;% hillpair(., q = 1) beta_q1p &lt;- genome_counts_filt %&gt;% column_to_rownames(., &quot;genome&quot;) %&gt;% hillpair(., q = 1, tree = genome_tree) 6.3 Phyloseq object #Phyloseq object count_phy &lt;- genome_counts_filt %&gt;% column_to_rownames(var=&quot;genome&quot;)%&gt;% otu_table(., taxa_are_rows=T) sample_info_tab_phy &lt;- sample_metadata%&gt;% column_to_rownames(var=&quot;Tube_code&quot;)%&gt;% sample_data() TAX &lt;- genome_metadata%&gt;% column_to_rownames(var=&quot;genome&quot;)%&gt;% select(1:7)%&gt;% as.matrix()%&gt;% tax_table() tree &lt;- phy_tree(genome_tree) physeq_all = phyloseq(count_phy, TAX, sample_info_tab_phy, tree) 6.4 Functional data # Aggregate bundle-level GIFTs into the compound level GIFTs_elements &lt;- to.elements(genome_gifts, GIFT_db) GIFTs_elements_filtered &lt;- GIFTs_elements[rownames(GIFTs_elements) %in% genome_counts_filt$genome, ] GIFTs_elements_filtered &lt;- as.data.frame(GIFTs_elements_filtered) %&gt;% select_if(~ !is.numeric(.) || sum(.) != 0) elements &lt;- GIFTs_elements_filtered %&gt;% as.data.frame() # Aggregate element-level GIFTs into the function level GIFTs_functions &lt;- to.functions(GIFTs_elements_filtered, GIFT_db) functions &lt;- GIFTs_functions %&gt;% as.data.frame() # Aggregate function-level GIFTs into overall Biosynthesis, Degradation and Structural GIFTs GIFTs_domains &lt;- to.domains(GIFTs_functions, GIFT_db) domains &lt;- GIFTs_domains %&gt;% as.data.frame() # Get community-weighed average GIFTs per sample GIFTs_elements_community &lt;- to.community(GIFTs_elements_filtered, genome_counts_filt %&gt;% column_to_rownames(., &quot;genome&quot;) %&gt;% tss(), GIFT_db) GIFTs_functions_community &lt;- to.community(GIFTs_functions, genome_counts_filt %&gt;% column_to_rownames(., &quot;genome&quot;) %&gt;% tss(), GIFT_db) GIFTs_domains_community &lt;- to.community(GIFTs_domains, genome_counts_filt %&gt;% column_to_rownames(., &quot;genome&quot;) %&gt;% tss(), GIFT_db) uniqueGIFT_db &lt;- unique(GIFT_db[c(2,4,5,6)]) %&gt;% unite(&quot;Function&quot;,Function:Element, sep= &quot;_&quot;, remove=FALSE) element_gift &lt;- GIFTs_elements_community %&gt;% as.data.frame() %&gt;% rownames_to_column(., &quot;Tube_code&quot;) %&gt;% left_join(sample_metadata[c(1, 7, 10)], by = &quot;Tube_code&quot;) save(richness, neutral, phylogenetic, alpha_div, physeq_all, beta_q0n, beta_q1n, beta_q1p, GIFTs_elements_filtered, GIFTs_elements_community, GIFTs_functions_community, GIFTs_domains_community, element_gift, uniqueGIFT_db, file = &quot;data/calculations_28022025.Rdata&quot;) "],["is-the-gm-of-cold--vs-warm-adapted-populations-similar-in-the-wild.html", "Chapter 7 Is the GM of cold- vs warm-adapted populations similar in the wild? 7.1 Shared and unique MAGs 7.2 Shapiro test 7.3 Alpha diversity 7.4 Beta diversity 7.5 Differential abundance 7.6 Functional capacity", " Chapter 7 Is the GM of cold- vs warm-adapted populations similar in the wild? load(&quot;data/data_27022025.Rdata&quot;) load(&quot;data/calculations_28022025.Rdata&quot;) #load(&quot;data/ancombc_04032025.Rdata&quot;) 7.1 Shared and unique MAGs locationcolors=c(&#39;#c4d7d1&#39;,&#39;#e08683&#39;) subset_meta &lt;- sample_metadata %&gt;% filter(time_point==&quot;Wild&quot;) genome_counts_rel_fil&lt;- genome_counts_filt %&gt;% select(one_of(c(&quot;genome&quot;, subset_meta$Tube_code))) %&gt;% filter(rowSums(across(where(is.numeric), ~ . != 0)) &gt; 0) %&gt;% select(genome, where( ~ is.numeric(.) &amp;&amp; sum(.) &gt; 0)) %&gt;% column_to_rownames(., &quot;genome&quot;) genome_counts_rel_pa=1*(genome_counts_rel_fil&gt;0) table_upset_analysis_cont=t(aggregate(t(genome_counts_rel_pa),by=list(subset_meta$Population),FUN=sum)[,-1]) colnames(table_upset_analysis_cont)=levels(as.factor(subset_meta$Population)) table_upset_analysis=(table_upset_analysis_cont&gt;0)*1 table_upset_analysis=data.frame(table_upset_analysis) table_upset_analysis=apply(table_upset_analysis,2,as.integer) rownames(table_upset_analysis) &lt;- rownames(genome_counts_rel_pa) upset(as.data.frame(table_upset_analysis), keep.order = T, sets = rev(c(&quot;Cold_wet&quot;,&quot;Hot_dry&quot;)), sets.bar.color= rev(locationcolors), mb.ratio = c(0.55, 0.45), order.by = &quot;freq&quot;) 7.2 Shapiro test alpha_div %&gt;% pivot_longer(-sample, names_to = &quot;metric&quot;, values_to = &quot;value&quot;) %&gt;% left_join(., sample_metadata, by = join_by(sample == Tube_code)) %&gt;% filter(time_point ==&quot;Acclimation&quot;| time_point == &quot;Wild&quot;) %&gt;% filter(metric==&quot;richness&quot;) %&gt;% summarize(shapiro_p_value = shapiro.test(value)$p.value) %&gt;% pull(shapiro_p_value) [1] 0.03999359 alpha_div %&gt;% pivot_longer(-sample, names_to = &quot;metric&quot;, values_to = &quot;value&quot;) %&gt;% left_join(., sample_metadata, by = join_by(sample == Tube_code)) %&gt;% filter(time_point ==&quot;Acclimation&quot;| time_point == &quot;Wild&quot;) %&gt;% filter(metric==&quot;neutral&quot;) %&gt;% summarize(shapiro_p_value = shapiro.test(value)$p.value) %&gt;% pull(shapiro_p_value) [1] 0.2966492 alpha_div %&gt;% pivot_longer(-sample, names_to = &quot;metric&quot;, values_to = &quot;value&quot;) %&gt;% left_join(., sample_metadata, by = join_by(sample == Tube_code)) %&gt;% filter(time_point ==&quot;Acclimation&quot;| time_point == &quot;Wild&quot;) %&gt;% filter(metric==&quot;phylogenetic&quot;) %&gt;% summarize(shapiro_p_value = shapiro.test(value)$p.value) %&gt;% pull(shapiro_p_value) [1] 0.5784544 7.3 Alpha diversity alpha_div %&gt;% pivot_longer(-sample, names_to = &quot;metric&quot;, values_to = &quot;value&quot;) %&gt;% left_join(., sample_metadata, by = join_by(sample == Tube_code)) %&gt;% filter(time_point==&quot;Wild&quot;) %&gt;% mutate(metric=factor(metric,levels=c(&quot;richness&quot;))) %&gt;% filter(metric==&quot;richness&quot;)%&gt;% ggplot(aes(y = value, x = Population, group=Population, color=Population, fill=Population)) + geom_boxplot(outlier.shape = NA) + geom_jitter(alpha=0.5) + scale_color_manual(name=&quot;Population&quot;, breaks=c(&quot;Cold_wet&quot;,&quot;Hot_dry&quot;), labels=c(&quot;Cold&quot;,&quot;Hot&quot;), values=c(&#39;#008080&#39;, &quot;#d57d2c&quot;)) + scale_fill_manual(name=&quot;Population&quot;, breaks=c(&quot;Cold_wet&quot;,&quot;Hot_dry&quot;), labels=c(&quot;Cold&quot;,&quot;Hot&quot;), values=c(&#39;#00808050&#39;, &quot;#d57d2c50&quot;)) + facet_wrap(. ~ metric,scales = &quot;free&quot;) + coord_cartesian(xlim = c(1, NA)) + stat_compare_means(method=&quot;wilcox.test&quot;, size=3, label.x=.58) + theme_classic() + theme( strip.background = element_blank(), panel.grid.minor.x = element_line(size = .1, color = &quot;grey&quot;), axis.title.x = element_blank(), axis.title.y = element_text(size=10), axis.text.x = element_blank(), # Increase plot size plot.title = element_text(size = 10), axis.text = element_text(size = 8), axis.title = element_text(size = 8) ) + ylab(&quot;Alpha diversity&quot;) alpha_div %&gt;% pivot_longer(-sample, names_to = &quot;metric&quot;, values_to = &quot;value&quot;) %&gt;% left_join(., sample_metadata, by = join_by(sample == Tube_code)) %&gt;% filter(time_point==&quot;Wild&quot;) %&gt;% mutate(metric=factor(metric,levels=c(&quot;neutral&quot;,&quot;phylogenetic&quot;))) %&gt;% filter(metric!=&quot;richness&quot;)%&gt;% ggplot(aes(y = value, x = Population, group=Population, color=Population, fill=Population)) + geom_boxplot(outlier.shape = NA) + geom_jitter(alpha=0.5) + scale_color_manual(name=&quot;Population&quot;, breaks=c(&quot;Cold_wet&quot;,&quot;Hot_dry&quot;), labels=c(&quot;Cold&quot;,&quot;Hot&quot;), values=c(&#39;#008080&#39;, &quot;#d57d2c&quot;)) + scale_fill_manual(name=&quot;Population&quot;, breaks=c(&quot;Cold_wet&quot;,&quot;Hot_dry&quot;), labels=c(&quot;Cold&quot;,&quot;Hot&quot;), values=c(&#39;#00808050&#39;, &quot;#d57d2c50&quot;)) + facet_wrap(. ~ metric,scales = &quot;free&quot;) + coord_cartesian(xlim = c(1, NA)) + stat_compare_means(method=&quot;t.test&quot;,size=3, label.x=.58) + theme_classic() + theme( strip.background = element_blank(), panel.grid.minor.x = element_line(size = .1, color = &quot;grey&quot;), axis.title.x = element_blank(), axis.title.y = element_text(size=10), axis.text.x = element_blank(), # Increase plot size plot.title = element_text(size = 10), axis.text = element_text(size = 8), axis.title = element_text(size = 8) ) + ylab(&quot;Alpha diversity&quot;) 7.4 Beta diversity Number of samples used samples_to_keep &lt;- sample_metadata %&gt;% filter(time_point == &quot;Wild&quot;) %&gt;% select(Tube_code) %&gt;% pull() subset_meta &lt;- sample_metadata %&gt;% filter(time_point == &quot;Wild&quot;) length(samples_to_keep) [1] 27 Richness richness &lt;- as.matrix(beta_q0n$S) richness &lt;- as.dist(richness[rownames(richness) %in% samples_to_keep, colnames(richness) %in% samples_to_keep]) betadisper(richness, subset_meta$Population) %&gt;% permutest(., pairwise = TRUE) Permutation test for homogeneity of multivariate dispersions Permutation: free Number of permutations: 999 Response: Distances Df Sum Sq Mean Sq F N.Perm Pr(&gt;F) Groups 1 0.000012 0.000012 0.0012 999 0.974 Residuals 25 0.257281 0.010291 Pairwise comparisons: (Observed p-value below diagonal, permuted p-value above diagonal) Cold_wet Hot_dry Cold_wet 0.972 Hot_dry 0.97302 adonis2(richness ~ Population, data = subset_meta %&gt;% arrange(match(Tube_code,labels(richness))), permutations = 999) %&gt;% broom::tidy() %&gt;% tt() .table td.tinytable_css_x1id8px5c4kprpzaweyu, .table th.tinytable_css_x1id8px5c4kprpzaweyu { border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; } .table td.tinytable_css_ubt92mn0bkyhdcju335z, .table th.tinytable_css_ubt92mn0bkyhdcju335z { border-bottom: solid #d3d8dc 0.1em; } term df SumOfSqs R2 statistic p.value Model 1 1.542719 0.2095041 6.625717 0.001 Residual 25 5.820951 0.7904959 NA NA Total 26 7.363669 1.0000000 NA NA Neutral neutral &lt;- as.matrix(beta_q1n$S) neutral &lt;- as.dist(neutral[rownames(neutral) %in% samples_to_keep, colnames(neutral) %in% samples_to_keep]) betadisper(neutral, subset_meta$Population) %&gt;% permutest(., pairwise = TRUE) Permutation test for homogeneity of multivariate dispersions Permutation: free Number of permutations: 999 Response: Distances Df Sum Sq Mean Sq F N.Perm Pr(&gt;F) Groups 1 0.000048 0.0000476 0.0044 999 0.945 Residuals 25 0.270114 0.0108046 Pairwise comparisons: (Observed p-value below diagonal, permuted p-value above diagonal) Cold_wet Hot_dry Cold_wet 0.945 Hot_dry 0.94763 adonis2(neutral ~ Population, data = subset_meta %&gt;% arrange(match(Tube_code,labels(neutral))), permutations = 999) %&gt;% broom::tidy() %&gt;% tt() .table td.tinytable_css_edpjoj3el2chcytyn2r9, .table th.tinytable_css_edpjoj3el2chcytyn2r9 { border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; } .table td.tinytable_css_8qc5nle60ond2htsn5hx, .table th.tinytable_css_8qc5nle60ond2htsn5hx { border-bottom: solid #d3d8dc 0.1em; } term df SumOfSqs R2 statistic p.value Model 1 1.918266 0.2608511 8.822682 0.001 Residual 25 5.435610 0.7391489 NA NA Total 26 7.353876 1.0000000 NA NA Phylogenetic phylo &lt;- as.matrix(beta_q1p$S) phylo &lt;- as.dist(phylo[rownames(phylo) %in% samples_to_keep, colnames(phylo) %in% samples_to_keep]) betadisper(phylo, subset_meta$Population) %&gt;% permutest(., pairwise = TRUE) Permutation test for homogeneity of multivariate dispersions Permutation: free Number of permutations: 999 Response: Distances Df Sum Sq Mean Sq F N.Perm Pr(&gt;F) Groups 1 0.03585 0.035847 2.4912 999 0.129 Residuals 25 0.35973 0.014389 Pairwise comparisons: (Observed p-value below diagonal, permuted p-value above diagonal) Cold_wet Hot_dry Cold_wet 0.132 Hot_dry 0.12705 adonis2(phylo ~ Population, data = subset_meta %&gt;% arrange(match(Tube_code,labels(phylo))), permutations = 999) %&gt;% broom::tidy() %&gt;% tt() .table td.tinytable_css_iikub25ehkl40rnvgr7k, .table th.tinytable_css_iikub25ehkl40rnvgr7k { border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; } .table td.tinytable_css_ew1jl6ddi5a3tw87cilo, .table th.tinytable_css_ew1jl6ddi5a3tw87cilo { border-bottom: solid #d3d8dc 0.1em; } term df SumOfSqs R2 statistic p.value Model 1 0.3218613 0.2162815 6.899207 0.001 Residual 25 1.1662981 0.7837185 NA NA Total 26 1.4881594 1.0000000 NA NA NMDS richness %&gt;% metaMDS(.,trymax = 500, k=2, verbosity=FALSE, trace=FALSE) %&gt;% vegan::scores() %&gt;% as_tibble(., rownames = &quot;sample&quot;) %&gt;% left_join(subset_meta, by = join_by(sample == Tube_code)) %&gt;% group_by(Population) %&gt;% mutate(x_cen = mean(NMDS1, na.rm = TRUE)) %&gt;% mutate(y_cen = mean(NMDS2, na.rm = TRUE)) %&gt;% ungroup() %&gt;% ggplot(., aes(x=NMDS1,y=NMDS2, color=Population, shape=type)) + scale_color_manual(name=&quot;Population&quot;, breaks=c(&quot;Cold_wet&quot;,&quot;Hot_dry&quot;), labels=c(&quot;Cold&quot;,&quot;Hot&quot;), values=c(&#39;#008080&#39;,&quot;#d57d2c&quot;)) + scale_shape_manual(name=&quot;Type&quot;, breaks=c(&quot;Control&quot;, &quot;Hot_control&quot;, &quot;Treatment&quot;), labels=c(&quot;Cold-Cold&quot;, &quot;Hot-Hot&quot;, &quot;Cold-Hot&quot;), values=c(&quot;circle&quot;,&quot;square&quot;,&quot;triangle&quot;)) + geom_point(size=2) + geom_segment(aes(x=x_cen, y=y_cen, xend=NMDS1, yend=NMDS2), alpha=0.2) + labs(y = &quot;NMDS2&quot;, x=&quot;NMDS1 \\n Richness beta diversity&quot;) + theme_classic() + theme(legend.position=&quot;none&quot;) neutral %&gt;% metaMDS(.,trymax = 500, k=2, verbosity=FALSE, trace=FALSE) %&gt;% vegan::scores() %&gt;% as_tibble(., rownames = &quot;sample&quot;) %&gt;% left_join(subset_meta, by = join_by(sample == Tube_code))%&gt;% group_by(Population) %&gt;% mutate(x_cen = mean(NMDS1, na.rm = TRUE)) %&gt;% mutate(y_cen = mean(NMDS2, na.rm = TRUE)) %&gt;% ungroup() %&gt;% ggplot(., aes(x=NMDS1,y=NMDS2, color=Population, shape=type)) + scale_color_manual(name=&quot;Population&quot;, breaks=c(&quot;Cold_wet&quot;,&quot;Hot_dry&quot;), labels=c(&quot;Cold&quot;,&quot;Hot&quot;), values=c(&#39;#008080&#39;,&quot;#d57d2c&quot;)) + scale_shape_manual(name=&quot;Type&quot;, breaks=c(&quot;Control&quot;, &quot;Hot_control&quot;, &quot;Treatment&quot;), labels=c(&quot;Cold-Cold&quot;, &quot;Hot-Hot&quot;, &quot;Cold-Hot&quot;), values=c(&quot;circle&quot;,&quot;square&quot;,&quot;triangle&quot;)) + geom_point(size=2) + geom_segment(aes(x=x_cen, y=y_cen, xend=NMDS1, yend=NMDS2), alpha=0.2) + labs(y = &quot;NMDS2&quot;, x=&quot;NMDS1 \\n Neutral beta diversity&quot;) + theme_classic() + theme(legend.position=&quot;none&quot;) phylo %&gt;% metaMDS(.,trymax = 500, k=2, verbosity=FALSE, trace=FALSE) %&gt;% vegan::scores() %&gt;% as_tibble(., rownames = &quot;sample&quot;) %&gt;% left_join(subset_meta, by = join_by(sample == Tube_code)) %&gt;% group_by(Population) %&gt;% mutate(x_cen = mean(NMDS1, na.rm = TRUE)) %&gt;% mutate(y_cen = mean(NMDS2, na.rm = TRUE)) %&gt;% ungroup() %&gt;% ggplot(., aes(x=NMDS1,y=NMDS2, color=Population, shape=type)) + scale_color_manual(name=&quot;Population&quot;, breaks=c(&quot;Cold_wet&quot;,&quot;Hot_dry&quot;), labels=c(&quot;Cold&quot;,&quot;Hot&quot;), values=c(&#39;#008080&#39;,&quot;#d57d2c&quot;)) + scale_shape_manual(name=&quot;Type&quot;, breaks=c(&quot;Control&quot;, &quot;Hot_control&quot;, &quot;Treatment&quot;), labels=c(&quot;Cold-Cold&quot;, &quot;Hot-Hot&quot;, &quot;Cold-Hot&quot;), values=c(&quot;circle&quot;,&quot;square&quot;,&quot;triangle&quot;)) + geom_point(size=2) + geom_segment(aes(x=x_cen, y=y_cen, xend=NMDS1, yend=NMDS2), alpha=0.2) + labs(y = element_blank (), x = &quot;NMDS1 \\n Phylogenetic beta diversity&quot;) + theme_classic() + theme(legend.position = &quot;none&quot;) 7.5 Differential abundance 7.5.1 Structural zeros wild_struc &lt;- structural_zeros %&gt;% filter(present==&quot;Cold_wet&quot;)%&gt;% count(phylum, name = &quot;Cold_wet&quot;) %&gt;% arrange(desc(Cold_wet)) structural_zeros %&gt;% filter(present==&quot;Hot_dry&quot;)%&gt;% count(phylum, name = &quot;Hot_dry&quot;) %&gt;% arrange(desc(Hot_dry)) %&gt;% full_join(., wild_struc, by=&quot;phylum&quot;) %&gt;% mutate(across(everything(), ~ ifelse(is.na(.), 0, .))) %&gt;% tt() .table td.tinytable_css_6ffxpbk53fmyq0rrau4r, .table th.tinytable_css_6ffxpbk53fmyq0rrau4r { border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; } .table td.tinytable_css_01a65iwvcvuyqbrib09p, .table th.tinytable_css_01a65iwvcvuyqbrib09p { border-bottom: solid #d3d8dc 0.1em; } phylum Hot_dry Cold_wet p__Bacillota_A 31 30 p__Bacteroidota 26 14 p__Bacillota 14 10 p__Pseudomonadota 12 8 p__Cyanobacteriota 5 4 p__Desulfobacterota 3 1 p__Bacillota_C 1 0 p__Chlamydiota 1 0 p__Elusimicrobiota 1 0 p__Fusobacteriota 1 0 p__Verrucomicrobiota 1 3 p__Actinomycetota 0 1 p__Bacillota_B 0 1 phylo_samples &lt;- sample_metadata %&gt;% filter(time_point == &quot;Wild&quot;) %&gt;% column_to_rownames(&quot;Tube_code&quot;) %&gt;% sample_data() phylo_genome &lt;- genome_counts_filt %&gt;% select(one_of(c(&quot;genome&quot;,rownames(phylo_samples)))) %&gt;% filter(!genome %in% structural_zeros$genome) %&gt;% column_to_rownames(&quot;genome&quot;) %&gt;% mutate_all( ~ replace(., . == 0, 0.00001)) %&gt;% otu_table(., taxa_are_rows = TRUE) phylo_taxonomy &lt;- genome_metadata %&gt;% filter(genome %in% rownames(phylo_genome)) %&gt;% mutate(genome2 = genome) %&gt;% column_to_rownames(&quot;genome2&quot;) %&gt;% dplyr::select(domain, phylum, class, order, family, genus, species, genome) %&gt;% as.matrix() %&gt;% tax_table() physeq_sample_wild &lt;- phyloseq(phylo_genome, phylo_taxonomy, phylo_samples) physeq_sample_wild &lt;- prune_taxa(taxa_sums(physeq_sample_wild)&gt;0, physeq_sample_wild) 7.5.2 Phylum ancom_rand_output_wild_phylum = ancombc2( data = physeq_sample_wild, assay_name = &quot;counts&quot;, tax_level = &quot;phylum&quot;, fix_formula = &quot;Population&quot;, p_adj_method = &quot;holm&quot;, pseudo_sens = TRUE, prv_cut = 0, lib_cut = 0, s0_perc = 0.05, group = NULL, struc_zero = FALSE, neg_lb = FALSE, alpha = 0.05, n_cl = 2, verbose = TRUE, global = FALSE, pairwise = FALSE, dunnet = FALSE, trend = FALSE, iter_control = list( tol = 1e-5, max_iter = 20, verbose = FALSE ), em_control = list(tol = 1e-5, max_iter = 100), mdfdr_control = list(fwer_ctrl_method = &quot;holm&quot;, B = 100), trend_control = NULL ) save(ancom_rand_output_wild_phylum, file=&quot;data/ancom_rand_output_wild_phylum.RData&quot;) load(&quot;data/ancom_rand_output_wild_phylum.RData&quot;) ancom_rand_output_wild_phylum$res %&gt;% dplyr::select(taxon, lfc_PopulationHot_dry, p_PopulationHot_dry) %&gt;% filter(p_PopulationHot_dry &lt; 0.05) taxon lfc_PopulationHot_dry p_PopulationHot_dry 1 p__Spirochaetota 10.437170 0.000212584 2 p__Verrucomicrobiota -7.396883 0.004337700 7.5.3 MAG level physeq_wild_mag &lt;- subset_samples(physeq_all, time_point == &quot;Wild&quot;) physeq_wild_mag &lt;- prune_taxa(taxa_sums(physeq_wild_mag)&gt;0, physeq_wild_mag) ancom_rand_output_mag_wild = ancombc2( data = physeq_wild_mag, assay_name = &quot;counts&quot;, tax_level = NULL, fix_formula = &quot;Population&quot;, p_adj_method = &quot;holm&quot;, pseudo_sens = TRUE, prv_cut = 0, lib_cut = 0, s0_perc = 0.05, group = NULL, struc_zero = FALSE, neg_lb = FALSE, alpha = 0.05, n_cl = 2, verbose = TRUE, global = FALSE, pairwise = FALSE, dunnet = FALSE, trend = FALSE, iter_control = list( tol = 1e-5, max_iter = 20, verbose = FALSE ), em_control = list(tol = 1e-5, max_iter = 100), mdfdr_control = list(fwer_ctrl_method = &quot;holm&quot;, B = 100), trend_control = NULL ) save(ancom_rand_output_mag_wild, file=&quot;data/ancom_rand_output_mag_wild.RData&quot;) load(&quot;data/ancom_rand_output_mag_wild.RData&quot;) Differentially abundant MAGs taxon lfc_PopulationHot_dry p_PopulationHot_dry domain phylum class order family genus species 1 AH1_2nd_12:bin_000012 -11.711444 0.0002281880 d__Bacteria Campylobacterota c__Campylobacteria Campylobacterales Helicobacteraceae Helicobacter_J 2 AH1_2nd_18:bin_000011 -8.232433 0.0048673134 d__Bacteria Bacillota c__Bacilli Erysipelotrichales Coprobacillaceae Coprobacillus 3 AH1_2nd_14:bin_000052 -7.975917 0.0090951404 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae Bacteroides 4 AH1_2nd_11:bin_000008 -7.396883 0.0158062531 d__Bacteria Verrucomicrobiota c__Verrucomicrobiae Verrucomicrobiales Akkermansiaceae Akkermansia 5 AH1_2nd_10:bin_000007 -7.099011 0.0206658101 d__Bacteria Bacillota_A c__Clostridia Lachnospirales 6 AH1_2nd_10:bin_000009 -6.919497 0.0229676440 d__Bacteria Desulfobacterota c__Desulfovibrionia Desulfovibrionales Desulfovibrionaceae Bilophila 7 AH1_2nd_15:bin_000004 -6.720938 0.0225394492 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae UMGS1251 8 AH1_2nd_7:bin_000027 -6.644411 0.0239859878 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Copromonas 9 AH1_2nd_17:bin_000020 -5.949921 0.0417531531 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Clostridium_Q 10 AH1_2nd_19:bin_000011 -5.742611 0.0409162435 d__Bacteria Desulfobacterota c__Desulfovibrionia Desulfovibrionales Desulfovibrionaceae Mailhella 11 LI1_2nd_5:bin_000023 6.621299 0.0413973594 d__Bacteria Pseudomonadota c__Alphaproteobacteria UBA3830 12 AH1_2nd_7:bin_000055 7.380090 0.0167421041 d__Bacteria Bacillota c__Bacilli Mycoplasmatales Mycoplasmoidaceae Ureaplasma 13 AH1_2nd_10:bin_000049 7.534728 0.0085610593 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Tannerellaceae Parabacteroides 14 LI1_2nd_5:bin_000037 8.429122 0.0034417084 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Marinifilaceae Odoribacter 15 AH1_2nd_11:bin_000004 9.469585 0.0008212177 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Hungatella_A 16 AH1_2nd_6:bin_000024 10.437170 0.0013800254 d__Bacteria Spirochaetota c__Brevinematia Brevinematales Brevinemataceae Brevinema 17 AH1_2nd_7:bin_000028 11.419184 0.0003141080 d__Bacteria Campylobacterota c__Campylobacteria Campylobacterales Helicobacteraceae NHYM01 Phyla of the significant MAGs in warm ancombc_rand_table_mag %&gt;% filter(lfc_PopulationHot_dry &gt; 0) %&gt;% count(phylum, name = &quot;sample_count&quot;) %&gt;% arrange(desc(sample_count)) phylum sample_count 1 Bacteroidota 2 2 Bacillota 1 3 Bacillota_A 1 4 Campylobacterota 1 5 Pseudomonadota 1 6 Spirochaetota 1 Phyla of the significant MAGs in cold ancombc_rand_table_mag %&gt;% filter(lfc_PopulationHot_dry &lt; 0) %&gt;% count(phylum, name = &quot;sample_count&quot;) %&gt;% arrange(desc(sample_count)) phylum sample_count 1 Bacillota_A 4 2 Desulfobacterota 2 3 Bacillota 1 4 Bacteroidota 1 5 Campylobacterota 1 6 Verrucomicrobiota 1 7.6 Functional capacity 7.6.1 Metabolic capacity index at functional level GIFTs_functions_community %&gt;% rowMeans() %&gt;% as_tibble(., rownames = &quot;sample&quot;) %&gt;% left_join(sample_metadata, by = join_by(sample == Tube_code)) %&gt;% filter(time_point == &quot;Wild&quot;) %&gt;% group_by(Population) %&gt;% summarise(MCI = mean(value), sd = sd(value)) # A tibble: 2 × 3 Population MCI sd &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; 1 Cold_wet 0.346 0.0194 2 Hot_dry 0.327 0.0244 MCI_element_wild &lt;- GIFTs_functions_community %&gt;% rowMeans() %&gt;% as_tibble(., rownames = &quot;sample&quot;) %&gt;% left_join(sample_metadata, by = join_by(sample == Tube_code)) %&gt;% filter(time_point == &quot;Wild&quot;) shapiro.test(MCI_element_wild$value) #normality test Shapiro-Wilk normality test data: MCI_element_wild$value W = 0.96385, p-value = 0.4503 var.test(value ~ Population, data = MCI_element_wild) F test to compare two variances data: value by Population F = 0.63604, num df = 17, denom df = 8, p-value = 0.4114 alternative hypothesis: true ratio of variances is not equal to 1 95 percent confidence interval: 0.1569001 1.9468860 sample estimates: ratio of variances 0.636035 t.test(value ~ Population, data = MCI_element_wild, var.equal = TRUE) Two Sample t-test data: value by Population t = 2.2416, df = 25, p-value = 0.03411 alternative hypothesis: true difference in means between group Cold_wet and group Hot_dry is not equal to 0 95 percent confidence interval: 0.001570698 0.037107300 sample estimates: mean in group Cold_wet mean in group Hot_dry 0.3461279 0.3267889 7.6.2 Differences in functional pathways element_gift_wild &lt;- element_gift %&gt;% filter(time_point == &quot;Wild&quot;) %&gt;% select(-time_point, -type) %&gt;% filter(rowSums(across(where(is.numeric), ~ . != 0)) &gt; 0) %&gt;% select(Tube_code, where( ~ is.numeric(.) &amp;&amp; sum(.) &gt; 0)) %&gt;% left_join(sample_metadata[c(1, 4)], by = &quot;Tube_code&quot;) significant_elements_wild &lt;- element_gift_wild %&gt;% pivot_longer(-c(Tube_code, Population), names_to = &quot;trait&quot;, values_to = &quot;value&quot;) %&gt;% group_by(trait) %&gt;% summarise(p_value = wilcox.test(value ~ Population)$p.value) %&gt;% mutate(p_adjust = p.adjust(p_value, method = &quot;BH&quot;)) %&gt;% filter(p_adjust &lt; 0.05) %&gt;% rownames_to_column(., &quot;Elements&quot;) %&gt;% select(-Elements) element_gift_sig_wild &lt;- element_gift_wild %&gt;% select(Tube_code, all_of(intersect( significant_elements_wild$trait, colnames(element_gift_wild) ))) %&gt;% left_join(., sample_metadata[c(1, 4)], by = join_by(Tube_code == Tube_code)) difference_table_wild &lt;- element_gift_sig_wild %&gt;% select(-Tube_code) %&gt;% group_by(Population) %&gt;% summarise(across(everything(), mean)) %&gt;% t() %&gt;% row_to_names(row_number = 1) %&gt;% as.data.frame() %&gt;% mutate_if(is.character, as.numeric) %&gt;% rownames_to_column(., &quot;Elements&quot;) %&gt;% left_join(., uniqueGIFT_db[c(1, 3, 4)], by = join_by(Elements == Code_element)) %&gt;% arrange(Function) %&gt;% mutate(Difference = Cold_wet - Hot_dry) %&gt;% mutate(group_color = ifelse(Difference &lt; 0, &quot;Hot&quot;, &quot;Cold&quot;)) difference_table_wild %&gt;% ggplot(aes(x = forcats::fct_reorder(Function, Difference),y = Difference,fill = group_color)) + geom_col() + scale_fill_manual(values = c(&#39;#008080&#39;, &quot;#d57d2c&quot;)) + geom_hline(yintercept = 0) + coord_flip() + theme( axis.text = element_text(size = 10), axis.title = element_text(size = 12), legend.position = &quot;right&quot;, legend.title = element_blank(), panel.background = element_blank(), panel.grid.major = element_line( size = 0.15, linetype = &#39;solid&#39;, colour = &quot;grey&quot; ) ) + xlab(&quot;Function&quot;) + ylab(&quot;Mean difference&quot;) "],["do-populations-mantain-a-different-gm-after-acclimation.html", "Chapter 8 Do populations mantain a different GM after acclimation? 8.1 Shapiro test 8.2 Alpha diversity 8.3 Beta diversity 8.4 Functional capacity", " Chapter 8 Do populations mantain a different GM after acclimation? load(&quot;data/data_27022025.Rdata&quot;) load(&quot;data/calculations_28022025.Rdata&quot;) 8.1 Shapiro test alpha_div %&gt;% pivot_longer(-sample, names_to = &quot;metric&quot;, values_to = &quot;value&quot;) %&gt;% left_join(., sample_metadata, by = join_by(sample == Tube_code)) %&gt;% filter(time_point ==&quot;Acclimation&quot;) %&gt;% filter(metric==&quot;richness&quot;) %&gt;% summarize(shapiro_p_value = shapiro.test(value)$p.value) %&gt;% pull(shapiro_p_value) [1] 0.2445285 alpha_div %&gt;% pivot_longer(-sample, names_to = &quot;metric&quot;, values_to = &quot;value&quot;) %&gt;% left_join(., sample_metadata, by = join_by(sample == Tube_code)) %&gt;% filter(time_point ==&quot;Acclimation&quot;) %&gt;% filter(metric==&quot;neutral&quot;) %&gt;% summarize(shapiro_p_value = shapiro.test(value)$p.value) %&gt;% pull(shapiro_p_value) [1] 0.4803302 alpha_div %&gt;% pivot_longer(-sample, names_to = &quot;metric&quot;, values_to = &quot;value&quot;) %&gt;% left_join(., sample_metadata, by = join_by(sample == Tube_code)) %&gt;% filter(time_point ==&quot;Acclimation&quot;) %&gt;% filter(metric==&quot;phylogenetic&quot;) %&gt;% summarize(shapiro_p_value = shapiro.test(value)$p.value) %&gt;% pull(shapiro_p_value) [1] 0.3335912 8.2 Alpha diversity alpha_div %&gt;% pivot_longer(-sample, names_to = &quot;metric&quot;, values_to = &quot;value&quot;) %&gt;% left_join(., sample_metadata, by = join_by(sample == Tube_code)) %&gt;% filter(time_point==&quot;Acclimation&quot;) %&gt;% mutate(metric=factor(metric,levels=c(&quot;richness&quot;,&quot;neutral&quot;,&quot;phylogenetic&quot;))) %&gt;% ggplot(aes(y = value, x = Population, group=Population, color=Population, fill=Population)) + geom_boxplot(outlier.shape = NA) + geom_jitter(alpha=0.5) + scale_color_manual(name=&quot;Population&quot;, breaks=c(&quot;Cold_wet&quot;,&quot;Hot_dry&quot;), labels=c(&quot;Cold&quot;,&quot;Hot&quot;), values=c(&#39;#008080&#39;, &quot;#d57d2c&quot;)) + scale_fill_manual(name=&quot;Population&quot;, breaks=c(&quot;Cold_wet&quot;,&quot;Hot_dry&quot;), labels=c(&quot;Cold&quot;,&quot;Hot&quot;), values=c(&#39;#00808050&#39;, &quot;#d57d2c50&quot;)) + facet_wrap(. ~ metric,scales = &quot;free&quot;) + coord_cartesian(xlim = c(1, NA)) + stat_compare_means(method=&quot;t.test&quot;,size=3, label.x=.58) + theme_classic() + theme( strip.background = element_blank(), panel.grid.minor.x = element_line(size = .1, color = &quot;grey&quot;), axis.title.x = element_blank(), axis.title.y = element_text(size=10), axis.text.x = element_blank(), # Increase plot size plot.title = element_text(size = 10), axis.text = element_text(size = 8), axis.title = element_text(size = 8) ) + ylab(&quot;Alpha diversity&quot;) 8.3 Beta diversity Number of samples used samples_to_keep_accli &lt;- sample_metadata %&gt;% filter(time_point == &quot;Acclimation&quot;) %&gt;% select(Tube_code) %&gt;% pull() subset_meta_accli &lt;- sample_metadata %&gt;% filter(time_point == &quot;Acclimation&quot;) length(samples_to_keep_accli) [1] 26 Richness richness_accli &lt;- as.matrix(beta_q0n$S) richness_accli &lt;- as.dist(richness_accli[rownames(richness_accli) %in% samples_to_keep_accli, colnames(richness_accli) %in% samples_to_keep_accli]) betadisper(richness_accli, subset_meta_accli$Population) %&gt;% permutest(., pairwise = TRUE) Permutation test for homogeneity of multivariate dispersions Permutation: free Number of permutations: 999 Response: Distances Df Sum Sq Mean Sq F N.Perm Pr(&gt;F) Groups 1 0.093187 0.093187 11.812 999 0.004 ** Residuals 24 0.189340 0.007889 --- Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 Pairwise comparisons: (Observed p-value below diagonal, permuted p-value above diagonal) Cold_wet Hot_dry Cold_wet 0.003 Hot_dry 0.0021532 adonis2(richness_accli ~ Population, data = subset_meta_accli %&gt;% arrange(match(Tube_code,labels(richness_accli))), permutations = 999) %&gt;% broom::tidy() %&gt;% tt() .table td.tinytable_css_ikyziayw6ievextf6r05, .table th.tinytable_css_ikyziayw6ievextf6r05 { border-bottom: solid #d3d8dc 0.1em; } .table td.tinytable_css_frbg7mkbsm4kv48vggl0, .table th.tinytable_css_frbg7mkbsm4kv48vggl0 { border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; } term df SumOfSqs R2 statistic p.value Model 1 1.639630 0.1929088 5.736415 0.001 Residual 24 6.859879 0.8070912 NA NA Total 25 8.499509 1.0000000 NA NA Neutral neutral_accli &lt;- as.matrix(beta_q1n$S) neutral_accli &lt;- as.dist(neutral_accli[rownames(neutral_accli) %in% samples_to_keep_accli, colnames(neutral_accli) %in% samples_to_keep_accli]) betadisper(neutral_accli, subset_meta_accli$Population) %&gt;% permutest(., pairwise = TRUE) Permutation test for homogeneity of multivariate dispersions Permutation: free Number of permutations: 999 Response: Distances Df Sum Sq Mean Sq F N.Perm Pr(&gt;F) Groups 1 0.05603 0.056026 4.1918 999 0.05 * Residuals 24 0.32077 0.013365 --- Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 Pairwise comparisons: (Observed p-value below diagonal, permuted p-value above diagonal) Cold_wet Hot_dry Cold_wet 0.042 Hot_dry 0.051717 adonis2(neutral_accli ~ Population, data = subset_meta_accli %&gt;% arrange(match(Tube_code,labels(neutral_accli))), permutations = 999) %&gt;% broom::tidy() %&gt;% tt() .table td.tinytable_css_nmvce8fw40ditobn0t5e, .table th.tinytable_css_nmvce8fw40ditobn0t5e { border-bottom: solid #d3d8dc 0.1em; } .table td.tinytable_css_9219ensdmx0dk9hm8ftj, .table th.tinytable_css_9219ensdmx0dk9hm8ftj { border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; } term df SumOfSqs R2 statistic p.value Model 1 1.961192 0.2493171 7.970889 0.001 Residual 24 5.905063 0.7506829 NA NA Total 25 7.866255 1.0000000 NA NA Phylogenetic phylo_accli &lt;- as.matrix(beta_q1p$S) phylo_accli &lt;- as.dist(phylo_accli[rownames(phylo_accli) %in% samples_to_keep_accli, colnames(phylo_accli) %in% samples_to_keep_accli]) betadisper(phylo_accli, subset_meta_accli$Population) %&gt;% permutest(., pairwise = TRUE) Permutation test for homogeneity of multivariate dispersions Permutation: free Number of permutations: 999 Response: Distances Df Sum Sq Mean Sq F N.Perm Pr(&gt;F) Groups 1 0.03637 0.036365 2.3087 999 0.147 Residuals 24 0.37804 0.015752 Pairwise comparisons: (Observed p-value below diagonal, permuted p-value above diagonal) Cold_wet Hot_dry Cold_wet 0.137 Hot_dry 0.14172 adonis2(phylo_accli ~ Population, data = subset_meta_accli %&gt;% arrange(match(Tube_code,labels(phylo_accli))), permutations = 999) %&gt;% broom::tidy() %&gt;% tt() .table td.tinytable_css_k810rky4s5ugx6j7ykr1, .table th.tinytable_css_k810rky4s5ugx6j7ykr1 { border-bottom: solid #d3d8dc 0.1em; } .table td.tinytable_css_eij79dsx7oaprbxzfovk, .table th.tinytable_css_eij79dsx7oaprbxzfovk { border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; } term df SumOfSqs R2 statistic p.value Model 1 0.2113395 0.1379515 3.84066 0.017 Residual 24 1.3206449 0.8620485 NA NA Total 25 1.5319844 1.0000000 NA NA NMDS richness_accli %&gt;% metaMDS(.,trymax = 500, k=2, verbosity=FALSE, trace=FALSE) %&gt;% vegan::scores() %&gt;% as_tibble(., rownames = &quot;sample&quot;) %&gt;% left_join(subset_meta_accli, by = join_by(sample == Tube_code))%&gt;% group_by(Population) %&gt;% mutate(x_cen = mean(NMDS1, na.rm = TRUE)) %&gt;% mutate(y_cen = mean(NMDS2, na.rm = TRUE)) %&gt;% ungroup() %&gt;% ggplot(., aes(x=NMDS1,y=NMDS2, color=Population)) + scale_color_manual(name=&quot;Population&quot;, breaks=c(&quot;Cold_wet&quot;,&quot;Hot_dry&quot;), labels=c(&quot;Cold&quot;,&quot;Hot&quot;), values=c(&#39;#008080&#39;,&quot;#d57d2c&quot;)) + scale_shape_manual(name=&quot;Type&quot;, breaks=c(&quot;Control&quot;, &quot;Hot_control&quot;, &quot;Treatment&quot;), labels=c(&quot;Cold-Cold&quot;, &quot;Hot-Hot&quot;, &quot;Cold-Hot&quot;), values=c(&quot;circle&quot;,&quot;square&quot;,&quot;triangle&quot;)) + geom_point(size=2) + geom_segment(aes(x=x_cen, y=y_cen, xend=NMDS1, yend=NMDS2), alpha=0.2) + labs(y = &quot;NMDS2&quot;, x=&quot;NMDS1 \\n Richness beta diversity&quot;) + theme_classic() + theme(legend.position=&quot;none&quot;) neutral_accli %&gt;% metaMDS(.,trymax = 500, k=2, verbosity=FALSE, trace=FALSE) %&gt;% vegan::scores() %&gt;% as_tibble(., rownames = &quot;sample&quot;) %&gt;% left_join(subset_meta_accli, by = join_by(sample == Tube_code))%&gt;% group_by(Population) %&gt;% mutate(x_cen = mean(NMDS1, na.rm = TRUE)) %&gt;% mutate(y_cen = mean(NMDS2, na.rm = TRUE)) %&gt;% ungroup() %&gt;% ggplot(., aes(x=NMDS1,y=NMDS2, color=Population, shape=type)) + scale_color_manual(name=&quot;Population&quot;, breaks=c(&quot;Cold_wet&quot;,&quot;Hot_dry&quot;), labels=c(&quot;Cold&quot;,&quot;Hot&quot;), values=c(&#39;#008080&#39;,&quot;#d57d2c&quot;)) + scale_shape_manual(name=&quot;Type&quot;, breaks=c(&quot;Control&quot;, &quot;Hot_control&quot;, &quot;Treatment&quot;), labels=c(&quot;Cold-Cold&quot;, &quot;Hot-Hot&quot;, &quot;Cold-Hot&quot;), values=c(&quot;circle&quot;,&quot;square&quot;,&quot;triangle&quot;)) + geom_point(size=2) + geom_segment(aes(x=x_cen, y=y_cen, xend=NMDS1, yend=NMDS2), alpha=0.2) + labs(y = &quot;NMDS2&quot;, x=&quot;NMDS1 \\n Neutral beta diversity&quot;) + theme_classic() + theme(legend.position=&quot;none&quot;) phylo_accli %&gt;% metaMDS(.,trymax = 500, k=2, verbosity=FALSE, trace=FALSE) %&gt;% vegan::scores() %&gt;% as_tibble(., rownames = &quot;sample&quot;) %&gt;% left_join(subset_meta_accli, by = join_by(sample == Tube_code))%&gt;% group_by(Population) %&gt;% mutate(x_cen = mean(NMDS1, na.rm = TRUE)) %&gt;% mutate(y_cen = mean(NMDS2, na.rm = TRUE)) %&gt;% ungroup() %&gt;% ggplot(., aes(x=NMDS1,y=NMDS2, color=Population)) + scale_color_manual(name=&quot;Population&quot;, breaks=c(&quot;Cold_wet&quot;,&quot;Hot_dry&quot;), labels=c(&quot;Cold&quot;,&quot;Hot&quot;), values=c(&#39;#008080&#39;,&quot;#d57d2c&quot;)) + scale_shape_manual(name=&quot;Type&quot;, breaks=c(&quot;Control&quot;, &quot;Hot_control&quot;, &quot;Treatment&quot;), labels=c(&quot;Cold-Cold&quot;, &quot;Hot-Hot&quot;, &quot;Cold-Hot&quot;), values=c(&quot;circle&quot;,&quot;square&quot;,&quot;triangle&quot;)) + geom_point(size=2) + geom_segment(aes(x=x_cen, y=y_cen, xend=NMDS1, yend=NMDS2), alpha=0.2) + labs(y= element_blank (),x=&quot;NMDS1 \\n Phylogenetic beta diversity&quot;) + theme_classic() + theme(legend.position=&quot;none&quot;) 8.4 Functional capacity 8.4.1 Metabolic capacity index at functional level GIFTs_functions_community %&gt;% rowMeans() %&gt;% as_tibble(., rownames = &quot;sample&quot;) %&gt;% left_join(sample_metadata, by = join_by(sample == Tube_code)) %&gt;% filter(time_point==&quot;Acclimation&quot;) %&gt;% group_by(Population) %&gt;% summarise(MCI = mean(value), sd = sd(value)) # A tibble: 2 × 3 Population MCI sd &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; 1 Cold_wet 0.329 0.0319 2 Hot_dry 0.348 0.0158 MCI_element_acclimation&lt;- GIFTs_functions_community %&gt;% rowMeans() %&gt;% as_tibble(., rownames = &quot;sample&quot;) %&gt;% left_join(sample_metadata, by = join_by(sample == Tube_code)) %&gt;% filter(time_point==&quot;Acclimation&quot;) shapiro.test(MCI_element_acclimation$value) #normality test Shapiro-Wilk normality test data: MCI_element_acclimation$value W = 0.92832, p-value = 0.0707 var.test(value ~ Population, data = MCI_element_acclimation) F test to compare two variances data: value by Population F = 4.0687, num df = 16, denom df = 8, p-value = 0.05027 alternative hypothesis: true ratio of variances is not equal to 1 95 percent confidence interval: 0.9981905 12.7140279 sample estimates: ratio of variances 4.06872 t.test(value ~ Population, data=MCI_element_acclimation, var.equal = TRUE) Two Sample t-test data: value by Population t = -1.633, df = 24, p-value = 0.1155 alternative hypothesis: true difference in means between group Cold_wet and group Hot_dry is not equal to 0 95 percent confidence interval: -0.042021638 0.004897661 sample estimates: mean in group Cold_wet mean in group Hot_dry 0.3292377 0.3477997 8.4.2 Differences in functional pathways element_gift_acclimation&lt;- element_gift %&gt;% filter(time_point==&quot;Acclimation&quot;) %&gt;% select(-time_point,-type) %&gt;% filter(rowSums(across(where(is.numeric), ~ . != 0)) &gt; 0) %&gt;% select(Tube_code, where(~ is.numeric(.) &amp;&amp; sum(.) &gt; 0)) %&gt;% left_join(sample_metadata[c(1, 4)], by = &quot;Tube_code&quot;) significant_elements_acclimation &lt;- element_gift_acclimation %&gt;% pivot_longer(-c(Tube_code,Population), names_to = &quot;trait&quot;, values_to = &quot;value&quot;) %&gt;% group_by(trait) %&gt;% summarise(p_value = wilcox.test(value ~ Population)$p.value) %&gt;% mutate(p_adjust=p.adjust(p_value, method=&quot;BH&quot;)) %&gt;% filter(p_adjust &lt; 0.05)%&gt;% rownames_to_column(., &quot;Elements&quot;) %&gt;% select(-Elements) element_gift_sig_acclimation &lt;- element_gift_acclimation %&gt;% select(Tube_code, all_of(intersect( significant_elements_acclimation$trait, colnames(element_gift_acclimation) ))) %&gt;% left_join(., sample_metadata[c(1, 4)], by = join_by(Tube_code == Tube_code)) difference_table_acclimation &lt;- element_gift_sig_acclimation %&gt;% select(-Tube_code) %&gt;% group_by(Population) %&gt;% summarise(across(everything(), mean)) %&gt;% t() %&gt;% row_to_names(row_number = 1) %&gt;% as.data.frame() %&gt;% mutate_if(is.character, as.numeric) %&gt;% rownames_to_column(., &quot;Elements&quot;) %&gt;% left_join(.,uniqueGIFT_db[c(1,3,4)],by = join_by(Elements == Code_element)) %&gt;% arrange(Function) %&gt;% mutate(Difference=Cold_wet-Hot_dry)%&gt;% mutate(group_color = ifelse(Difference &lt;0, &quot;Hot&quot;,&quot;Cold&quot;)) difference_table_acclimation %&gt;% ggplot(aes(x=forcats::fct_reorder(Function,Difference), y=Difference, fill=group_color)) + geom_col() + scale_fill_manual(values=c(&#39;#008080&#39;,&quot;#d57d2c&quot;)) + geom_hline(yintercept=0) + coord_flip()+ theme(axis.text = element_text(size = 10), axis.title = element_text(size = 12), legend.position = &quot;right&quot;, legend.title = element_blank(), panel.background = element_blank(), panel.grid.major = element_line(size = 0.15, linetype = &#39;solid&#39;, colour = &quot;grey&quot;))+ xlab(&quot;Function&quot;) + ylab(&quot;Mean difference&quot;) "],["faecal-microbiota-transplantation-fmt.html", "Chapter 9 Faecal Microbiota Transplantation (FMT) 9.1 What is the trend of the microbiota in each type after FMT? 9.2 Differences between acclimation and FMT1 across the three experimental groups 9.3 Differences between FMT1 and FMT2 across the three experimental groups", " Chapter 9 Faecal Microbiota Transplantation (FMT) load(&quot;data/data_27022025.Rdata&quot;) load(&quot;data/calculations_28022025.Rdata&quot;) 9.1 What is the trend of the microbiota in each type after FMT? 9.1.1 Alpha diversity label_map &lt;- c( &quot;Control&quot; = &quot;Cold-control&quot;, &quot;Treatment&quot; = &quot;Cold-intervention&quot;, &quot;Hot_control&quot; = &quot;Warm-control&quot;, &quot;richness&quot; = &quot;Species Richness&quot;, &quot;neutral&quot; = &quot;Neutral Diversity&quot;, &quot;phylogenetic&quot; = &quot;Phylogenetic Diversity&quot; ) alpha_div %&gt;% pivot_longer(-sample, names_to = &quot;metric&quot;, values_to = &quot;value&quot;) %&gt;% left_join(., sample_metadata, by = join_by(sample == Tube_code)) %&gt;% filter(time_point %in% c(&quot;FMT1&quot;,&quot;Acclimation&quot;, &quot;FMT2&quot;)) %&gt;% mutate(metric = factor(metric, levels = c(&quot;richness&quot;, &quot;neutral&quot;, &quot;phylogenetic&quot;))) %&gt;% ggplot(aes(y = value, x = time_point, color = type, fill = type)) + geom_boxplot(outlier.shape = NA, show.legend = FALSE) + geom_point(position = position_jitterdodge(jitter.width = 0.2, dodge.width = 0.8), alpha = 0.5, show.legend = FALSE) + facet_grid(metric ~ type, scales = &quot;free_y&quot;, labeller = labeller(metric = label_map, type = label_map))+ # facet_nested(.~metric+type, labeller = labeller(metric = label_map, type = label_map))+ scale_color_manual(name=&quot;Type&quot;, breaks=c(&quot;Control&quot;, &quot;Hot_control&quot;, &quot;Treatment&quot;), labels=c(&quot;Cold-Cold&quot;, &quot;Hot-Hot&quot;, &quot;Cold-Hot&quot;), values=c(&quot;#4477AA&quot;,&quot;#d57d2c&quot;,&quot;#76b183&quot;)) + scale_fill_manual(name=&quot;Type&quot;, breaks=c(&quot;Control&quot;, &quot;Hot_control&quot;, &quot;Treatment&quot;), labels=c(&quot;Cold-Cold&quot;, &quot;Hot-Hot&quot;, &quot;Cold-Hot&quot;), values=c(&quot;#4477AA50&quot;,&quot;#d57d2c50&quot;,&quot;#76b18350&quot;)) + theme_minimal() + theme(axis.text.x=element_text(size=10))+ labs(x = &quot;Time Point&quot;, y = &quot;value&quot;) alpha_div_meta &lt;- alpha_div %&gt;% left_join(sample_metadata, by = join_by(sample == Tube_code)) %&gt;% filter(time_point==&quot;FMT1&quot;|time_point==&quot;Acclimation&quot;|time_point==&quot;FMT2&quot;) Richness Modelq0GLMMNB &lt;- glmer.nb(richness ~ type*time_point+(1|individual), data = alpha_div_meta) summary(Modelq0GLMMNB) Generalized linear mixed model fit by maximum likelihood (Laplace Approximation) [&#39;glmerMod&#39;] Family: Negative Binomial(5.7695) ( log ) Formula: richness ~ type * time_point + (1 | individual) Data: alpha_div_meta AIC BIC logLik deviance df.resid 757.7 783.7 -367.8 735.7 68 Scaled residuals: Min 1Q Median 3Q Max -2.01194 -0.49654 0.06198 0.55787 1.90952 Random effects: Groups Name Variance Std.Dev. individual (Intercept) 0.02586 0.1608 Number of obs: 79, groups: individual, 27 Fixed effects: Estimate Std. Error z value Pr(&gt;|z|) (Intercept) 3.9089 0.1696 23.046 &lt;2e-16 *** typeHot_control 0.5568 0.2283 2.439 0.0147 * typeTreatment -0.1233 0.2297 -0.537 0.5916 time_pointFMT1 -0.3140 0.2167 -1.449 0.1473 time_pointFMT2 0.1487 0.2173 0.684 0.4937 typeHot_control:time_pointFMT1 -0.1155 0.2983 -0.387 0.6987 typeTreatment:time_pointFMT1 0.4309 0.3068 1.404 0.1602 typeHot_control:time_pointFMT2 -0.3876 0.2988 -1.297 0.1945 typeTreatment:time_pointFMT2 0.4093 0.2990 1.369 0.1710 --- Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 Correlation of Fixed Effects: (Intr) typHt_ typTrt t_FMT1 t_FMT2 tH_:_FMT1 tT:_FMT1 tH_:_FMT2 typHt_cntrl -0.741 typeTretmnt -0.721 0.535 tim_pntFMT1 -0.677 0.503 0.497 tim_pntFMT2 -0.702 0.520 0.507 0.532 typH_:_FMT1 0.496 -0.671 -0.362 -0.727 -0.389 typTr:_FMT1 0.482 -0.357 -0.664 -0.707 -0.378 0.515 typH_:_FMT2 0.515 -0.684 -0.370 -0.388 -0.730 0.516 0.276 typTr:_FMT2 0.498 -0.370 -0.686 -0.384 -0.719 0.280 0.511 0.524 emmeans::emmeans(Modelq0GLMMNB, pairwise ~ type) $emmeans type emmean SE df asymp.LCL asymp.UCL Control 3.85 0.1050 Inf 3.65 4.06 Hot_control 4.24 0.0996 Inf 4.05 4.44 Treatment 4.01 0.1030 Inf 3.81 4.21 Results are averaged over the levels of: time_point Results are given on the log (not the response) scale. Confidence level used: 0.95 $contrasts contrast estimate SE df z.ratio p.value Control - Hot_control -0.389 0.144 Inf -2.711 0.0184 Control - Treatment -0.157 0.145 Inf -1.083 0.5246 Hot_control - Treatment 0.232 0.143 Inf 1.627 0.2342 Results are averaged over the levels of: time_point Results are given on the log (not the response) scale. P value adjustment: tukey method for comparing a family of 3 estimates emmeans::emmeans(Modelq0GLMMNB, pairwise ~ time_point) $emmeans time_point emmean SE df asymp.LCL asymp.UCL Acclimation 4.05 0.0938 Inf 3.87 4.24 FMT1 3.84 0.0949 Inf 3.66 4.03 FMT2 4.21 0.0895 Inf 4.03 4.38 Results are averaged over the levels of: type Results are given on the log (not the response) scale. Confidence level used: 0.95 $contrasts contrast estimate SE df z.ratio p.value Acclimation - FMT1 0.209 0.123 Inf 1.700 0.2050 Acclimation - FMT2 -0.156 0.121 Inf -1.286 0.4028 FMT1 - FMT2 -0.365 0.122 Inf -2.997 0.0077 Results are averaged over the levels of: type Results are given on the log (not the response) scale. P value adjustment: tukey method for comparing a family of 3 estimates Neutral Modelq1n &lt;- nlme::lme(neutral ~ type*time_point, random = ~ 1 | individual, data = alpha_div_meta) summary(Modelq1n) Linear mixed-effects model fit by REML Data: alpha_div_meta AIC BIC logLik 563.2664 587.9998 -270.6332 Random effects: Formula: ~1 | individual (Intercept) Residual StdDev: 4.551076 9.160157 Fixed effects: neutral ~ type * time_point Value Std.Error DF t-value p-value (Intercept) 21.343055 3.603126 46 5.923483 0.0000 typeHot_control 23.258307 4.960549 24 4.688656 0.0001 typeTreatment -3.944072 4.960549 24 -0.795088 0.4344 time_pointFMT1 -3.983722 4.472618 46 -0.890691 0.3777 time_pointFMT2 2.374489 4.472618 46 0.530895 0.5980 typeHot_control:time_pointFMT1 -14.877819 6.216964 46 -2.393101 0.0208 typeTreatment:time_pointFMT1 11.253000 6.325237 46 1.779064 0.0818 typeHot_control:time_pointFMT2 -14.775497 6.216964 46 -2.376642 0.0217 typeTreatment:time_pointFMT2 20.108022 6.216964 46 3.234380 0.0023 Correlation: (Intr) typHt_ typTrt t_FMT1 t_FMT2 tH_:_FMT1 tT:_FMT1 tH_:_FMT2 typeHot_control -0.726 typeTreatment -0.726 0.528 time_pointFMT1 -0.663 0.481 0.481 time_pointFMT2 -0.663 0.481 0.481 0.534 typeHot_control:time_pointFMT1 0.477 -0.649 -0.346 -0.719 -0.384 typeTreatment:time_pointFMT1 0.469 -0.340 -0.638 -0.707 -0.378 0.509 typeHot_control:time_pointFMT2 0.477 -0.649 -0.346 -0.384 -0.719 0.518 0.272 typeTreatment:time_pointFMT2 0.477 -0.346 -0.649 -0.384 -0.719 0.276 0.509 0.518 Standardized Within-Group Residuals: Min Q1 Med Q3 Max -2.1324340 -0.7088533 0.0456110 0.6569569 1.9681295 Number of Observations: 79 Number of Groups: 27 emmeans::emmeans(Modelq1n, pairwise ~ type) $emmeans type emmean SE df lower.CL upper.CL Control 20.8 2.36 26 16.0 25.7 Hot_control 34.2 2.33 24 29.4 39.0 Treatment 27.3 2.36 24 22.4 32.2 Results are averaged over the levels of: time_point Degrees-of-freedom method: containment Confidence level used: 0.95 $contrasts contrast estimate SE df t.ratio p.value Control - Hot_control -13.37 3.31 24 -4.038 0.0013 Control - Treatment -6.51 3.33 24 -1.952 0.1461 Hot_control - Treatment 6.86 3.31 24 2.073 0.1170 Results are averaged over the levels of: time_point Degrees-of-freedom method: containment P value adjustment: tukey method for comparing a family of 3 estimates emmeans::emmeans(Modelq1n, pairwise ~ time_point) $emmeans time_point emmean SE df lower.CL upper.CL Acclimation 27.8 2.01 24 23.6 31.9 FMT1 22.6 2.01 24 18.4 26.7 FMT2 31.9 1.97 24 27.9 36.0 Results are averaged over the levels of: type Degrees-of-freedom method: containment Confidence level used: 0.95 $contrasts contrast estimate SE df t.ratio p.value Acclimation - FMT1 5.19 2.55 46 2.034 0.1156 Acclimation - FMT2 -4.15 2.52 46 -1.646 0.2372 FMT1 - FMT2 -9.34 2.52 46 -3.703 0.0016 Results are averaged over the levels of: type Degrees-of-freedom method: containment P value adjustment: tukey method for comparing a family of 3 estimates Phylogenetic Model_phylo &lt;- nlme::lme(phylogenetic ~ type*time_point, random = ~ 1 | individual, data = alpha_div_meta) summary(Model_phylo) Linear mixed-effects model fit by REML Data: alpha_div_meta AIC BIC logLik 269.7976 294.5311 -123.8988 Random effects: Formula: ~1 | individual (Intercept) Residual StdDev: 0.4986226 1.145917 Fixed effects: phylogenetic ~ type * time_point Value Std.Error DF t-value p-value (Intercept) 5.256251 0.4407611 46 11.925398 0.0000 typeHot_control 1.266332 0.6064636 24 2.088060 0.0476 typeTreatment 0.283689 0.6064636 24 0.467776 0.6442 time_pointFMT1 -0.837008 0.5590601 46 -1.497169 0.1412 time_pointFMT2 -0.481515 0.5590601 46 -0.861293 0.3935 typeHot_control:time_pointFMT1 -1.410952 0.7774021 46 -1.814958 0.0761 typeTreatment:time_pointFMT1 -0.545877 0.7906304 46 -0.690432 0.4934 typeHot_control:time_pointFMT2 -0.585100 0.7774021 46 -0.752635 0.4555 typeTreatment:time_pointFMT2 0.056099 0.7774021 46 0.072162 0.9428 Correlation: (Intr) typHt_ typTrt t_FMT1 t_FMT2 tH_:_FMT1 tT:_FMT1 tH_:_FMT2 typeHot_control -0.727 typeTreatment -0.727 0.528 time_pointFMT1 -0.676 0.492 0.492 time_pointFMT2 -0.676 0.492 0.492 0.533 typeHot_control:time_pointFMT1 0.486 -0.663 -0.353 -0.719 -0.383 typeTreatment:time_pointFMT1 0.478 -0.348 -0.652 -0.707 -0.377 0.509 typeHot_control:time_pointFMT2 0.486 -0.663 -0.353 -0.383 -0.719 0.517 0.271 typeTreatment:time_pointFMT2 0.486 -0.353 -0.663 -0.383 -0.719 0.276 0.509 0.517 Standardized Within-Group Residuals: Min Q1 Med Q3 Max -2.81722823 -0.52018811 -0.06481484 0.55835817 2.23628404 Number of Observations: 79 Number of Groups: 27 emmeans::emmeans(Model_phylo, pairwise ~ type) $emmeans type emmean SE df lower.CL upper.CL Control 4.82 0.280 26 4.24 5.39 Hot_control 5.42 0.276 24 4.85 5.99 Treatment 4.94 0.280 24 4.36 5.52 Results are averaged over the levels of: time_point Degrees-of-freedom method: containment Confidence level used: 0.95 $contrasts contrast estimate SE df t.ratio p.value Control - Hot_control -0.601 0.393 24 -1.527 0.2963 Control - Treatment -0.120 0.396 24 -0.304 0.9505 Hot_control - Treatment 0.481 0.393 24 1.221 0.4525 Results are averaged over the levels of: time_point Degrees-of-freedom method: containment P value adjustment: tukey method for comparing a family of 3 estimates emmeans::emmeans(Model_phylo, pairwise ~ time_point) $emmeans time_point emmean SE df lower.CL upper.CL Acclimation 5.77 0.245 24 5.27 6.28 FMT1 4.28 0.245 24 3.78 4.79 FMT2 5.12 0.241 24 4.62 5.61 Results are averaged over the levels of: type Degrees-of-freedom method: containment Confidence level used: 0.95 $contrasts contrast estimate SE df t.ratio p.value Acclimation - FMT1 1.489 0.319 46 4.666 0.0001 Acclimation - FMT2 0.658 0.316 46 2.085 0.1042 FMT1 - FMT2 -0.831 0.316 46 -2.635 0.0302 Results are averaged over the levels of: type Degrees-of-freedom method: containment P value adjustment: tukey method for comparing a family of 3 estimates 9.1.1.1 Beta diversity Number of samples used samples_to_keep_post7 &lt;- sample_metadata %&gt;% filter(time_point==&quot;FMT1&quot;|time_point==&quot;Acclimation&quot;|time_point==&quot;FMT2&quot;) %&gt;% select(Tube_code) %&gt;% pull() subset_meta_post7 &lt;- sample_metadata %&gt;% filter(time_point==&quot;FMT1&quot;|time_point==&quot;Acclimation&quot;|time_point==&quot;FMT2&quot;) subset_meta_post7$time_point&lt;-as.factor(subset_meta_post7$time_point) subset_meta_post7$type&lt;-as.factor(subset_meta_post7$type) length(samples_to_keep_post7) [1] 79 Richness richness_post7 &lt;- as.matrix(beta_q0n$S) richness_post7 &lt;- as.dist(richness_post7[rownames(richness_post7) %in% samples_to_keep_post7, colnames(richness_post7) %in% samples_to_keep_post7]) betadisper(richness_post7, subset_meta_post7$type) %&gt;% permutest(., pairwise = TRUE) Permutation test for homogeneity of multivariate dispersions Permutation: free Number of permutations: 999 Response: Distances Df Sum Sq Mean Sq F N.Perm Pr(&gt;F) Groups 2 0.06454 0.032268 4.9753 999 0.01 ** Residuals 76 0.49290 0.006485 --- Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 Pairwise comparisons: (Observed p-value below diagonal, permuted p-value above diagonal) Control Hot_control Treatment Control 0.0160000 0.697 Hot_control 0.0119513 0.002 Treatment 0.6817089 0.0035106 adonis2(richness_post7 ~ type*time_point, data = subset_meta_post7 %&gt;% arrange(match(Tube_code,labels(richness_post7))), permutations = 999, strata = subset_meta_post7 %&gt;% arrange(match(Tube_code,labels(richness_post7))) %&gt;% pull(individual), by=&quot;terms&quot;) %&gt;% broom::tidy() %&gt;% tt() .table td.tinytable_css_oydgv29n7n7c4hnrlw1m, .table th.tinytable_css_oydgv29n7n7c4hnrlw1m { border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; } .table td.tinytable_css_fbrvn0jbx1bu9m4c05zg, .table th.tinytable_css_fbrvn0jbx1bu9m4c05zg { border-bottom: solid #d3d8dc 0.1em; } term df SumOfSqs R2 statistic p.value type 2 3.120806 0.11961754 5.546155 0.001 time_point 2 1.703776 0.06530413 3.027874 0.001 type:time_point 4 1.570884 0.06021051 1.395852 0.001 Residual 70 19.694403 0.75486782 NA NA Total 78 26.089870 1.00000000 NA NA Neutral neutral_post7 &lt;- as.matrix(beta_q1n$S) neutral_post7 &lt;- as.dist(neutral_post7[rownames(neutral_post7) %in% samples_to_keep_post7, colnames(neutral_post7) %in% samples_to_keep_post7]) betadisper(neutral_post7, subset_meta_post7$type) %&gt;% permutest(., pairwise = TRUE) Permutation test for homogeneity of multivariate dispersions Permutation: free Number of permutations: 999 Response: Distances Df Sum Sq Mean Sq F N.Perm Pr(&gt;F) Groups 2 0.06738 0.033689 3.8309 999 0.031 * Residuals 76 0.66833 0.008794 --- Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 Pairwise comparisons: (Observed p-value below diagonal, permuted p-value above diagonal) Control Hot_control Treatment Control 0.2150000 0.186 Hot_control 0.1985046 0.009 Treatment 0.1611083 0.0069718 adonis2(neutral_post7 ~ type*time_point, data = subset_meta_post7 %&gt;% arrange(match(Tube_code,labels(neutral_post7))), permutations = 999, strata = subset_meta_post7 %&gt;% arrange(match(Tube_code,labels(neutral_post7))) %&gt;% pull(individual), by=&quot;terms&quot;) %&gt;% broom::tidy() %&gt;% tt() .table td.tinytable_css_lhmgx8xdcpwakcekrsmo, .table th.tinytable_css_lhmgx8xdcpwakcekrsmo { border-bottom: solid #d3d8dc 0.1em; } .table td.tinytable_css_exxtqajgn8zasuols284, .table th.tinytable_css_exxtqajgn8zasuols284 { border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; } term df SumOfSqs R2 statistic p.value type 2 3.705559 0.14953527 7.609355 0.001 time_point 2 2.217656 0.08949199 4.553951 0.001 type:time_point 4 1.813192 0.07317011 1.861693 0.001 Residual 70 17.044094 0.68780262 NA NA Total 78 24.780501 1.00000000 NA NA Phylogenetic phylo_post7 &lt;- as.matrix(beta_q1p$S) phylo_post7 &lt;- as.dist(phylo_post7[rownames(phylo_post7) %in% samples_to_keep_post7, colnames(phylo_post7) %in% samples_to_keep_post7]) betadisper(phylo_post7, subset_meta_post7$type) %&gt;% permutest(., pairwise = TRUE) Permutation test for homogeneity of multivariate dispersions Permutation: free Number of permutations: 999 Response: Distances Df Sum Sq Mean Sq F N.Perm Pr(&gt;F) Groups 2 0.05438 0.027192 2.1499 999 0.116 Residuals 76 0.96123 0.012648 Pairwise comparisons: (Observed p-value below diagonal, permuted p-value above diagonal) Control Hot_control Treatment Control 0.704000 0.164 Hot_control 0.697512 0.083 Treatment 0.155309 0.083221 adonis2(phylo_post7 ~ type*time_point, data = subset_meta_post7 %&gt;% arrange(match(Tube_code,labels(phylo_post7))), permutations = 999, strata = subset_meta_post7 %&gt;% arrange(match(Tube_code,labels(phylo_post7))) %&gt;% pull(individual), by=&quot;terms&quot;) %&gt;% broom::tidy() %&gt;% tt() .table td.tinytable_css_b8kaowhncd8u1vz0g0c1, .table th.tinytable_css_b8kaowhncd8u1vz0g0c1 { border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; } .table td.tinytable_css_1pmzbp3kfedhut72ncqa, .table th.tinytable_css_1pmzbp3kfedhut72ncqa { border-bottom: solid #d3d8dc 0.1em; } term df SumOfSqs R2 statistic p.value type 2 0.2941494 0.07500331 3.592254 0.001 time_point 2 0.5528857 0.14097688 6.752032 0.001 type:time_point 4 0.2088312 0.05324856 1.275159 0.147 Residual 70 2.8659522 0.73077126 NA NA Total 78 3.9218184 1.00000000 NA NA dbRDA #Richness cca_ord &lt;- capscale(formula = richness_post7 ~ subset_meta_post7$time_point* subset_meta_post7$type) CAP_df &lt;- as.data.frame(vegan::scores(cca_ord, display = &quot;sites&quot;)) %&gt;% rownames_to_column(&#39;Tube_code&#39;) %&gt;% left_join(subset_meta_post7, by = &#39;Tube_code&#39;) %&gt;% column_to_rownames(&#39;Tube_code&#39;)%&gt;% mutate(x_cen = mean(CAP1, na.rm = TRUE)) %&gt;% mutate(y_cen = mean(CAP2, na.rm = TRUE)) biplot_scores &lt;- as.data.frame(vegan::scores(cca_ord, display = &quot;bp&quot;)) %&gt;% rownames_to_column(&quot;Variable&quot;) biplot_scores$Variable &lt;- recode(biplot_scores$Variable, &quot;subset_meta_post7$time_pointFMT1&quot; = &quot;FMT1&quot;, &quot;subset_meta_post7$time_pointFMT2&quot;=&quot;FMT2&quot;, &quot;subset_meta_post7$typeHot_control&quot;=&quot;Warm-control&quot;, &quot;subset_meta_post7$typeTreatment&quot; = &quot;Cold-intervention&quot;, &quot;subset_meta_post7$time_pointFMT1:subset_meta_post7$typeHot_control&quot;=&quot;FMT1 Warm-control&quot;, &quot;subset_meta_post7$time_pointFMT2:subset_meta_post7$typeHot_control&quot;=&quot;FMT2 Warm-control&quot;, &quot;subset_meta_post7$time_pointFMT1:subset_meta_post7$typeTreatment&quot; = &quot;FMT1 Cold-intervention&quot;, &quot;subset_meta_post7$time_pointFMT2:subset_meta_post7$typeTreatment&quot; = &quot;FMT2 Cold-intervention&quot;) beta_richness_nmds_post7 &lt;-CAP_df %&gt;% group_by(type, time_point) %&gt;% mutate(x_cen = mean(CAP1, na.rm = TRUE)) %&gt;% mutate(y_cen = mean(CAP2, na.rm = TRUE)) %&gt;% ungroup() %&gt;% ggplot(., aes(x=CAP1,y=CAP2, color=type,shape = time_point)) + scale_color_manual(name=&quot;Type&quot;, breaks=c(&quot;Control&quot;,&quot;Hot_control&quot;, &quot;Treatment&quot;), labels=c(&quot;Cold-control&quot;,&quot;Warm-control&quot;, &quot;Cold-intervention&quot;), values=c(&quot;#4477AA&quot;,&quot;#d57d2c&quot;, &quot;#76b183&quot;)) + scale_fill_manual(name=&quot;Type&quot;, breaks=c(&quot;Control&quot;,&quot;Hot_control&quot;, &quot;Treatment&quot;), labels=c(&quot;Cold-control&quot;,&quot;Warm-control&quot;, &quot;Cold-intervention&quot;), values=c(&quot;#4477AA50&quot;,&quot;#d57d2c50&quot;,&quot;#76b18350&quot;)) + scale_x_discrete(labels = c(&quot;Control&quot; = &quot;Cold-Cold&quot;, &quot;Hot_control&quot; = &quot;Hot-Hot&quot;, &quot;Treatment&quot; = &quot;Cold-Hot&quot;)) + geom_point(size=2) + geom_hline(yintercept = 0, linetype = &quot;dotted&quot;) + geom_vline(xintercept = 0, linetype = &quot;dotted&quot;) + geom_segment(aes(x=x_cen, y=y_cen, xend=CAP1, yend=CAP2), alpha=0.2) + geom_segment(data = biplot_scores, aes(x = 0, y = 0, xend = CAP1, yend = CAP2), inherit.aes = FALSE, arrow = arrow(length = unit(0.2, &quot;cm&quot;)), color = &quot;black&quot;) + geom_text(data = biplot_scores, aes(x = CAP1, y = CAP2, label = Variable), inherit.aes = FALSE, color = &quot;black&quot;, vjust = -0.5, hjust = 0.5)+ theme_classic() #Neutral cca_ord &lt;- capscale(formula = neutral_post7 ~ subset_meta_post7$time_point* subset_meta_post7$type) CAP_df &lt;- as.data.frame(vegan::scores(cca_ord, display = &quot;sites&quot;)) %&gt;% rownames_to_column(&#39;Tube_code&#39;) %&gt;% left_join(subset_meta_post7, by = &#39;Tube_code&#39;) %&gt;% column_to_rownames(&#39;Tube_code&#39;)%&gt;% mutate(x_cen = mean(CAP1, na.rm = TRUE)) %&gt;% mutate(y_cen = mean(CAP2, na.rm = TRUE)) biplot_scores &lt;- as.data.frame(vegan::scores(cca_ord, display = &quot;bp&quot;)) %&gt;% rownames_to_column(&quot;Variable&quot;) biplot_scores$Variable &lt;- recode(biplot_scores$Variable, &quot;subset_meta_post7$time_pointFMT1&quot; = &quot;FMT1&quot;, &quot;subset_meta_post7$time_pointFMT2&quot;=&quot;FMT2&quot;, &quot;subset_meta_post7$typeHot_control&quot;=&quot;Warm-control&quot;, &quot;subset_meta_post7$typeTreatment&quot; = &quot;Cold-intervention&quot;, &quot;subset_meta_post7$time_pointFMT1:subset_meta_post7$typeHot_control&quot;=&quot;FMT1 Warm-control&quot;, &quot;subset_meta_post7$time_pointFMT2:subset_meta_post7$typeHot_control&quot;=&quot;FMT2 Warm-control&quot;, &quot;subset_meta_post7$time_pointFMT1:subset_meta_post7$typeTreatment&quot; = &quot;FMT1 Cold-intervention&quot;, &quot;subset_meta_post7$time_pointFMT2:subset_meta_post7$typeTreatment&quot; = &quot;FMT2 Cold-intervention&quot;) beta_neutral_nmds_post7 &lt;- CAP_df %&gt;% group_by(type, time_point) %&gt;% mutate(x_cen = mean(CAP1, na.rm = TRUE)) %&gt;% mutate(y_cen = mean(CAP2, na.rm = TRUE)) %&gt;% ungroup() %&gt;% ggplot(., aes(x=CAP1,y=CAP2, color=type,shape = time_point)) + scale_color_manual(name=&quot;Type&quot;, breaks=c(&quot;Control&quot;,&quot;Hot_control&quot;, &quot;Treatment&quot;), labels=c(&quot;Cold-control&quot;,&quot;Warm-control&quot;, &quot;Cold-intervention&quot;), values=c(&quot;#4477AA&quot;,&quot;#d57d2c&quot;, &quot;#76b183&quot;)) + scale_fill_manual(name=&quot;Type&quot;, breaks=c(&quot;Control&quot;,&quot;Hot_control&quot;, &quot;Treatment&quot;), labels=c(&quot;Cold-control&quot;,&quot;Warm-control&quot;, &quot;Cold-intervention&quot;), values=c(&quot;#4477AA50&quot;,&quot;#d57d2c50&quot;,&quot;#76b18350&quot;)) + scale_x_discrete(labels = c(&quot;Control&quot; = &quot;Cold-Cold&quot;, &quot;Hot_control&quot; = &quot;Hot-Hot&quot;, &quot;Treatment&quot; = &quot;Cold-Hot&quot;)) + geom_point(size=2) + geom_hline(yintercept = 0, linetype = &quot;dotted&quot;) + geom_vline(xintercept = 0, linetype = &quot;dotted&quot;) + geom_segment(aes(x=x_cen, y=y_cen, xend=CAP1, yend=CAP2), alpha=0.2) + geom_segment(data = biplot_scores, aes(x = 0, y = 0, xend = CAP1, yend = CAP2), inherit.aes = FALSE, arrow = arrow(length = unit(0.2, &quot;cm&quot;)), color = &quot;black&quot;) + geom_text(data = biplot_scores, aes(x = CAP1, y = CAP2, label = Variable), inherit.aes = FALSE, color = &quot;black&quot;, vjust = -0.5, hjust = 0.5)+ theme_classic() #Phylogenetic cca_ord &lt;- capscale(formula = phylo_post7 ~ subset_meta_post7$time_point* subset_meta_post7$type) CAP_df &lt;- as.data.frame(vegan::scores(cca_ord, display = &quot;sites&quot;)) %&gt;% rownames_to_column(&#39;Tube_code&#39;) %&gt;% left_join(subset_meta_post7, by = &#39;Tube_code&#39;) %&gt;% column_to_rownames(&#39;Tube_code&#39;)%&gt;% mutate(x_cen = mean(CAP1, na.rm = TRUE)) %&gt;% mutate(y_cen = mean(CAP2, na.rm = TRUE)) biplot_scores &lt;- as.data.frame(vegan::scores(cca_ord, display = &quot;bp&quot;)) %&gt;% rownames_to_column(&quot;Variable&quot;) biplot_scores$Variable &lt;- recode(biplot_scores$Variable, &quot;subset_meta_post7$time_pointFMT1&quot; = &quot;FMT1&quot;, &quot;subset_meta_post7$time_pointFMT2&quot;=&quot;FMT2&quot;, &quot;subset_meta_post7$typeHot_control&quot;=&quot;Warm-control&quot;, &quot;subset_meta_post7$typeTreatment&quot; = &quot;Cold-intervention&quot;, &quot;subset_meta_post7$time_pointFMT1:subset_meta_post7$typeHot_control&quot;=&quot;FMT1 Warm-control&quot;, &quot;subset_meta_post7$time_pointFMT2:subset_meta_post7$typeHot_control&quot;=&quot;FMT2 Warm-control&quot;, &quot;subset_meta_post7$time_pointFMT1:subset_meta_post7$typeTreatment&quot; = &quot;FMT1 Cold-intervention&quot;, &quot;subset_meta_post7$time_pointFMT2:subset_meta_post7$typeTreatment&quot; = &quot;FMT2 Cold-intervention&quot;) beta_phylogenetic_nmds_post7 &lt;- CAP_df %&gt;% group_by(type, time_point) %&gt;% mutate(x_cen = mean(CAP1, na.rm = TRUE)) %&gt;% mutate(y_cen = mean(CAP2, na.rm = TRUE)) %&gt;% ungroup() %&gt;% ggplot(., aes(x=CAP1,y=CAP2, color=type,shape = time_point)) + scale_color_manual(name=&quot;Type&quot;, breaks=c(&quot;Control&quot;,&quot;Hot_control&quot;, &quot;Treatment&quot;), labels=c(&quot;Cold-control&quot;,&quot;Warm-control&quot;, &quot;Cold-intervention&quot;), values=c(&quot;#4477AA&quot;,&quot;#d57d2c&quot;, &quot;#76b183&quot;)) + scale_fill_manual(name=&quot;Type&quot;, breaks=c(&quot;Control&quot;,&quot;Hot_control&quot;, &quot;Treatment&quot;), labels=c(&quot;Cold-control&quot;,&quot;Warm-control&quot;, &quot;Cold-intervention&quot;), values=c(&quot;#4477AA50&quot;,&quot;#d57d2c50&quot;,&quot;#76b18350&quot;)) + scale_x_discrete(labels = c(&quot;Control&quot; = &quot;Cold-Cold&quot;, &quot;Hot_control&quot; = &quot;Hot-Hot&quot;, &quot;Treatment&quot; = &quot;Cold-Hot&quot;)) + geom_point(size=2) + geom_hline(yintercept = 0, linetype = &quot;dotted&quot;) + geom_vline(xintercept = 0, linetype = &quot;dotted&quot;) + geom_segment(aes(x=x_cen, y=y_cen, xend=CAP1, yend=CAP2), alpha=0.2) + geom_segment(data = biplot_scores, aes(x = 0, y = 0, xend = CAP1, yend = CAP2), inherit.aes = FALSE, arrow = arrow(length = unit(0.2, &quot;cm&quot;)), color = &quot;black&quot;) + geom_text(data = biplot_scores, aes(x = CAP1, y = CAP2, label = Variable), inherit.aes = FALSE, color = &quot;black&quot;, vjust = -0.5, hjust = 0.5)+ theme_classic() ggarrange(beta_richness_nmds_post7, beta_neutral_nmds_post7, beta_phylogenetic_nmds_post7, ncol=3, nrow=1, common.legend = TRUE, legend=&quot;right&quot;) beta_neutral_nmds_post7 9.2 Differences between acclimation and FMT1 across the three experimental groups 9.2.1 Functional differences CI from acclimation to FMT1 significant_element&lt;-element_gift %&gt;% filter(time_point %in% c(&quot;FMT1&quot;,&quot;Acclimation&quot;) &amp; type == &quot;Treatment&quot;) %&gt;% select(-time_point, -type) %&gt;% filter(rowSums(across(where(is.numeric), ~ . != 0)) &gt; 0) %&gt;% select(Tube_code, where( ~ is.numeric(.) &amp;&amp; sum(.) &gt; 0)) %&gt;% left_join(sample_metadata[c(1, 10)], by = &quot;Tube_code&quot;) %&gt;% pivot_longer(-c(Tube_code, time_point), names_to = &quot;trait&quot;, values_to = &quot;value&quot;) %&gt;% group_by(trait) %&gt;% summarise(p_value = wilcox.test(value ~ time_point)$p.value) %&gt;% mutate(p_adjust = p.adjust(p_value, method = &quot;BH&quot;)) %&gt;% filter(p_adjust &lt; 0.05) %&gt;% remove_rownames() %&gt;% left_join(., uniqueGIFT_db, by=join_by(&quot;trait&quot;==&quot;Code_element&quot;)) element_gift_sig &lt;- element_gift %&gt;% select(Tube_code, all_of(intersect( significant_element$trait, colnames(element_gift) ))) %&gt;% left_join(., sample_metadata[c(1, 7, 10)], by = join_by(Tube_code == Tube_code)) %&gt;% filter(time_point %in% c(&quot;FMT1&quot;,&quot;Acclimation&quot;))%&gt;% filter(type==&quot;Treatment&quot;) difference_table &lt;- element_gift_sig %&gt;% select(-Tube_code, -type) %&gt;% group_by(time_point) %&gt;% summarise(across(everything(), mean)) %&gt;% t() %&gt;% row_to_names(row_number = 1) %&gt;% as.data.frame() %&gt;% mutate_if(is.character, as.numeric) %&gt;% rownames_to_column(., &quot;Elements&quot;) %&gt;% left_join(.,uniqueGIFT_db[c(1,3,4)],by = join_by(Elements == Code_element)) %&gt;% arrange(Function) %&gt;% mutate(Difference=Acclimation-FMT1)%&gt;% mutate(group_color = ifelse(Difference &lt;0,&quot;FMT1&quot;, &quot;Acclimation&quot;)) difference_table %&gt;% ggplot(aes(x=forcats::fct_reorder(Function,Difference), y=Difference, fill=group_color)) + geom_col() + scale_fill_manual(values=c(&quot;#76b183&quot;,&#39;#008080&#39;)) + geom_hline(yintercept=0) + coord_flip()+ theme(axis.text = element_text(size = 10), axis.title = element_text(size = 12), legend.position = &quot;right&quot;, legend.title = element_blank(), panel.background = element_blank(), panel.grid.major = element_line(size = 0.15, linetype = &#39;solid&#39;, colour = &quot;grey&quot;))+ xlab(&quot;Function&quot;) + ylab(&quot;Mean difference&quot;) CC from acclimation to FMT1 significant_element&lt;-element_gift %&gt;% filter(time_point %in% c(&quot;FMT1&quot;,&quot;Acclimation&quot;) &amp; type == &quot;Control&quot;) %&gt;% select(-time_point, -type) %&gt;% filter(rowSums(across(where(is.numeric), ~ . != 0)) &gt; 0) %&gt;% select(Tube_code, where( ~ is.numeric(.) &amp;&amp; sum(.) &gt; 0)) %&gt;% left_join(sample_metadata[c(1, 10)], by = &quot;Tube_code&quot;) %&gt;% pivot_longer(-c(Tube_code, time_point), names_to = &quot;trait&quot;, values_to = &quot;value&quot;) %&gt;% group_by(trait) %&gt;% summarise(p_value = wilcox.test(value ~ time_point)$p.value) %&gt;% mutate(p_adjust = p.adjust(p_value, method = &quot;BH&quot;)) %&gt;% filter(p_adjust &lt; 0.05) %&gt;% remove_rownames() %&gt;% left_join(., uniqueGIFT_db, by=join_by(&quot;trait&quot;==&quot;Code_element&quot;)) element_gift_sig &lt;- element_gift %&gt;% select(Tube_code, all_of(intersect( significant_element$trait, colnames(element_gift) ))) %&gt;% left_join(., sample_metadata[c(1, 7, 10)], by = join_by(Tube_code == Tube_code)) %&gt;% filter(time_point %in% c(&quot;FMT1&quot;,&quot;Acclimation&quot;))%&gt;% filter(type==&quot;Control&quot;) difference_table &lt;- element_gift_sig %&gt;% select(-Tube_code, -type) %&gt;% group_by(time_point) %&gt;% summarise(across(everything(), mean)) %&gt;% t() %&gt;% row_to_names(row_number = 1) %&gt;% as.data.frame() %&gt;% mutate_if(is.character, as.numeric) %&gt;% rownames_to_column(., &quot;Elements&quot;) %&gt;% left_join(.,uniqueGIFT_db[c(1,3,4)],by = join_by(Elements == Code_element)) %&gt;% arrange(Function) %&gt;% mutate(Difference=Acclimation-FMT1)%&gt;% mutate(group_color = ifelse(Difference &lt;0,&quot;FMT1&quot;, &quot;Acclimation&quot;)) difference_table %&gt;% ggplot(aes(x=forcats::fct_reorder(Function,Difference), y=Difference, fill=group_color)) + geom_col() + scale_fill_manual(values=c(&quot;#4477AA&quot;,&#39;#008080&#39;)) + geom_hline(yintercept=0) + coord_flip()+ theme(axis.text = element_text(size = 10), axis.title = element_text(size = 12), legend.position = &quot;right&quot;, legend.title = element_blank(), panel.background = element_blank(), panel.grid.major = element_line(size = 0.15, linetype = &#39;solid&#39;, colour = &quot;grey&quot;))+ xlab(&quot;Function&quot;) + ylab(&quot;Mean difference&quot;) WC from acclimation to FMT1 element_gift %&gt;% filter(time_point %in% c(&quot;FMT1&quot;,&quot;Acclimation&quot;) &amp; type == &quot;Hot_control&quot;) %&gt;% select(-time_point, -type) %&gt;% filter(rowSums(across(where(is.numeric), ~ . != 0)) &gt; 0) %&gt;% select(Tube_code, where( ~ is.numeric(.) &amp;&amp; sum(.) &gt; 0)) %&gt;% left_join(sample_metadata[c(1, 10)], by = &quot;Tube_code&quot;) %&gt;% pivot_longer(-c(Tube_code, time_point), names_to = &quot;trait&quot;, values_to = &quot;value&quot;) %&gt;% group_by(trait) %&gt;% summarise(p_value = wilcox.test(value ~ time_point)$p.value) %&gt;% mutate(p_adjust = p.adjust(p_value, method = &quot;BH&quot;)) %&gt;% filter(p_adjust &lt; 0.05) %&gt;% remove_rownames() %&gt;% left_join(., uniqueGIFT_db, by=join_by(&quot;trait&quot;==&quot;Code_element&quot;)) # A tibble: 0 × 6 # ℹ 6 variables: trait &lt;chr&gt;, p_value &lt;dbl&gt;, p_adjust &lt;dbl&gt;, Domain &lt;chr&gt;, Function &lt;chr&gt;, Element &lt;chr&gt; 9.2.2 Differential abundances 9.2.2.1 CI: acclimation vs FMT1 Structural zeros struc &lt;- structural_zeros %&gt;% filter(present==&quot;Acclimation&quot;)%&gt;% count(phylum, name = &quot;Acclimation&quot;) %&gt;% arrange(desc(Acclimation)) structural_zeros %&gt;% filter(present==&quot;FMT1&quot;)%&gt;% count(phylum, name = &quot;FMT1&quot;) %&gt;% arrange(desc(FMT1)) %&gt;% full_join(., struc, by=&quot;phylum&quot;) %&gt;% mutate(across(everything(), ~ ifelse(is.na(.), 0, .))) %&gt;% tt() .table td.tinytable_css_wtn04eozpsrdcsh04dvl, .table th.tinytable_css_wtn04eozpsrdcsh04dvl { border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; } .table td.tinytable_css_1eh1o8e6yr6eab14jtgb, .table th.tinytable_css_1eh1o8e6yr6eab14jtgb { border-bottom: solid #d3d8dc 0.1em; } phylum FMT1 Acclimation p__Bacteroidota 33 11 p__Bacillota_A 25 16 p__Pseudomonadota 5 8 p__Desulfobacterota 4 2 p__Bacillota 3 9 p__Campylobacterota 2 0 p__Cyanobacteriota 2 2 p__Bacillota_C 1 1 p__Elusimicrobiota 1 0 p__Verrucomicrobiota 0 2 p__Actinomycetota 0 1 p__Bacillota_B 0 1 phylo_samples &lt;- sample_metadata %&gt;% filter(type == &quot;Treatment&quot; &amp; time_point %in% c(&quot;Acclimation&quot;, &quot;FMT1&quot;) )%&gt;% column_to_rownames(&quot;Tube_code&quot;) %&gt;% sample_data() phylo_genome &lt;- genome_counts_filt %&gt;% filter(!genome %in% structural_zeros$genome) %&gt;% select(one_of(c(&quot;genome&quot;,rownames(phylo_samples)))) %&gt;% filter(rowSums(across(where(is.numeric), ~ . != 0)) &gt; 0) %&gt;% select(genome, where(~ is.numeric(.) &amp;&amp; sum(.) &gt; 0)) %&gt;% column_to_rownames(&quot;genome&quot;) %&gt;% otu_table(., taxa_are_rows = TRUE) phylo_taxonomy &lt;- genome_metadata %&gt;% filter(genome %in% rownames(phylo_genome)) %&gt;% column_to_rownames(&quot;genome&quot;) %&gt;% dplyr::select(domain,phylum,class,order,family,genus,species) %&gt;% as.matrix() %&gt;% tax_table() physeq_genome_filtered &lt;- phyloseq(phylo_genome, phylo_taxonomy, phylo_samples) ancom_rand_output_ci_accli_fmt1 = ancombc2(data = physeq_genome_filtered, assay_name = &quot;counts&quot;, tax_level = NULL, fix_formula = &quot;time_point&quot;, p_adj_method = &quot;holm&quot;, pseudo_sens = TRUE, prv_cut =0, lib_cut = 0, s0_perc = 0.05, group = NULL, struc_zero = FALSE, neg_lb = FALSE, alpha = 0.05, n_cl = 2, verbose = TRUE, global = FALSE, pairwise = FALSE, dunnet = FALSE, trend = FALSE, iter_control = list(tol = 1e-5, max_iter = 20, verbose = FALSE), em_control = list(tol = 1e-5, max_iter = 100), mdfdr_control = list(fwer_ctrl_method = &quot;holm&quot;, B = 100), trend_control = NULL) save(ancom_rand_output_ci_accli_fmt1, file=&quot;data/ancom_rand_output_ci_accli_fmt1.RData&quot;) load(&quot;data/ancom_rand_output_ci_accli_fmt1.RData&quot;) ancom_rand_output_ci_accli_fmt1$res %&gt;% dplyr::select(taxon, lfc_time_pointFMT1, p_time_pointFMT1) %&gt;% filter(p_time_pointFMT1 &lt; 0.05) %&gt;% left_join(., genome_metadata, by=join_by(&quot;taxon&quot;==&quot;genome&quot;)) %&gt;% select(2,3,7,8,9) %&gt;% tt() .table td.tinytable_css_vfb615moeko3h0ivbcfu, .table th.tinytable_css_vfb615moeko3h0ivbcfu { border-bottom: solid #d3d8dc 0.1em; } .table td.tinytable_css_fes2lxyjz09k7kk8f3wq, .table th.tinytable_css_fes2lxyjz09k7kk8f3wq { border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; } lfc_time_pointFMT1 p_time_pointFMT1 order family genus -1.8462367 0.0286090261 o__Bacteroidales f__Rikenellaceae g__Alistipes -1.0602262 0.0256488405 o__Campylobacterales f__Helicobacteraceae g__Helicobacter_J -2.1031126 0.0039988943 o__Mycoplasmatales f__Mycoplasmoidaceae g__Mycoplasmoides -1.1937360 0.0258952249 o__Lachnospirales f__Lachnospiraceae g__Hungatella_A 1.1869122 0.0246642650 o__Oscillospirales f__Ruminococcaceae g__Negativibacillus -3.0923830 0.0007999100 o__Erysipelotrichales f__Coprobacillaceae g__Coprobacillus -1.2524541 0.0482834029 o__Opitutales f__LL51 g__ -1.2157647 0.0209074696 o__Bacteroidales f__Bacteroidaceae g__Bacteroides -2.1668443 0.0092167448 o__Gastranaerophilales f__Gastranaerophilaceae g__Scatousia 1.8856206 0.0022558153 o__Lachnospirales f__Lachnospiraceae g__ -1.2811877 0.0290779856 o__Bacteroidales f__Marinifilaceae g__Odoribacter -0.9960276 0.0294171519 o__Selenomonadales f__ g__ -1.9064058 0.0121488844 o__Lachnospirales f__Lachnospiraceae g__CAG-95 -2.0548675 0.0169404933 o__Christensenellales f__ g__ -1.8189515 0.0001244128 o__Bacteroidales f__Marinifilaceae g__Odoribacter 1.0549620 0.0254528501 o__Erysipelotrichales f__Erysipelotrichaceae g__Clostridium_AQ -1.4937622 0.0113515485 o__Bacteroidales f__Tannerellaceae g__Parabacteroides_B 1.9263692 0.0019001955 o__Bacteroidales f__Tannerellaceae g__Parabacteroides taxonomy &lt;- data.frame(physeq_genome_filtered@tax_table) %&gt;% rownames_to_column(., &quot;taxon&quot;) %&gt;% mutate_at(vars(order, phylum, family, genus, species), ~ str_replace(., &quot;[dpcofgs]__&quot;, &quot;&quot;)) ancombc_rand_table_mag &lt;- ancom_rand_output_ci_accli_fmt1$res %&gt;% dplyr::select(taxon, lfc_time_pointFMT1, p_time_pointFMT1) %&gt;% #filter(p_time_pointFMT1 &lt; 0.05) %&gt;% dplyr::arrange(p_time_pointFMT1) %&gt;% merge(., taxonomy, by=&quot;taxon&quot;) %&gt;% mutate_at(vars(phylum, species), ~ str_replace(., &quot;[dpcofgs]__&quot;, &quot;&quot;))%&gt;% dplyr::arrange(lfc_time_pointFMT1) ancombc_rand_table_mag taxon lfc_time_pointFMT1 p_time_pointFMT1 domain phylum class order family genus species 1 AH1_2nd_18:bin_000011 -3.092382977 0.0007999100 d__Bacteria Bacillota c__Bacilli Erysipelotrichales Coprobacillaceae Coprobacillus 2 AH1_2nd_2:bin_000003 -2.648161454 1.0000000000 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae JAAYNV01 3 AH1_2nd_1:bin_000003 -2.166844294 0.0092167448 d__Bacteria Cyanobacteriota c__Vampirovibrionia Gastranaerophilales Gastranaerophilaceae Scatousia 4 AH1_2nd_12:bin_000041 -2.103112630 0.0039988943 d__Bacteria Bacillota c__Bacilli Mycoplasmatales Mycoplasmoidaceae Mycoplasmoides 5 LI1_2nd_4:bin_000001 -2.054867498 0.0169404933 d__Bacteria Bacillota_A c__Clostridia Christensenellales 6 AH1_2nd_8:bin_000006 -1.906405809 0.0121488844 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae CAG-95 7 AH1_2nd_10:bin_000041 -1.846236702 0.0286090261 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Rikenellaceae Alistipes 8 LI1_2nd_4:bin_000026 -1.818951547 0.0001244128 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Marinifilaceae Odoribacter 9 AH1_2nd_10:bin_000040 -1.684889357 1.0000000000 d__Bacteria Bacillota_A c__Clostridia Oscillospirales Ruminococcaceae UBA866 10 AH1_2nd_19:bin_000011 -1.494726874 0.0611399521 d__Bacteria Desulfobacterota c__Desulfovibrionia Desulfovibrionales Desulfovibrionaceae Mailhella 11 LI1_2nd_7:bin_000042 -1.493762171 0.0113515485 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Tannerellaceae Parabacteroides_B 12 AH1_2nd_19:bin_000072 -1.478268874 1.0000000000 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae 13 AH1_2nd_14:bin_000015 -1.316753957 0.1424337358 d__Bacteria Bacillota_A c__Clostridia Christensenellales UBA3700 14 AH1_2nd_1:bin_000039 -1.281187716 0.0290779856 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Marinifilaceae Odoribacter 15 AH1_2nd_19:bin_000052 -1.252454135 0.0482834029 d__Bacteria Verrucomicrobiota c__Verrucomicrobiae Opitutales LL51 16 AH1_2nd_19:bin_000067 -1.215764663 0.0209074696 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae Bacteroides Bacteroides ovatus 17 AH1_2nd_14:bin_000003 -1.193736037 0.0258952249 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Hungatella_A 18 AH1_2nd_18:bin_000024 -1.188731159 0.0611452591 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Marinifilaceae Odoribacter 19 AH1_2nd_9:bin_000002 -1.169209782 0.0986538496 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae Phocaeicola 20 AH1_2nd_12:bin_000012 -1.060226151 0.0256488405 d__Bacteria Campylobacterota c__Campylobacteria Campylobacterales Helicobacteraceae Helicobacter_J 21 AH1_2nd_5:bin_000001 -0.996027576 0.0294171519 d__Bacteria Bacillota_C c__Negativicutes Selenomonadales 22 LI1_2nd_9:bin_000022 -0.906243708 0.0903292981 d__Bacteria Bacillota_A c__Clostridia Oscillospirales Oscillospiraceae Oscillibacter 23 LI1_2nd_5:bin_000013 -0.829604319 0.1527144304 d__Bacteria Bacillota_A c__Clostridia Christensenellales DTU072 24 AH1_2nd_12:bin_000019 -0.825145331 0.2042360107 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae 25 AH1_2nd_15:bin_000013 -0.710209451 0.1048903811 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Ventrimonas 26 AH1_2nd_14:bin_000052 -0.703781720 0.0836982274 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae Bacteroides 27 AH1_2nd_18:bin_000041 -0.639488073 0.1767526356 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae Bacteroides 28 AH1_2nd_10:bin_000069 -0.638476918 0.1756392299 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae Bacteroides 29 LI1_2nd_8:bin_000019 -0.626058321 0.1873913604 d__Bacteria Bacillota_A c__Clostridia Christensenellales UBA3700 30 LI1_2nd_8:bin_000048 -0.604410683 0.1802313047 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae 31 AH1_2nd_18:bin_000039 -0.565089676 0.1344504970 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Rikenellaceae Alistipes 32 AH1_2nd_15:bin_000001 -0.558917827 0.2775215236 d__Bacteria Pseudomonadota c__Alphaproteobacteria Rhizobiales Rhizobiaceae Agrobacterium Agrobacterium tumefaciens_H 33 LI1_2nd_1:bin_000014 -0.541762433 0.1908782875 d__Bacteria Desulfobacterota c__Desulfovibrionia Desulfovibrionales Desulfovibrionaceae 34 AH1_2nd_17:bin_000020 -0.529683120 0.1375747225 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Clostridium_Q 35 AH1_2nd_5:bin_000037 -0.412726510 0.3766702653 d__Bacteria Bacillota_A c__Clostridia Oscillospirales Oscillospiraceae Pseudoflavonifractor 36 LI1_2nd_8:bin_000030 -0.401958059 1.0000000000 d__Bacteria Actinomycetota c__Actinomycetia Mycobacteriales Mycobacteriaceae Corynebacterium 37 AH1_2nd_8:bin_000027 -0.372699058 0.3929034840 d__Bacteria Bacillota c__Bacilli Erysipelotrichales Erysipelotrichaceae NSJ-61 38 AH1_2nd_20:bin_000016 -0.367964849 0.4149817314 d__Bacteria Bacillota c__Bacilli Erysipelotrichales Erysipelotrichaceae 39 AH1_2nd_15:bin_000004 -0.363232962 0.4110273927 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae UMGS1251 40 AH1_2nd_20:bin_000061 -0.298108663 0.5019948183 d__Bacteria Bacillota c__Bacilli Lactobacillales Enterococcaceae Enterococcus 41 AH1_2nd_19:bin_000050 -0.289132629 0.4961320864 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae 42 AH1_2nd_14:bin_000063 -0.241075741 0.4791871743 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Blautia_A 43 AH1_2nd_12:bin_000018 -0.233278943 1.0000000000 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Rikenellaceae Alistipes 44 AH1_2nd_14:bin_000014 -0.191639074 0.5967459585 d__Bacteria Bacillota_A c__Clostridia Oscillospirales Oscillospiraceae Marseille-P3106 45 AH1_2nd_5:bin_000069 -0.113362480 0.7480149690 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae Bacteroides 46 AH1_2nd_5:bin_000004 -0.099553779 0.7766158242 d__Bacteria Bacillota_A c__Clostridia Oscillospirales Acutalibacteraceae 47 AH1_2nd_19:bin_000053 -0.064499564 0.8633425245 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae CAG-56 48 AH1_2nd_5:bin_000023 -0.061255060 0.8885990209 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Blautia 49 LI1_2nd_4:bin_000052 -0.059179520 0.8521593297 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Enterocloster 50 AH1_2nd_7:bin_000011 -0.022457084 0.9485771277 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Lacrimispora 51 AH1_2nd_7:bin_000036 -0.020211734 0.9505096511 d__Bacteria Bacillota_A c__Clostridia Oscillospirales Oscillospiraceae Intestinimonas 52 AH1_2nd_8:bin_000007 -0.015776367 0.9642381855 d__Bacteria Bacillota c__Bacilli Erysipelotrichales Erysipelotrichaceae Dielma 53 AH1_2nd_18:bin_000033 0.007439884 0.9829288918 d__Bacteria Bacillota c__Bacilli Erysipelotrichales Coprobacillaceae Beduini 54 AH1_2nd_13:bin_000049 0.007967211 0.9806505882 d__Bacteria Bacillota_A c__Clostridia Christensenellales UBA3700 55 AH1_2nd_20:bin_000075 0.011269835 0.9740329519 d__Bacteria Desulfobacterota c__Desulfovibrionia Desulfovibrionales Desulfovibrionaceae Mailhella 56 AH1_2nd_1:bin_000048 0.022520775 0.9415136028 d__Bacteria Bacillota_A c__Clostridia Peptostreptococcales Anaerovoracaceae 57 AH1_2nd_15:bin_000009 0.050832331 0.8809383092 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Acetatifactor 58 LI1_2nd_3:bin_000015 0.100951096 0.7675764926 d__Bacteria Bacillota c__Bacilli Staphylococcales Staphylococcaceae Staphylococcus Staphylococcus shinii 59 AH1_2nd_12:bin_000008 0.126572793 0.7200772057 d__Bacteria Bacillota c__Bacilli Lactobacillales Streptococcaceae Lactococcus Lactococcus formosensis 60 AH1_2nd_6:bin_000046 0.148642513 0.7391254614 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae Bacteroides 61 AH1_2nd_15:bin_000043 0.162855259 0.6651236201 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae Bacteroides 62 AH1_2nd_14:bin_000032 0.203085142 0.5604935050 d__Bacteria Bacillota_C c__Negativicutes Selenomonadales Massilibacillaceae 63 AH1_2nd_11:bin_000028 0.215783039 0.6001649151 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae Bacteroides 64 AH1_2nd_19:bin_000055 0.241280202 0.5605744834 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Tannerellaceae Parabacteroides 65 AH1_2nd_1:bin_000015 0.248363743 0.5365901183 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae MGBC136627 66 LI1_2nd_1:bin_000006 0.256745957 0.4812257132 d__Bacteria Bacillota_B c__Peptococcia Peptococcales Peptococcaceae RGIG6463 67 LI1_2nd_4:bin_000041 0.275507297 0.4771321706 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Clostridium_Q 68 AH1_2nd_8:bin_000051 0.409027135 0.2422754936 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae Bacteroides 69 LI1_2nd_3:bin_000003 0.426226521 0.3026156952 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Rikenellaceae Alistipes 70 AH1_2nd_11:bin_000005 0.439025859 0.3469594997 d__Bacteria Fusobacteriota c__Fusobacteriia Fusobacteriales Fusobacteriaceae Fusobacterium_A Fusobacterium_A ulcerans 71 LI1_2nd_8:bin_000016 0.449295795 0.2725481226 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Rikenellaceae Rikenella 72 AH1_2nd_9:bin_000047 0.468455027 0.1949450949 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae Bacteroides 73 AH1_2nd_16:bin_000045 0.477451825 0.3015275739 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Rikenellaceae Alistipes 74 AH1_2nd_1:bin_000002 0.672741699 0.0931456403 d__Bacteria Bacillota_A c__Clostridia Oscillospirales Ruminococcaceae Fournierella 75 LI1_2nd_4:bin_000034 0.683769866 0.1489775197 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae Bacteroides Bacteroides thetaiotaomicron 76 LI1_2nd_8:bin_000070 0.715744805 0.0557648829 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae Bacteroides 77 LI1_2nd_8:bin_000079 0.759315418 0.1169813633 d__Bacteria Pseudomonadota c__Gammaproteobacteria Enterobacterales Enterobacteriaceae Citrobacter_A Citrobacter_A amalonaticus 78 LI1_2nd_7:bin_000009 0.778541309 0.0871078423 d__Bacteria Bacillota_A c__Clostridia Oscillospirales Ruminococcaceae Anaerotruncus 79 LI1_2nd_7:bin_000078 0.818012844 0.2168112843 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Copromonas 80 AH1_2nd_7:bin_000027 0.898315397 1.0000000000 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Copromonas 81 AH1_2nd_7:bin_000041 0.917073058 0.0786806187 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae 82 AH1_2nd_7:bin_000004 0.930226516 0.0840011143 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Eisenbergiella 83 AH1_2nd_16:bin_000058 1.019983368 1.0000000000 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Enterocloster 84 LI1_2nd_7:bin_000016 1.054961961 0.0254528501 d__Bacteria Bacillota c__Bacilli Erysipelotrichales Erysipelotrichaceae Clostridium_AQ 85 AH1_2nd_16:bin_000025 1.186912214 0.0246642650 d__Bacteria Bacillota_A c__Clostridia Oscillospirales Ruminococcaceae Negativibacillus 86 AH1_2nd_1:bin_000034 1.307370374 0.1316029549 d__Bacteria Bacillota c__Bacilli Erysipelotrichales Erysipelotrichaceae Dielma 87 AH1_2nd_12:bin_000007 1.669993570 1.0000000000 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae 88 AH1_2nd_1:bin_000023 1.885620641 0.0022558153 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae 89 LI1_2nd_8:bin_000064 1.926369204 0.0019001955 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Tannerellaceae Parabacteroides 90 AH1_2nd_20:bin_000042 1.959227946 1.0000000000 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Hungatella colors_alphabetic &lt;- read_tsv(&quot;https://raw.githubusercontent.com/earthhologenome/EHI_taxonomy_colour/main/ehi_phylum_colors.tsv&quot;) %&gt;% mutate_at(vars(phylum), ~ str_replace(., &quot;[dpcofgs]__&quot;, &quot;&quot;)) %&gt;% right_join(taxonomy, by=join_by(phylum == phylum)) %&gt;% dplyr::select(phylum, colors) %&gt;% mutate(colors = str_c(colors, &quot;80&quot;)) %&gt;% #add 80% alpha unique() %&gt;% dplyr::arrange(phylum) tax_table &lt;- as.data.frame(unique(ancombc_rand_table_mag$phylum)) colnames(tax_table)[1] &lt;- &quot;phylum&quot; tax_color &lt;- merge(tax_table, colors_alphabetic, by=&quot;phylum&quot;)%&gt;% dplyr::arrange(phylum) %&gt;% dplyr::select(colors) %&gt;% pull() ancombc_rand_table_mag %&gt;% mutate( genome = factor(taxon, levels = ancombc_rand_table_mag$taxon), significance = ifelse(p_time_pointFMT1 &lt; 0.05, phylum, NA) # Set non-significant to NA (not mapped in legend) ) %&gt;% ggplot() + # Plot significant points with legend geom_point(aes(x = lfc_time_pointFMT1, y = -log10(p_time_pointFMT1), color = significance), size = 3, alpha = 0.7, na.rm = TRUE) + # Plot non-significant points separately without legend geom_point(data = filter(ancombc_rand_table_mag, p_time_pointFMT1 &gt;= 0.05), aes(x = lfc_time_pointFMT1, y = -log10(p_time_pointFMT1)), color = &quot;grey70&quot;, size = 3, alpha = 0.7, show.legend = FALSE) + scale_color_manual( values = tax_color, # Only keeps phylum colors in legend na.translate = FALSE # Removes NA (non-significant) from legend ) + geom_hline(yintercept = -log10(0.05), linetype = &quot;dashed&quot;) + geom_vline(xintercept = 0, linetype = &quot;dashed&quot;) + scale_y_continuous(limits = c(0, 10)) + xlab(&quot;log2FoldChange&quot;) + ylab(&quot;-log10(p-value)&quot;) + guides(color = guide_legend(title = &quot;Phylum&quot;)) + theme_minimal()+ annotate(&quot;text&quot;, x = min(ancombc_rand_table_mag$lfc_time_pointFMT1), y = 3, label = &quot;FMT1&quot;, hjust = 0, size = 4, fontface = &quot;bold&quot;) + annotate(&quot;text&quot;, x = max(ancombc_rand_table_mag$lfc_time_pointFMT1), y = 3, label = &quot;Acclimation&quot;, hjust = 1, size = 4, fontface = &quot;bold&quot;) Phyla of the significant MAGs in acclimation ancombc_rand_table_mag%&gt;% filter(p_time_pointFMT1 &lt; 0.05) %&gt;% filter(lfc_time_pointFMT1&gt;0) %&gt;% count(phylum, name = &quot;sample_count&quot;) %&gt;% arrange(desc(sample_count)) phylum sample_count 1 Bacillota_A 2 2 Bacillota 1 3 Bacteroidota 1 Phyla of the significant MAGs in FMT1 ancombc_rand_table_mag%&gt;% filter(p_time_pointFMT1 &lt; 0.05) %&gt;% filter(lfc_time_pointFMT1&lt;0) %&gt;% count(phylum, name = &quot;sample_count&quot;) %&gt;% arrange(desc(sample_count)) phylum sample_count 1 Bacteroidota 5 2 Bacillota_A 3 3 Bacillota 2 4 Bacillota_C 1 5 Campylobacterota 1 6 Cyanobacteriota 1 7 Verrucomicrobiota 1 9.2.2.2 CC: acclimation vs FMT1 Structural zeros struc &lt;- structural_zeros %&gt;% filter(present==&quot;Acclimation&quot;)%&gt;% count(phylum, name = &quot;Acclimation&quot;) %&gt;% arrange(desc(Acclimation)) structural_zeros %&gt;% filter(present==&quot;FMT1&quot;)%&gt;% count(phylum, name = &quot;FMT1&quot;) %&gt;% arrange(desc(FMT1)) %&gt;% full_join(., struc, by=&quot;phylum&quot;) %&gt;% mutate(across(everything(), ~ ifelse(is.na(.), 0, .))) %&gt;% tt() .table td.tinytable_css_uysn0ay6l1mattn7p9lt, .table th.tinytable_css_uysn0ay6l1mattn7p9lt { border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; } .table td.tinytable_css_epdeumqp9ugqq8xy6ljn, .table th.tinytable_css_epdeumqp9ugqq8xy6ljn { border-bottom: solid #d3d8dc 0.1em; } phylum FMT1 Acclimation p__Bacillota_A 15 20 p__Bacteroidota 10 8 p__Bacillota 4 8 p__Bacillota_C 3 0 p__Actinomycetota 2 0 p__Desulfobacterota 1 1 p__Fusobacteriota 1 0 p__Pseudomonadota 1 6 p__Cyanobacteriota 0 3 p__Verrucomicrobiota 0 3 p__Campylobacterota 0 1 phylo_samples &lt;- sample_metadata %&gt;% filter(type == &quot;Control&quot; &amp; time_point %in% c(&quot;Acclimation&quot;, &quot;FMT1&quot;) )%&gt;% column_to_rownames(&quot;Tube_code&quot;) %&gt;% sample_data() phylo_genome &lt;- genome_counts_filt %&gt;% filter(!genome %in% structural_zeros$genome) %&gt;% select(one_of(c(&quot;genome&quot;,rownames(phylo_samples)))) %&gt;% filter(rowSums(across(where(is.numeric), ~ . != 0)) &gt; 0) %&gt;% select(genome, where(~ is.numeric(.) &amp;&amp; sum(.) &gt; 0)) %&gt;% column_to_rownames(&quot;genome&quot;) %&gt;% otu_table(., taxa_are_rows = TRUE) phylo_taxonomy &lt;- genome_metadata %&gt;% filter(genome %in% rownames(phylo_genome)) %&gt;% column_to_rownames(&quot;genome&quot;) %&gt;% dplyr::select(domain,phylum,class,order,family,genus,species) %&gt;% as.matrix() %&gt;% tax_table() physeq_genome_filtered &lt;- phyloseq(phylo_genome, phylo_taxonomy, phylo_samples) ancom_rand_output_cc_accli_fmt1 = ancombc2(data = physeq_genome_filtered, assay_name = &quot;counts&quot;, tax_level = NULL, fix_formula = &quot;time_point&quot;, rand_formula = &quot;(1|individual)&quot;, p_adj_method = &quot;holm&quot;, pseudo_sens = TRUE, prv_cut =0, lib_cut = 0, s0_perc = 0.05, group = NULL, struc_zero = FALSE, neg_lb = FALSE, alpha = 0.05, n_cl = 2, verbose = TRUE, global = FALSE, pairwise = FALSE, dunnet = FALSE, trend = FALSE, iter_control = list(tol = 1e-5, max_iter = 20, verbose = FALSE), em_control = list(tol = 1e-5, max_iter = 100), lme_control = lme4::lmerControl(), mdfdr_control = list(fwer_ctrl_method = &quot;holm&quot;, B = 100), trend_control = NULL) save(ancom_rand_output_cc_accli_fmt1, file=&quot;data/ancom_rand_output_cc_accli_fmt1.RData&quot;) load(&quot;data/ancom_rand_output_cc_accli_fmt1.RData&quot;) ancom_rand_output_cc_accli_fmt1$res %&gt;% dplyr::select(taxon, lfc_time_pointFMT1, p_time_pointFMT1) %&gt;% filter(p_time_pointFMT1 &lt; 0.05) %&gt;% left_join(., genome_metadata, by=join_by(&quot;taxon&quot;==&quot;genome&quot;)) %&gt;% select(2,3,7,8,9) %&gt;% tt() .table td.tinytable_css_ryumxmp8v04e4fpl6j51, .table th.tinytable_css_ryumxmp8v04e4fpl6j51 { border-bottom: solid #d3d8dc 0.1em; } .table td.tinytable_css_6nprxqubo5l752db6o06, .table th.tinytable_css_6nprxqubo5l752db6o06 { border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; } lfc_time_pointFMT1 p_time_pointFMT1 order family genus -0.05106234 1.087347e-03 o__Bacteroidales f__Rikenellaceae g__Alistipes -2.00983141 4.135734e-03 o__Mycoplasmatales f__Mycoplasmoidaceae g__Mycoplasmoides 0.34566268 1.734034e-08 o__Rhizobiales f__Rhizobiaceae g__Agrobacterium 1.16482511 1.499816e-02 o__Lachnospirales f__Lachnospiraceae g__Clostridium_Q 0.61551493 6.112591e-03 o__Bacteroidales f__Marinifilaceae g__Odoribacter -1.55576342 7.385690e-03 o__Lachnospirales f__Lachnospiraceae g__Roseburia 0.84351603 2.471203e-10 o__Desulfovibrionales f__Desulfovibrionaceae g__Mailhella -1.82483412 8.901467e-04 o__Opitutales f__LL51 g__ 2.39547299 3.716946e-03 o__Bacteroidales f__Tannerellaceae g__Parabacteroides -1.02615136 3.081813e-02 o__Gastranaerophilales f__Gastranaerophilaceae g__Scatousia 2.26880456 6.155443e-04 o__Lachnospirales f__Lachnospiraceae g__ 2.08639210 2.257694e-02 o__Erysipelotrichales f__Erysipelotrichaceae g__Dielma -0.15320881 2.894390e-07 o__Oscillospirales f__Acutalibacteraceae g__ 0.40216781 8.043863e-08 o__Lachnospirales f__Lachnospiraceae g__Blautia -0.31420642 3.503801e-02 o__Bacteroidales f__Bacteroidaceae g__Bacteroides 1.59121485 2.689122e-02 o__Lachnospirales f__Lachnospiraceae g__Lacrimispora 1.15237654 4.105427e-02 o__Lachnospirales f__Lachnospiraceae g__Copromonas 0.96788096 3.266235e-02 o__Bacteroidales f__Tannerellaceae g__Parabacteroides -1.62665913 6.927224e-10 o__Lachnospirales f__Lachnospiraceae g__CAG-95 -0.33476597 7.639704e-06 o__Bacteroidales f__Bacteroidaceae g__ 1.71086415 8.629735e-03 o__Bacteroidales f__Tannerellaceae g__Parabacteroides 1.69183592 1.540801e-03 o__Bacteroidales f__Bacteroidaceae g__Bacteroides taxonomy &lt;- data.frame(physeq_genome_filtered@tax_table) %&gt;% rownames_to_column(., &quot;taxon&quot;) %&gt;% mutate_at(vars(order, phylum, family, genus, species), ~ str_replace(., &quot;[dpcofgs]__&quot;, &quot;&quot;)) ancombc_rand_table_mag &lt;- ancom_rand_output_cc_accli_fmt1$res %&gt;% dplyr::select(taxon, lfc_time_pointFMT1, p_time_pointFMT1) %&gt;% #filter(p_time_pointFMT1 &lt; 0.05) %&gt;% dplyr::arrange(p_time_pointFMT1) %&gt;% merge(., taxonomy, by=&quot;taxon&quot;) %&gt;% mutate_at(vars(phylum, species), ~ str_replace(., &quot;[dpcofgs]__&quot;, &quot;&quot;))%&gt;% dplyr::arrange(lfc_time_pointFMT1) ancombc_rand_table_mag taxon lfc_time_pointFMT1 p_time_pointFMT1 domain phylum class order family genus species 1 AH1_2nd_12:bin_000041 -2.0098314057 4.135734e-03 d__Bacteria Bacillota c__Bacilli Mycoplasmatales Mycoplasmoidaceae Mycoplasmoides 2 AH1_2nd_19:bin_000052 -1.8248341168 8.901467e-04 d__Bacteria Verrucomicrobiota c__Verrucomicrobiae Opitutales LL51 3 AH1_2nd_1:bin_000005 -1.6703353062 2.963969e-01 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae 4 AH1_2nd_13:bin_000029 -1.6509016959 1.323946e-01 d__Bacteria Pseudomonadota c__Alphaproteobacteria UBA3830 UBA3830 5 AH1_2nd_8:bin_000006 -1.6266591275 6.927224e-10 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae CAG-95 6 AH1_2nd_7:bin_000015 -1.5768771619 9.018007e-02 d__Bacteria Pseudomonadota c__Alphaproteobacteria RF32 CAG-239 CAZU01 7 AH1_2nd_19:bin_000005 -1.5557634212 7.385690e-03 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Roseburia 8 LI1_2nd_1:bin_000014 -1.4459683538 6.299616e-02 d__Bacteria Desulfobacterota c__Desulfovibrionia Desulfovibrionales Desulfovibrionaceae 9 LI1_2nd_7:bin_000042 -1.2839852420 7.671653e-02 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Tannerellaceae Parabacteroides_B 10 AH1_2nd_1:bin_000003 -1.0261513612 3.081813e-02 d__Bacteria Cyanobacteriota c__Vampirovibrionia Gastranaerophilales Gastranaerophilaceae Scatousia 11 AH1_2nd_12:bin_000012 -0.8749431375 8.489977e-02 d__Bacteria Campylobacterota c__Campylobacteria Campylobacterales Helicobacteraceae Helicobacter_J 12 AH1_2nd_12:bin_000056 -0.6610914186 4.690402e-01 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Enterocloster 13 AH1_2nd_8:bin_000027 -0.4882381496 6.433405e-01 d__Bacteria Bacillota c__Bacilli Erysipelotrichales Erysipelotrichaceae NSJ-61 14 AH1_2nd_15:bin_000043 -0.4810736412 5.802953e-01 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae Bacteroides 15 AH1_2nd_15:bin_000002 -0.4672817537 1.703380e-01 d__Bacteria Cyanobacteriota c__Vampirovibrionia Gastranaerophilales Gastranaerophilaceae Limenecus 16 AH1_2nd_19:bin_000001 -0.4545397916 5.081422e-01 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Tannerellaceae Parabacteroides 17 AH1_2nd_12:bin_000008 -0.3678311880 7.555310e-01 d__Bacteria Bacillota c__Bacilli Lactobacillales Streptococcaceae Lactococcus Lactococcus formosensis 18 AH1_2nd_14:bin_000063 -0.3354775895 6.681162e-01 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Blautia_A 19 LI1_2nd_4:bin_000036 -0.3347659706 7.639704e-06 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae 20 LI1_2nd_5:bin_000013 -0.3271726770 5.702459e-01 d__Bacteria Bacillota_A c__Clostridia Christensenellales DTU072 21 AH1_2nd_10:bin_000069 -0.3156615004 9.471734e-02 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae Bacteroides 22 AH1_2nd_5:bin_000069 -0.3142064217 3.503801e-02 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae Bacteroides 23 AH1_2nd_14:bin_000003 -0.2967363541 1.452498e-01 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Hungatella_A 24 AH1_2nd_15:bin_000021 -0.2798348578 5.949280e-01 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae 25 AH1_2nd_5:bin_000004 -0.1532088150 2.894390e-07 d__Bacteria Bacillota_A c__Clostridia Oscillospirales Acutalibacteraceae 26 AH1_2nd_9:bin_000002 -0.1342013529 8.275304e-01 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae Phocaeicola 27 AH1_2nd_18:bin_000013 -0.1137908659 5.882182e-01 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Tannerellaceae Parabacteroides 28 AH1_2nd_10:bin_000041 -0.0510623447 1.087347e-03 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Rikenellaceae Alistipes 29 AH1_2nd_8:bin_000007 -0.0350828231 3.150661e-01 d__Bacteria Bacillota c__Bacilli Erysipelotrichales Erysipelotrichaceae Dielma 30 AH1_2nd_19:bin_000053 -0.0003851823 9.996040e-01 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae CAG-56 31 AH1_2nd_10:bin_000010 0.0177132839 9.754083e-01 d__Bacteria Cyanobacteriota c__Vampirovibrionia Gastranaerophilales Gastranaerophilaceae CALURL01 32 LI1_2nd_8:bin_000019 0.0330561738 9.649354e-01 d__Bacteria Bacillota_A c__Clostridia Christensenellales UBA3700 33 AH1_2nd_1:bin_000002 0.0805489370 9.289207e-01 d__Bacteria Bacillota_A c__Clostridia Oscillospirales Ruminococcaceae Fournierella 34 LI1_2nd_4:bin_000041 0.0813274494 8.305518e-01 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Clostridium_Q 35 AH1_2nd_15:bin_000009 0.0892631201 8.254512e-01 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Acetatifactor 36 AH1_2nd_10:bin_000009 0.1337766821 9.223732e-01 d__Bacteria Desulfobacterota c__Desulfovibrionia Desulfovibrionales Desulfovibrionaceae Bilophila 37 AH1_2nd_19:bin_000050 0.1996556223 5.764965e-01 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae 38 AH1_2nd_9:bin_000047 0.2732331969 4.194325e-01 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae Bacteroides 39 AH1_2nd_7:bin_000004 0.2837172221 6.979655e-01 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Eisenbergiella 40 AH1_2nd_15:bin_000001 0.3456626829 1.734034e-08 d__Bacteria Pseudomonadota c__Alphaproteobacteria Rhizobiales Rhizobiaceae Agrobacterium Agrobacterium tumefaciens_H 41 AH1_2nd_16:bin_000045 0.3540886159 9.167962e-02 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Rikenellaceae Alistipes 42 AH1_2nd_5:bin_000023 0.4021678093 8.043863e-08 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Blautia 43 LI1_2nd_7:bin_000016 0.4351335352 4.934382e-01 d__Bacteria Bacillota c__Bacilli Erysipelotrichales Erysipelotrichaceae Clostridium_AQ 44 AH1_2nd_9:bin_000015 0.5086688642 2.771345e-01 d__Bacteria Desulfobacterota c__Desulfovibrionia Desulfovibrionales Desulfovibrionaceae Desulfovibrio 45 AH1_2nd_12:bin_000018 0.5118576862 3.358897e-01 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Rikenellaceae Alistipes 46 AH1_2nd_7:bin_000041 0.5692201848 2.043944e-01 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae 47 AH1_2nd_18:bin_000024 0.6155149297 6.112591e-03 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Marinifilaceae Odoribacter 48 AH1_2nd_17:bin_000029 0.6279351867 2.386998e-01 d__Bacteria Bacillota c__Bacilli Erysipelotrichales Erysipelotrichaceae NSJ-61 49 AH1_2nd_7:bin_000006 0.6287624494 6.623893e-01 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae JALFVM01 50 AH1_2nd_15:bin_000004 0.6396825285 6.546907e-02 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae UMGS1251 51 AH1_2nd_14:bin_000052 0.6553491117 2.980585e-01 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae Bacteroides 52 AH1_2nd_8:bin_000051 0.6982285685 1.401025e-01 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae Bacteroides 53 LI1_2nd_8:bin_000048 0.7730152411 4.020595e-01 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae 54 LI1_2nd_1:bin_000006 0.8265218512 1.569650e-01 d__Bacteria Bacillota_B c__Peptococcia Peptococcales Peptococcaceae RGIG6463 55 AH1_2nd_19:bin_000011 0.8435160306 2.471203e-10 d__Bacteria Desulfobacterota c__Desulfovibrionia Desulfovibrionales Desulfovibrionaceae Mailhella 56 AH1_2nd_7:bin_000036 0.9059126265 6.188627e-02 d__Bacteria Bacillota_A c__Clostridia Oscillospirales Oscillospiraceae Intestinimonas 57 AH1_2nd_7:bin_000065 0.9678809620 3.266235e-02 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Tannerellaceae Parabacteroides 58 AH1_2nd_7:bin_000027 1.1523765352 4.105427e-02 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Copromonas 59 AH1_2nd_17:bin_000020 1.1648251133 1.499816e-02 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Clostridium_Q 60 AH1_2nd_7:bin_000011 1.5912148477 2.689122e-02 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Lacrimispora 61 LI1_2nd_8:bin_000070 1.6918359214 1.540801e-03 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae Bacteroides 62 LI1_2nd_8:bin_000064 1.7108641514 8.629735e-03 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Tannerellaceae Parabacteroides 63 AH1_2nd_18:bin_000041 1.7975889669 1.230196e-01 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae Bacteroides 64 AH1_2nd_1:bin_000034 2.0863921048 2.257694e-02 d__Bacteria Bacillota c__Bacilli Erysipelotrichales Erysipelotrichaceae Dielma 65 AH1_2nd_1:bin_000023 2.2688045609 6.155443e-04 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae 66 AH1_2nd_19:bin_000055 2.3954729933 3.716946e-03 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Tannerellaceae Parabacteroides 67 AH1_2nd_11:bin_000028 2.7042309264 6.224806e-02 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae Bacteroides 68 AH1_2nd_1:bin_000015 NA 1.000000e+00 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae MGBC136627 69 AH1_2nd_1:bin_000048 NA 1.000000e+00 d__Bacteria Bacillota_A c__Clostridia Peptostreptococcales Anaerovoracaceae 70 AH1_2nd_10:bin_000049 NA 1.000000e+00 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Tannerellaceae Parabacteroides 71 AH1_2nd_11:bin_000004 NA 1.000000e+00 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Hungatella_A 72 AH1_2nd_11:bin_000009 NA 1.000000e+00 d__Bacteria Pseudomonadota c__Alphaproteobacteria RF32 CAG-239 Scatocola 73 AH1_2nd_12:bin_000007 NA 1.000000e+00 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae 74 AH1_2nd_12:bin_000009 NA 1.000000e+00 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Rikenellaceae Alistipes 75 AH1_2nd_12:bin_000044 NA 1.000000e+00 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Tannerellaceae Parabacteroides Parabacteroides distasonis 76 AH1_2nd_12:bin_000063 NA 1.000000e+00 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae CHH4-2 77 AH1_2nd_13:bin_000011 NA 1.000000e+00 d__Bacteria Pseudomonadota c__Alphaproteobacteria RF32 CAG-239 MGBC133411 78 AH1_2nd_14:bin_000014 NA 1.000000e+00 d__Bacteria Bacillota_A c__Clostridia Oscillospirales Oscillospiraceae Marseille-P3106 79 AH1_2nd_14:bin_000047 NA 1.000000e+00 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae Bacteroides 80 AH1_2nd_15:bin_000013 NA 1.000000e+00 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Ventrimonas 81 AH1_2nd_15:bin_000025 NA 1.000000e+00 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae Phocaeicola 82 AH1_2nd_16:bin_000025 NA 1.000000e+00 d__Bacteria Bacillota_A c__Clostridia Oscillospirales Ruminococcaceae Negativibacillus 83 AH1_2nd_16:bin_000058 NA 1.000000e+00 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Enterocloster 84 AH1_2nd_17:bin_000030 NA 1.000000e+00 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae Bacteroides 85 AH1_2nd_18:bin_000033 NA 1.000000e+00 d__Bacteria Bacillota c__Bacilli Erysipelotrichales Coprobacillaceae Beduini 86 AH1_2nd_18:bin_000039 NA 1.000000e+00 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Rikenellaceae Alistipes 87 AH1_2nd_18:bin_000047 NA 1.000000e+00 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Tannerellaceae Parabacteroides 88 AH1_2nd_19:bin_000067 NA 1.000000e+00 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae Bacteroides Bacteroides ovatus 89 AH1_2nd_2:bin_000003 NA 1.000000e+00 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae JAAYNV01 90 AH1_2nd_20:bin_000027 NA 1.000000e+00 d__Bacteria Desulfobacterota c__Desulfovibrionia Desulfovibrionales Desulfovibrionaceae Desulfovibrio 91 AH1_2nd_20:bin_000061 NA 1.000000e+00 d__Bacteria Bacillota c__Bacilli Lactobacillales Enterococcaceae Enterococcus 92 AH1_2nd_20:bin_000073 NA 1.000000e+00 d__Bacteria Bacillota c__Bacilli Lactobacillales Enterococcaceae Enterococcus Enterococcus sp002174455 93 AH1_2nd_5:bin_000037 NA 1.000000e+00 d__Bacteria Bacillota_A c__Clostridia Oscillospirales Oscillospiraceae Pseudoflavonifractor 94 AH1_2nd_7:bin_000010 NA 1.000000e+00 d__Bacteria Pseudomonadota c__Alphaproteobacteria RF32 CAG-239 CAJLXD01 95 AH1_2nd_7:bin_000017 NA 1.000000e+00 d__Bacteria Desulfobacterota c__Desulfovibrionia Desulfovibrionales Desulfovibrionaceae Lawsonia 96 AH1_2nd_7:bin_000060 NA 1.000000e+00 d__Bacteria Bacillota_A c__Clostridia Eubacteriales Eubacteriaceae Eubacterium 97 AH1_2nd_7:bin_000070 NA 1.000000e+00 d__Bacteria Bacillota_A c__Clostridia Oscillospirales Oscillospiraceae Pseudoflavonifractor 98 AH1_2nd_8:bin_000056 NA 1.000000e+00 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae Bacteroides 99 LI1_2nd_10:bin_000017 NA 1.000000e+00 d__Bacteria Chlamydiota c__Chlamydiia Chlamydiales Chlamydiaceae 100 LI1_2nd_3:bin_000003 NA 1.000000e+00 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Rikenellaceae Alistipes [ reached &#39;max&#39; / getOption(&quot;max.print&quot;) -- omitted 7 rows ] colors_alphabetic &lt;- read_tsv(&quot;https://raw.githubusercontent.com/earthhologenome/EHI_taxonomy_colour/main/ehi_phylum_colors.tsv&quot;) %&gt;% mutate_at(vars(phylum), ~ str_replace(., &quot;[dpcofgs]__&quot;, &quot;&quot;)) %&gt;% right_join(taxonomy, by=join_by(phylum == phylum)) %&gt;% dplyr::select(phylum, colors) %&gt;% mutate(colors = str_c(colors, &quot;80&quot;)) %&gt;% #add 80% alpha unique() %&gt;% dplyr::arrange(phylum) tax_table &lt;- as.data.frame(unique(ancombc_rand_table_mag$phylum)) colnames(tax_table)[1] &lt;- &quot;phylum&quot; tax_color &lt;- merge(tax_table, colors_alphabetic, by=&quot;phylum&quot;)%&gt;% dplyr::arrange(phylum) %&gt;% dplyr::select(colors) %&gt;% pull() ancombc_rand_table_mag %&gt;% mutate( genome = factor(taxon, levels = ancombc_rand_table_mag$taxon), significance = ifelse(p_time_pointFMT1 &lt; 0.05, phylum, NA) # Set non-significant to NA (not mapped in legend) ) %&gt;% ggplot() + # Plot significant points with legend geom_point(aes(x = lfc_time_pointFMT1, y = -log10(p_time_pointFMT1), color = significance), size = 3, alpha = 0.7, na.rm = TRUE) + # Plot non-significant points separately without legend geom_point(data = filter(ancombc_rand_table_mag, p_time_pointFMT1 &gt;= 0.05), aes(x = lfc_time_pointFMT1, y = -log10(p_time_pointFMT1)), color = &quot;grey70&quot;, size = 3, alpha = 0.7, show.legend = FALSE) + scale_color_manual( values = tax_color, # Only keeps phylum colors in legend na.translate = FALSE # Removes NA (non-significant) from legend ) + geom_hline(yintercept = -log10(0.05), linetype = &quot;dashed&quot;) + geom_vline(xintercept = 0, linetype = &quot;dashed&quot;) + scale_y_continuous(limits = c(0, 10)) + xlab(&quot;log2FoldChange&quot;) + ylab(&quot;-log10(p-value)&quot;) + guides(color = guide_legend(title = &quot;Phylum&quot;)) + theme_minimal()+ annotate(&quot;text&quot;, x = min(ancombc_rand_table_mag$lfc_time_pointFMT1), y = 10, label = &quot;FMT1&quot;, hjust = 0, size = 4, fontface = &quot;bold&quot;) + annotate(&quot;text&quot;, x = max(ancombc_rand_table_mag$lfc_time_pointFMT1), y = 10, label = &quot;Acclimation&quot;, hjust = 1, size = 4, fontface = &quot;bold&quot;) Phyla of the significant MAGs in acclimation ancombc_rand_table_mag%&gt;% filter(p_time_pointFMT1 &lt; 0.05) %&gt;% filter(lfc_time_pointFMT1&gt;0) %&gt;% count(phylum, name = &quot;sample_count&quot;) %&gt;% arrange(desc(sample_count)) phylum sample_count 1 Bacillota_A 5 2 Bacteroidota 5 3 Bacillota 1 4 Desulfobacterota 1 5 Pseudomonadota 1 Phyla of the significant MAGs in FMT1 ancombc_rand_table_mag%&gt;% filter(p_time_pointFMT1 &lt; 0.05) %&gt;% filter(lfc_time_pointFMT1&lt;0) %&gt;% count(phylum, name = &quot;sample_count&quot;) %&gt;% arrange(desc(sample_count)) phylum sample_count 1 Bacillota_A 3 2 Bacteroidota 3 3 Bacillota 1 4 Cyanobacteriota 1 5 Verrucomicrobiota 1 9.2.2.3 WC: acclimation vs FMT1 Structural zeros struc &lt;- structural_zeros %&gt;% filter(present==&quot;Acclimation&quot;)%&gt;% count(phylum, name = &quot;Acclimation&quot;) %&gt;% arrange(desc(Acclimation)) structural_zeros %&gt;% filter(present==&quot;FMT1&quot;)%&gt;% count(phylum, name = &quot;FMT1&quot;) %&gt;% arrange(desc(FMT1)) %&gt;% full_join(., struc, by=&quot;phylum&quot;) %&gt;% mutate(across(everything(), ~ ifelse(is.na(.), 0, .))) %&gt;% tt() .table td.tinytable_css_6dr0821v5ipkrnjt6pgl, .table th.tinytable_css_6dr0821v5ipkrnjt6pgl { border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; } .table td.tinytable_css_2u5g4u5w3160x8moyl0q, .table th.tinytable_css_2u5g4u5w3160x8moyl0q { border-bottom: solid #d3d8dc 0.1em; } phylum FMT1 Acclimation p__Bacillota_A 8 24 p__Bacillota 4 9 p__Bacteroidota 4 9 p__Bacillota_C 3 0 p__Pseudomonadota 2 7 p__Desulfobacterota 1 3 p__Cyanobacteriota 0 4 p__Verrucomicrobiota 0 2 p__Bacillota_B 0 1 phylo_samples &lt;- sample_metadata %&gt;% filter(type == &quot;Hot_control&quot; &amp; time_point %in% c(&quot;Acclimation&quot;, &quot;FMT1&quot;) )%&gt;% column_to_rownames(&quot;Tube_code&quot;) %&gt;% sample_data() phylo_genome &lt;- genome_counts_filt %&gt;% filter(!genome %in% structural_zeros$genome) %&gt;% select(one_of(c(&quot;genome&quot;,rownames(phylo_samples)))) %&gt;% filter(rowSums(across(where(is.numeric), ~ . != 0)) &gt; 0) %&gt;% select(genome, where(~ is.numeric(.) &amp;&amp; sum(.) &gt; 0)) %&gt;% column_to_rownames(&quot;genome&quot;) %&gt;% otu_table(., taxa_are_rows = TRUE) phylo_taxonomy &lt;- genome_metadata %&gt;% filter(genome %in% rownames(phylo_genome)) %&gt;% column_to_rownames(&quot;genome&quot;) %&gt;% dplyr::select(domain,phylum,class,order,family,genus,species) %&gt;% as.matrix() %&gt;% tax_table() physeq_genome_filtered &lt;- phyloseq(phylo_genome, phylo_taxonomy, phylo_samples) ancom_rand_output_wc_accli_fmt1 = ancombc2(data = physeq_genome_filtered, assay_name = &quot;counts&quot;, tax_level = NULL, fix_formula = &quot;time_point&quot;, p_adj_method = &quot;holm&quot;, pseudo_sens = TRUE, prv_cut =0, lib_cut = 0, s0_perc = 0.05, group = NULL, struc_zero = FALSE, neg_lb = FALSE, alpha = 0.05, n_cl = 2, verbose = TRUE, global = FALSE, pairwise = FALSE, dunnet = FALSE, trend = FALSE, iter_control = list(tol = 1e-5, max_iter = 20, verbose = FALSE), em_control = list(tol = 1e-5, max_iter = 100), mdfdr_control = list(fwer_ctrl_method = &quot;holm&quot;, B = 100), trend_control = NULL) save(ancom_rand_output_wc_accli_fmt1, file=&quot;data/ancom_rand_output_wc_accli_fmt1.RData&quot;) load(&quot;data/ancom_rand_output_wc_accli_fmt1.RData&quot;) ancom_rand_output_wc_accli_fmt1$res %&gt;% dplyr::select(taxon, lfc_time_pointFMT1, p_time_pointFMT1) %&gt;% filter(p_time_pointFMT1 &lt; 0.05) %&gt;% left_join(., genome_metadata, by=join_by(&quot;taxon&quot;==&quot;genome&quot;)) %&gt;% select(2,3,7,8,9) %&gt;% tt() .table td.tinytable_css_48any93mlasfkmkth7du, .table th.tinytable_css_48any93mlasfkmkth7du { border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; } .table td.tinytable_css_36qjsro0qphig64cr4kb, .table th.tinytable_css_36qjsro0qphig64cr4kb { border-bottom: solid #d3d8dc 0.1em; } lfc_time_pointFMT1 p_time_pointFMT1 order family genus -1.8462367 0.0286090261 o__Bacteroidales f__Rikenellaceae g__Alistipes -1.0602262 0.0256488405 o__Campylobacterales f__Helicobacteraceae g__Helicobacter_J -2.1031126 0.0039988943 o__Mycoplasmatales f__Mycoplasmoidaceae g__Mycoplasmoides -1.1937360 0.0258952249 o__Lachnospirales f__Lachnospiraceae g__Hungatella_A 1.1869122 0.0246642650 o__Oscillospirales f__Ruminococcaceae g__Negativibacillus -3.0923830 0.0007999100 o__Erysipelotrichales f__Coprobacillaceae g__Coprobacillus -1.2524541 0.0482834029 o__Opitutales f__LL51 g__ -1.2157647 0.0209074696 o__Bacteroidales f__Bacteroidaceae g__Bacteroides -2.1668443 0.0092167448 o__Gastranaerophilales f__Gastranaerophilaceae g__Scatousia 1.8856206 0.0022558153 o__Lachnospirales f__Lachnospiraceae g__ -1.2811877 0.0290779856 o__Bacteroidales f__Marinifilaceae g__Odoribacter -0.9960276 0.0294171519 o__Selenomonadales f__ g__ -1.9064058 0.0121488844 o__Lachnospirales f__Lachnospiraceae g__CAG-95 -2.0548675 0.0169404933 o__Christensenellales f__ g__ -1.8189515 0.0001244128 o__Bacteroidales f__Marinifilaceae g__Odoribacter 1.0549620 0.0254528501 o__Erysipelotrichales f__Erysipelotrichaceae g__Clostridium_AQ -1.4937622 0.0113515485 o__Bacteroidales f__Tannerellaceae g__Parabacteroides_B 1.9263692 0.0019001955 o__Bacteroidales f__Tannerellaceae g__Parabacteroides taxonomy &lt;- data.frame(physeq_genome_filtered@tax_table) %&gt;% rownames_to_column(., &quot;taxon&quot;) %&gt;% mutate_at(vars(order, phylum, family, genus, species), ~ str_replace(., &quot;[dpcofgs]__&quot;, &quot;&quot;)) ancombc_rand_table_mag &lt;- ancom_rand_output_wc_accli_fmt1$res %&gt;% dplyr::select(taxon, lfc_time_pointFMT1, p_time_pointFMT1) %&gt;% #filter(p_time_pointFMT1 &lt; 0.05) %&gt;% dplyr::arrange(p_time_pointFMT1) %&gt;% merge(., taxonomy, by=&quot;taxon&quot;) %&gt;% mutate_at(vars(phylum, species), ~ str_replace(., &quot;[dpcofgs]__&quot;, &quot;&quot;))%&gt;% dplyr::arrange(lfc_time_pointFMT1) ancombc_rand_table_mag taxon lfc_time_pointFMT1 p_time_pointFMT1 domain phylum class order family genus species 1 AH1_2nd_18:bin_000011 -3.09238298 0.0007999100 d__Bacteria Bacillota c__Bacilli Erysipelotrichales Coprobacillaceae Coprobacillus 2 AH1_2nd_2:bin_000003 -2.64816145 1.0000000000 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae JAAYNV01 3 AH1_2nd_1:bin_000003 -2.16684429 0.0092167448 d__Bacteria Cyanobacteriota c__Vampirovibrionia Gastranaerophilales Gastranaerophilaceae Scatousia 4 LI1_2nd_4:bin_000001 -2.05486750 0.0169404933 d__Bacteria Bacillota_A c__Clostridia Christensenellales 5 AH1_2nd_8:bin_000006 -1.90640581 0.0121488844 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae CAG-95 6 LI1_2nd_4:bin_000026 -1.81895155 0.0001244128 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Marinifilaceae Odoribacter 7 AH1_2nd_19:bin_000011 -1.49472687 0.0611399521 d__Bacteria Desulfobacterota c__Desulfovibrionia Desulfovibrionales Desulfovibrionaceae Mailhella 8 LI1_2nd_7:bin_000042 -1.49376217 0.0113515485 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Tannerellaceae Parabacteroides_B 9 AH1_2nd_19:bin_000072 -1.47826887 1.0000000000 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae 10 AH1_2nd_14:bin_000015 -1.31675396 0.1424337358 d__Bacteria Bacillota_A c__Clostridia Christensenellales UBA3700 11 AH1_2nd_1:bin_000039 -1.28118772 0.0290779856 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Marinifilaceae Odoribacter 12 AH1_2nd_14:bin_000003 -1.19373604 0.0258952249 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Hungatella_A 13 AH1_2nd_18:bin_000024 -1.18873116 0.0611452591 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Marinifilaceae Odoribacter 14 AH1_2nd_9:bin_000002 -1.16920978 0.0986538496 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae Phocaeicola 15 AH1_2nd_12:bin_000012 -1.06022615 0.0256488405 d__Bacteria Campylobacterota c__Campylobacteria Campylobacterales Helicobacteraceae Helicobacter_J 16 LI1_2nd_9:bin_000022 -0.90624371 0.0903292981 d__Bacteria Bacillota_A c__Clostridia Oscillospirales Oscillospiraceae Oscillibacter 17 LI1_2nd_5:bin_000013 -0.82960432 0.1527144304 d__Bacteria Bacillota_A c__Clostridia Christensenellales DTU072 18 AH1_2nd_14:bin_000052 -0.70378172 0.0836982274 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae Bacteroides 19 AH1_2nd_10:bin_000069 -0.63847692 0.1756392299 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae Bacteroides 20 LI1_2nd_8:bin_000019 -0.62605832 0.1873913604 d__Bacteria Bacillota_A c__Clostridia Christensenellales UBA3700 21 LI1_2nd_8:bin_000048 -0.60441068 0.1802313047 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae 22 AH1_2nd_15:bin_000001 -0.55891783 0.2775215236 d__Bacteria Pseudomonadota c__Alphaproteobacteria Rhizobiales Rhizobiaceae Agrobacterium Agrobacterium tumefaciens_H 23 LI1_2nd_1:bin_000014 -0.54176243 0.1908782875 d__Bacteria Desulfobacterota c__Desulfovibrionia Desulfovibrionales Desulfovibrionaceae 24 AH1_2nd_17:bin_000020 -0.52968312 0.1375747225 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Clostridium_Q 25 AH1_2nd_8:bin_000027 -0.37269906 0.3929034840 d__Bacteria Bacillota c__Bacilli Erysipelotrichales Erysipelotrichaceae NSJ-61 26 AH1_2nd_20:bin_000016 -0.36796485 0.4149817314 d__Bacteria Bacillota c__Bacilli Erysipelotrichales Erysipelotrichaceae 27 AH1_2nd_15:bin_000004 -0.36323296 0.4110273927 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae UMGS1251 28 AH1_2nd_14:bin_000063 -0.24107574 0.4791871743 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Blautia_A 29 AH1_2nd_14:bin_000014 -0.19163907 0.5967459585 d__Bacteria Bacillota_A c__Clostridia Oscillospirales Oscillospiraceae Marseille-P3106 30 AH1_2nd_5:bin_000069 -0.11336248 0.7480149690 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae Bacteroides 31 AH1_2nd_5:bin_000004 -0.09955378 0.7766158242 d__Bacteria Bacillota_A c__Clostridia Oscillospirales Acutalibacteraceae 32 AH1_2nd_19:bin_000053 -0.06449956 0.8633425245 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae CAG-56 33 AH1_2nd_5:bin_000023 -0.06125506 0.8885990209 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Blautia 34 LI1_2nd_4:bin_000052 -0.05917952 0.8521593297 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Enterocloster 35 AH1_2nd_7:bin_000011 -0.02245708 0.9485771277 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Lacrimispora 36 LI1_2nd_3:bin_000015 0.10095110 0.7675764926 d__Bacteria Bacillota c__Bacilli Staphylococcales Staphylococcaceae Staphylococcus Staphylococcus shinii 37 AH1_2nd_12:bin_000008 0.12657279 0.7200772057 d__Bacteria Bacillota c__Bacilli Lactobacillales Streptococcaceae Lactococcus Lactococcus formosensis 38 AH1_2nd_6:bin_000046 0.14864251 0.7391254614 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae Bacteroides 39 AH1_2nd_15:bin_000043 0.16285526 0.6651236201 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae Bacteroides 40 AH1_2nd_11:bin_000028 0.21578304 0.6001649151 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae Bacteroides 41 AH1_2nd_19:bin_000055 0.24128020 0.5605744834 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Tannerellaceae Parabacteroides 42 AH1_2nd_1:bin_000015 0.24836374 0.5365901183 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae MGBC136627 43 LI1_2nd_1:bin_000006 0.25674596 0.4812257132 d__Bacteria Bacillota_B c__Peptococcia Peptococcales Peptococcaceae RGIG6463 44 LI1_2nd_4:bin_000041 0.27550730 0.4771321706 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Clostridium_Q 45 AH1_2nd_8:bin_000051 0.40902714 0.2422754936 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae Bacteroides 46 LI1_2nd_3:bin_000003 0.42622652 0.3026156952 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Rikenellaceae Alistipes 47 AH1_2nd_11:bin_000005 0.43902586 0.3469594997 d__Bacteria Fusobacteriota c__Fusobacteriia Fusobacteriales Fusobacteriaceae Fusobacterium_A Fusobacterium_A ulcerans 48 LI1_2nd_8:bin_000016 0.44929580 0.2725481226 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Rikenellaceae Rikenella 49 AH1_2nd_9:bin_000047 0.46845503 0.1949450949 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae Bacteroides 50 AH1_2nd_16:bin_000045 0.47745182 0.3015275739 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Rikenellaceae Alistipes 51 AH1_2nd_1:bin_000002 0.67274170 0.0931456403 d__Bacteria Bacillota_A c__Clostridia Oscillospirales Ruminococcaceae Fournierella 52 LI1_2nd_4:bin_000034 0.68376987 0.1489775197 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae Bacteroides Bacteroides thetaiotaomicron 53 LI1_2nd_8:bin_000070 0.71574480 0.0557648829 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae Bacteroides 54 LI1_2nd_8:bin_000079 0.75931542 0.1169813633 d__Bacteria Pseudomonadota c__Gammaproteobacteria Enterobacterales Enterobacteriaceae Citrobacter_A Citrobacter_A amalonaticus 55 LI1_2nd_7:bin_000009 0.77854131 0.0871078423 d__Bacteria Bacillota_A c__Clostridia Oscillospirales Ruminococcaceae Anaerotruncus 56 LI1_2nd_7:bin_000078 0.81801284 0.2168112843 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Copromonas 57 AH1_2nd_7:bin_000027 0.89831540 1.0000000000 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Copromonas 58 AH1_2nd_7:bin_000041 0.91707306 0.0786806187 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae 59 AH1_2nd_7:bin_000004 0.93022652 0.0840011143 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Eisenbergiella 60 AH1_2nd_16:bin_000058 1.01998337 1.0000000000 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Enterocloster 61 LI1_2nd_7:bin_000016 1.05496196 0.0254528501 d__Bacteria Bacillota c__Bacilli Erysipelotrichales Erysipelotrichaceae Clostridium_AQ 62 AH1_2nd_16:bin_000025 1.18691221 0.0246642650 d__Bacteria Bacillota_A c__Clostridia Oscillospirales Ruminococcaceae Negativibacillus 63 AH1_2nd_12:bin_000007 1.66999357 1.0000000000 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae 64 AH1_2nd_1:bin_000023 1.88562064 0.0022558153 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae 65 LI1_2nd_8:bin_000064 1.92636920 0.0019001955 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Tannerellaceae Parabacteroides 66 AH1_2nd_20:bin_000042 1.95922795 1.0000000000 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Hungatella colors_alphabetic &lt;- read_tsv(&quot;https://raw.githubusercontent.com/earthhologenome/EHI_taxonomy_colour/main/ehi_phylum_colors.tsv&quot;) %&gt;% mutate_at(vars(phylum), ~ str_replace(., &quot;[dpcofgs]__&quot;, &quot;&quot;)) %&gt;% right_join(taxonomy, by=join_by(phylum == phylum)) %&gt;% dplyr::select(phylum, colors) %&gt;% mutate(colors = str_c(colors, &quot;80&quot;)) %&gt;% #add 80% alpha unique() %&gt;% dplyr::arrange(phylum) tax_table &lt;- as.data.frame(unique(ancombc_rand_table_mag$phylum)) colnames(tax_table)[1] &lt;- &quot;phylum&quot; tax_color &lt;- merge(tax_table, colors_alphabetic, by=&quot;phylum&quot;)%&gt;% dplyr::arrange(phylum) %&gt;% dplyr::select(colors) %&gt;% pull() ancombc_rand_table_mag %&gt;% mutate( genome = factor(taxon, levels = ancombc_rand_table_mag$taxon), significance = ifelse(p_time_pointFMT1 &lt; 0.05, phylum, NA) # Set non-significant to NA (not mapped in legend) ) %&gt;% ggplot() + # Plot significant points with legend geom_point(aes(x = lfc_time_pointFMT1, y = -log10(p_time_pointFMT1), color = significance), size = 3, alpha = 0.7, na.rm = TRUE) + # Plot non-significant points separately without legend geom_point(data = filter(ancombc_rand_table_mag, p_time_pointFMT1 &gt;= 0.05), aes(x = lfc_time_pointFMT1, y = -log10(p_time_pointFMT1)), color = &quot;grey70&quot;, size = 3, alpha = 0.7, show.legend = FALSE) + scale_color_manual( values = tax_color, # Only keeps phylum colors in legend na.translate = FALSE # Removes NA (non-significant) from legend ) + geom_hline(yintercept = -log10(0.05), linetype = &quot;dashed&quot;) + geom_vline(xintercept = 0, linetype = &quot;dashed&quot;) + scale_y_continuous(limits = c(0, 5)) + xlab(&quot;log2FoldChange&quot;) + ylab(&quot;-log10(p-value)&quot;) + guides(color = guide_legend(title = &quot;Phylum&quot;)) + theme_minimal()+ annotate(&quot;text&quot;, x = min(ancombc_rand_table_mag$lfc_time_pointFMT1), y = 5, label = &quot;FMT1&quot;, hjust = 0, size = 4, fontface = &quot;bold&quot;) + annotate(&quot;text&quot;, x = max(ancombc_rand_table_mag$lfc_time_pointFMT1), y = 5, label = &quot;Acclimation&quot;, hjust = 1, size = 4, fontface = &quot;bold&quot;) Phyla of the significant MAGs in acclimation ancombc_rand_table_mag%&gt;% filter(p_time_pointFMT1 &lt; 0.05) %&gt;% filter(lfc_time_pointFMT1&gt;0) %&gt;% count(phylum, name = &quot;sample_count&quot;) %&gt;% arrange(desc(sample_count)) phylum sample_count 1 Bacillota_A 2 2 Bacillota 1 3 Bacteroidota 1 Phyla of the significant MAGs in FMT1 ancombc_rand_table_mag%&gt;% filter(p_time_pointFMT1 &lt; 0.05) %&gt;% filter(lfc_time_pointFMT1&lt;0) %&gt;% count(phylum, name = &quot;sample_count&quot;) %&gt;% arrange(desc(sample_count)) phylum sample_count 1 Bacillota_A 3 2 Bacteroidota 3 3 Bacillota 1 4 Campylobacterota 1 5 Cyanobacteriota 1 9.3 Differences between FMT1 and FMT2 across the three experimental groups 9.3.1 Functional differences CI from FMT1 to FMT2 significant_element&lt;-element_gift %&gt;% filter(time_point %in% c(&quot;FMT2&quot;,&quot;FMT1&quot;) &amp; type == &quot;Treatment&quot;) %&gt;% select(-time_point, -type) %&gt;% filter(rowSums(across(where(is.numeric), ~ . != 0)) &gt; 0) %&gt;% select(Tube_code, where( ~ is.numeric(.) &amp;&amp; sum(.) &gt; 0)) %&gt;% left_join(sample_metadata[c(1, 10)], by = &quot;Tube_code&quot;) %&gt;% pivot_longer(-c(Tube_code, time_point), names_to = &quot;trait&quot;, values_to = &quot;value&quot;) %&gt;% group_by(trait) %&gt;% summarise(p_value = wilcox.test(value ~ time_point)$p.value) %&gt;% mutate(p_adjust = p.adjust(p_value, method = &quot;BH&quot;)) %&gt;% filter(p_adjust &lt; 0.05) %&gt;% remove_rownames() %&gt;% left_join(., uniqueGIFT_db, by=join_by(&quot;trait&quot;==&quot;Code_element&quot;)) element_gift_sig &lt;- element_gift %&gt;% select(Tube_code, all_of(intersect( significant_element$trait, colnames(element_gift) ))) %&gt;% left_join(., sample_metadata[c(1, 7, 10)], by = join_by(Tube_code == Tube_code)) %&gt;% filter(time_point %in% c(&quot;FMT2&quot;,&quot;FMT1&quot;))%&gt;% filter(type==&quot;Treatment&quot;) difference_table &lt;- element_gift_sig %&gt;% select(-Tube_code, -type) %&gt;% group_by(time_point) %&gt;% summarise(across(everything(), mean)) %&gt;% t() %&gt;% row_to_names(row_number = 1) %&gt;% as.data.frame() %&gt;% mutate_if(is.character, as.numeric) %&gt;% rownames_to_column(., &quot;Elements&quot;) %&gt;% left_join(.,uniqueGIFT_db[c(1,3,4)],by = join_by(Elements == Code_element)) %&gt;% arrange(Function) %&gt;% mutate(Difference=FMT1-FMT2)%&gt;% mutate(group_color = ifelse(Difference &lt;0,&quot;FMT2&quot;, &quot;FMT1&quot;)) difference_table %&gt;% ggplot(aes(x=forcats::fct_reorder(Function,Difference), y=Difference, fill=group_color)) + geom_col() + scale_fill_manual(values=c(&#39;#008080&#39;,&quot;#76b183&quot;)) + geom_hline(yintercept=0) + coord_flip()+ theme(axis.text = element_text(size = 10), axis.title = element_text(size = 12), legend.position = &quot;right&quot;, legend.title = element_blank(), panel.background = element_blank(), panel.grid.major = element_line(size = 0.15, linetype = &#39;solid&#39;, colour = &quot;grey&quot;))+ xlab(&quot;Function&quot;) + ylab(&quot;Mean difference&quot;) CC from FMT1 to FMT2 element_gift %&gt;% filter(time_point %in% c(&quot;FMT2&quot;,&quot;FMT1&quot;) &amp; type == &quot;Control&quot;) %&gt;% select(-time_point, -type) %&gt;% filter(rowSums(across(where(is.numeric), ~ . != 0)) &gt; 0) %&gt;% select(Tube_code, where( ~ is.numeric(.) &amp;&amp; sum(.) &gt; 0)) %&gt;% left_join(sample_metadata[c(1, 10)], by = &quot;Tube_code&quot;) %&gt;% pivot_longer(-c(Tube_code, time_point), names_to = &quot;trait&quot;, values_to = &quot;value&quot;) %&gt;% group_by(trait) %&gt;% summarise(p_value = wilcox.test(value ~ time_point)$p.value) %&gt;% mutate(p_adjust = p.adjust(p_value, method = &quot;BH&quot;)) %&gt;% filter(p_adjust &lt; 0.05) %&gt;% remove_rownames() %&gt;% left_join(., uniqueGIFT_db, by=join_by(&quot;trait&quot;==&quot;Code_element&quot;)) # A tibble: 0 × 6 # ℹ 6 variables: trait &lt;chr&gt;, p_value &lt;dbl&gt;, p_adjust &lt;dbl&gt;, Domain &lt;chr&gt;, Function &lt;chr&gt;, Element &lt;chr&gt; WC from FMT1 to FMT2 element_gift %&gt;% filter(time_point %in% c(&quot;FMT2&quot;,&quot;FMT1&quot;) &amp; type == &quot;Hot_control&quot;) %&gt;% select(-time_point, -type) %&gt;% filter(rowSums(across(where(is.numeric), ~ . != 0)) &gt; 0) %&gt;% select(Tube_code, where( ~ is.numeric(.) &amp;&amp; sum(.) &gt; 0)) %&gt;% left_join(sample_metadata[c(1, 10)], by = &quot;Tube_code&quot;) %&gt;% pivot_longer(-c(Tube_code, time_point), names_to = &quot;trait&quot;, values_to = &quot;value&quot;) %&gt;% group_by(trait) %&gt;% summarise(p_value = wilcox.test(value ~ time_point)$p.value) %&gt;% mutate(p_adjust = p.adjust(p_value, method = &quot;BH&quot;)) %&gt;% filter(p_adjust &lt; 0.05) %&gt;% remove_rownames() %&gt;% left_join(., uniqueGIFT_db, by=join_by(&quot;trait&quot;==&quot;Code_element&quot;)) # A tibble: 0 × 6 # ℹ 6 variables: trait &lt;chr&gt;, p_value &lt;dbl&gt;, p_adjust &lt;dbl&gt;, Domain &lt;chr&gt;, Function &lt;chr&gt;, Element &lt;chr&gt; 9.3.2 Differential abundances 9.3.2.1 CI: FMT1 vs FMT2 Structural zeros struc &lt;- structural_zeros %&gt;% filter(present==&quot;FMT1&quot;)%&gt;% count(phylum, name = &quot;FMT1&quot;) %&gt;% arrange(desc(FMT1)) structural_zeros %&gt;% filter(present==&quot;FMT2&quot;)%&gt;% count(phylum, name = &quot;FMT2&quot;) %&gt;% arrange(desc(FMT2)) %&gt;% full_join(., struc, by=&quot;phylum&quot;) %&gt;% mutate(across(everything(), ~ ifelse(is.na(.), 0, .))) %&gt;% tt() .table td.tinytable_css_kry8lkcwqglqow9oxq5q, .table th.tinytable_css_kry8lkcwqglqow9oxq5q { border-bottom: solid #d3d8dc 0.1em; } .table td.tinytable_css_42063y7v3s72e9cdgm3t, .table th.tinytable_css_42063y7v3s72e9cdgm3t { border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; } phylum FMT2 FMT1 p__Bacillota_A 19 8 p__Pseudomonadota 15 0 p__Bacteroidota 8 2 p__Bacillota 5 3 p__Cyanobacteriota 5 0 p__Desulfobacterota 2 0 p__Verrucomicrobiota 2 0 p__Bacillota_C 1 0 p__Spirochaetota 1 0 p__Actinomycetota 0 1 p__Campylobacterota 0 1 phylo_samples &lt;- sample_metadata %&gt;% filter(type == &quot;Treatment&quot; &amp; time_point %in% c(&quot;FMT1&quot;, &quot;FMT2&quot;) )%&gt;% column_to_rownames(&quot;Tube_code&quot;) %&gt;% sample_data() phylo_genome &lt;- genome_counts_filt %&gt;% filter(!genome %in% structural_zeros$genome) %&gt;% select(one_of(c(&quot;genome&quot;,rownames(phylo_samples)))) %&gt;% filter(rowSums(across(where(is.numeric), ~ . != 0)) &gt; 0) %&gt;% select(genome, where(~ is.numeric(.) &amp;&amp; sum(.) &gt; 0)) %&gt;% column_to_rownames(&quot;genome&quot;) %&gt;% otu_table(., taxa_are_rows = TRUE) phylo_taxonomy &lt;- genome_metadata %&gt;% filter(genome %in% rownames(phylo_genome)) %&gt;% column_to_rownames(&quot;genome&quot;) %&gt;% dplyr::select(domain,phylum,class,order,family,genus,species) %&gt;% as.matrix() %&gt;% tax_table() physeq_genome_filtered &lt;- phyloseq(phylo_genome, phylo_taxonomy, phylo_samples) ancom_rand_output_ci_fmt1_FMT2 = ancombc2(data = physeq_genome_filtered, assay_name = &quot;counts&quot;, tax_level = NULL, fix_formula = &quot;time_point&quot;, p_adj_method = &quot;holm&quot;, pseudo_sens = TRUE, prv_cut =0, lib_cut = 0, s0_perc = 0.05, group = NULL, struc_zero = FALSE, neg_lb = FALSE, alpha = 0.05, n_cl = 2, verbose = TRUE, global = FALSE, pairwise = FALSE, dunnet = FALSE, trend = FALSE, iter_control = list(tol = 1e-5, max_iter = 20, verbose = FALSE), em_control = list(tol = 1e-5, max_iter = 100), mdfdr_control = list(fwer_ctrl_method = &quot;holm&quot;, B = 100), trend_control = NULL) save(ancom_rand_output_ci_fmt1_FMT2, file=&quot;data/ancom_rand_output_ci_fmt1_FMT2.RData&quot;) load(&quot;data/ancom_rand_output_ci_fmt1_FMT2.RData&quot;) ancom_rand_output_ci_fmt1_FMT2$res %&gt;% dplyr::select(taxon, lfc_time_pointFMT2, p_time_pointFMT2) %&gt;% filter(p_time_pointFMT2 &lt; 0.05) %&gt;% left_join(., genome_metadata, by=join_by(&quot;taxon&quot;==&quot;genome&quot;)) %&gt;% select(2,3,7,8,9) %&gt;% tt() .table td.tinytable_css_mh68rehek1ssn6zbx4a7, .table th.tinytable_css_mh68rehek1ssn6zbx4a7 { border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; } .table td.tinytable_css_79sqbd9uiwlmsq96scyr, .table th.tinytable_css_79sqbd9uiwlmsq96scyr { border-bottom: solid #d3d8dc 0.1em; } lfc_time_pointFMT2 p_time_pointFMT2 order family genus 1.6049257 0.0157811865 o__Gastranaerophilales f__Gastranaerophilaceae g__Limenecus 0.9564973 0.0275097081 o__Bacteroidales f__Tannerellaceae g__Parabacteroides 2.0492182 0.0166204040 o__Lachnospirales f__Lachnospiraceae g__Hungatella_A -1.8918089 0.0096699943 o__Campylobacterales f__Helicobacteraceae g__Helicobacter_J -1.2081046 0.0210589073 o__RF32 f__CAG-239 g__MGBC133411 1.1513092 0.0219338284 o__Bacteroidales f__Bacteroidaceae g__Bacteroides 1.9022386 0.0009678398 o__Lachnospirales f__Lachnospiraceae g__Hungatella_A -1.1428833 0.0226212068 o__Rhizobiales f__Rhizobiaceae g__Agrobacterium 1.5906273 0.0008227118 o__Lachnospirales f__Lachnospiraceae g__Acetatifactor 1.0975241 0.0150004122 o__Oscillospirales f__Oscillospiraceae g__Scatomorpha -1.0241243 0.0081256230 o__Lachnospirales f__Lachnospiraceae g__ 1.1899452 0.0392264054 o__Bacteroidales f__Marinifilaceae g__Odoribacter 2.3003362 0.0160580780 o__Bacteroidales f__Rikenellaceae g__Alistipes -1.1771426 0.0398005716 o__Bacteroidales f__Bacteroidaceae g__Bacteroides 2.1549960 0.0063980102 o__Enterobacterales f__Enterobacteriaceae g__Proteus 1.1806298 0.0153184259 o__Lachnospirales f__Lachnospiraceae g__CAG-95 0.9643164 0.0213552124 o__Bacteroidales f__Bacteroidaceae g__Bacteroides 0.9715614 0.0148063589 o__Desulfovibrionales f__Desulfovibrionaceae g__ 1.4550695 0.0288178503 o__Christensenellales f__ g__ 1.6826957 0.0003988880 o__Bacteroidales f__Marinifilaceae g__Odoribacter -1.7750818 0.0188386554 o__Bacteroidales f__Rikenellaceae g__Alistipes -1.0206596 0.0387357946 o__Erysipelotrichales f__Erysipelotrichaceae g__Clostridium_AQ 1.6686679 0.0064021556 o__Lachnospirales f__Lachnospiraceae g__ 1.2527317 0.0339066213 o__RF32 f__CAG-239 g__CAJLXD01 1.1133229 0.0229428387 o__Oscillospirales f__Oscillospiraceae g__Oscillibacter taxonomy &lt;- data.frame(physeq_genome_filtered@tax_table) %&gt;% rownames_to_column(., &quot;taxon&quot;) %&gt;% mutate_at(vars(order, phylum, family, genus, species), ~ str_replace(., &quot;[dpcofgs]__&quot;, &quot;&quot;)) ancombc_rand_table_mag &lt;- ancom_rand_output_ci_fmt1_FMT2$res %&gt;% dplyr::select(taxon, lfc_time_pointFMT2, p_time_pointFMT2) %&gt;% #filter(p_time_pointFMT2 &lt; 0.05) %&gt;% dplyr::arrange(p_time_pointFMT2) %&gt;% merge(., taxonomy, by=&quot;taxon&quot;) %&gt;% mutate_at(vars(phylum, species), ~ str_replace(., &quot;[dpcofgs]__&quot;, &quot;&quot;))%&gt;% dplyr::arrange(lfc_time_pointFMT2) ancombc_rand_table_mag taxon lfc_time_pointFMT2 p_time_pointFMT2 domain phylum class order family genus species 1 AH1_2nd_2:bin_000018 -2.2170598063 1.000000000 d__Bacteria Elusimicrobiota c__Elusimicrobia Elusimicrobiales Elusimicrobiaceae UBA1436 2 AH1_2nd_12:bin_000012 -1.8918089133 0.009669994 d__Bacteria Campylobacterota c__Campylobacteria Campylobacterales Helicobacteraceae Helicobacter_J 3 LI1_2nd_7:bin_000012 -1.7750818207 0.018838655 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Rikenellaceae Alistipes 4 AH1_2nd_1:bin_000034 -1.6789181354 0.122732881 d__Bacteria Bacillota c__Bacilli Erysipelotrichales Erysipelotrichaceae Dielma 5 AH1_2nd_2:bin_000017 -1.6426716470 0.099339305 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Copromonas 6 AH1_2nd_12:bin_000007 -1.3317033001 0.149416168 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae 7 AH1_2nd_13:bin_000049 -1.2129524427 1.000000000 d__Bacteria Bacillota_A c__Clostridia Christensenellales UBA3700 8 AH1_2nd_13:bin_000011 -1.2081045846 0.021058907 d__Bacteria Pseudomonadota c__Alphaproteobacteria RF32 CAG-239 MGBC133411 9 AH1_2nd_6:bin_000046 -1.1771425789 0.039800572 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae Bacteroides 10 AH1_2nd_15:bin_000001 -1.1428833092 0.022621207 d__Bacteria Pseudomonadota c__Alphaproteobacteria Rhizobiales Rhizobiaceae Agrobacterium Agrobacterium tumefaciens_H 11 AH1_2nd_1:bin_000023 -1.0241242829 0.008125623 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae 12 LI1_2nd_7:bin_000016 -1.0206596135 0.038735795 d__Bacteria Bacillota c__Bacilli Erysipelotrichales Erysipelotrichaceae Clostridium_AQ 13 AH1_2nd_16:bin_000020 -0.8225875416 0.125186659 d__Bacteria Desulfobacterota c__Desulfovibrionia Desulfovibrionales Desulfovibrionaceae Bilophila 14 LI1_2nd_4:bin_000036 -0.7526182338 0.126502547 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae 15 AH1_2nd_16:bin_000033 -0.7360800124 0.259428270 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales 16 AH1_2nd_16:bin_000018 -0.7339917867 0.050556863 d__Bacteria Bacillota_A c__Clostridia Christensenellales UBA3700 17 LI1_2nd_2:bin_000006 -0.6585081211 0.243653517 d__Bacteria Bacillota_A c__Clostridia Christensenellales MGBC116941 MGBC116941 18 AH1_2nd_12:bin_000008 -0.6374710495 0.240673518 d__Bacteria Bacillota c__Bacilli Lactobacillales Streptococcaceae Lactococcus Lactococcus formosensis 19 AH1_2nd_16:bin_000045 -0.6276290480 0.142544098 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Rikenellaceae Alistipes 20 AH1_2nd_2:bin_000001 -0.6267639593 0.103108160 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae 21 AH1_2nd_10:bin_000097 -0.6211566272 0.172843312 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Tannerellaceae Parabacteroides 22 AH1_2nd_5:bin_000006 -0.5548028629 0.145909036 d__Bacteria Bacillota_C c__Negativicutes Acidaminococcales Acidaminococcaceae Phascolarctobacterium Phascolarctobacterium sp900544795 23 LI1_2nd_8:bin_000079 -0.5544455362 0.224155344 d__Bacteria Pseudomonadota c__Gammaproteobacteria Enterobacterales Enterobacteriaceae Citrobacter_A Citrobacter_A amalonaticus 24 AH1_2nd_5:bin_000073 -0.5285887213 0.294517985 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Tannerellaceae Parabacteroides Parabacteroides goldsteinii 25 AH1_2nd_9:bin_000047 -0.5283891290 0.106458224 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae Bacteroides 26 LI1_2nd_9:bin_000023 -0.5086805333 0.166418031 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae JALFVM01 27 LI1_2nd_8:bin_000070 -0.4860780178 0.356817063 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae Bacteroides 28 LI1_2nd_7:bin_000014 -0.4683845951 0.314952838 d__Bacteria Bacteroidota c__Bacteroidia Flavobacteriales UBA1820 Merdimorpha 29 AH1_2nd_16:bin_000047 -0.4250924170 1.000000000 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Marinifilaceae Odoribacter 30 AH1_2nd_19:bin_000055 -0.4061328159 0.375240869 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Tannerellaceae Parabacteroides 31 LI1_2nd_7:bin_000038 -0.3966759624 1.000000000 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Tannerellaceae Parabacteroides_B 32 AH1_2nd_5:bin_000069 -0.3900113691 0.311651914 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae Bacteroides 33 AH1_2nd_20:bin_000087 -0.3245503533 0.266844424 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Tannerellaceae Parabacteroides Parabacteroides gordonii 34 AH1_2nd_7:bin_000036 -0.3212194894 0.334517234 d__Bacteria Bacillota_A c__Clostridia Oscillospirales Oscillospiraceae Intestinimonas 35 AH1_2nd_17:bin_000020 -0.3187362250 0.426259092 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Clostridium_Q 36 AH1_2nd_10:bin_000042 -0.3101620775 1.000000000 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Rikenellaceae Alistipes 37 LI1_2nd_8:bin_000064 -0.2610335171 0.646907024 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Tannerellaceae Parabacteroides 38 AH1_2nd_7:bin_000070 -0.2418389514 0.493532671 d__Bacteria Bacillota_A c__Clostridia Oscillospirales Oscillospiraceae Pseudoflavonifractor 39 LI1_2nd_7:bin_000040 -0.2381398538 0.583059586 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae 40 AH1_2nd_5:bin_000023 -0.2136643987 0.593548408 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Blautia 41 AH1_2nd_7:bin_000027 -0.1580093141 0.583321480 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Copromonas 42 AH1_2nd_8:bin_000027 -0.1571181689 0.675378421 d__Bacteria Bacillota c__Bacilli Erysipelotrichales Erysipelotrichaceae NSJ-61 43 AH1_2nd_15:bin_000004 -0.1536142465 0.696309517 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae UMGS1251 44 AH1_2nd_8:bin_000007 -0.1519617815 0.586159184 d__Bacteria Bacillota c__Bacilli Erysipelotrichales Erysipelotrichaceae Dielma 45 AH1_2nd_12:bin_000041 -0.1294680069 0.770313039 d__Bacteria Bacillota c__Bacilli Mycoplasmatales Mycoplasmoidaceae Mycoplasmoides 46 AH1_2nd_7:bin_000041 -0.1273204684 0.690949221 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae 47 LI1_2nd_4:bin_000034 -0.1191329256 0.736328904 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae Bacteroides Bacteroides thetaiotaomicron 48 LI1_2nd_7:bin_000083 -0.1172775988 0.698043047 d__Bacteria Bacillota_A c__Clostridia Oscillospirales Oscillospiraceae Pseudoflavonifractor 49 LI1_2nd_4:bin_000041 -0.1155769310 0.702040962 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Clostridium_Q 50 AH1_2nd_1:bin_000048 -0.1090369787 0.695407410 d__Bacteria Bacillota_A c__Clostridia Peptostreptococcales Anaerovoracaceae 51 AH1_2nd_19:bin_000067 -0.0833564079 0.811024224 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae Bacteroides Bacteroides ovatus 52 AH1_2nd_11:bin_000005 -0.0355162768 0.950102054 d__Bacteria Fusobacteriota c__Fusobacteriia Fusobacteriales Fusobacteriaceae Fusobacterium_A Fusobacterium_A ulcerans 53 LI1_2nd_7:bin_000005 -0.0290229668 1.000000000 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Ventrimonas 54 LI1_2nd_5:bin_000023 -0.0240259598 0.929045880 d__Bacteria Pseudomonadota c__Alphaproteobacteria UBA3830 55 AH1_2nd_16:bin_000058 -0.0169831516 0.954070956 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Enterocloster 56 AH1_2nd_18:bin_000033 -0.0100174674 0.969643769 d__Bacteria Bacillota c__Bacilli Erysipelotrichales Coprobacillaceae Beduini 57 AH1_2nd_15:bin_000013 -0.0001675958 0.999546475 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Ventrimonas 58 LI1_2nd_8:bin_000016 0.0011274655 0.996771407 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Rikenellaceae Rikenella 59 AH1_2nd_16:bin_000025 0.0366697281 0.901342928 d__Bacteria Bacillota_A c__Clostridia Oscillospirales Ruminococcaceae Negativibacillus 60 AH1_2nd_16:bin_000019 0.0369204081 0.924379274 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Rikenellaceae Alistipes 61 AH1_2nd_7:bin_000011 0.0479829666 0.875765303 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Lacrimispora 62 AH1_2nd_18:bin_000041 0.0540359585 1.000000000 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae Bacteroides 63 AH1_2nd_15:bin_000025 0.0701556801 0.886016538 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae Phocaeicola 64 AH1_2nd_7:bin_000004 0.0707079559 0.893038874 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Eisenbergiella 65 LI1_2nd_7:bin_000009 0.0852744160 0.793414837 d__Bacteria Bacillota_A c__Clostridia Oscillospirales Ruminococcaceae Anaerotruncus 66 LI1_2nd_7:bin_000053 0.0883838079 0.808848213 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae Bacteroides Bacteroides nordii 67 AH1_2nd_18:bin_000039 0.0902103672 0.751572915 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Rikenellaceae Alistipes 68 AH1_2nd_7:bin_000055 0.0995980252 0.783239722 d__Bacteria Bacillota c__Bacilli Mycoplasmatales Mycoplasmoidaceae Ureaplasma 69 AH1_2nd_20:bin_000042 0.1457144435 0.687129943 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Hungatella 70 AH1_2nd_14:bin_000032 0.1595169983 0.607052158 d__Bacteria Bacillota_C c__Negativicutes Selenomonadales Massilibacillaceae 71 AH1_2nd_12:bin_000018 0.1715907913 0.539214376 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Rikenellaceae Alistipes 72 AH1_2nd_14:bin_000052 0.1912431554 0.601899268 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae Bacteroides 73 AH1_2nd_13:bin_000025 0.2216490755 0.511924664 d__Bacteria Bacillota_A c__Clostridia Christensenellales UBA3700 74 AH1_2nd_1:bin_000015 0.2218604736 0.613436269 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae MGBC136627 75 LI1_2nd_5:bin_000037 0.2236604323 0.503097501 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Marinifilaceae Odoribacter 76 AH1_2nd_14:bin_000063 0.2304734293 0.488756700 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Blautia_A 77 AH1_2nd_15:bin_000043 0.2329462366 0.511602438 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae Bacteroides 78 AH1_2nd_5:bin_000004 0.2382441207 0.468334972 d__Bacteria Bacillota_A c__Clostridia Oscillospirales Acutalibacteraceae 79 LI1_2nd_7:bin_000078 0.2932171645 0.427503289 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Copromonas 80 LI1_2nd_8:bin_000006 0.3331258193 0.403780867 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Rikenellaceae Alistipes 81 AH1_2nd_14:bin_000014 0.3373252266 0.270598847 d__Bacteria Bacillota_A c__Clostridia Oscillospirales Oscillospiraceae Marseille-P3106 82 AH1_2nd_20:bin_000006 0.3542645004 0.293421552 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Marinifilaceae Butyricimonas Butyricimonas sp900184685 83 LI1_2nd_7:bin_000019 0.3561942661 0.281023895 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Marinifilaceae Butyricimonas 84 AH1_2nd_19:bin_000050 0.3635927906 0.421825302 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae 85 AH1_2nd_1:bin_000003 0.3754832574 0.314191050 d__Bacteria Cyanobacteriota c__Vampirovibrionia Gastranaerophilales Gastranaerophilaceae Scatousia 86 AH1_2nd_11:bin_000028 0.4410427786 0.247717608 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae Bacteroides 87 AH1_2nd_1:bin_000002 0.4518609898 0.177644573 d__Bacteria Bacillota_A c__Clostridia Oscillospirales Ruminococcaceae Fournierella 88 AH1_2nd_6:bin_000062 0.4580597934 0.307562524 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Muribaculaceae HGM05232 89 LI1_2nd_4:bin_000052 0.4668907031 0.232901360 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Enterocloster 90 LI1_2nd_7:bin_000033 0.4871294051 0.230751490 d__Bacteria Bacillota_A c__Clostridia Oscillospirales Ruminococcaceae Fournierella 91 AH1_2nd_16:bin_000023 0.4902761874 0.360578043 d__Bacteria Bacillota_A c__Clostridia Christensenellales UBA3700 92 AH1_2nd_6:bin_000037 0.4968732068 1.000000000 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales UBA932 Egerieousia 93 AH1_2nd_6:bin_000060 0.5058525720 0.123057603 d__Bacteria Bacillota_A c__Clostridia Oscillospirales Oscillospiraceae Intestinimonas 94 LI1_2nd_3:bin_000003 0.5061346473 0.172686818 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Rikenellaceae Alistipes 95 AH1_2nd_16:bin_000096 0.5099151644 0.171129861 d__Bacteria Bacillota_A c__Clostridia Oscillospirales Ruminococcaceae Ruthenibacterium 96 AH1_2nd_16:bin_000100 0.5845172386 0.253252310 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae Bacteroides 97 AH1_2nd_10:bin_000069 0.5995170753 0.171999992 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae Bacteroides 98 AH1_2nd_20:bin_000016 0.6065298438 0.204139484 d__Bacteria Bacillota c__Bacilli Erysipelotrichales Erysipelotrichaceae 99 AH1_2nd_18:bin_000024 0.7171503230 0.107781924 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Marinifilaceae Odoribacter 100 AH1_2nd_20:bin_000027 0.7182052755 0.095720918 d__Bacteria Desulfobacterota c__Desulfovibrionia Desulfovibrionales Desulfovibrionaceae Desulfovibrio [ reached &#39;max&#39; / getOption(&quot;max.print&quot;) -- omitted 51 rows ] colors_alphabetic &lt;- read_tsv(&quot;https://raw.githubusercontent.com/earthhologenome/EHI_taxonomy_colour/main/ehi_phylum_colors.tsv&quot;) %&gt;% mutate_at(vars(phylum), ~ str_replace(., &quot;[dpcofgs]__&quot;, &quot;&quot;)) %&gt;% right_join(taxonomy, by=join_by(phylum == phylum)) %&gt;% dplyr::select(phylum, colors) %&gt;% mutate(colors = str_c(colors, &quot;80&quot;)) %&gt;% #add 80% alpha unique() %&gt;% dplyr::arrange(phylum) tax_table &lt;- as.data.frame(unique(ancombc_rand_table_mag$phylum)) colnames(tax_table)[1] &lt;- &quot;phylum&quot; tax_color &lt;- merge(tax_table, colors_alphabetic, by=&quot;phylum&quot;)%&gt;% dplyr::arrange(phylum) %&gt;% dplyr::select(colors) %&gt;% pull() ancombc_rand_table_mag %&gt;% mutate( genome = factor(taxon, levels = ancombc_rand_table_mag$taxon), significance = ifelse(p_time_pointFMT2 &lt; 0.05, phylum, NA) # Set non-significant to NA (not mapped in legend) ) %&gt;% ggplot() + # Plot significant points with legend geom_point(aes(x = lfc_time_pointFMT2, y = -log10(p_time_pointFMT2), color = significance), size = 3, alpha = 0.7, na.rm = TRUE) + # Plot non-significant points separately without legend geom_point(data = filter(ancombc_rand_table_mag, p_time_pointFMT2 &gt;= 0.05), aes(x = lfc_time_pointFMT2, y = -log10(p_time_pointFMT2)), color = &quot;grey70&quot;, size = 3, alpha = 0.7, show.legend = FALSE) + scale_color_manual( values = tax_color, # Only keeps phylum colors in legend na.translate = FALSE # Removes NA (non-significant) from legend ) + geom_hline(yintercept = -log10(0.05), linetype = &quot;dashed&quot;) + geom_vline(xintercept = 0, linetype = &quot;dashed&quot;) + scale_y_continuous(limits = c(0, 4)) + xlab(&quot;log2FoldChange&quot;) + ylab(&quot;-log10(p-value)&quot;) + guides(color = guide_legend(title = &quot;Phylum&quot;)) + theme_minimal()+ annotate(&quot;text&quot;, x = min(ancombc_rand_table_mag$lfc_time_pointFMT2), y = 4, label = &quot;FMT2&quot;, hjust = 0, size = 4, fontface = &quot;bold&quot;) + annotate(&quot;text&quot;, x = max(ancombc_rand_table_mag$lfc_time_pointFMT2), y = 4, label = &quot;FMT1&quot;, hjust = 1, size = 4, fontface = &quot;bold&quot;) Phyla of the significant MAGs in FMT1 ancombc_rand_table_mag%&gt;% filter(p_time_pointFMT2 &lt; 0.05) %&gt;% filter(lfc_time_pointFMT2&gt;0) %&gt;% count(phylum, name = &quot;sample_count&quot;) %&gt;% arrange(desc(sample_count)) phylum sample_count 1 Bacillota_A 8 2 Bacteroidota 6 3 Pseudomonadota 2 4 Cyanobacteriota 1 5 Desulfobacterota 1 Phyla of the significant MAGs in FMT2 ancombc_rand_table_mag%&gt;% filter(p_time_pointFMT2 &lt; 0.05) %&gt;% filter(lfc_time_pointFMT2&lt;0) %&gt;% count(phylum, name = &quot;sample_count&quot;) %&gt;% arrange(desc(sample_count)) phylum sample_count 1 Bacteroidota 2 2 Pseudomonadota 2 3 Bacillota 1 4 Bacillota_A 1 5 Campylobacterota 1 9.3.2.2 CC: FMT1 vs FMT2 Structural zeros struc &lt;- structural_zeros %&gt;% filter(present==&quot;FMT1&quot;)%&gt;% count(phylum, name = &quot;FMT1&quot;) %&gt;% arrange(desc(FMT1)) structural_zeros %&gt;% filter(present==&quot;FMT2&quot;)%&gt;% count(phylum, name = &quot;FMT2&quot;) %&gt;% arrange(desc(FMT2)) %&gt;% full_join(., struc, by=&quot;phylum&quot;) %&gt;% mutate(across(everything(), ~ ifelse(is.na(.), 0, .))) %&gt;% tt() .table td.tinytable_css_xehp7bgnepxr5vup8bmx, .table th.tinytable_css_xehp7bgnepxr5vup8bmx { border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; } .table td.tinytable_css_18uly4hi64mekdp6sn8o, .table th.tinytable_css_18uly4hi64mekdp6sn8o { border-bottom: solid #d3d8dc 0.1em; } phylum FMT2 FMT1 p__Bacillota_A 19 6 p__Bacillota 6 4 p__Bacteroidota 6 6 p__Pseudomonadota 6 1 p__Cyanobacteriota 2 0 p__Desulfobacterota 2 1 p__Campylobacterota 1 0 p__Verrucomicrobiota 1 0 p__Actinomycetota 0 1 phylo_samples &lt;- sample_metadata %&gt;% filter(type == &quot;Control&quot; &amp; time_point %in% c(&quot;FMT1&quot;, &quot;FMT2&quot;) )%&gt;% column_to_rownames(&quot;Tube_code&quot;) %&gt;% sample_data() phylo_genome &lt;- genome_counts_filt %&gt;% filter(!genome %in% structural_zeros$genome) %&gt;% select(one_of(c(&quot;genome&quot;,rownames(phylo_samples)))) %&gt;% filter(rowSums(across(where(is.numeric), ~ . != 0)) &gt; 0) %&gt;% select(genome, where(~ is.numeric(.) &amp;&amp; sum(.) &gt; 0)) %&gt;% column_to_rownames(&quot;genome&quot;) %&gt;% otu_table(., taxa_are_rows = TRUE) phylo_taxonomy &lt;- genome_metadata %&gt;% filter(genome %in% rownames(phylo_genome)) %&gt;% column_to_rownames(&quot;genome&quot;) %&gt;% dplyr::select(domain,phylum,class,order,family,genus,species) %&gt;% as.matrix() %&gt;% tax_table() physeq_genome_filtered &lt;- phyloseq(phylo_genome, phylo_taxonomy, phylo_samples) ancom_rand_output_cc_fmt1_FMT2 = ancombc2(data = physeq_genome_filtered, assay_name = &quot;counts&quot;, tax_level = NULL, fix_formula = &quot;time_point&quot;, p_adj_method = &quot;holm&quot;, pseudo_sens = TRUE, prv_cut =0, lib_cut = 0, s0_perc = 0.05, group = NULL, struc_zero = FALSE, neg_lb = FALSE, alpha = 0.05, n_cl = 2, verbose = TRUE, global = FALSE, pairwise = FALSE, dunnet = FALSE, trend = FALSE, iter_control = list(tol = 1e-5, max_iter = 20, verbose = FALSE), em_control = list(tol = 1e-5, max_iter = 100), mdfdr_control = list(fwer_ctrl_method = &quot;holm&quot;, B = 100), trend_control = NULL) save(ancom_rand_output_cc_fmt1_FMT2, file=&quot;data/ancom_rand_output_cc_fmt1_FMT2.RData&quot;) load(&quot;data/ancom_rand_output_cc_fmt1_FMT2.RData&quot;) ancom_rand_output_cc_fmt1_FMT2$res %&gt;% dplyr::select(taxon, lfc_time_pointFMT2, p_time_pointFMT2) %&gt;% filter(p_time_pointFMT2 &lt; 0.05) %&gt;% left_join(., genome_metadata, by=join_by(&quot;taxon&quot;==&quot;genome&quot;)) %&gt;% select(2,3,7,8,9) %&gt;% tt() .table td.tinytable_css_u9eh3i0m411ig2mvnu9v, .table th.tinytable_css_u9eh3i0m411ig2mvnu9v { border-bottom: solid #d3d8dc 0.1em; } .table td.tinytable_css_0q30bmku4i0iwfqz8ubl, .table th.tinytable_css_0q30bmku4i0iwfqz8ubl { border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; } lfc_time_pointFMT2 p_time_pointFMT2 order family genus -1.1198010 0.0493049214 o__Gastranaerophilales f__Gastranaerophilaceae g__CALURL01 -1.5062750 0.0097993771 o__Fusobacteriales f__Fusobacteriaceae g__Fusobacterium_A 2.4827509 0.0139900313 o__RF32 f__CAG-239 g__Scatocola -1.3151251 0.0072517933 o__Lactobacillales f__Streptococcaceae g__Lactococcus 1.4541589 0.0160901322 o__Bacteroidales f__Rikenellaceae g__Alistipes -0.8116835 0.0444836721 o__Bacteroidales f__Rikenellaceae g__Alistipes 1.1136172 0.0250850130 o__Mycoplasmatales f__Mycoplasmoidaceae g__Mycoplasmoides -1.3597164 0.0258606259 o__Rhizobiales f__Rhizobiaceae g__Agrobacterium 1.1091976 0.0164391414 o__Gastranaerophilales f__Gastranaerophilaceae g__Limenecus -0.9340069 0.0351897805 o__Lachnospirales f__Lachnospiraceae g__Clostridium_Q -1.5761511 0.0087725684 o__Erysipelotrichales f__Erysipelotrichaceae g__NSJ-61 1.6900744 0.0007465450 o__Bacteroidales f__Tannerellaceae g__Parabacteroides -2.0339744 0.0146779089 o__Bacteroidales f__Marinifilaceae g__Odoribacter -1.1908960 0.0223022242 o__Coriobacteriales f__Eggerthellaceae g__Eggerthella 1.0462006 0.0272520397 o__Bacteroidales f__Tannerellaceae g__Parabacteroides -1.1937901 0.0224995913 o__Bacteroidales f__Tannerellaceae g__Parabacteroides -2.3139777 0.0012671561 o__Lachnospirales f__Lachnospiraceae g__ 1.1186724 0.0417965155 o__Lachnospirales f__Lachnospiraceae g__ -2.3220764 0.0118523538 o__Lachnospirales f__Lachnospiraceae g__MGBC136627 -1.7225724 0.0084680237 o__Lachnospirales f__Lachnospiraceae g__ -1.0102405 0.0451494772 o__Erysipelotrichales f__Erysipelotrichaceae g__Dielma 1.0311504 0.0132985343 o__Oscillospirales f__Acutalibacteraceae g__ -3.0528873 0.0006416506 o__Enterobacterales f__Enterobacteriaceae g__Proteus -2.0779366 0.0016473980 o__Mycoplasmatales f__Mycoplasmoidaceae g__Ureaplasma -1.6574844 0.0054464823 o__Bacteroidales f__Tannerellaceae g__Parabacteroides -1.1168025 0.0257358548 o__Oscillospirales f__Oscillospiraceae g__Pseudoflavonifractor -1.2369578 0.0432727439 o__Peptococcales f__Peptococcaceae g__RGIG6463 -1.1783817 0.0145456346 o__Erysipelotrichales f__Erysipelotrichaceae g__Clostridium_AQ -1.4329605 0.0047288564 o__Christensenellales f__UBA3700 g__ -1.5111121 0.0031036121 o__Bacteroidales f__Tannerellaceae g__Parabacteroides -1.1709722 0.0168869804 o__Bacteroidales f__Bacteroidaceae g__Bacteroides taxonomy &lt;- data.frame(physeq_genome_filtered@tax_table) %&gt;% rownames_to_column(., &quot;taxon&quot;) %&gt;% mutate_at(vars(order, phylum, family, genus, species), ~ str_replace(., &quot;[dpcofgs]__&quot;, &quot;&quot;)) ancombc_rand_table_mag &lt;- ancom_rand_output_cc_fmt1_FMT2$res %&gt;% dplyr::select(taxon, lfc_time_pointFMT2, p_time_pointFMT2) %&gt;% #filter(p_time_pointFMT2 &lt; 0.05) %&gt;% dplyr::arrange(p_time_pointFMT2) %&gt;% merge(., taxonomy, by=&quot;taxon&quot;) %&gt;% mutate_at(vars(phylum, species), ~ str_replace(., &quot;[dpcofgs]__&quot;, &quot;&quot;))%&gt;% dplyr::arrange(lfc_time_pointFMT2) ancombc_rand_table_mag taxon lfc_time_pointFMT2 p_time_pointFMT2 domain phylum class order family genus species 1 LI1_2nd_10:bin_000018 -3.31447172 1.0000000000 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae Bacteroides 2 AH1_2nd_7:bin_000010 -3.30303446 1.0000000000 d__Bacteria Pseudomonadota c__Alphaproteobacteria RF32 CAG-239 CAJLXD01 3 AH1_2nd_7:bin_000003 -3.05288727 0.0006416506 d__Bacteria Pseudomonadota c__Gammaproteobacteria Enterobacterales Enterobacteriaceae Proteus Proteus cibarius 4 AH1_2nd_1:bin_000015 -2.32207641 0.0118523538 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae MGBC136627 5 AH1_2nd_19:bin_000072 -2.31397767 0.0012671561 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae 6 LI1_2nd_7:bin_000053 -2.20355358 1.0000000000 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae Bacteroides Bacteroides nordii 7 AH1_2nd_7:bin_000055 -2.07793662 0.0016473980 d__Bacteria Bacillota c__Bacilli Mycoplasmatales Mycoplasmoidaceae Ureaplasma 8 AH1_2nd_18:bin_000024 -2.03397439 0.0146779089 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Marinifilaceae Odoribacter 9 AH1_2nd_12:bin_000007 -1.92051662 0.1148569151 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae 10 AH1_2nd_13:bin_000011 -1.73568910 0.0938536205 d__Bacteria Pseudomonadota c__Alphaproteobacteria RF32 CAG-239 MGBC133411 11 AH1_2nd_12:bin_000056 -1.72844259 1.0000000000 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Enterocloster 12 AH1_2nd_1:bin_000023 -1.72257236 0.0084680237 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae 13 AH1_2nd_12:bin_000044 -1.66220366 1.0000000000 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Tannerellaceae Parabacteroides Parabacteroides distasonis 14 AH1_2nd_7:bin_000065 -1.65748443 0.0054464823 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Tannerellaceae Parabacteroides 15 AH1_2nd_5:bin_000073 -1.64486345 1.0000000000 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Tannerellaceae Parabacteroides Parabacteroides goldsteinii 16 AH1_2nd_17:bin_000029 -1.57615105 0.0087725684 d__Bacteria Bacillota c__Bacilli Erysipelotrichales Erysipelotrichaceae NSJ-61 17 AH1_2nd_7:bin_000017 -1.54785352 1.0000000000 d__Bacteria Desulfobacterota c__Desulfovibrionia Desulfovibrionales Desulfovibrionaceae Lawsonia 18 LI1_2nd_7:bin_000078 -1.54732211 0.1079249807 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Copromonas 19 LI1_2nd_8:bin_000064 -1.51111211 0.0031036121 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Tannerellaceae Parabacteroides 20 AH1_2nd_11:bin_000005 -1.50627503 0.0097993771 d__Bacteria Fusobacteriota c__Fusobacteriia Fusobacteriales Fusobacteriaceae Fusobacterium_A Fusobacterium_A ulcerans 21 LI1_2nd_8:bin_000019 -1.43296047 0.0047288564 d__Bacteria Bacillota_A c__Clostridia Christensenellales UBA3700 22 AH1_2nd_15:bin_000001 -1.35971644 0.0258606259 d__Bacteria Pseudomonadota c__Alphaproteobacteria Rhizobiales Rhizobiaceae Agrobacterium Agrobacterium tumefaciens_H 23 AH1_2nd_12:bin_000008 -1.31512515 0.0072517933 d__Bacteria Bacillota c__Bacilli Lactobacillales Streptococcaceae Lactococcus Lactococcus formosensis 24 AH1_2nd_7:bin_000005 -1.25956132 1.0000000000 d__Bacteria Bacillota_C c__Negativicutes Acidaminococcales Acidaminococcaceae Phascolarctobacterium Phascolarctobacterium faecium 25 LI1_2nd_1:bin_000006 -1.23695782 0.0432727439 d__Bacteria Bacillota_B c__Peptococcia Peptococcales Peptococcaceae RGIG6463 26 LI1_2nd_7:bin_000040 -1.22539158 1.0000000000 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae 27 AH1_2nd_19:bin_000055 -1.19379007 0.0224995913 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Tannerellaceae Parabacteroides 28 AH1_2nd_18:bin_000040 -1.19089597 0.0223022242 d__Bacteria Actinomycetota c__Coriobacteriia Coriobacteriales Eggerthellaceae Eggerthella 29 LI1_2nd_4:bin_000003 -1.17899796 1.0000000000 d__Bacteria Bacillota c__Bacilli Erysipelotrichales Erysipelotrichaceae Dielma 30 LI1_2nd_7:bin_000016 -1.17838172 0.0145456346 d__Bacteria Bacillota c__Bacilli Erysipelotrichales Erysipelotrichaceae Clostridium_AQ 31 LI1_2nd_8:bin_000070 -1.17097217 0.0168869804 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae Bacteroides 32 LI1_2nd_10:bin_000017 -1.17083402 1.0000000000 d__Bacteria Chlamydiota c__Chlamydiia Chlamydiales Chlamydiaceae 33 AH1_2nd_10:bin_000010 -1.11980097 0.0493049214 d__Bacteria Cyanobacteriota c__Vampirovibrionia Gastranaerophilales Gastranaerophilaceae CALURL01 34 AH1_2nd_7:bin_000070 -1.11680255 0.0257358548 d__Bacteria Bacillota_A c__Clostridia Oscillospirales Oscillospiraceae Pseudoflavonifractor 35 AH1_2nd_7:bin_000060 -1.08947485 0.0685470039 d__Bacteria Bacillota_A c__Clostridia Eubacteriales Eubacteriaceae Eubacterium 36 AH1_2nd_10:bin_000049 -1.07227109 0.0608887882 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Tannerellaceae Parabacteroides 37 AH1_2nd_11:bin_000004 -1.02816598 1.0000000000 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Hungatella_A 38 AH1_2nd_1:bin_000034 -1.01024053 0.0451494772 d__Bacteria Bacillota c__Bacilli Erysipelotrichales Erysipelotrichaceae Dielma 39 AH1_2nd_7:bin_000036 -0.97686460 0.0502387436 d__Bacteria Bacillota_A c__Clostridia Oscillospirales Oscillospiraceae Intestinimonas 40 AH1_2nd_8:bin_000056 -0.97181884 0.1651921678 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae Bacteroides 41 LI1_2nd_8:bin_000048 -0.96753499 0.0535034050 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae 42 AH1_2nd_8:bin_000051 -0.95370662 0.0693984419 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae Bacteroides 43 AH1_2nd_13:bin_000025 -0.93846629 0.2249741351 d__Bacteria Bacillota_A c__Clostridia Christensenellales UBA3700 44 AH1_2nd_17:bin_000020 -0.93400691 0.0351897805 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Clostridium_Q 45 AH1_2nd_5:bin_000037 -0.87365532 0.1845172680 d__Bacteria Bacillota_A c__Clostridia Oscillospirales Oscillospiraceae Pseudoflavonifractor 46 AH1_2nd_14:bin_000052 -0.86717451 0.0577734349 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae Bacteroides 47 AH1_2nd_14:bin_000047 -0.81464036 0.0863462228 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae Bacteroides 48 AH1_2nd_12:bin_000018 -0.81168355 0.0444836721 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Rikenellaceae Alistipes 49 AH1_2nd_19:bin_000053 -0.79618314 0.1992914834 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae CAG-56 50 AH1_2nd_9:bin_000015 -0.79008674 0.0590367450 d__Bacteria Desulfobacterota c__Desulfovibrionia Desulfovibrionales Desulfovibrionaceae Desulfovibrio 51 AH1_2nd_19:bin_000067 -0.74344051 0.1079809596 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae Bacteroides Bacteroides ovatus 52 AH1_2nd_15:bin_000013 -0.73243588 0.0721427879 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Ventrimonas 53 AH1_2nd_14:bin_000063 -0.70775819 0.0704567863 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Blautia_A 54 LI1_2nd_4:bin_000036 -0.68890291 0.1570833781 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae 55 AH1_2nd_5:bin_000001 -0.68335428 0.1397977805 d__Bacteria Bacillota_C c__Negativicutes Selenomonadales 56 AH1_2nd_11:bin_000028 -0.68309728 0.1393442950 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae Bacteroides 57 LI1_2nd_7:bin_000083 -0.67263526 0.0624737938 d__Bacteria Bacillota_A c__Clostridia Oscillospirales Oscillospiraceae Pseudoflavonifractor 58 AH1_2nd_7:bin_000027 -0.63326144 0.0916304094 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Copromonas 59 AH1_2nd_18:bin_000033 -0.58034909 0.0910414445 d__Bacteria Bacillota c__Bacilli Erysipelotrichales Coprobacillaceae Beduini 60 AH1_2nd_15:bin_000025 -0.54489588 0.2773138276 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae Phocaeicola 61 AH1_2nd_15:bin_000004 -0.52431644 0.1585491114 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae UMGS1251 62 LI1_2nd_8:bin_000033 -0.49339480 0.1388733016 d__Bacteria Bacillota_C c__Negativicutes Selenomonadales 63 AH1_2nd_7:bin_000011 -0.48690691 0.2623426147 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Lacrimispora 64 AH1_2nd_8:bin_000027 -0.48377974 0.2494601462 d__Bacteria Bacillota c__Bacilli Erysipelotrichales Erysipelotrichaceae NSJ-61 65 AH1_2nd_16:bin_000045 -0.42231725 0.2208254178 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Rikenellaceae Alistipes 66 AH1_2nd_7:bin_000041 -0.39412286 0.2217449561 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae 67 AH1_2nd_5:bin_000023 -0.39168229 0.2268615577 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Blautia 68 AH1_2nd_7:bin_000006 -0.36796246 0.3870562374 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae JALFVM01 69 LI1_2nd_8:bin_000079 -0.35815947 0.3356688673 d__Bacteria Pseudomonadota c__Gammaproteobacteria Enterobacterales Enterobacteriaceae Citrobacter_A Citrobacter_A amalonaticus 70 AH1_2nd_20:bin_000027 -0.34093412 1.0000000000 d__Bacteria Desulfobacterota c__Desulfovibrionia Desulfovibrionales Desulfovibrionaceae Desulfovibrio 71 AH1_2nd_9:bin_000047 -0.32989275 0.3542232032 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae Bacteroides 72 AH1_2nd_18:bin_000047 -0.32948173 0.5225406255 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Tannerellaceae Parabacteroides 73 LI1_2nd_4:bin_000041 -0.32846163 0.4400601654 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Clostridium_Q 74 AH1_2nd_10:bin_000009 -0.28981661 0.4969603184 d__Bacteria Desulfobacterota c__Desulfovibrionia Desulfovibrionales Desulfovibrionaceae Bilophila 75 AH1_2nd_19:bin_000052 -0.28309379 1.0000000000 d__Bacteria Verrucomicrobiota c__Verrucomicrobiae Opitutales LL51 76 AH1_2nd_7:bin_000015 -0.27606569 0.5381996098 d__Bacteria Pseudomonadota c__Alphaproteobacteria RF32 CAG-239 CAZU01 77 AH1_2nd_19:bin_000005 -0.27324855 0.5764297719 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Roseburia 78 AH1_2nd_16:bin_000025 -0.17985834 0.6301171269 d__Bacteria Bacillota_A c__Clostridia Oscillospirales Ruminococcaceae Negativibacillus 79 AH1_2nd_6:bin_000060 -0.16640238 1.0000000000 d__Bacteria Bacillota_A c__Clostridia Oscillospirales Oscillospiraceae Intestinimonas 80 AH1_2nd_14:bin_000014 -0.13288978 0.6732891961 d__Bacteria Bacillota_A c__Clostridia Oscillospirales Oscillospiraceae Marseille-P3106 81 AH1_2nd_1:bin_000002 -0.10001017 0.8160007850 d__Bacteria Bacillota_A c__Clostridia Oscillospirales Ruminococcaceae Fournierella 82 AH1_2nd_9:bin_000023 -0.09322762 0.7761682735 d__Bacteria Bacillota c__Bacilli RFN20 CAG-288 CAG-345 83 AH1_2nd_14:bin_000003 -0.08065138 0.8025648272 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Hungatella_A 84 AH1_2nd_2:bin_000003 -0.07671433 0.8331358783 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae JAAYNV01 85 AH1_2nd_14:bin_000032 -0.07653254 0.7839900466 d__Bacteria Bacillota_C c__Negativicutes Selenomonadales Massilibacillaceae 86 AH1_2nd_12:bin_000012 -0.06274417 0.9057514001 d__Bacteria Campylobacterota c__Campylobacteria Campylobacterales Helicobacteraceae Helicobacter_J 87 AH1_2nd_19:bin_000050 -0.05308836 0.8751060041 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae 88 AH1_2nd_19:bin_000011 -0.05304035 0.8480587918 d__Bacteria Desulfobacterota c__Desulfovibrionia Desulfovibrionales Desulfovibrionaceae Mailhella 89 AH1_2nd_16:bin_000058 -0.01315872 0.9676246419 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Enterocloster 90 LI1_2nd_7:bin_000042 0.02510170 0.9570955853 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Tannerellaceae Parabacteroides_B 91 AH1_2nd_17:bin_000030 0.02700578 0.9280458119 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae Bacteroides 92 AH1_2nd_1:bin_000048 0.05860244 0.8608253774 d__Bacteria Bacillota_A c__Clostridia Peptostreptococcales Anaerovoracaceae 93 AH1_2nd_9:bin_000002 0.08996790 0.8783653622 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae Phocaeicola 94 AH1_2nd_15:bin_000043 0.09039449 0.7743586532 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae Bacteroides 95 LI1_2nd_5:bin_000013 0.09954948 0.7714367611 d__Bacteria Bacillota_A c__Clostridia Christensenellales DTU072 96 AH1_2nd_18:bin_000039 0.11265385 0.7016436018 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Rikenellaceae Alistipes 97 AH1_2nd_13:bin_000055 0.12595106 1.0000000000 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae Bacteroides Bacteroides fragilis_B 98 AH1_2nd_8:bin_000007 0.14324438 0.6584805091 d__Bacteria Bacillota c__Bacilli Erysipelotrichales Erysipelotrichaceae Dielma 99 LI1_2nd_7:bin_000009 0.14984004 0.6315253053 d__Bacteria Bacillota_A c__Clostridia Oscillospirales Ruminococcaceae Anaerotruncus 100 AH1_2nd_5:bin_000069 0.16883787 0.7076248864 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae Bacteroides [ reached &#39;max&#39; / getOption(&quot;max.print&quot;) -- omitted 25 rows ] colors_alphabetic &lt;- read_tsv(&quot;https://raw.githubusercontent.com/earthhologenome/EHI_taxonomy_colour/main/ehi_phylum_colors.tsv&quot;) %&gt;% mutate_at(vars(phylum), ~ str_replace(., &quot;[dpcofgs]__&quot;, &quot;&quot;)) %&gt;% right_join(taxonomy, by=join_by(phylum == phylum)) %&gt;% dplyr::select(phylum, colors) %&gt;% mutate(colors = str_c(colors, &quot;80&quot;)) %&gt;% #add 80% alpha unique() %&gt;% dplyr::arrange(phylum) tax_table &lt;- as.data.frame(unique(ancombc_rand_table_mag$phylum)) colnames(tax_table)[1] &lt;- &quot;phylum&quot; tax_color &lt;- merge(tax_table, colors_alphabetic, by=&quot;phylum&quot;)%&gt;% dplyr::arrange(phylum) %&gt;% dplyr::select(colors) %&gt;% pull() ancombc_rand_table_mag %&gt;% mutate( genome = factor(taxon, levels = ancombc_rand_table_mag$taxon), significance = ifelse(p_time_pointFMT2 &lt; 0.05, phylum, NA) # Set non-significant to NA (not mapped in legend) ) %&gt;% ggplot() + # Plot significant points with legend geom_point(aes(x = lfc_time_pointFMT2, y = -log10(p_time_pointFMT2), color = significance), size = 3, alpha = 0.7, na.rm = TRUE) + # Plot non-significant points separately without legend geom_point(data = filter(ancombc_rand_table_mag, p_time_pointFMT2 &gt;= 0.05), aes(x = lfc_time_pointFMT2, y = -log10(p_time_pointFMT2)), color = &quot;grey70&quot;, size = 3, alpha = 0.7, show.legend = FALSE) + scale_color_manual( values = tax_color, # Only keeps phylum colors in legend na.translate = FALSE # Removes NA (non-significant) from legend ) + geom_hline(yintercept = -log10(0.05), linetype = &quot;dashed&quot;) + geom_vline(xintercept = 0, linetype = &quot;dashed&quot;) + scale_y_continuous(limits = c(0, 4)) + xlab(&quot;log2FoldChange&quot;) + ylab(&quot;-log10(p-value)&quot;) + guides(color = guide_legend(title = &quot;Phylum&quot;)) + theme_minimal()+ annotate(&quot;text&quot;, x = min(ancombc_rand_table_mag$lfc_time_pointFMT2), y = 4, label = &quot;FMT2&quot;, hjust = 0, size = 4, fontface = &quot;bold&quot;) + annotate(&quot;text&quot;, x = max(ancombc_rand_table_mag$lfc_time_pointFMT2), y = 4, label = &quot;FMT1&quot;, hjust = 1, size = 4, fontface = &quot;bold&quot;) Phyla of the significant MAGs in FMT1 ancombc_rand_table_mag%&gt;% filter(p_time_pointFMT2 &lt; 0.05) %&gt;% filter(lfc_time_pointFMT2&gt;0) %&gt;% count(phylum, name = &quot;sample_count&quot;) %&gt;% arrange(desc(sample_count)) phylum sample_count 1 Bacteroidota 3 2 Bacillota_A 2 3 Bacillota 1 4 Cyanobacteriota 1 5 Pseudomonadota 1 Phyla of the significant MAGs in FMT2 ancombc_rand_table_mag%&gt;% filter(p_time_pointFMT2 &lt; 0.05) %&gt;% filter(lfc_time_pointFMT2&lt;0) %&gt;% count(phylum, name = &quot;sample_count&quot;) %&gt;% arrange(desc(sample_count)) phylum sample_count 1 Bacillota_A 6 2 Bacteroidota 6 3 Bacillota 5 4 Pseudomonadota 2 5 Actinomycetota 1 6 Bacillota_B 1 7 Cyanobacteriota 1 8 Fusobacteriota 1 9.3.2.3 WC: FMT1 vs FMT2 Structural zeros struc &lt;- structural_zeros %&gt;% filter(present==&quot;FMT1&quot;)%&gt;% count(phylum, name = &quot;FMT1&quot;) %&gt;% arrange(desc(FMT1)) structural_zeros %&gt;% filter(present==&quot;FMT2&quot;)%&gt;% count(phylum, name = &quot;FMT2&quot;) %&gt;% arrange(desc(FMT2)) %&gt;% full_join(., struc, by=&quot;phylum&quot;) %&gt;% mutate(across(everything(), ~ ifelse(is.na(.), 0, .))) %&gt;% tt() .table td.tinytable_css_s5ciwulfog15j740wy5n, .table th.tinytable_css_s5ciwulfog15j740wy5n { border-bottom: solid #d3d8dc 0.1em; } .table td.tinytable_css_fzzmbp7hn0kvnsutlwug, .table th.tinytable_css_fzzmbp7hn0kvnsutlwug { border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; } phylum FMT2 FMT1 p__Bacillota_A 12 13 p__Bacteroidota 8 3 p__Bacillota 4 5 p__Pseudomonadota 4 1 p__Cyanobacteriota 3 0 p__Desulfobacterota 2 0 p__Verrucomicrobiota 2 0 p__Bacillota_B 1 0 p__Bacillota_C 0 1 phylo_samples &lt;- sample_metadata %&gt;% filter(type == &quot;Hot_control&quot; &amp; time_point %in% c(&quot;FMT1&quot;, &quot;FMT2&quot;) )%&gt;% column_to_rownames(&quot;Tube_code&quot;) %&gt;% sample_data() phylo_genome &lt;- genome_counts_filt %&gt;% filter(!genome %in% structural_zeros$genome) %&gt;% select(one_of(c(&quot;genome&quot;,rownames(phylo_samples)))) %&gt;% filter(rowSums(across(where(is.numeric), ~ . != 0)) &gt; 0) %&gt;% select(genome, where(~ is.numeric(.) &amp;&amp; sum(.) &gt; 0)) %&gt;% column_to_rownames(&quot;genome&quot;) %&gt;% otu_table(., taxa_are_rows = TRUE) phylo_taxonomy &lt;- genome_metadata %&gt;% filter(genome %in% rownames(phylo_genome)) %&gt;% column_to_rownames(&quot;genome&quot;) %&gt;% dplyr::select(domain,phylum,class,order,family,genus,species) %&gt;% as.matrix() %&gt;% tax_table() physeq_genome_filtered &lt;- phyloseq(phylo_genome, phylo_taxonomy, phylo_samples) ancom_rand_output_wc_fmt1_FMT2 = ancombc2(data = physeq_genome_filtered, assay_name = &quot;counts&quot;, tax_level = NULL, fix_formula = &quot;time_point&quot;, p_adj_method = &quot;holm&quot;, pseudo_sens = TRUE, prv_cut =0, lib_cut = 0, s0_perc = 0.05, group = NULL, struc_zero = FALSE, neg_lb = FALSE, alpha = 0.05, n_cl = 2, verbose = TRUE, global = FALSE, pairwise = FALSE, dunnet = FALSE, trend = FALSE, iter_control = list(tol = 1e-5, max_iter = 20, verbose = FALSE), em_control = list(tol = 1e-5, max_iter = 100), mdfdr_control = list(fwer_ctrl_method = &quot;holm&quot;, B = 100), trend_control = NULL) save(ancom_rand_output_wc_fmt1_FMT2, file=&quot;data/ancom_rand_output_wc_fmt1_FMT2.RData&quot;) load(&quot;data/ancom_rand_output_wc_fmt1_FMT2.RData&quot;) ancom_rand_output_wc_fmt1_FMT2$res %&gt;% dplyr::select(taxon, lfc_time_pointFMT2, p_time_pointFMT2) %&gt;% filter(p_time_pointFMT2 &lt; 0.05) %&gt;% left_join(., genome_metadata, by=join_by(&quot;taxon&quot;==&quot;genome&quot;)) %&gt;% select(2,3,7,8,9) %&gt;% tt() .table td.tinytable_css_nogsymsh4v274v72ri35, .table th.tinytable_css_nogsymsh4v274v72ri35 { border-bottom: solid #d3d8dc 0.1em; } .table td.tinytable_css_3huu7nhtzpmq83q2n80z, .table th.tinytable_css_3huu7nhtzpmq83q2n80z { border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; } lfc_time_pointFMT2 p_time_pointFMT2 order family genus 1.2537326 0.029011592 o__Gastranaerophilales f__Gastranaerophilaceae g__Limenecus -1.2446217 0.020897423 o__Fusobacteriales f__Fusobacteriaceae g__Fusobacterium_A -1.3152585 0.044543566 o__Campylobacterales f__Helicobacteraceae g__Helicobacter_J -0.8821247 0.029330814 o__Lachnospirales f__Lachnospiraceae g__UMGS1251 1.0370118 0.034798957 o__Bacteroidales f__Marinifilaceae g__Odoribacter -1.4081840 0.011345343 o__Erysipelotrichales f__Coprobacillaceae g__Coprobacillus -1.1775932 0.019499013 o__Erysipelotrichales f__Erysipelotrichaceae g__ 1.3523456 0.016477166 o__Desulfovibrionales f__Desulfovibrionaceae g__Desulfovibrio 1.3457840 0.022072104 o__Christensenellales f__UBA1242 g__ -1.7017766 0.009626806 o__Bacteroidales f__Tannerellaceae g__Parabacteroides 1.2803274 0.043789284 o__Acidaminococcales f__Acidaminococcaceae g__Phascolarctobacterium -1.3245580 0.011056772 o__Bacteroidales f__Tannerellaceae g__Parabacteroides 1.3062379 0.019865972 o__Bacteroidales f__Marinifilaceae g__Odoribacter 1.3245459 0.013082060 o__UBA3830 f__UBA3830 g__ -1.5592978 0.025407226 o__Enterobacterales f__Enterobacteriaceae g__Proteus -1.0812434 0.013919048 o__Lachnospirales f__Lachnospiraceae g__Eisenbergiella -1.0099993 0.023380581 o__Bacteroidales f__Bacteroidaceae g__Bacteroides -1.2817587 0.001367698 o__Bacteroidales f__Bacteroidaceae g__Bacteroides -1.1580559 0.033213589 o__Chlamydiales f__Chlamydiaceae g__ 0.6998666 0.026257060 o__Christensenellales f__MGBC116941 g__MGBC116941 1.5483904 0.002502671 o__Christensenellales f__ g__ -0.9563076 0.039772633 o__Oscillospirales f__Ruminococcaceae g__Anaerotruncus 2.3773897 0.015636767 o__Lachnospirales f__Lachnospiraceae g__14-2 -0.9161289 0.047763620 o__Bacteroidales f__Rikenellaceae g__Alistipes -0.9044650 0.026634652 o__Oscillospirales f__Ruminococcaceae g__Fournierella 1.4541017 0.030212527 o__Bacteroidales f__Tannerellaceae g__Parabacteroides_B -1.0124183 0.011201440 o__Lachnospirales f__Lachnospiraceae g__ -0.9084866 0.028859682 o__Bacteroidales f__Bacteroidaceae g__Bacteroides -0.7064749 0.043580546 o__Lachnospirales f__Lachnospiraceae g__Copromonas -0.7714673 0.029067633 o__Oscillospirales f__Oscillospiraceae g__Pseudoflavonifractor 1.5835650 0.022738072 o__Bacteroidales f__Rikenellaceae g__Alistipes -1.8505816 0.008115738 o__Christensenellales f__UBA3700 g__ -1.1895270 0.015730599 o__Bacteroidales f__Bacteroidaceae g__Bacteroides -1.4689203 0.016641039 o__RF32 f__CAG-239 g__CAJLXD01 taxonomy &lt;- data.frame(physeq_genome_filtered@tax_table) %&gt;% rownames_to_column(., &quot;taxon&quot;) %&gt;% mutate_at(vars(order, phylum, family, genus, species), ~ str_replace(., &quot;[dpcofgs]__&quot;, &quot;&quot;)) ancombc_rand_table_mag &lt;- ancom_rand_output_wc_fmt1_FMT2$res %&gt;% dplyr::select(taxon, lfc_time_pointFMT2, p_time_pointFMT2) %&gt;% #filter(p_time_pointFMT2 &lt; 0.05) %&gt;% dplyr::arrange(p_time_pointFMT2) %&gt;% merge(., taxonomy, by=&quot;taxon&quot;) %&gt;% mutate_at(vars(phylum, species), ~ str_replace(., &quot;[dpcofgs]__&quot;, &quot;&quot;))%&gt;% dplyr::arrange(lfc_time_pointFMT2) ancombc_rand_table_mag taxon lfc_time_pointFMT2 p_time_pointFMT2 domain phylum class order family genus species 1 AH1_2nd_20:bin_000073 -4.3031986605 1.000000000 d__Bacteria Bacillota c__Bacilli Lactobacillales Enterococcaceae Enterococcus Enterococcus sp002174455 2 AH1_2nd_10:bin_000097 -2.9177221045 0.054500707 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Tannerellaceae Parabacteroides 3 LI1_2nd_8:bin_000019 -1.8505816110 0.008115738 d__Bacteria Bacillota_A c__Clostridia Christensenellales UBA3700 4 AH1_2nd_20:bin_000087 -1.7017765913 0.009626806 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Tannerellaceae Parabacteroides Parabacteroides gordonii 5 AH1_2nd_7:bin_000003 -1.5592977512 0.025407226 d__Bacteria Pseudomonadota c__Gammaproteobacteria Enterobacterales Enterobacteriaceae Proteus Proteus cibarius 6 AH1_2nd_20:bin_000054 -1.5356764519 0.102478293 d__Bacteria Bacillota c__Bacilli Erysipelotrichales Erysipelotrichaceae NSJ-61 7 LI1_2nd_9:bin_000007 -1.4689203139 0.016641039 d__Bacteria Pseudomonadota c__Alphaproteobacteria RF32 CAG-239 CAJLXD01 8 LI1_2nd_7:bin_000074 -1.4189758753 1.000000000 d__Bacteria Pseudomonadota c__Gammaproteobacteria Enterobacterales Enterobacteriaceae Escherichia Escherichia coli 9 AH1_2nd_18:bin_000011 -1.4081840491 0.011345343 d__Bacteria Bacillota c__Bacilli Erysipelotrichales Coprobacillaceae Coprobacillus 10 AH1_2nd_5:bin_000016 -1.3273361980 1.000000000 d__Bacteria Bacillota c__Bacilli Lactobacillales Enterococcaceae Enterococcus_B Enterococcus_B pernyi 11 AH1_2nd_5:bin_000073 -1.3245580375 0.011056772 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Tannerellaceae Parabacteroides Parabacteroides goldsteinii 12 AH1_2nd_12:bin_000012 -1.3152585091 0.044543566 d__Bacteria Campylobacterota c__Campylobacteria Campylobacterales Helicobacteraceae Helicobacter_J 13 AH1_2nd_9:bin_000047 -1.2817586725 0.001367698 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae Bacteroides 14 AH1_2nd_11:bin_000028 -1.2753870314 0.062137762 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae Bacteroides 15 AH1_2nd_11:bin_000005 -1.2446217311 0.020897423 d__Bacteria Fusobacteriota c__Fusobacteriia Fusobacteriales Fusobacteriaceae Fusobacterium_A Fusobacterium_A ulcerans 16 LI1_2nd_7:bin_000008 -1.1951326552 1.000000000 d__Bacteria Bacillota c__Bacilli Erysipelotrichales Erysipelotrichaceae Breznakia 17 LI1_2nd_8:bin_000070 -1.1895270220 0.015730599 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae Bacteroides 18 AH1_2nd_20:bin_000016 -1.1775932152 0.019499013 d__Bacteria Bacillota c__Bacilli Erysipelotrichales Erysipelotrichaceae 19 LI1_2nd_10:bin_000017 -1.1580558994 0.033213589 d__Bacteria Chlamydiota c__Chlamydiia Chlamydiales Chlamydiaceae 20 LI1_2nd_7:bin_000019 -1.1124293522 0.149183525 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Marinifilaceae Butyricimonas 21 AH1_2nd_7:bin_000004 -1.0812434111 0.013919048 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Eisenbergiella 22 LI1_2nd_4:bin_000034 -1.0225200710 0.083242971 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae Bacteroides Bacteroides thetaiotaomicron 23 LI1_2nd_7:bin_000040 -1.0124183060 0.011201440 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae 24 AH1_2nd_8:bin_000051 -1.0099993165 0.023380581 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae Bacteroides 25 AH1_2nd_16:bin_000023 -0.9686000832 0.085015020 d__Bacteria Bacillota_A c__Clostridia Christensenellales UBA3700 26 AH1_2nd_10:bin_000010 -0.9585647917 1.000000000 d__Bacteria Cyanobacteriota c__Vampirovibrionia Gastranaerophilales Gastranaerophilaceae CALURL01 27 LI1_2nd_7:bin_000009 -0.9563075684 0.039772633 d__Bacteria Bacillota_A c__Clostridia Oscillospirales Ruminococcaceae Anaerotruncus 28 LI1_2nd_5:bin_000023 -0.9417496711 0.168204342 d__Bacteria Pseudomonadota c__Alphaproteobacteria UBA3830 29 AH1_2nd_12:bin_000014 -0.9339125227 1.000000000 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Velocimicrobium 30 AH1_2nd_5:bin_000069 -0.9174655829 0.082673743 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae Bacteroides 31 LI1_2nd_7:bin_000012 -0.9161289182 0.047763620 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Rikenellaceae Alistipes 32 LI1_2nd_7:bin_000053 -0.9084866198 0.028859682 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae Bacteroides Bacteroides nordii 33 LI1_2nd_7:bin_000033 -0.9044650474 0.026634652 d__Bacteria Bacillota_A c__Clostridia Oscillospirales Ruminococcaceae Fournierella 34 AH1_2nd_15:bin_000004 -0.8821246572 0.029330814 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae UMGS1251 35 AH1_2nd_13:bin_000025 -0.8680263424 0.129315753 d__Bacteria Bacillota_A c__Clostridia Christensenellales UBA3700 36 AH1_2nd_15:bin_000025 -0.8595055441 0.088893228 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae Phocaeicola 37 AH1_2nd_1:bin_000023 -0.8485566246 0.051298352 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae 38 AH1_2nd_1:bin_000002 -0.8298285974 0.055203725 d__Bacteria Bacillota_A c__Clostridia Oscillospirales Ruminococcaceae Fournierella 39 AH1_2nd_20:bin_000014 -0.7873319767 0.266163558 d__Bacteria Pseudomonadota c__Gammaproteobacteria Enterobacterales Enterobacteriaceae Citrobacter Citrobacter portucalensis 40 LI1_2nd_7:bin_000083 -0.7714673222 0.029067633 d__Bacteria Bacillota_A c__Clostridia Oscillospirales Oscillospiraceae Pseudoflavonifractor 41 LI1_2nd_7:bin_000016 -0.7641367834 0.174649343 d__Bacteria Bacillota c__Bacilli Erysipelotrichales Erysipelotrichaceae Clostridium_AQ 42 AH1_2nd_19:bin_000055 -0.7482249727 0.085497964 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Tannerellaceae Parabacteroides 43 AH1_2nd_16:bin_000096 -0.7135494901 0.058885209 d__Bacteria Bacillota_A c__Clostridia Oscillospirales Ruminococcaceae Ruthenibacterium 44 AH1_2nd_7:bin_000011 -0.7111546220 0.085242948 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Lacrimispora 45 LI1_2nd_7:bin_000078 -0.7064749442 0.043580546 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Copromonas 46 AH1_2nd_15:bin_000043 -0.6930651128 0.136980924 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae Bacteroides 47 LI1_2nd_4:bin_000052 -0.6854029085 0.060051824 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Enterocloster 48 AH1_2nd_7:bin_000055 -0.6850686515 0.093901249 d__Bacteria Bacillota c__Bacilli Mycoplasmatales Mycoplasmoidaceae Ureaplasma 49 LI1_2nd_7:bin_000014 -0.6837208110 0.071808537 d__Bacteria Bacteroidota c__Bacteroidia Flavobacteriales UBA1820 Merdimorpha 50 LI1_2nd_4:bin_000024 -0.6714278639 0.134833426 d__Bacteria Bacillota_A c__Clostridia Christensenellales UBA3700 51 LI1_2nd_2:bin_000019 -0.6571501008 0.271447491 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Lacrimispora 52 LI1_2nd_9:bin_000023 -0.5650076374 0.145237850 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae JALFVM01 53 LI1_2nd_8:bin_000033 -0.5604122612 0.074391325 d__Bacteria Bacillota_C c__Negativicutes Selenomonadales 54 LI1_2nd_6:bin_000001 -0.5557966168 0.255666702 d__Bacteria Pseudomonadota c__Gammaproteobacteria Enterobacterales Enterobacteriaceae Salmonella Salmonella enterica 55 AH1_2nd_5:bin_000023 -0.5386669211 0.153233607 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Blautia 56 LI1_2nd_4:bin_000041 -0.4991024745 1.000000000 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Clostridium_Q 57 LI1_2nd_9:bin_000004 -0.4951898724 0.240711583 d__Bacteria Cyanobacteriota c__Vampirovibrionia Gastranaerophilales Gastranaerophilaceae Scatousia 58 AH1_2nd_6:bin_000024 -0.4873529814 1.000000000 d__Bacteria Spirochaetota c__Brevinematia Brevinematales Brevinemataceae Brevinema 59 AH1_2nd_6:bin_000046 -0.4829259561 0.390146489 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae Bacteroides 60 AH1_2nd_7:bin_000070 -0.4798045746 0.111090744 d__Bacteria Bacillota_A c__Clostridia Oscillospirales Oscillospiraceae Pseudoflavonifractor 61 AH1_2nd_12:bin_000015 -0.4686515851 0.304069456 d__Bacteria Bacillota c__Bacilli Erysipelotrichales Coprobacillaceae Thomasclavelia 62 LI1_2nd_4:bin_000003 -0.4551253032 0.250500169 d__Bacteria Bacillota c__Bacilli Erysipelotrichales Erysipelotrichaceae Dielma 63 AH1_2nd_9:bin_000002 -0.4142955598 0.355256835 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae Phocaeicola 64 AH1_2nd_16:bin_000020 -0.4072296475 0.297339652 d__Bacteria Desulfobacterota c__Desulfovibrionia Desulfovibrionales Desulfovibrionaceae Bilophila 65 AH1_2nd_16:bin_000019 -0.4040599998 0.412451897 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Rikenellaceae Alistipes 66 AH1_2nd_15:bin_000001 -0.3959368985 0.378170161 d__Bacteria Pseudomonadota c__Alphaproteobacteria Rhizobiales Rhizobiaceae Agrobacterium Agrobacterium tumefaciens_H 67 AH1_2nd_7:bin_000041 -0.3720973856 0.233995370 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae 68 AH1_2nd_17:bin_000020 -0.3428926031 0.374303220 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Clostridium_Q 69 LI1_2nd_7:bin_000042 -0.3142829854 0.438513832 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Tannerellaceae Parabacteroides_B 70 AH1_2nd_18:bin_000033 -0.3066543906 0.300776171 d__Bacteria Bacillota c__Bacilli Erysipelotrichales Coprobacillaceae Beduini 71 AH1_2nd_7:bin_000005 -0.3006930463 1.000000000 d__Bacteria Bacillota_C c__Negativicutes Acidaminococcales Acidaminococcaceae Phascolarctobacterium Phascolarctobacterium faecium 72 LI1_2nd_7:bin_000005 -0.2826849226 0.444682578 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Ventrimonas 73 LI1_2nd_8:bin_000038 -0.2790071525 0.381747916 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Clostridium_Q 74 AH1_2nd_16:bin_000064 -0.2750516218 0.348255518 d__Bacteria Bacillota_A c__Clostridia Oscillospirales Oscillospiraceae Scatomorpha 75 AH1_2nd_2:bin_000001 -0.2671760340 0.392465851 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae 76 AH1_2nd_2:bin_000017 -0.2223616001 0.555717356 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Copromonas 77 LI1_2nd_1:bin_000014 -0.2198452936 0.424958355 d__Bacteria Desulfobacterota c__Desulfovibrionia Desulfovibrionales Desulfovibrionaceae 78 LI1_2nd_10:bin_000018 -0.2155836414 0.582444881 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae Bacteroides 79 LI1_2nd_8:bin_000064 -0.2086630313 0.627760403 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Tannerellaceae Parabacteroides 80 AH1_2nd_16:bin_000018 -0.1829930410 0.682269344 d__Bacteria Bacillota_A c__Clostridia Christensenellales UBA3700 81 LI1_2nd_8:bin_000079 -0.1651060534 0.667068808 d__Bacteria Pseudomonadota c__Gammaproteobacteria Enterobacterales Enterobacteriaceae Citrobacter_A Citrobacter_A amalonaticus 82 AH1_2nd_1:bin_000003 -0.1645008166 0.628676671 d__Bacteria Cyanobacteriota c__Vampirovibrionia Gastranaerophilales Gastranaerophilaceae Scatousia 83 AH1_2nd_14:bin_000032 -0.1565956728 0.643080764 d__Bacteria Bacillota_C c__Negativicutes Selenomonadales Massilibacillaceae 84 AH1_2nd_14:bin_000003 -0.1550162106 0.589569859 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Hungatella_A 85 AH1_2nd_18:bin_000024 -0.1302381965 0.676600512 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Marinifilaceae Odoribacter 86 AH1_2nd_6:bin_000062 -0.1280136556 0.670802948 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Muribaculaceae HGM05232 87 AH1_2nd_10:bin_000049 -0.1268983003 0.735417765 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Tannerellaceae Parabacteroides 88 AH1_2nd_6:bin_000060 -0.1136227348 0.672787685 d__Bacteria Bacillota_A c__Clostridia Oscillospirales Oscillospiraceae Intestinimonas 89 AH1_2nd_11:bin_000004 -0.0844828810 0.792385949 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Hungatella_A 90 LI1_2nd_3:bin_000007 -0.0607461929 0.855862769 d__Bacteria Bacillota c__Bacilli Erysipelotrichales Erysipelotrichaceae C-19 91 AH1_2nd_13:bin_000011 -0.0512873419 0.901434978 d__Bacteria Pseudomonadota c__Alphaproteobacteria RF32 CAG-239 MGBC133411 92 AH1_2nd_20:bin_000042 -0.0451252679 0.896928950 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Hungatella 93 AH1_2nd_14:bin_000014 -0.0428104454 0.883994549 d__Bacteria Bacillota_A c__Clostridia Oscillospirales Oscillospiraceae Marseille-P3106 94 LI1_2nd_8:bin_000016 -0.0289266615 0.921023369 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Rikenellaceae Rikenella 95 AH1_2nd_8:bin_000006 -0.0236498519 0.958712271 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae CAG-95 96 LI1_2nd_4:bin_000036 -0.0006468985 0.998617732 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae 97 AH1_2nd_20:bin_000008 -0.0005516928 0.998506841 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Rikenellaceae Alistipes 98 AH1_2nd_15:bin_000009 0.0469551011 0.905872372 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Acetatifactor 99 LI1_2nd_8:bin_000048 0.0655156507 0.830117224 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae 100 AH1_2nd_7:bin_000027 0.0702534748 0.834430082 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Copromonas [ reached &#39;max&#39; / getOption(&quot;max.print&quot;) -- omitted 59 rows ] colors_alphabetic &lt;- read_tsv(&quot;https://raw.githubusercontent.com/earthhologenome/EHI_taxonomy_colour/main/ehi_phylum_colors.tsv&quot;) %&gt;% mutate_at(vars(phylum), ~ str_replace(., &quot;[dpcofgs]__&quot;, &quot;&quot;)) %&gt;% right_join(taxonomy, by=join_by(phylum == phylum)) %&gt;% dplyr::select(phylum, colors) %&gt;% mutate(colors = str_c(colors, &quot;80&quot;)) %&gt;% #add 80% alpha unique() %&gt;% dplyr::arrange(phylum) tax_table &lt;- as.data.frame(unique(ancombc_rand_table_mag$phylum)) colnames(tax_table)[1] &lt;- &quot;phylum&quot; tax_color &lt;- merge(tax_table, colors_alphabetic, by=&quot;phylum&quot;)%&gt;% dplyr::arrange(phylum) %&gt;% dplyr::select(colors) %&gt;% pull() ancombc_rand_table_mag %&gt;% mutate( genome = factor(taxon, levels = ancombc_rand_table_mag$taxon), significance = ifelse(p_time_pointFMT2 &lt; 0.05, phylum, NA) # Set non-significant to NA (not mapped in legend) ) %&gt;% ggplot() + # Plot significant points with legend geom_point(aes(x = lfc_time_pointFMT2, y = -log10(p_time_pointFMT2), color = significance), size = 3, alpha = 0.7, na.rm = TRUE) + # Plot non-significant points separately without legend geom_point(data = filter(ancombc_rand_table_mag, p_time_pointFMT2 &gt;= 0.05), aes(x = lfc_time_pointFMT2, y = -log10(p_time_pointFMT2)), color = &quot;grey70&quot;, size = 3, alpha = 0.7, show.legend = FALSE) + scale_color_manual( values = tax_color, # Only keeps phylum colors in legend na.translate = FALSE # Removes NA (non-significant) from legend ) + geom_hline(yintercept = -log10(0.05), linetype = &quot;dashed&quot;) + geom_vline(xintercept = 0, linetype = &quot;dashed&quot;) + scale_y_continuous(limits = c(0, 4)) + xlab(&quot;log2FoldChange&quot;) + ylab(&quot;-log10(p-value)&quot;) + guides(color = guide_legend(title = &quot;Phylum&quot;)) + theme_minimal()+ annotate(&quot;text&quot;, x = min(ancombc_rand_table_mag$lfc_time_pointFMT2), y = 4, label = &quot;FMT2&quot;, hjust = 0, size = 4, fontface = &quot;bold&quot;) + annotate(&quot;text&quot;, x = max(ancombc_rand_table_mag$lfc_time_pointFMT2), y = 4, label = &quot;FMT1&quot;, hjust = 1, size = 4, fontface = &quot;bold&quot;) Phyla of the significant MAGs in FMT1 ancombc_rand_table_mag%&gt;% filter(p_time_pointFMT2 &lt; 0.05) %&gt;% filter(lfc_time_pointFMT2&gt;0) %&gt;% count(phylum, name = &quot;sample_count&quot;) %&gt;% arrange(desc(sample_count)) phylum sample_count 1 Bacillota_A 4 2 Bacteroidota 4 3 Bacillota_C 1 4 Cyanobacteriota 1 5 Desulfobacterota 1 6 Pseudomonadota 1 Phyla of the significant MAGs in FMT2 ancombc_rand_table_mag%&gt;% filter(p_time_pointFMT2 &lt; 0.05) %&gt;% filter(lfc_time_pointFMT2&lt;0) %&gt;% count(phylum, name = &quot;sample_count&quot;) %&gt;% arrange(desc(sample_count)) phylum sample_count 1 Bacillota_A 8 2 Bacteroidota 7 3 Bacillota 2 4 Pseudomonadota 2 5 Campylobacterota 1 6 Chlamydiota 1 7 Fusobacteriota 1 "],["what-are-the-differences-at-fmt1-between-groups.html", "Chapter 10 What are the differences at FMT1 between groups? 10.1 Is the GM of the intervention group more similar to warm population after one week from FMT? 10.2 Is the GM of the intervention group still more similar to warm population after one week from FMT?", " Chapter 10 What are the differences at FMT1 between groups? 10.1 Is the GM of the intervention group more similar to warm population after one week from FMT? 10.1.1 Shapiro test alpha_div %&gt;% pivot_longer(-sample, names_to = &quot;metric&quot;, values_to = &quot;value&quot;) %&gt;% left_join(., sample_metadata, by = join_by(sample == Tube_code)) %&gt;% filter(time_point ==&quot;FMT1&quot;) %&gt;% filter(metric==&quot;richness&quot;) %&gt;% summarize(shapiro_p_value = shapiro.test(value)$p.value) %&gt;% pull(shapiro_p_value) [1] 0.6077531 alpha_div %&gt;% pivot_longer(-sample, names_to = &quot;metric&quot;, values_to = &quot;value&quot;) %&gt;% left_join(., sample_metadata, by = join_by(sample == Tube_code)) %&gt;% filter(time_point ==&quot;FMT1&quot;) %&gt;% filter(metric==&quot;neutral&quot;) %&gt;% summarize(shapiro_p_value = shapiro.test(value)$p.value) %&gt;% pull(shapiro_p_value) [1] 0.3357428 alpha_div %&gt;% pivot_longer(-sample, names_to = &quot;metric&quot;, values_to = &quot;value&quot;) %&gt;% left_join(., sample_metadata, by = join_by(sample == Tube_code)) %&gt;% filter(time_point ==&quot;FMT1&quot;) %&gt;% filter(metric==&quot;phylogenetic&quot;) %&gt;% summarize(shapiro_p_value = shapiro.test(value)$p.value) %&gt;% pull(shapiro_p_value) [1] 0.9273925 10.1.2 Alpha diversity alpha_div %&gt;% pivot_longer(-sample, names_to = &quot;metric&quot;, values_to = &quot;value&quot;) %&gt;% left_join(., sample_metadata, by = join_by(sample == Tube_code)) %&gt;% filter(time_point==&quot;FMT1&quot;) %&gt;% mutate(metric=factor(metric,levels=c(&quot;richness&quot;,&quot;neutral&quot;,&quot;phylogenetic&quot;))) %&gt;% ggplot(aes(y = value, x = type, group=type, color=type, fill=type)) + geom_boxplot(outlier.shape = NA) + geom_jitter(alpha=0.5) + scale_color_manual(name=&quot;Type&quot;, breaks=c(&quot;Control&quot;,&quot;Hot_control&quot;, &quot;Treatment&quot;), labels=c(&quot;Cold-control&quot;,&quot;Warm-control&quot;, &quot;Cold-intervention&quot;), values=c(&quot;#4477AA&quot;,&quot;#d57d2c&quot;, &quot;#76b183&quot;)) + scale_fill_manual(name=&quot;Type&quot;, breaks=c(&quot;Control&quot;,&quot;Hot_control&quot;, &quot;Treatment&quot;), labels=c(&quot;Cold-control&quot;,&quot;Warm-control&quot;, &quot;Cold-intervention&quot;), values=c(&quot;#4477AA50&quot;,&quot;#d57d2c50&quot;,&quot;#76b18350&quot;)) + facet_wrap(. ~ metric,scales = &quot;free&quot;) + coord_cartesian(xlim = c(1, NA)) + stat_compare_means(method=&quot;t.test&quot;,size=3, label.x=.7) + theme_classic() + theme( strip.background = element_blank(), panel.grid.minor.x = element_line(size = .1, color = &quot;grey&quot;), axis.title.x = element_blank(), axis.title.y = element_text(size=10), axis.text.x = element_blank(), # Increase plot size plot.title = element_text(size = 10), axis.text = element_text(size = 8), axis.title = element_text(size = 8) ) + ylab(&quot;Alpha diversity&quot;) ***p&lt;0.05 when comparing neutral beta diversity between Cold-control and Warm-control 10.1.3 Beta diversity Number of samples used samples_to_keep_post1 &lt;- sample_metadata %&gt;% filter(time_point == &quot;FMT1&quot;) %&gt;% select(Tube_code) %&gt;% pull() subset_meta_post1 &lt;- sample_metadata %&gt;% filter(time_point == &quot;FMT1&quot;) length(samples_to_keep_post1) [1] 26 Richness richness_post1 &lt;- as.matrix(beta_q0n$S) richness_post1 &lt;- as.dist(richness_post1[rownames(richness_post1) %in% samples_to_keep_post1, colnames(richness_post1) %in% samples_to_keep_post1]) betadisper(richness_post1, subset_meta_post1$type) %&gt;% permutest(., pairwise = TRUE) Permutation test for homogeneity of multivariate dispersions Permutation: free Number of permutations: 999 Response: Distances Df Sum Sq Mean Sq F N.Perm Pr(&gt;F) Groups 2 0.01060 0.0052999 1.1619 999 0.38 Residuals 23 0.10491 0.0045613 Pairwise comparisons: (Observed p-value below diagonal, permuted p-value above diagonal) Control Hot_control Treatment Control 0.036000 0.641 Hot_control 0.055742 0.478 Treatment 0.625388 0.420078 adonis2(richness_post1 ~ type, data = subset_meta_post1 %&gt;% arrange(match(Tube_code,labels(richness_post1))), permutations = 999) %&gt;% broom::tidy() %&gt;% tt() .table td.tinytable_css_lavw434bcy4r779odujb, .table th.tinytable_css_lavw434bcy4r779odujb { border-bottom: solid #d3d8dc 0.1em; } .table td.tinytable_css_f96p429csey4kl7yrm7v, .table th.tinytable_css_f96p429csey4kl7yrm7v { border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; } term df SumOfSqs R2 statistic p.value Model 2 1.195567 0.1448246 1.947534 0.001 Residual 23 7.059710 0.8551754 NA NA Total 25 8.255277 1.0000000 NA NA subset_meta_post1_arrange &lt;- column_to_rownames(subset_meta_post1, &quot;Tube_code&quot;) subset_meta_post1_arrange&lt;-subset_meta_post1_arrange[labels(richness_post1),] pairwise &lt;- pairwise.adonis(richness_post1, subset_meta_post1_arrange$type, perm=999) pairwise%&gt;% tt() .table td.tinytable_css_oufugf3wbp2hnok7t001, .table th.tinytable_css_oufugf3wbp2hnok7t001 { border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; } .table td.tinytable_css_8ggvjkm27yav3qfkkxqr, .table th.tinytable_css_8ggvjkm27yav3qfkkxqr { border-bottom: solid #d3d8dc 0.1em; } pairs Df SumsOfSqs F.Model R2 p.value p.adjusted sig Control vs Treatment 1 0.5615418 1.729004 0.1033537 0.014 0.042 . Control vs Hot_control 1 0.8438429 2.793772 0.1486541 0.001 0.003 * Treatment vs Hot_control 1 0.3734921 1.268929 0.0779971 0.102 0.306 Neutral neutral_post1 &lt;- as.matrix(beta_q1n$S) neutral_post1 &lt;- as.dist(neutral_post1[rownames(neutral_post1) %in% samples_to_keep_post1, colnames(neutral_post1) %in% samples_to_keep_post1]) betadisper(neutral_post1, subset_meta_post1$type) %&gt;% permutest(., pairwise = TRUE) Permutation test for homogeneity of multivariate dispersions Permutation: free Number of permutations: 999 Response: Distances Df Sum Sq Mean Sq F N.Perm Pr(&gt;F) Groups 2 0.002996 0.0014982 0.1374 999 0.881 Residuals 23 0.250747 0.0109020 Pairwise comparisons: (Observed p-value below diagonal, permuted p-value above diagonal) Control Hot_control Treatment Control 0.55200 0.892 Hot_control 0.55320 0.748 Treatment 0.86589 0.76648 adonis2(neutral_post1 ~ type, data = subset_meta_post1 %&gt;% arrange(match(Tube_code,labels(neutral_post1))), permutations = 999) %&gt;% broom::tidy() %&gt;% tt() .table td.tinytable_css_odqgwx5svnc5bnnw6q9y, .table th.tinytable_css_odqgwx5svnc5bnnw6q9y { border-bottom: solid #d3d8dc 0.1em; } .table td.tinytable_css_9y892cxv841x9110f9s5, .table th.tinytable_css_9y892cxv841x9110f9s5 { border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; } term df SumOfSqs R2 statistic p.value Model 2 1.395968 0.1900228 2.697931 0.001 Residual 23 5.950350 0.8099772 NA NA Total 25 7.346318 1.0000000 NA NA subset_meta_post1_arrange &lt;- column_to_rownames(subset_meta_post1, &quot;Tube_code&quot;) subset_meta_post1_arrange&lt;-subset_meta_post1_arrange[labels(neutral_post1),] pairwise &lt;- pairwise.adonis(neutral_post1, subset_meta_post1_arrange$type, perm=999) pairwise%&gt;% tt() .table td.tinytable_css_qacml7bfvgkoyo7ooubm, .table th.tinytable_css_qacml7bfvgkoyo7ooubm { border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; } .table td.tinytable_css_1aju5tghdpcl5udhvniy, .table th.tinytable_css_1aju5tghdpcl5udhvniy { border-bottom: solid #d3d8dc 0.1em; } pairs Df SumsOfSqs F.Model R2 p.value p.adjusted sig Control vs Treatment 1 0.6051778 2.250849 0.13047758 0.013 0.039 . Control vs Hot_control 1 1.0528902 4.143637 0.20570451 0.001 0.003 * Treatment vs Hot_control 1 0.4150076 1.637268 0.09840968 0.058 0.174 Phylogenetic phylo_post1 &lt;- as.matrix(beta_q1p$S) phylo_post1 &lt;- as.dist(phylo_post1[rownames(phylo_post1) %in% samples_to_keep_post1, colnames(phylo_post1) %in% samples_to_keep_post1]) betadisper(phylo_post1, subset_meta_post1$type) %&gt;% permutest(., pairwise = TRUE) Permutation test for homogeneity of multivariate dispersions Permutation: free Number of permutations: 999 Response: Distances Df Sum Sq Mean Sq F N.Perm Pr(&gt;F) Groups 2 0.00399 0.0019943 0.1213 999 0.923 Residuals 23 0.37812 0.0164399 Pairwise comparisons: (Observed p-value below diagonal, permuted p-value above diagonal) Control Hot_control Treatment Control 0.91000 0.716 Hot_control 0.91065 0.802 Treatment 0.65272 0.74852 adonis2(phylo_post1 ~ type, data = subset_meta_post1 %&gt;% arrange(match(Tube_code,labels(phylo_post1))), permutations = 999) %&gt;% broom::tidy() %&gt;% tt() .table td.tinytable_css_k02ir589iqgohftj8zgq, .table th.tinytable_css_k02ir589iqgohftj8zgq { border-bottom: solid #d3d8dc 0.1em; } .table td.tinytable_css_9n670fcc7od9upa0vh4z, .table th.tinytable_css_9n670fcc7od9upa0vh4z { border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; } term df SumOfSqs R2 statistic p.value Model 2 0.07451036 0.07059466 0.8735033 0.554 Residual 23 0.98095695 0.92940534 NA NA Total 25 1.05546731 1.00000000 NA NA subset_meta_post1_arrange &lt;- column_to_rownames(subset_meta_post1, &quot;Tube_code&quot;) subset_meta_post1_arrange&lt;-subset_meta_post1_arrange[labels(phylo_post1),] pairwise &lt;- pairwise.adonis(phylo_post1, subset_meta_post1_arrange$type, perm=999) pairwise%&gt;% tt() .table td.tinytable_css_u6hga1p2begiom1h3k28, .table th.tinytable_css_u6hga1p2begiom1h3k28 { border-bottom: solid #d3d8dc 0.1em; } .table td.tinytable_css_hlceokvdbolqi4i8tqhg, .table th.tinytable_css_hlceokvdbolqi4i8tqhg { border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; } pairs Df SumsOfSqs F.Model R2 p.value p.adjusted sig Control vs Treatment 1 0.01842535 0.4144162 0.02688498 0.766 1.000 Control vs Hot_control 1 0.05987967 1.7387847 0.09802164 0.102 0.306 Treatment vs Hot_control 1 0.03212966 0.6477782 0.04139746 0.695 1.000 NMDS richness_post1 %&gt;% metaMDS(.,trymax = 500, k=2, verbosity=FALSE, trace = FALSE) %&gt;% scores() %&gt;% as_tibble(., rownames = &quot;sample&quot;) %&gt;% left_join(subset_meta_post1, by = join_by(sample == Tube_code)) %&gt;% group_by(type) %&gt;% mutate(x_cen = mean(NMDS1, na.rm = TRUE)) %&gt;% mutate(y_cen = mean(NMDS2, na.rm = TRUE)) %&gt;% ungroup() %&gt;% ggplot(., aes(x=NMDS1,y=NMDS2, color=type)) + scale_color_manual(name=&quot;Type&quot;, breaks=c(&quot;Control&quot;, &quot;Hot_control&quot;, &quot;Treatment&quot;), labels=c(&quot;Cold-Cold&quot;, &quot;Hot-Hot&quot;, &quot;Cold-Hot&quot;), values=c(&quot;#4477AA&quot;,&quot;#d57d2c&quot;,&quot;#76b183&quot;)) + geom_point(size=2) + geom_segment(aes(x=x_cen, y=y_cen, xend=NMDS1, yend=NMDS2), alpha=0.2) + labs(y = &quot;NMDS2&quot;, x=&quot;NMDS1 \\n Richness beta diversity&quot;) + theme_classic() + theme(legend.position=&quot;none&quot;) neutral_post1 %&gt;% metaMDS(.,trymax = 500, k=2, verbosity=FALSE, trace = FALSE) %&gt;% scores() %&gt;% as_tibble(., rownames = &quot;sample&quot;) %&gt;% left_join(subset_meta_post1, by = join_by(sample == Tube_code))%&gt;% group_by(type) %&gt;% mutate(x_cen = mean(NMDS1, na.rm = TRUE)) %&gt;% mutate(y_cen = mean(NMDS2, na.rm = TRUE)) %&gt;% ungroup() %&gt;% ggplot(., aes(x=NMDS1,y=NMDS2, color=type)) + scale_color_manual(name=&quot;Type&quot;, breaks=c(&quot;Control&quot;, &quot;Hot_control&quot;, &quot;Treatment&quot;), labels=c(&quot;Cold-Cold&quot;, &quot;Hot-Hot&quot;, &quot;Cold-Hot&quot;), values=c(&quot;#4477AA&quot;,&quot;#d57d2c&quot;,&quot;#76b183&quot;)) + geom_point(size=2) + geom_segment(aes(x=x_cen, y=y_cen, xend=NMDS1, yend=NMDS2), alpha=0.2) + labs(y = &quot;NMDS2&quot;, x=&quot;NMDS1 \\n Neutral beta diversity&quot;) + theme_classic() + theme(legend.position=&quot;none&quot;) phylo_post1 %&gt;% metaMDS(.,trymax = 500, k=2, verbosity=FALSE, trace = FALSE) %&gt;% scores() %&gt;% as_tibble(., rownames = &quot;sample&quot;) %&gt;% left_join(subset_meta_post1, by = join_by(sample == Tube_code))%&gt;% group_by(type) %&gt;% mutate(x_cen = mean(NMDS1, na.rm = TRUE)) %&gt;% mutate(y_cen = mean(NMDS2, na.rm = TRUE)) %&gt;% ungroup() %&gt;% ggplot(., aes(x=NMDS1,y=NMDS2, color=type)) + scale_color_manual(name=&quot;Type&quot;, breaks=c(&quot;Control&quot;, &quot;Hot_control&quot;, &quot;Treatment&quot;), labels=c(&quot;Cold-Cold&quot;, &quot;Hot-Hot&quot;, &quot;Cold-Hot&quot;), values=c(&quot;#4477AA&quot;,&quot;#d57d2c&quot;,&quot;#76b183&quot;)) + geom_point(size=2) + geom_segment(aes(x=x_cen, y=y_cen, xend=NMDS1, yend=NMDS2), alpha=0.2) + labs(y= element_blank (), x=&quot;NMDS1 \\n Phylogenetic beta diversity&quot;) + theme_classic() + theme(legend.position=&quot;none&quot;) 10.1.4 Differentially abundant MAGs 10.1.4.1 Warm vs Intervention Structural zeros struc &lt;- structural_zeros %&gt;% filter(present==&quot;warm_control&quot;)%&gt;% count(phylum, name = &quot;Hot_control&quot;) %&gt;% arrange(desc(Hot_control)) structural_zeros %&gt;% filter(present==&quot;treatment&quot;)%&gt;% count(phylum, name = &quot;Treatment&quot;) %&gt;% arrange(desc(Treatment)) %&gt;% full_join(., struc, by=&quot;phylum&quot;) %&gt;% mutate(across(everything(), ~ ifelse(is.na(.), 0, .))) %&gt;% tt() .table td.tinytable_css_d8c8a753qdv2fdmfejzk, .table th.tinytable_css_d8c8a753qdv2fdmfejzk { border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; } .table td.tinytable_css_2vz6dad5hgo6fvtfpul7, .table th.tinytable_css_2vz6dad5hgo6fvtfpul7 { border-bottom: solid #d3d8dc 0.1em; } phylum Treatment Hot_control p__Bacillota_A 9 12 p__Bacteroidota 8 5 p__Bacillota 3 9 p__Desulfobacterota 2 1 p__Actinomycetota 1 1 p__Campylobacterota 1 0 p__Cyanobacteriota 1 4 p__Verrucomicrobiota 1 0 p__Pseudomonadota 0 5 p__Bacillota_C 0 2 p__Bacillota_B 0 1 p__Chlamydiota 0 1 p__Spirochaetota 0 1 physeq_FMT1 &lt;- subset_samples(physeq_all, type %in% c(&quot;Hot_control&quot;, &quot;Treatment&quot;) &amp; time_point == &quot;FMT1&quot;) physeq_FMT1 &lt;- prune_taxa(taxa_sums(physeq_FMT1)&gt;0, physeq_FMT1) ancom_rand_output_fmt1 = ancombc2(data = physeq_FMT1, assay_name = &quot;counts&quot;, tax_level = NULL, fix_formula = &quot;type&quot;, p_adj_method = &quot;holm&quot;, pseudo_sens = TRUE, prv_cut =0, lib_cut = 0, s0_perc = 0.05, group = NULL, struc_zero = FALSE, neg_lb = FALSE, alpha = 0.05, n_cl = 2, verbose = TRUE, global = FALSE, pairwise = FALSE, dunnet = FALSE, trend = FALSE, iter_control = list(tol = 1e-5, max_iter = 20, verbose = FALSE), em_control = list(tol = 1e-5, max_iter = 100), mdfdr_control = list(fwer_ctrl_method = &quot;holm&quot;, B = 100), trend_control = NULL) save(ancom_rand_output_fmt1, file=&quot;data/ancom_rand_output_fmt1.RData&quot;) load(&quot;data/ancom_rand_output_fmt1.RData&quot;) ancom_rand_output_fmt1$res %&gt;% dplyr::select(taxon, lfc_typeTreatment, p_typeTreatment) %&gt;% filter(p_typeTreatment &lt; 0.05) taxon lfc_typeTreatment p_typeTreatment 1 AH1_2nd_2:bin_000001 1.5624677 0.018919780 2 AH1_2nd_16:bin_000020 1.2543468 0.021313464 3 AH1_2nd_8:bin_000006 -1.4308506 0.038167012 4 AH1_2nd_1:bin_000023 1.6503345 0.002555181 5 AH1_2nd_16:bin_000058 1.3473611 0.022667050 6 AH1_2nd_2:bin_000017 1.7705419 0.025232075 7 LI1_2nd_8:bin_000019 -2.1022782 0.011143033 8 AH1_2nd_1:bin_000048 0.8195104 0.036621153 9 AH1_2nd_5:bin_000006 1.8686151 0.013960894 10 AH1_2nd_20:bin_000016 -1.4853429 0.017176614 11 LI1_2nd_4:bin_000003 -1.6188761 0.003401341 12 AH1_2nd_20:bin_000073 -1.9847277 0.049679526 taxonomy &lt;- data.frame(physeq_FMT1@tax_table) %&gt;% rownames_to_column(., &quot;taxon&quot;) %&gt;% mutate_at(vars(order, phylum, family, genus, species), ~ str_replace(., &quot;[dpcofgs]__&quot;, &quot;&quot;)) ancombc_rand_table_mag &lt;- ancom_rand_output_fmt1$res %&gt;% dplyr::select(taxon, lfc_typeTreatment, p_typeTreatment) %&gt;% #filter(p_typeTreatment &lt; 0.05) %&gt;% dplyr::arrange(p_typeTreatment) %&gt;% merge(., taxonomy, by=&quot;taxon&quot;) %&gt;% mutate_at(vars(phylum, species), ~ str_replace(., &quot;[dpcofgs]__&quot;, &quot;&quot;))%&gt;% dplyr::arrange(lfc_typeTreatment) ancombc_rand_table_mag taxon lfc_typeTreatment p_typeTreatment domain phylum class order family genus species 1 AH1_2nd_18:bin_000011 -2.468619132 1.000000000 d__Bacteria Bacillota c__Bacilli Erysipelotrichales Coprobacillaceae Coprobacillus 2 LI1_2nd_8:bin_000019 -2.102278206 0.011143033 d__Bacteria Bacillota_A c__Clostridia Christensenellales UBA3700 3 AH1_2nd_7:bin_000028 -2.066980233 1.000000000 d__Bacteria Campylobacterota c__Campylobacteria Campylobacterales Helicobacteraceae NHYM01 4 AH1_2nd_20:bin_000040 -2.016595193 1.000000000 d__Bacteria Desulfobacterota c__Desulfovibrionia Desulfovibrionales Desulfovibrionaceae Bilophila Bilophila wadsworthia 5 AH1_2nd_20:bin_000073 -1.984727713 0.049679526 d__Bacteria Bacillota c__Bacilli Lactobacillales Enterococcaceae Enterococcus Enterococcus sp002174455 6 LI1_2nd_9:bin_000007 -1.739676190 0.050274812 d__Bacteria Pseudomonadota c__Alphaproteobacteria RF32 CAG-239 CAJLXD01 7 LI1_2nd_4:bin_000003 -1.618876088 0.003401341 d__Bacteria Bacillota c__Bacilli Erysipelotrichales Erysipelotrichaceae Dielma 8 AH1_2nd_20:bin_000016 -1.485342916 0.017176614 d__Bacteria Bacillota c__Bacilli Erysipelotrichales Erysipelotrichaceae 9 AH1_2nd_8:bin_000006 -1.430850620 0.038167012 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae CAG-95 10 LI1_2nd_4:bin_000035 -1.302384706 0.077504423 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae Bacteroides Bacteroides sp900552405 11 LI1_2nd_4:bin_000052 -1.095822609 1.000000000 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Enterocloster 12 AH1_2nd_20:bin_000008 -1.080863538 1.000000000 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Rikenellaceae Alistipes 13 AH1_2nd_14:bin_000015 -0.972644946 1.000000000 d__Bacteria Bacillota_A c__Clostridia Christensenellales UBA3700 14 AH1_2nd_6:bin_000037 -0.966615209 1.000000000 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales UBA932 Egerieousia 15 LI1_2nd_10:bin_000018 -0.961330225 0.088239747 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae Bacteroides 16 LI1_2nd_5:bin_000013 -0.945686437 0.108889035 d__Bacteria Bacillota_A c__Clostridia Christensenellales DTU072 17 AH1_2nd_16:bin_000019 -0.787176315 0.072707666 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Rikenellaceae Alistipes 18 LI1_2nd_7:bin_000005 -0.768967003 0.105154547 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Ventrimonas 19 AH1_2nd_8:bin_000051 -0.763885833 0.073791871 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae Bacteroides 20 AH1_2nd_19:bin_000053 -0.744486786 0.124962342 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae CAG-56 21 AH1_2nd_7:bin_000006 -0.709164924 0.103257991 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae JALFVM01 22 AH1_2nd_11:bin_000005 -0.699464908 0.195445681 d__Bacteria Fusobacteriota c__Fusobacteriia Fusobacteriales Fusobacteriaceae Fusobacterium_A Fusobacterium_A ulcerans 23 AH1_2nd_5:bin_000051 -0.680022523 1.000000000 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae Bacteroides 24 LI1_2nd_4:bin_000034 -0.620525833 0.265900731 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae Bacteroides Bacteroides thetaiotaomicron 25 AH1_2nd_7:bin_000003 -0.585713837 0.229278417 d__Bacteria Pseudomonadota c__Gammaproteobacteria Enterobacterales Enterobacteriaceae Proteus Proteus cibarius 26 AH1_2nd_20:bin_000087 -0.584752326 0.264599869 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Tannerellaceae Parabacteroides Parabacteroides gordonii 27 AH1_2nd_15:bin_000009 -0.584171326 0.202275187 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Acetatifactor 28 AH1_2nd_1:bin_000015 -0.575993759 1.000000000 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae MGBC136627 29 AH1_2nd_11:bin_000004 -0.534315885 0.183678672 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Hungatella_A 30 LI1_2nd_4:bin_000001 -0.520630445 0.222899119 d__Bacteria Bacillota_A c__Clostridia Christensenellales 31 LI1_2nd_1:bin_000006 -0.479435438 0.225308382 d__Bacteria Bacillota_B c__Peptococcia Peptococcales Peptococcaceae RGIG6463 32 AH1_2nd_10:bin_000097 -0.467185752 0.238266594 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Tannerellaceae Parabacteroides 33 LI1_2nd_7:bin_000014 -0.420073522 1.000000000 d__Bacteria Bacteroidota c__Bacteroidia Flavobacteriales UBA1820 Merdimorpha 34 LI1_2nd_4:bin_000024 -0.402299961 1.000000000 d__Bacteria Bacillota_A c__Clostridia Christensenellales UBA3700 35 AH1_2nd_1:bin_000002 -0.394108912 0.311462398 d__Bacteria Bacillota_A c__Clostridia Oscillospirales Ruminococcaceae Fournierella 36 AH1_2nd_6:bin_000060 -0.383122844 0.230582972 d__Bacteria Bacillota_A c__Clostridia Oscillospirales Oscillospiraceae Intestinimonas 37 LI1_2nd_9:bin_000022 -0.377475898 0.420460574 d__Bacteria Bacillota_A c__Clostridia Oscillospirales Oscillospiraceae Oscillibacter 38 AH1_2nd_20:bin_000024 -0.356763333 1.000000000 d__Bacteria Pseudomonadota c__Alphaproteobacteria RF32 CAG-239 CAZU01 39 AH1_2nd_9:bin_000002 -0.344950056 0.580449613 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae Phocaeicola 40 LI1_2nd_7:bin_000001 -0.334715421 0.517219303 d__Bacteria Bacillota_A c__Clostridia Clostridiales Clostridiaceae Sarcina 41 AH1_2nd_15:bin_000013 -0.330553191 0.479054141 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Ventrimonas 42 AH1_2nd_15:bin_000004 -0.326943420 0.488207444 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae UMGS1251 43 LI1_2nd_7:bin_000040 -0.322751187 0.377235176 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae 44 LI1_2nd_7:bin_000053 -0.283084210 0.449047154 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae Bacteroides Bacteroides nordii 45 LI1_2nd_7:bin_000042 -0.274988264 0.433576175 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Tannerellaceae Parabacteroides_B 46 AH1_2nd_15:bin_000043 -0.260022127 0.532495374 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae Bacteroides 47 LI1_2nd_7:bin_000016 -0.209090913 0.711507543 d__Bacteria Bacillota c__Bacilli Erysipelotrichales Erysipelotrichaceae Clostridium_AQ 48 AH1_2nd_10:bin_000049 -0.186053708 0.640421827 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Tannerellaceae Parabacteroides 49 AH1_2nd_18:bin_000041 -0.184804264 1.000000000 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae Bacteroides 50 LI1_2nd_3:bin_000015 -0.161108085 0.703967582 d__Bacteria Bacillota c__Bacilli Staphylococcales Staphylococcaceae Staphylococcus Staphylococcus shinii 51 LI1_2nd_8:bin_000048 -0.153622459 0.681139385 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae 52 LI1_2nd_5:bin_000023 -0.139496159 0.713969567 d__Bacteria Pseudomonadota c__Alphaproteobacteria UBA3830 53 AH1_2nd_14:bin_000003 -0.122850629 0.684734837 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Hungatella_A 54 AH1_2nd_6:bin_000062 -0.117928695 0.743341522 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Muribaculaceae HGM05232 55 AH1_2nd_1:bin_000034 -0.116670875 1.000000000 d__Bacteria Bacillota c__Bacilli Erysipelotrichales Erysipelotrichaceae Dielma 56 AH1_2nd_5:bin_000073 -0.115048283 0.811444529 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Tannerellaceae Parabacteroides Parabacteroides goldsteinii 57 AH1_2nd_15:bin_000025 -0.090872120 0.875723378 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae Phocaeicola 58 LI1_2nd_7:bin_000033 -0.078905778 0.833358470 d__Bacteria Bacillota_A c__Clostridia Oscillospirales Ruminococcaceae Fournierella 59 AH1_2nd_18:bin_000024 -0.062307351 0.879116915 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Marinifilaceae Odoribacter 60 LI1_2nd_4:bin_000026 -0.031786071 0.917742179 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Marinifilaceae Odoribacter 61 AH1_2nd_5:bin_000001 -0.029490833 0.935209717 d__Bacteria Bacillota_C c__Negativicutes Selenomonadales 62 LI1_2nd_7:bin_000009 -0.028137018 0.940837245 d__Bacteria Bacillota_A c__Clostridia Oscillospirales Ruminococcaceae Anaerotruncus 63 LI1_2nd_4:bin_000010 -0.015677603 0.977118759 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Tannerellaceae Parabacteroides 64 AH1_2nd_19:bin_000011 -0.010623100 0.982873696 d__Bacteria Desulfobacterota c__Desulfovibrionia Desulfovibrionales Desulfovibrionaceae Mailhella 65 AH1_2nd_12:bin_000008 -0.001881838 0.996769914 d__Bacteria Bacillota c__Bacilli Lactobacillales Streptococcaceae Lactococcus Lactococcus formosensis 66 AH1_2nd_7:bin_000041 0.017937612 0.952594613 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae 67 AH1_2nd_1:bin_000039 0.044563259 0.902348925 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Marinifilaceae Odoribacter 68 AH1_2nd_1:bin_000003 0.049237156 0.911971117 d__Bacteria Cyanobacteriota c__Vampirovibrionia Gastranaerophilales Gastranaerophilaceae Scatousia 69 AH1_2nd_5:bin_000069 0.078447184 0.861802396 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae Bacteroides 70 AH1_2nd_16:bin_000096 0.081703659 0.824979035 d__Bacteria Bacillota_A c__Clostridia Oscillospirales Ruminococcaceae Ruthenibacterium 71 AH1_2nd_19:bin_000072 0.102617543 1.000000000 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae 72 AH1_2nd_7:bin_000011 0.106725078 0.775764395 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Lacrimispora 73 AH1_2nd_19:bin_000043 0.129918069 1.000000000 d__Bacteria Bacillota_A c__Clostridia Christensenellales Pumilibacteraceae Protoclostridium 74 LI1_2nd_8:bin_000038 0.161948148 0.630963978 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Clostridium_Q 75 AH1_2nd_16:bin_000064 0.167555439 0.658371975 d__Bacteria Bacillota_A c__Clostridia Oscillospirales Oscillospiraceae Scatomorpha 76 AH1_2nd_13:bin_000037 0.184139491 0.592936949 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Marinifilaceae Odoribacter 77 AH1_2nd_17:bin_000020 0.197975079 0.607915540 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Clostridium_Q 78 AH1_2nd_16:bin_000023 0.219753070 0.721513147 d__Bacteria Bacillota_A c__Clostridia Christensenellales UBA3700 79 AH1_2nd_20:bin_000006 0.229744759 0.541253110 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Marinifilaceae Butyricimonas Butyricimonas sp900184685 80 LI1_2nd_5:bin_000037 0.253222244 0.477947227 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Marinifilaceae Odoribacter 81 LI1_2nd_8:bin_000070 0.262946401 0.512901463 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae Bacteroides 82 LI1_2nd_7:bin_000083 0.282031662 0.432321056 d__Bacteria Bacillota_A c__Clostridia Oscillospirales Oscillospiraceae Pseudoflavonifractor 83 LI1_2nd_7:bin_000019 0.288379908 0.502957351 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Marinifilaceae Butyricimonas 84 LI1_2nd_4:bin_000041 0.292831194 1.000000000 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Clostridium_Q 85 AH1_2nd_20:bin_000042 0.318480936 0.383467843 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Hungatella 86 LI1_2nd_4:bin_000036 0.330308297 0.438011632 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae 87 AH1_2nd_16:bin_000018 0.336035409 0.469818754 d__Bacteria Bacillota_A c__Clostridia Christensenellales UBA3700 88 AH1_2nd_5:bin_000004 0.340353456 0.371230374 d__Bacteria Bacillota_A c__Clostridia Oscillospirales Acutalibacteraceae 89 AH1_2nd_10:bin_000050 0.374360982 0.301592236 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae Bacteroides Bacteroides intestinalis 90 AH1_2nd_14:bin_000032 0.375451250 0.324887265 d__Bacteria Bacillota_C c__Negativicutes Selenomonadales Massilibacillaceae 91 AH1_2nd_11:bin_000028 0.375572635 0.438976492 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae Bacteroides 92 LI1_2nd_7:bin_000078 0.393434454 0.296311532 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Copromonas 93 AH1_2nd_1:bin_000005 0.401037354 0.413159988 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae 94 LI1_2nd_9:bin_000023 0.427463842 0.283952071 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae JALFVM01 95 AH1_2nd_19:bin_000055 0.433396794 0.291856464 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Tannerellaceae Parabacteroides 96 AH1_2nd_9:bin_000047 0.448157684 0.234636950 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae Bacteroides 97 AH1_2nd_14:bin_000063 0.456394141 0.365221042 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Blautia_A 98 AH1_2nd_7:bin_000055 0.467009305 0.271531000 d__Bacteria Bacillota c__Bacilli Mycoplasmatales Mycoplasmoidaceae Ureaplasma 99 AH1_2nd_10:bin_000001 0.496894956 1.000000000 d__Bacteria Cyanobacteriota c__Vampirovibrionia Gastranaerophilales Gastranaerophilaceae Limenecus 100 AH1_2nd_16:bin_000033 0.502343930 0.302206437 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales [ reached &#39;max&#39; / getOption(&quot;max.print&quot;) -- omitted 108 rows ] colors_alphabetic &lt;- read_tsv(&quot;https://raw.githubusercontent.com/earthhologenome/EHI_taxonomy_colour/main/ehi_phylum_colors.tsv&quot;) %&gt;% mutate_at(vars(phylum), ~ str_replace(., &quot;[dpcofgs]__&quot;, &quot;&quot;)) %&gt;% right_join(taxonomy, by=join_by(phylum == phylum)) %&gt;% dplyr::select(phylum, colors) %&gt;% mutate(colors = str_c(colors, &quot;80&quot;)) %&gt;% #add 80% alpha unique() %&gt;% dplyr::arrange(phylum) tax_table &lt;- as.data.frame(unique(ancombc_rand_table_mag$phylum)) colnames(tax_table)[1] &lt;- &quot;phylum&quot; tax_color &lt;- merge(tax_table, colors_alphabetic, by=&quot;phylum&quot;)%&gt;% dplyr::arrange(phylum) %&gt;% dplyr::select(colors) %&gt;% pull() ancombc_rand_table_mag %&gt;% mutate( genome = factor(taxon, levels = ancombc_rand_table_mag$taxon), significance = ifelse(p_typeTreatment &lt; 0.05, phylum, NA) # Set non-significant to NA (not mapped in legend) ) %&gt;% ggplot() + # Plot significant points with legend geom_point(aes(x = lfc_typeTreatment, y = -log10(p_typeTreatment), color = significance), size = 3, alpha = 0.7, na.rm = TRUE) + # Plot non-significant points separately without legend geom_point(data = filter(ancombc_rand_table_mag, p_typeTreatment &gt;= 0.05), aes(x = lfc_typeTreatment, y = -log10(p_typeTreatment)), color = &quot;grey70&quot;, size = 3, alpha = 0.7, show.legend = FALSE) + scale_color_manual( values = tax_color, # Only keeps phylum colors in legend na.translate = FALSE # Removes NA (non-significant) from legend ) + geom_hline(yintercept = -log10(0.05), linetype = &quot;dashed&quot;) + geom_vline(xintercept = 0, linetype = &quot;dashed&quot;) + scale_y_continuous(limits = c(0, 4)) + xlab(&quot;log2FoldChange&quot;) + ylab(&quot;-log10(p-value)&quot;) + guides(color = guide_legend(title = &quot;Phylum&quot;)) + theme_minimal()+ annotate(&quot;text&quot;, x = min(ancombc_rand_table_mag$lfc_typeTreatment), y = 4, label = &quot;Cold-intervention&quot;, hjust = 0, size = 4, fontface = &quot;bold&quot;) + annotate(&quot;text&quot;, x = max(ancombc_rand_table_mag$lfc_typeTreatment), y = 4, label = &quot;Warm-control&quot;, hjust = 1, size = 4, fontface = &quot;bold&quot;) Phyla of the significant MAGs in warm control ancombc_rand_table_mag%&gt;% filter(p_typeTreatment &lt; 0.05) %&gt;% filter(lfc_typeTreatment&gt;0) %&gt;% count(phylum, name = &quot;sample_count&quot;) %&gt;% arrange(desc(sample_count)) phylum sample_count 1 Bacillota_A 4 2 Bacillota_C 1 3 Bacteroidota 1 4 Desulfobacterota 1 Phyla of the significant MAGs in intervention group ancombc_rand_table_mag%&gt;% filter(p_typeTreatment &lt; 0.05) %&gt;% filter(lfc_typeTreatment&lt;0) %&gt;% count(phylum, name = &quot;sample_count&quot;) %&gt;% arrange(desc(sample_count)) phylum sample_count 1 Bacillota 3 2 Bacillota_A 2 10.1.4.2 Intervention vs cold control Structural zeros struc &lt;- structural_zeros %&gt;% filter(present==&quot;cold_control&quot;)%&gt;% count(phylum, name = &quot;Cold_control&quot;) %&gt;% arrange(desc(Cold_control)) structural_zeros %&gt;% filter(present==&quot;treatment&quot;)%&gt;% count(phylum, name = &quot;Treatment&quot;) %&gt;% arrange(desc(Treatment)) %&gt;% full_join(., struc, by=&quot;phylum&quot;) %&gt;% mutate(across(everything(), ~ ifelse(is.na(.), 0, .))) %&gt;% tt() .table td.tinytable_css_vhv6zal2e5ra278ghng2, .table th.tinytable_css_vhv6zal2e5ra278ghng2 { border-bottom: solid #d3d8dc 0.1em; } .table td.tinytable_css_mwemwqh9bs05ntc6cs2i, .table th.tinytable_css_mwemwqh9bs05ntc6cs2i { border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; } phylum Treatment Cold_control p__Bacteroidota 24 10 p__Bacillota_A 16 4 p__Desulfobacterota 3 3 p__Bacillota 2 3 p__Campylobacterota 2 0 p__Cyanobacteriota 2 2 p__Bacillota_C 1 2 p__Elusimicrobiota 1 0 p__Pseudomonadota 1 4 p__Actinomycetota 0 1 p__Chlamydiota 0 1 physeq_FMT1_cold &lt;- subset_samples(physeq_all, type %in% c(&quot;Control&quot;, &quot;Treatment&quot;) &amp; time_point == &quot;FMT1&quot;) physeq_FMT1_cold &lt;- prune_taxa(taxa_sums(physeq_FMT1_cold)&gt;0, physeq_FMT1_cold) ancom_rand_output_cold = ancombc2(data = physeq_FMT1_cold, assay_name = &quot;counts&quot;, tax_level = NULL, fix_formula = &quot;type&quot;, p_adj_method = &quot;holm&quot;, pseudo_sens = TRUE, prv_cut =0, lib_cut = 0, s0_perc = 0.05, group = NULL, struc_zero = FALSE, neg_lb = FALSE, alpha = 0.05, n_cl = 2, verbose = TRUE, global = FALSE, pairwise = FALSE, dunnet = FALSE, trend = FALSE, iter_control = list(tol = 1e-5, max_iter = 20, verbose = FALSE), em_control = list(tol = 1e-5, max_iter = 100), mdfdr_control = list(fwer_ctrl_method = &quot;holm&quot;, B = 100), trend_control = NULL) save(ancom_rand_output_cold, file=&quot;data/ancom_rand_output_cold.RData&quot;) load(&quot;data/ancom_rand_output_cold.RData&quot;) ancom_rand_output_cold$res %&gt;% dplyr::select(taxon, lfc_typeTreatment, p_typeTreatment) %&gt;% filter(p_typeTreatment &lt; 0.05) %&gt;% left_join(., genome_metadata, by=join_by(&quot;taxon&quot;==&quot;genome&quot;)) %&gt;% select(2,3,8,9,10) %&gt;% tt() .table td.tinytable_css_oiduit8n9fi2190cx01w, .table th.tinytable_css_oiduit8n9fi2190cx01w { border-bottom: solid #d3d8dc 0.1em; } .table td.tinytable_css_8dyxhrq2xlx5y9syp94f, .table th.tinytable_css_8dyxhrq2xlx5y9syp94f { border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; } lfc_typeTreatment p_typeTreatment family genus species -1.2669085 0.016056297 f__Bacteroidaceae g__Bacteroides s__ -1.0321400 0.038302393 f__Bacteroidaceae g__Bacteroides s__ -0.9895362 0.028180996 f__Tannerellaceae g__Parabacteroides s__ -1.5258430 0.008367883 f__Tannerellaceae g__Parabacteroides s__ -1.5870692 0.009614235 f__Enterobacteriaceae g__Proteus s__Proteus cibarius -0.9815246 0.034489041 f__Oscillospiraceae g__Intestinimonas s__ -1.3260451 0.031388530 f__Lachnospiraceae g__JALFVM01 s__ -1.2001345 0.030460336 f__Lachnospiraceae g__Ventrimonas s__ -1.7676743 0.021740985 f__UBA3700 g__ s__ -0.9341728 0.023128929 f__Mycoplasmoidaceae g__Ureaplasma s__ 1.3651254 0.049425233 f__Enterococcaceae g__Enterococcus s__Enterococcus sp002174455 taxonomy &lt;- data.frame(physeq_FMT1_cold@tax_table) %&gt;% rownames_to_column(., &quot;taxon&quot;) %&gt;% mutate_at(vars(order, phylum, family, genus, species), ~ str_replace(., &quot;[dpcofgs]__&quot;, &quot;&quot;)) ancombc_rand_table_mag &lt;- ancom_rand_output_cold$res %&gt;% dplyr::select(taxon, lfc_typeTreatment, p_typeTreatment) %&gt;% #filter(p_typeTreatment &lt; 0.05) %&gt;% dplyr::arrange(p_typeTreatment) %&gt;% merge(., taxonomy, by=&quot;taxon&quot;) %&gt;% mutate_at(vars(phylum, species), ~ str_replace(., &quot;[dpcofgs]__&quot;, &quot;&quot;))%&gt;% dplyr::arrange(lfc_typeTreatment) colors_alphabetic &lt;- read_tsv(&quot;https://raw.githubusercontent.com/earthhologenome/EHI_taxonomy_colour/main/ehi_phylum_colors.tsv&quot;) %&gt;% mutate_at(vars(phylum), ~ str_replace(., &quot;[dpcofgs]__&quot;, &quot;&quot;)) %&gt;% right_join(taxonomy, by=join_by(phylum == phylum)) %&gt;% dplyr::select(phylum, colors) %&gt;% mutate(colors = str_c(colors, &quot;80&quot;)) %&gt;% #add 80% alpha unique() %&gt;% dplyr::arrange(phylum) tax_table &lt;- as.data.frame(unique(ancombc_rand_table_mag$phylum)) colnames(tax_table)[1] &lt;- &quot;phylum&quot; tax_color &lt;- merge(tax_table, colors_alphabetic, by=&quot;phylum&quot;)%&gt;% dplyr::arrange(phylum) %&gt;% dplyr::select(colors) %&gt;% pull() ancombc_rand_table_mag %&gt;% mutate( genome = factor(taxon, levels = ancombc_rand_table_mag$taxon), significance = ifelse(p_typeTreatment &lt; 0.05, phylum, NA) # Set non-significant to NA (not mapped in legend) ) %&gt;% ggplot() + # Plot significant points with legend geom_point(aes(x = lfc_typeTreatment, y = -log10(p_typeTreatment), color = significance), size = 3, alpha = 0.7, na.rm = TRUE) + # Plot non-significant points separately without legend geom_point(data = filter(ancombc_rand_table_mag, p_typeTreatment &gt;= 0.05), aes(x = lfc_typeTreatment, y = -log10(p_typeTreatment)), color = &quot;grey70&quot;, size = 3, alpha = 0.7, show.legend = FALSE) + scale_color_manual( values = tax_color, # Only keeps phylum colors in legend na.translate = FALSE # Removes NA (non-significant) from legend ) + geom_hline(yintercept = -log10(0.05), linetype = &quot;dashed&quot;) + geom_vline(xintercept = 0, linetype = &quot;dashed&quot;) + scale_y_continuous(limits = c(0, 4)) + xlab(&quot;log2FoldChange&quot;) + ylab(&quot;-log10(p-value)&quot;) + guides(color = guide_legend(title = &quot;Phylum&quot;)) + theme_minimal()+ annotate(&quot;text&quot;, x = min(ancombc_rand_table_mag$lfc_typeTreatment), y = 4, label = &quot;Cold-control&quot;, hjust = 0, size = 4, fontface = &quot;bold&quot;) + annotate(&quot;text&quot;, x = max(ancombc_rand_table_mag$lfc_typeTreatment), y = 4, label = &quot;Cold-intervention&quot;, hjust = 1, size = 4, fontface = &quot;bold&quot;) Phyla of the significant MAGs in intervention group ancombc_rand_table_mag%&gt;% filter(p_typeTreatment &lt; 0.05) %&gt;% filter(lfc_typeTreatment&gt;0) %&gt;% count(phylum, name = &quot;sample_count&quot;) %&gt;% arrange(desc(sample_count)) phylum sample_count 1 Bacillota 1 Phyla of the significant MAGs in cold control ancombc_rand_table_mag%&gt;% filter(p_typeTreatment &lt; 0.05) %&gt;% filter(lfc_typeTreatment&lt;0) %&gt;% count(phylum, name = &quot;sample_count&quot;) %&gt;% arrange(desc(sample_count)) phylum sample_count 1 Bacillota_A 4 2 Bacteroidota 4 3 Bacillota 1 4 Pseudomonadota 1 10.1.4.3 Functional differences MCI GIFTs_functions_community %&gt;% rowMeans() %&gt;% as_tibble(., rownames = &quot;sample&quot;) %&gt;% left_join(sample_metadata, by = join_by(sample == Tube_code)) %&gt;% filter(time_point==&quot;FMT1&quot;) %&gt;% group_by(type) %&gt;% summarise(MCI = mean(value), sd = sd(value)) # A tibble: 3 × 3 type MCI sd &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; 1 Control 0.373 0.0247 2 Hot_control 0.372 0.0367 3 Treatment 0.353 0.0186 MCI_tm5_ele &lt;- GIFTs_functions_community %&gt;% rowMeans() %&gt;% as_tibble(., rownames = &quot;sample&quot;) %&gt;% left_join(sample_metadata, by = join_by(sample == Tube_code)) %&gt;% filter(time_point == &quot;FMT1&quot;) shapiro.test(MCI_tm5_ele$value)#normality test Shapiro-Wilk normality test data: MCI_tm5_ele$value W = 0.92343, p-value = 0.05415 res.aov &lt;- aov(value ~ type, data = MCI_tm5_ele)#anova test summary(res.aov) Df Sum Sq Mean Sq F value Pr(&gt;F) type 2 0.00216 0.0010798 1.371 0.274 Residuals 23 0.01811 0.0007875 Functional differences CC and CI element_gift %&gt;% filter(type %in% c(&quot;Control&quot;, &quot;Treatment&quot;) &amp; time_point == &quot;FMT1&quot;) %&gt;% select(-time_point, -type) %&gt;% filter(rowSums(across(where(is.numeric), ~ . != 0)) &gt; 0) %&gt;% select(Tube_code, where( ~ is.numeric(.) &amp;&amp; sum(.) &gt; 0)) %&gt;% left_join(sample_metadata[c(1, 7)], by = &quot;Tube_code&quot;) %&gt;% pivot_longer(-c(Tube_code, type), names_to = &quot;trait&quot;, values_to = &quot;value&quot;) %&gt;% group_by(trait) %&gt;% summarise(p_value = wilcox.test(value ~ type)$p.value) %&gt;% mutate(p_adjust = p.adjust(p_value, method = &quot;BH&quot;)) %&gt;% filter(p_adjust &lt; 0.05) %&gt;% remove_rownames() # A tibble: 0 × 3 # ℹ 3 variables: trait &lt;chr&gt;, p_value &lt;dbl&gt;, p_adjust &lt;dbl&gt; CI and WC element_gift %&gt;% filter(type %in% c(&quot;Hot_control&quot;, &quot;Treatment&quot;) &amp; time_point == &quot;FMT1&quot;) %&gt;% select(-time_point, -type) %&gt;% filter(rowSums(across(where(is.numeric), ~ . != 0)) &gt; 0) %&gt;% select(Tube_code, where(~ is.numeric(.) &amp;&amp; sum(.) &gt; 0)) %&gt;% left_join(sample_metadata[c(1, 7)], by = &quot;Tube_code&quot;) %&gt;% pivot_longer(-c(Tube_code,type), names_to = &quot;trait&quot;, values_to = &quot;value&quot;) %&gt;% group_by(trait) %&gt;% summarise(p_value = wilcox.test(value ~ type)$p.value) %&gt;% mutate(p_adjust=p.adjust(p_value, method=&quot;BH&quot;)) %&gt;% filter(p_adjust &lt; 0.05)%&gt;% remove_rownames() # A tibble: 0 × 3 # ℹ 3 variables: trait &lt;chr&gt;, p_value &lt;dbl&gt;, p_adjust &lt;dbl&gt; CC and WC element_gift %&gt;% filter(type %in% c(&quot;Hot_control&quot;, &quot;Control&quot;) &amp; time_point == &quot;FMT1&quot;) %&gt;% select(-time_point, -type) %&gt;% filter(rowSums(across(where(is.numeric), ~ . != 0)) &gt; 0) %&gt;% select(Tube_code, where(~ is.numeric(.) &amp;&amp; sum(.) &gt; 0)) %&gt;% left_join(sample_metadata[c(1, 7)], by = &quot;Tube_code&quot;) %&gt;% pivot_longer(-c(Tube_code,type), names_to = &quot;trait&quot;, values_to = &quot;value&quot;) %&gt;% group_by(trait) %&gt;% summarise(p_value = wilcox.test(value ~ type)$p.value) %&gt;% mutate(p_adjust=p.adjust(p_value, method=&quot;BH&quot;)) %&gt;% filter(p_adjust &lt; 0.05)%&gt;% remove_rownames() # A tibble: 0 × 3 # ℹ 3 variables: trait &lt;chr&gt;, p_value &lt;dbl&gt;, p_adjust &lt;dbl&gt; 10.2 Is the GM of the intervention group still more similar to warm population after one week from FMT? 10.2.1 Shapiro test alpha_div %&gt;% pivot_longer(-sample, names_to = &quot;metric&quot;, values_to = &quot;value&quot;) %&gt;% left_join(., sample_metadata, by = join_by(sample == Tube_code)) %&gt;% filter(time_point ==&quot;FMT2&quot;) %&gt;% filter(metric==&quot;richness&quot;) %&gt;% summarize(shapiro_p_value = shapiro.test(value)$p.value) %&gt;% pull(shapiro_p_value) [1] 0.1683943 alpha_div %&gt;% pivot_longer(-sample, names_to = &quot;metric&quot;, values_to = &quot;value&quot;) %&gt;% left_join(., sample_metadata, by = join_by(sample == Tube_code)) %&gt;% filter(time_point ==&quot;FMT2&quot;) %&gt;% filter(metric==&quot;neutral&quot;) %&gt;% summarize(shapiro_p_value = shapiro.test(value)$p.value) %&gt;% pull(shapiro_p_value) [1] 0.6310339 alpha_div %&gt;% pivot_longer(-sample, names_to = &quot;metric&quot;, values_to = &quot;value&quot;) %&gt;% left_join(., sample_metadata, by = join_by(sample == Tube_code)) %&gt;% filter(time_point ==&quot;FMT2&quot;) %&gt;% filter(metric==&quot;phylogenetic&quot;) %&gt;% summarize(shapiro_p_value = shapiro.test(value)$p.value) %&gt;% pull(shapiro_p_value) [1] 0.3446539 10.2.2 Alpha diversity alpha_div %&gt;% pivot_longer(-sample, names_to = &quot;metric&quot;, values_to = &quot;value&quot;) %&gt;% left_join(., sample_metadata, by = join_by(sample == Tube_code)) %&gt;% filter(time_point==&quot;FMT2&quot;) %&gt;% mutate(metric=factor(metric,levels=c(&quot;richness&quot;,&quot;neutral&quot;,&quot;phylogenetic&quot;))) %&gt;% ggplot(aes(y = value, x = type, group=type, color=type, fill=type)) + geom_boxplot(outlier.shape = NA) + geom_jitter(alpha=0.5) + scale_color_manual(name=&quot;Type&quot;, breaks=c(&quot;Control&quot;,&quot;Hot_control&quot;, &quot;Treatment&quot;), labels=c(&quot;Cold-control&quot;,&quot;Warm-control&quot;, &quot;Cold-intervention&quot;), values=c(&quot;#4477AA&quot;,&quot;#d57d2c&quot;, &quot;#76b183&quot;)) + scale_fill_manual(name=&quot;Type&quot;, breaks=c(&quot;Control&quot;,&quot;Hot_control&quot;, &quot;Treatment&quot;), labels=c(&quot;Cold-control&quot;,&quot;Warm-control&quot;, &quot;Cold-intervention&quot;), values=c(&quot;#4477AA50&quot;,&quot;#d57d2c50&quot;,&quot;#76b18350&quot;)) + scale_x_discrete(labels = c(&quot;Control&quot; = &quot;Cold-Cold&quot;, &quot;Hot_control&quot; = &quot;Hot-Hot&quot;, &quot;Treatment&quot; = &quot;Cold-Hot&quot;)) + facet_wrap(. ~ metric,scales = &quot;free&quot;) + coord_cartesian(xlim = c(1, NA)) + stat_compare_means(method=&quot;t.test&quot;,size=3, label.x=.7) + theme_classic() + theme( strip.background = element_blank(), panel.grid.minor.x = element_line(size = .1, color = &quot;grey&quot;), axis.title.x = element_blank(), axis.title.y = element_text(size=10), axis.text.x = element_blank(), # Increase plot size plot.title = element_text(size = 10), axis.text = element_text(size = 8), axis.title = element_text(size = 8) ) + ylab(&quot;Alpha diversity&quot;) ***p&lt;0.05 when comparing richness and neutral beta diversity between Cold-control and Cold-intervention 10.2.3 Beta diversity Number of samples used samples_to_keep_FMT2 &lt;- sample_metadata %&gt;% filter(time_point == &quot;FMT2&quot;) %&gt;% select(Tube_code) %&gt;% pull() subset_meta_FMT2 &lt;- sample_metadata %&gt;% filter(time_point == &quot;FMT2&quot;) length(samples_to_keep_FMT2) [1] 27 Richness richness_FMT2 &lt;- as.matrix(beta_q0n$S) richness_FMT2 &lt;- as.dist(richness_FMT2[rownames(richness_FMT2) %in% samples_to_keep_FMT2, colnames(richness_FMT2) %in% samples_to_keep_FMT2]) betadisper(richness_FMT2, subset_meta_FMT2$type) %&gt;% permutest(., pairwise = TRUE) Permutation test for homogeneity of multivariate dispersions Permutation: free Number of permutations: 999 Response: Distances Df Sum Sq Mean Sq F N.Perm Pr(&gt;F) Groups 2 0.003043 0.0015214 0.2578 999 0.764 Residuals 24 0.141630 0.0059013 Pairwise comparisons: (Observed p-value below diagonal, permuted p-value above diagonal) Control Hot_control Treatment Control 0.93800 0.498 Hot_control 0.93628 0.534 Treatment 0.50455 0.54043 adonis2(richness_FMT2 ~ type, data = subset_meta_FMT2 %&gt;% arrange(match(Tube_code,labels(richness_FMT2))), permutations = 999) %&gt;% broom::tidy() %&gt;% tt() .table td.tinytable_css_5rhap0x20qu64csk5n8l, .table th.tinytable_css_5rhap0x20qu64csk5n8l { border-bottom: solid #d3d8dc 0.1em; } .table td.tinytable_css_2efpvqmqucde58osmxzu, .table th.tinytable_css_2efpvqmqucde58osmxzu { border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; } term df SumOfSqs R2 statistic p.value Model 2 1.504341 0.1967776 2.939822 0.001 Residual 24 6.140538 0.8032224 NA NA Total 26 7.644879 1.0000000 NA NA subset_meta_FMT2_arrange &lt;- column_to_rownames(subset_meta_FMT2, &quot;Tube_code&quot;) subset_meta_FMT2_arrange&lt;-subset_meta_FMT2_arrange[labels(richness_FMT2),] pairwise &lt;- pairwise.adonis(richness_FMT2, subset_meta_FMT2_arrange$type, perm=999) pairwise%&gt;% tt() .table td.tinytable_css_lccg3x6qsjxduu991rkb, .table th.tinytable_css_lccg3x6qsjxduu991rkb { border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; } .table td.tinytable_css_atpnudbkxk8z6ih29bnn, .table th.tinytable_css_atpnudbkxk8z6ih29bnn { border-bottom: solid #d3d8dc 0.1em; } pairs Df SumsOfSqs F.Model R2 p.value p.adjusted sig Control vs Treatment 1 0.6463814 2.560441 0.1379515 0.001 0.003 * Control vs Hot_control 1 1.1305044 4.268317 0.2105906 0.001 0.003 * Treatment vs Hot_control 1 0.4796256 1.916520 0.1069694 0.001 0.003 * Neutral neutral_FMT2 &lt;- as.matrix(beta_q1n$S) neutral_FMT2 &lt;- as.dist(neutral_FMT2[rownames(neutral_FMT2) %in% samples_to_keep_FMT2, colnames(neutral_FMT2) %in% samples_to_keep_FMT2]) betadisper(neutral_FMT2, subset_meta_FMT2$type) %&gt;% permutest(., pairwise = TRUE) Permutation test for homogeneity of multivariate dispersions Permutation: free Number of permutations: 999 Response: Distances Df Sum Sq Mean Sq F N.Perm Pr(&gt;F) Groups 2 0.005365 0.0026827 0.309 999 0.736 Residuals 24 0.208332 0.0086805 Pairwise comparisons: (Observed p-value below diagonal, permuted p-value above diagonal) Control Hot_control Treatment Control 0.75000 0.636 Hot_control 0.75233 0.436 Treatment 0.64640 0.46107 adonis2(neutral_FMT2 ~ type, data = subset_meta_FMT2 %&gt;% arrange(match(Tube_code,labels(neutral_FMT2))), permutations = 999) %&gt;% broom::tidy() %&gt;% tt() .table td.tinytable_css_fbhqj287ycxd3gtorrke, .table th.tinytable_css_fbhqj287ycxd3gtorrke { border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; } .table td.tinytable_css_c0dm83pi8bh5rn8c9r58, .table th.tinytable_css_c0dm83pi8bh5rn8c9r58 { border-bottom: solid #d3d8dc 0.1em; } term df SumOfSqs R2 statistic p.value Model 2 1.923807 0.2603795 4.224537 0.001 Residual 24 5.464666 0.7396205 NA NA Total 26 7.388473 1.0000000 NA NA subset_meta_FMT2_arrange &lt;- column_to_rownames(subset_meta_FMT2, &quot;Tube_code&quot;) subset_meta_FMT2_arrange&lt;-subset_meta_FMT2_arrange[labels(neutral_FMT2),] pairwise &lt;- pairwise.adonis(neutral_FMT2, subset_meta_FMT2_arrange$type, perm=999) pairwise%&gt;% tt() .table td.tinytable_css_5xgys37b9ix3e4xg1708, .table th.tinytable_css_5xgys37b9ix3e4xg1708 { border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; } .table td.tinytable_css_3kdmj17ov2shs27g5s10, .table th.tinytable_css_3kdmj17ov2shs27g5s10 { border-bottom: solid #d3d8dc 0.1em; } pairs Df SumsOfSqs F.Model R2 p.value p.adjusted sig Control vs Treatment 1 1.0227481 4.648335 0.2251191 0.001 0.003 * Control vs Hot_control 1 1.3619424 5.771031 0.2650785 0.001 0.003 * Treatment vs Hot_control 1 0.5010202 2.206532 0.1211945 0.001 0.003 * Phylogenetic phylo_FMT2 &lt;- as.matrix(beta_q1p$S) phylo_FMT2 &lt;- as.dist(phylo_FMT2[rownames(phylo_FMT2) %in% samples_to_keep_FMT2, colnames(phylo_FMT2) %in% samples_to_keep_FMT2]) betadisper(phylo_FMT2, subset_meta_FMT2$type) %&gt;% permutest(., pairwise = TRUE) Permutation test for homogeneity of multivariate dispersions Permutation: free Number of permutations: 999 Response: Distances Df Sum Sq Mean Sq F N.Perm Pr(&gt;F) Groups 2 0.002880 0.0014398 0.3483 999 0.703 Residuals 24 0.099207 0.0041336 Pairwise comparisons: (Observed p-value below diagonal, permuted p-value above diagonal) Control Hot_control Treatment Control 0.80700 0.613 Hot_control 0.79696 0.437 Treatment 0.60817 0.41749 adonis2(phylo_FMT2 ~ type, data = subset_meta_FMT2 %&gt;% arrange(match(Tube_code,labels(phylo_FMT2))), permutations = 999) %&gt;% broom::tidy() %&gt;% tt() .table td.tinytable_css_jpckfdshpzvlah2amwti, .table th.tinytable_css_jpckfdshpzvlah2amwti { border-bottom: solid #d3d8dc 0.1em; } .table td.tinytable_css_ce00ptp1yv7egd0sk6nu, .table th.tinytable_css_ce00ptp1yv7egd0sk6nu { border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; } term df SumOfSqs R2 statistic p.value Model 2 0.1594363 0.2042241 3.079623 0.001 Residual 24 0.6212564 0.7957759 NA NA Total 26 0.7806927 1.0000000 NA NA subset_meta_FMT2_arrange &lt;- column_to_rownames(subset_meta_FMT2, &quot;Tube_code&quot;) subset_meta_FMT2_arrange&lt;-subset_meta_FMT2_arrange[labels(phylo_FMT2),] pairwise &lt;- pairwise.adonis(phylo_FMT2, subset_meta_FMT2_arrange$type, perm=999) pairwise%&gt;% tt() .table td.tinytable_css_6o18vic8xraqlkclkvgp, .table th.tinytable_css_6o18vic8xraqlkclkvgp { border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; } .table td.tinytable_css_3e7dacmd6jzgzgr5srzo, .table th.tinytable_css_3e7dacmd6jzgzgr5srzo { border-bottom: solid #d3d8dc 0.1em; } pairs Df SumsOfSqs F.Model R2 p.value p.adjusted sig Control vs Treatment 1 0.05927454 2.382025 0.1295845 0.023 0.069 Control vs Hot_control 1 0.11081709 4.043656 0.2017424 0.002 0.006 * Treatment vs Hot_control 1 0.06906280 2.722460 0.1454115 0.007 0.021 . NMDS richness_FMT2 %&gt;% metaMDS(.,trymax = 500, k=2, verbosity=FALSE, trace = FALSE) %&gt;% scores() %&gt;% as_tibble(., rownames = &quot;sample&quot;) %&gt;% left_join(subset_meta_FMT2, by = join_by(sample == Tube_code)) %&gt;% group_by(type) %&gt;% mutate(x_cen = mean(NMDS1, na.rm = TRUE)) %&gt;% mutate(y_cen = mean(NMDS2, na.rm = TRUE)) %&gt;% ungroup() %&gt;% ggplot(., aes(x=NMDS1,y=NMDS2, color=type)) + scale_color_manual(name=&quot;Type&quot;, breaks=c(&quot;Control&quot;, &quot;Hot_control&quot;, &quot;Treatment&quot;), labels=c(&quot;Cold-Cold&quot;, &quot;Hot-Hot&quot;, &quot;Cold-Hot&quot;), values=c(&quot;#4477AA&quot;,&quot;#d57d2c&quot;,&quot;#76b183&quot;)) + geom_point(size=2) + geom_segment(aes(x=x_cen, y=y_cen, xend=NMDS1, yend=NMDS2), alpha=0.2) + labs(y = &quot;NMDS2&quot;, x=&quot;NMDS1 \\n Richness beta diversity&quot;) + theme_classic() + theme(legend.position=&quot;none&quot;) neutral_FMT2 %&gt;% metaMDS(.,trymax = 500, k=2, verbosity=FALSE, trace = FALSE) %&gt;% scores() %&gt;% as_tibble(., rownames = &quot;sample&quot;) %&gt;% left_join(subset_meta_FMT2, by = join_by(sample == Tube_code))%&gt;% group_by(type) %&gt;% mutate(x_cen = mean(NMDS1, na.rm = TRUE)) %&gt;% mutate(y_cen = mean(NMDS2, na.rm = TRUE)) %&gt;% ungroup() %&gt;% ggplot(., aes(x=NMDS1,y=NMDS2, color=type)) + scale_color_manual(name=&quot;Type&quot;, breaks=c(&quot;Control&quot;, &quot;Hot_control&quot;, &quot;Treatment&quot;), labels=c(&quot;Cold-Cold&quot;, &quot;Hot-Hot&quot;, &quot;Cold-Hot&quot;), values=c(&quot;#4477AA&quot;,&quot;#d57d2c&quot;,&quot;#76b183&quot;)) + geom_point(size=2) + geom_segment(aes(x=x_cen, y=y_cen, xend=NMDS1, yend=NMDS2), alpha=0.2) + labs(y = &quot;NMDS2&quot;, x=&quot;NMDS1 \\n Neutral beta diversity&quot;) + theme_classic() + theme(legend.position=&quot;none&quot;) phylo_FMT2 %&gt;% metaMDS(.,trymax = 500, k=2, verbosity=FALSE, trace = FALSE) %&gt;% scores() %&gt;% as_tibble(., rownames = &quot;sample&quot;) %&gt;% left_join(subset_meta_FMT2, by = join_by(sample == Tube_code))%&gt;% group_by(type) %&gt;% mutate(x_cen = mean(NMDS1, na.rm = TRUE)) %&gt;% mutate(y_cen = mean(NMDS2, na.rm = TRUE)) %&gt;% ungroup() %&gt;% ggplot(., aes(x=NMDS1,y=NMDS2, color=type)) + scale_color_manual(name=&quot;Type&quot;, breaks=c(&quot;Control&quot;, &quot;Hot_control&quot;, &quot;Treatment&quot;), labels=c(&quot;Cold-Cold&quot;, &quot;Hot-Hot&quot;, &quot;Cold-Hot&quot;), values=c(&quot;#4477AA&quot;,&quot;#d57d2c&quot;,&quot;#76b183&quot;)) + geom_point(size=2) + geom_segment(aes(x=x_cen, y=y_cen, xend=NMDS1, yend=NMDS2), alpha=0.2) + labs(y= element_blank (), x=&quot;NMDS1 \\n Phylogenetic beta diversity&quot;) + theme_classic() + theme(legend.position=&quot;none&quot;) 10.2.4 Differentially abundant MAGs 10.2.4.1 Warm vs Intervention Structural zeros struc &lt;- structural_zeros %&gt;% filter(present==&quot;warm_control&quot;)%&gt;% count(phylum, name = &quot;Hot_control&quot;) %&gt;% arrange(desc(Hot_control)) structural_zeros %&gt;% filter(present==&quot;treatment&quot;)%&gt;% count(phylum, name = &quot;Treatment&quot;) %&gt;% arrange(desc(Treatment)) %&gt;% full_join(., struc, by=&quot;phylum&quot;) %&gt;% mutate(across(everything(), ~ ifelse(is.na(.), 0, .))) %&gt;% tt() .table td.tinytable_css_oqwy9vk2ptdukgbvcx91, .table th.tinytable_css_oqwy9vk2ptdukgbvcx91 { border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; } .table td.tinytable_css_lrs1d5p87qw7cxrvcs2v, .table th.tinytable_css_lrs1d5p87qw7cxrvcs2v { border-bottom: solid #d3d8dc 0.1em; } phylum Treatment Hot_control p__Bacillota_A 21 12 p__Bacteroidota 12 8 p__Pseudomonadota 10 3 p__Bacillota 9 12 p__Desulfobacterota 2 1 p__Verrucomicrobiota 2 1 p__Bacillota_C 1 1 p__Bacillota_B 0 2 p__Actinomycetota 0 1 p__Chlamydiota 0 1 p__Cyanobacteriota 0 1 physeq_FMT2 &lt;- subset_samples(physeq_all, type %in% c(&quot;Hot_control&quot;, &quot;Treatment&quot;) &amp; time_point == &quot;FMT2&quot;) physeq_FMT2 &lt;- prune_taxa(taxa_sums(physeq_FMT2)&gt;0, physeq_FMT2) ancom_rand_output_fmt2 = ancombc2(data = physeq_FMT2, assay_name = &quot;counts&quot;, tax_level = NULL, fix_formula = &quot;type&quot;, p_adj_method = &quot;holm&quot;, pseudo_sens = TRUE, prv_cut =0, lib_cut = 0, s0_perc = 0.05, group = NULL, struc_zero = FALSE, neg_lb = FALSE, alpha = 0.05, n_cl = 2, verbose = TRUE, global = FALSE, pairwise = FALSE, dunnet = FALSE, trend = FALSE, iter_control = list(tol = 1e-5, max_iter = 20, verbose = FALSE), em_control = list(tol = 1e-5, max_iter = 100), mdfdr_control = list(fwer_ctrl_method = &quot;holm&quot;, B = 100), trend_control = NULL) save(ancom_rand_output_fmt2, file=&quot;data/ancom_rand_output_fmt2.RData&quot;) load(&quot;data/ancom_rand_output_fmt2.RData&quot;) ancom_rand_output_fmt2$res %&gt;% dplyr::select(taxon, lfc_typeTreatment, p_typeTreatment) %&gt;% filter(p_typeTreatment &lt; 0.05) %&gt;% left_join(., genome_metadata, by=join_by(&quot;taxon&quot;==&quot;genome&quot;)) %&gt;% select(2,3,7,8,9) %&gt;% tt() .table td.tinytable_css_zxqd9vcny4fe6ucs04p7, .table th.tinytable_css_zxqd9vcny4fe6ucs04p7 { border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; } .table td.tinytable_css_1vowh5ov8iskbw7t569o, .table th.tinytable_css_1vowh5ov8iskbw7t569o { border-bottom: solid #d3d8dc 0.1em; } lfc_typeTreatment p_typeTreatment order family genus -1.0679498 0.009253269 o__Bacteroidales f__Marinifilaceae g__Odoribacter -2.1330510 0.003515889 o__Bacteroidales f__UBA932 g__Egerieousia -1.2303114 0.040435884 o__Bacteroidales f__Rikenellaceae g__Alistipes 1.2508603 0.003488718 o__Bacteroidales f__Bacteroidaceae g__Bacteroides -1.2494056 0.015559786 o__Bacteroidales f__Bacteroidaceae g__ 1.0321504 0.027726345 o__Bacteroidales f__Tannerellaceae g__Parabacteroides -1.9342981 0.016789457 o__Bacteroidales f__Tannerellaceae g__Parabacteroides_B -0.9544608 0.019594706 o__Flavobacteriales f__UBA1820 g__Merdimorpha -2.2089350 0.011697474 o__Campylobacterales f__Helicobacteraceae g__NHYM01 -0.9513399 0.030047879 o__RF32 f__CAG-239 g__MGBC133411 -1.1393041 0.018366689 o__UBA3830 f__UBA3830 g__ 0.8441881 0.018157703 o__Desulfovibrionales f__Desulfovibrionaceae g__ 0.6788804 0.039879070 o__Oscillospirales f__Oscillospiraceae g__Scatomorpha -0.7249833 0.046706314 o__Oscillospirales f__Acutalibacteraceae g__ -2.3839909 0.013309685 o__TANB77 f__CAG-508 g__CAG-269 -1.8439728 0.029190806 o__Lachnospirales f__Lachnospiraceae g__Roseburia 1.3029581 0.012958648 o__Lachnospirales f__Lachnospiraceae g__JAAYNV01 -1.7383039 0.014467363 o__Lachnospirales f__Lachnospiraceae g__Kineothrix -1.0504449 0.019243961 o__Lachnospirales f__Lachnospiraceae g__CAG-95 -1.3471776 0.001836196 o__Lachnospirales f__Lachnospiraceae g__Ventrimonas 1.1102930 0.023339563 o__Lachnospirales f__Lachnospiraceae g__Hungatella_A -0.8237748 0.028865185 o__Lachnospirales f__Lachnospiraceae g__Enterocloster -1.1046970 0.007568127 o__Christensenellales f__UBA3700 g__ -1.3296719 0.010278401 o__Christensenellales f__DTU072 g__ -1.5184068 0.002257121 o__Christensenellales f__ g__ -1.0443752 0.004184507 o__Christensenellales f__MGBC116941 g__MGBC116941 -0.8800659 0.041833078 o__Acidaminococcales f__Acidaminococcaceae g__Phascolarctobacterium -1.3205037 0.012348024 o__Erysipelotrichales f__Erysipelotrichaceae g__Clostridium_AQ -1.0766652 0.016082944 o__Erysipelotrichales f__Erysipelotrichaceae g__Dielma taxonomy &lt;- data.frame(physeq_FMT2@tax_table) %&gt;% rownames_to_column(., &quot;taxon&quot;) %&gt;% mutate_at(vars(order, phylum, family, genus, species), ~ str_replace(., &quot;[dpcofgs]__&quot;, &quot;&quot;)) ancombc_rand_table_mag &lt;- ancom_rand_output_fmt2$res %&gt;% dplyr::select(taxon, lfc_typeTreatment, p_typeTreatment) %&gt;% #filter(p_typeTreatment &lt; 0.05) %&gt;% dplyr::arrange(p_typeTreatment) %&gt;% merge(., taxonomy, by=&quot;taxon&quot;) %&gt;% mutate_at(vars(phylum, species), ~ str_replace(., &quot;[dpcofgs]__&quot;, &quot;&quot;))%&gt;% dplyr::arrange(lfc_typeTreatment) ancombc_rand_table_mag taxon lfc_typeTreatment p_typeTreatment domain phylum class order family genus species 1 LI1_2nd_3:bin_000017 -2.38399090 0.013309685 d__Bacteria Bacillota_A c__Clostridia TANB77 CAG-508 CAG-269 2 AH1_2nd_2:bin_000018 -2.24552777 0.069285639 d__Bacteria Elusimicrobiota c__Elusimicrobia Elusimicrobiales Elusimicrobiaceae UBA1436 3 AH1_2nd_7:bin_000028 -2.20893500 0.011697474 d__Bacteria Campylobacterota c__Campylobacteria Campylobacterales Helicobacteraceae NHYM01 4 LI1_2nd_4:bin_000035 -2.20837056 0.078393655 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae Bacteroides Bacteroides sp900552405 5 AH1_2nd_6:bin_000037 -2.13305102 0.003515889 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales UBA932 Egerieousia 6 LI1_2nd_7:bin_000038 -1.93429814 0.016789457 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Tannerellaceae Parabacteroides_B 7 AH1_2nd_19:bin_000005 -1.84397276 0.029190806 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Roseburia 8 AH1_2nd_20:bin_000009 -1.73830390 0.014467363 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Kineothrix 9 AH1_2nd_6:bin_000024 -1.70210831 1.000000000 d__Bacteria Spirochaetota c__Brevinematia Brevinematales Brevinemataceae Brevinema 10 AH1_2nd_16:bin_000033 -1.68963835 0.089129622 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales 11 AH1_2nd_1:bin_000005 -1.62989530 1.000000000 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae 12 LI1_2nd_4:bin_000001 -1.51840677 0.002257121 d__Bacteria Bacillota_A c__Clostridia Christensenellales 13 AH1_2nd_10:bin_000007 -1.40756413 0.108146674 d__Bacteria Bacillota_A c__Clostridia Lachnospirales 14 LI1_2nd_7:bin_000005 -1.34717759 0.001836196 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Ventrimonas 15 LI1_2nd_5:bin_000013 -1.32967189 0.010278401 d__Bacteria Bacillota_A c__Clostridia Christensenellales DTU072 16 LI1_2nd_7:bin_000016 -1.32050371 0.012348024 d__Bacteria Bacillota c__Bacilli Erysipelotrichales Erysipelotrichaceae Clostridium_AQ 17 LI1_2nd_4:bin_000036 -1.24940559 0.015559786 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae 18 AH1_2nd_16:bin_000019 -1.23031145 0.040435884 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Rikenellaceae Alistipes 19 AH1_2nd_5:bin_000051 -1.19416186 0.051875752 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae Bacteroides 20 AH1_2nd_6:bin_000030 -1.13930407 0.018366689 d__Bacteria Pseudomonadota c__Alphaproteobacteria UBA3830 UBA3830 21 AH1_2nd_16:bin_000018 -1.10469701 0.007568127 d__Bacteria Bacillota_A c__Clostridia Christensenellales UBA3700 22 LI1_2nd_4:bin_000003 -1.07666524 0.016082944 d__Bacteria Bacillota c__Bacilli Erysipelotrichales Erysipelotrichaceae Dielma 23 LI1_2nd_5:bin_000037 -1.06794984 0.009253269 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Marinifilaceae Odoribacter 24 AH1_2nd_8:bin_000006 -1.05044492 0.019243961 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae CAG-95 25 LI1_2nd_2:bin_000006 -1.04437525 0.004184507 d__Bacteria Bacillota_A c__Clostridia Christensenellales MGBC116941 MGBC116941 26 LI1_2nd_5:bin_000026 -0.98903869 0.067783814 d__Bacteria Bacillota_A c__Clostridia Christensenellales UBA1242 Caccovivens 27 LI1_2nd_4:bin_000022 -0.98113068 0.153421722 d__Bacteria Pseudomonadota c__Alphaproteobacteria UBA3830 UBA3830 28 LI1_2nd_7:bin_000014 -0.95446077 0.019594706 d__Bacteria Bacteroidota c__Bacteroidia Flavobacteriales UBA1820 Merdimorpha 29 AH1_2nd_13:bin_000011 -0.95133994 0.030047879 d__Bacteria Pseudomonadota c__Alphaproteobacteria RF32 CAG-239 MGBC133411 30 AH1_2nd_5:bin_000006 -0.88006587 0.041833078 d__Bacteria Bacillota_C c__Negativicutes Acidaminococcales Acidaminococcaceae Phascolarctobacterium Phascolarctobacterium sp900544795 31 AH1_2nd_19:bin_000001 -0.86434627 0.072264998 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Tannerellaceae Parabacteroides 32 AH1_2nd_12:bin_000015 -0.84119071 0.197352443 d__Bacteria Bacillota c__Bacilli Erysipelotrichales Coprobacillaceae Thomasclavelia 33 LI1_2nd_4:bin_000052 -0.82377475 0.028865185 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Enterocloster 34 AH1_2nd_20:bin_000040 -0.81868165 0.200178486 d__Bacteria Desulfobacterota c__Desulfovibrionia Desulfovibrionales Desulfovibrionaceae Bilophila Bilophila wadsworthia 35 AH1_2nd_6:bin_000004 -0.81010832 0.067505289 d__Bacteria Cyanobacteriota c__Vampirovibrionia Gastranaerophilales RUG14156 36 AH1_2nd_5:bin_000004 -0.72498326 0.046706314 d__Bacteria Bacillota_A c__Clostridia Oscillospirales Acutalibacteraceae 37 LI1_2nd_9:bin_000002 -0.67900110 0.163312737 d__Bacteria Cyanobacteriota c__Vampirovibrionia Gastranaerophilales Gastranaerophilaceae Limenecus 38 LI1_2nd_1:bin_000006 -0.63634090 0.110447924 d__Bacteria Bacillota_B c__Peptococcia Peptococcales Peptococcaceae RGIG6463 39 AH1_2nd_16:bin_000047 -0.62294972 0.151753253 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Marinifilaceae Odoribacter 40 AH1_2nd_6:bin_000046 -0.61941897 0.225341055 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae Bacteroides 41 AH1_2nd_17:bin_000020 -0.61165757 0.152451414 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Clostridium_Q 42 AH1_2nd_6:bin_000060 -0.61063226 0.064023999 d__Bacteria Bacillota_A c__Clostridia Oscillospirales Oscillospiraceae Intestinimonas 43 AH1_2nd_7:bin_000041 -0.59574244 0.106448211 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae 44 LI1_2nd_8:bin_000079 -0.56053104 0.291649247 d__Bacteria Pseudomonadota c__Gammaproteobacteria Enterobacterales Enterobacteriaceae Citrobacter_A Citrobacter_A amalonaticus 45 LI1_2nd_7:bin_000012 -0.54114030 0.170587391 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Rikenellaceae Alistipes 46 AH1_2nd_20:bin_000006 -0.53914305 0.102089907 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Marinifilaceae Butyricimonas Butyricimonas sp900184685 47 AH1_2nd_1:bin_000048 -0.53459950 0.082363699 d__Bacteria Bacillota_A c__Clostridia Peptostreptococcales Anaerovoracaceae 48 LI1_2nd_4:bin_000034 -0.52025319 0.240464108 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae Bacteroides Bacteroides thetaiotaomicron 49 AH1_2nd_20:bin_000016 -0.51817266 0.193327549 d__Bacteria Bacillota c__Bacilli Erysipelotrichales Erysipelotrichaceae 50 AH1_2nd_5:bin_000002 -0.50336870 1.000000000 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Marinifilaceae Odoribacter 51 AH1_2nd_2:bin_000017 -0.49059726 0.232911331 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Copromonas 52 AH1_2nd_15:bin_000004 -0.45325196 0.137243464 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae UMGS1251 53 AH1_2nd_10:bin_000069 -0.45143994 0.345944197 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae Bacteroides 54 AH1_2nd_6:bin_000062 -0.44903206 0.153810727 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Muribaculaceae HGM05232 55 AH1_2nd_20:bin_000042 -0.44736081 0.247873852 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Hungatella 56 LI1_2nd_7:bin_000040 -0.41583299 0.364385546 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae 57 LI1_2nd_10:bin_000018 -0.41478260 0.397415211 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae Bacteroides 58 LI1_2nd_8:bin_000006 -0.40259955 0.258368514 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Rikenellaceae Alistipes 59 LI1_2nd_8:bin_000064 -0.38370383 0.466862769 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Tannerellaceae Parabacteroides 60 AH1_2nd_19:bin_000011 -0.37870334 0.340135994 d__Bacteria Desulfobacterota c__Desulfovibrionia Desulfovibrionales Desulfovibrionaceae Mailhella 61 LI1_2nd_9:bin_000032 -0.36252781 1.000000000 d__Bacteria Pseudomonadota c__Alphaproteobacteria RF32 CAG-239 CAZU01 62 LI1_2nd_9:bin_000023 -0.34184156 0.270280897 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae JALFVM01 63 AH1_2nd_11:bin_000005 -0.33776358 0.541097408 d__Bacteria Fusobacteriota c__Fusobacteriia Fusobacteriales Fusobacteriaceae Fusobacterium_A Fusobacterium_A ulcerans 64 LI1_2nd_9:bin_000004 -0.31998881 0.403611707 d__Bacteria Cyanobacteriota c__Vampirovibrionia Gastranaerophilales Gastranaerophilaceae Scatousia 65 AH1_2nd_10:bin_000042 -0.30027870 0.442833313 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Rikenellaceae Alistipes 66 AH1_2nd_18:bin_000011 -0.28521622 0.308837109 d__Bacteria Bacillota c__Bacilli Erysipelotrichales Coprobacillaceae Coprobacillus 67 AH1_2nd_5:bin_000069 -0.26858171 0.555792315 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae Bacteroides 68 AH1_2nd_20:bin_000002 -0.26134483 0.528278739 d__Bacteria Cyanobacteriota c__Vampirovibrionia Gastranaerophilales RUG14156 RUG14156 69 AH1_2nd_1:bin_000003 -0.22545760 0.411696506 d__Bacteria Cyanobacteriota c__Vampirovibrionia Gastranaerophilales Gastranaerophilaceae Scatousia 70 AH1_2nd_14:bin_000052 -0.22542477 0.549429505 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae Bacteroides 71 AH1_2nd_12:bin_000012 -0.20705124 0.627917678 d__Bacteria Campylobacterota c__Campylobacteria Campylobacterales Helicobacteraceae Helicobacter_J 72 LI1_2nd_9:bin_000022 -0.19370587 0.466691411 d__Bacteria Bacillota_A c__Clostridia Oscillospirales Oscillospiraceae Oscillibacter 73 LI1_2nd_4:bin_000010 -0.18589330 0.686969935 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Tannerellaceae Parabacteroides 74 AH1_2nd_18:bin_000024 -0.17929210 0.592180401 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Marinifilaceae Odoribacter 75 LI1_2nd_4:bin_000041 -0.17812864 0.551786455 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Clostridium_Q 76 AH1_2nd_14:bin_000063 -0.17213688 0.578143711 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Blautia_A 77 AH1_2nd_5:bin_000073 -0.17089407 0.732948122 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Tannerellaceae Parabacteroides Parabacteroides goldsteinii 78 AH1_2nd_20:bin_000027 -0.14600500 0.733313089 d__Bacteria Desulfobacterota c__Desulfovibrionia Desulfovibrionales Desulfovibrionaceae Desulfovibrio 79 AH1_2nd_7:bin_000027 -0.14423299 0.606676548 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Copromonas 80 AH1_2nd_15:bin_000043 -0.12935246 0.738308239 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae Bacteroides 81 LI1_2nd_8:bin_000033 -0.11709250 0.656713591 d__Bacteria Bacillota_C c__Negativicutes Selenomonadales 82 AH1_2nd_11:bin_000008 -0.11365018 0.778321759 d__Bacteria Verrucomicrobiota c__Verrucomicrobiae Verrucomicrobiales Akkermansiaceae Akkermansia 83 LI1_2nd_5:bin_000023 -0.11178441 0.695252735 d__Bacteria Pseudomonadota c__Alphaproteobacteria UBA3830 84 LI1_2nd_7:bin_000053 -0.11010210 0.790270091 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae Bacteroides Bacteroides nordii 85 LI1_2nd_7:bin_000051 -0.10777118 0.736576733 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae RGIG4733 86 AH1_2nd_19:bin_000031 -0.09966514 0.792055827 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Lachnotalea 87 LI1_2nd_7:bin_000042 -0.08960727 0.841026471 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Tannerellaceae Parabacteroides_B 88 AH1_2nd_19:bin_000050 -0.07851513 0.797875329 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae 89 AH1_2nd_16:bin_000020 -0.07197894 0.879201786 d__Bacteria Desulfobacterota c__Desulfovibrionia Desulfovibrionales Desulfovibrionaceae Bilophila 90 AH1_2nd_14:bin_000032 -0.06120503 0.828678147 d__Bacteria Bacillota_C c__Negativicutes Selenomonadales Massilibacillaceae 91 AH1_2nd_10:bin_000001 -0.04610651 0.905024452 d__Bacteria Cyanobacteriota c__Vampirovibrionia Gastranaerophilales Gastranaerophilaceae Limenecus 92 AH1_2nd_19:bin_000055 -0.04489346 0.918642443 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Tannerellaceae Parabacteroides 93 AH1_2nd_16:bin_000058 -0.03914055 0.915310347 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Enterocloster 94 AH1_2nd_15:bin_000001 -0.03610555 0.913145520 d__Bacteria Pseudomonadota c__Alphaproteobacteria Rhizobiales Rhizobiaceae Agrobacterium Agrobacterium tumefaciens_H 95 AH1_2nd_13:bin_000037 -0.02747882 0.922847059 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Marinifilaceae Odoribacter 96 LI1_2nd_9:bin_000007 -0.01994595 0.953153950 d__Bacteria Pseudomonadota c__Alphaproteobacteria RF32 CAG-239 CAJLXD01 97 LI1_2nd_8:bin_000016 -0.01948112 0.941816693 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Rikenellaceae Rikenella 98 AH1_2nd_15:bin_000025 -0.01749507 0.965803510 d__Bacteria Bacteroidota c__Bacteroidia Bacteroidales Bacteroidaceae Phocaeicola 99 AH1_2nd_7:bin_000070 0.01131749 0.966065411 d__Bacteria Bacillota_A c__Clostridia Oscillospirales Oscillospiraceae Pseudoflavonifractor 100 AH1_2nd_7:bin_000011 0.01222425 0.971806038 d__Bacteria Bacillota_A c__Clostridia Lachnospirales Lachnospiraceae Lacrimispora [ reached &#39;max&#39; / getOption(&quot;max.print&quot;) -- omitted 152 rows ] colors_alphabetic &lt;- read_tsv(&quot;https://raw.githubusercontent.com/earthhologenome/EHI_taxonomy_colour/main/ehi_phylum_colors.tsv&quot;) %&gt;% mutate_at(vars(phylum), ~ str_replace(., &quot;[dpcofgs]__&quot;, &quot;&quot;)) %&gt;% right_join(taxonomy, by=join_by(phylum == phylum)) %&gt;% dplyr::select(phylum, colors) %&gt;% mutate(colors = str_c(colors, &quot;80&quot;)) %&gt;% #add 80% alpha unique() %&gt;% dplyr::arrange(phylum) tax_table &lt;- as.data.frame(unique(ancombc_rand_table_mag$phylum)) colnames(tax_table)[1] &lt;- &quot;phylum&quot; tax_color &lt;- merge(tax_table, colors_alphabetic, by=&quot;phylum&quot;)%&gt;% dplyr::arrange(phylum) %&gt;% dplyr::select(colors) %&gt;% pull() ancombc_rand_table_mag %&gt;% mutate( genome = factor(taxon, levels = ancombc_rand_table_mag$taxon), significance = ifelse(p_typeTreatment &lt; 0.05, phylum, NA) # Set non-significant to NA (not mapped in legend) ) %&gt;% ggplot() + # Plot significant points with legend geom_point(aes(x = lfc_typeTreatment, y = -log10(p_typeTreatment), color = significance), size = 3, alpha = 0.7, na.rm = TRUE) + # Plot non-significant points separately without legend geom_point(data = filter(ancombc_rand_table_mag, p_typeTreatment &gt;= 0.05), aes(x = lfc_typeTreatment, y = -log10(p_typeTreatment)), color = &quot;grey70&quot;, size = 3, alpha = 0.7, show.legend = FALSE) + scale_color_manual( values = tax_color, # Only keeps phylum colors in legend na.translate = FALSE # Removes NA (non-significant) from legend ) + geom_hline(yintercept = -log10(0.05), linetype = &quot;dashed&quot;) + geom_vline(xintercept = 0, linetype = &quot;dashed&quot;) + scale_y_continuous(limits = c(0, 4)) + xlab(&quot;log2FoldChange&quot;) + ylab(&quot;-log10(p-value)&quot;) + guides(color = guide_legend(title = &quot;Phylum&quot;)) + theme_minimal()+ annotate(&quot;text&quot;, x = min(ancombc_rand_table_mag$lfc_typeTreatment), y = 4, label = &quot;Cold-intervention&quot;, hjust = 0, size = 4, fontface = &quot;bold&quot;) + annotate(&quot;text&quot;, x = max(ancombc_rand_table_mag$lfc_typeTreatment), y = 4, label = &quot;Warm-control&quot;, hjust = 1, size = 4, fontface = &quot;bold&quot;) Phyla of the significant MAGs in warm control ancombc_rand_table_mag%&gt;% filter(p_typeTreatment &lt; 0.05) %&gt;% filter(lfc_typeTreatment&gt;0) %&gt;% count(phylum, name = &quot;sample_count&quot;) %&gt;% arrange(desc(sample_count)) phylum sample_count 1 Bacillota_A 3 2 Bacteroidota 2 3 Desulfobacterota 1 Phyla of the significant MAGs in intervention group ancombc_rand_table_mag%&gt;% filter(p_typeTreatment &lt; 0.05) %&gt;% filter(lfc_typeTreatment&lt;0) %&gt;% count(phylum, name = &quot;sample_count&quot;) %&gt;% arrange(desc(sample_count)) phylum sample_count 1 Bacillota_A 11 2 Bacteroidota 6 3 Bacillota 2 4 Pseudomonadota 2 5 Bacillota_C 1 6 Campylobacterota 1 10.2.4.2 Intervention vs cold control Structural zeros struc &lt;- structural_zeros %&gt;% filter(present==&quot;cold_control&quot;)%&gt;% count(phylum, name = &quot;Cold_control&quot;) %&gt;% arrange(desc(Cold_control)) structural_zeros %&gt;% filter(present==&quot;treatment&quot;)%&gt;% count(phylum, name = &quot;Treatment&quot;) %&gt;% arrange(desc(Treatment)) %&gt;% full_join(., struc, by=&quot;phylum&quot;) %&gt;% mutate(across(everything(), ~ ifelse(is.na(.), 0, .))) %&gt;% tt() .table td.tinytable_css_xbzupuxuwgku0ywmskj4, .table th.tinytable_css_xbzupuxuwgku0ywmskj4 { border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; } .table td.tinytable_css_e8pxs4ndv1w6tbyp5k34, .table th.tinytable_css_e8pxs4ndv1w6tbyp5k34 { border-bottom: solid #d3d8dc 0.1em; } phylum Treatment Cold_control p__Bacteroidota 25 5 p__Bacillota_A 22 12 p__Pseudomonadota 10 3 p__Cyanobacteriota 5 2 p__Bacillota 2 3 p__Desulfobacterota 2 1 p__Bacillota_C 1 1 p__Elusimicrobiota 1 0 p__Spirochaetota 1 0 p__Verrucomicrobiota 1 0 p__Actinomycetota 0 1 p__Chlamydiota 0 1 phylo_samples &lt;- sample_metadata %&gt;% filter(type %in% c(&quot;Control&quot;, &quot;Treatment&quot;) &amp; time_point == &quot;FMT2&quot;)%&gt;% column_to_rownames(&quot;Tube_code&quot;) %&gt;% sample_data() phylo_genome &lt;- genome_counts_filt %&gt;% filter(!genome %in% structural_zeros$genome) %&gt;% select(one_of(c(&quot;genome&quot;,rownames(phylo_samples)))) %&gt;% filter(rowSums(across(where(is.numeric), ~ . != 0)) &gt; 0) %&gt;% select(genome, where(~ is.numeric(.) &amp;&amp; sum(.) &gt; 0)) %&gt;% column_to_rownames(&quot;genome&quot;) %&gt;% otu_table(., taxa_are_rows = TRUE) phylo_taxonomy &lt;- genome_metadata %&gt;% filter(genome %in% rownames(phylo_genome)) %&gt;% column_to_rownames(&quot;genome&quot;) %&gt;% dplyr::select(domain,phylum,class,order,family,genus,species) %&gt;% as.matrix() %&gt;% tax_table() physeq_genome_filtered &lt;- phyloseq(phylo_genome, phylo_taxonomy, phylo_samples) ancom_rand_output_cold_fmt2 = ancombc2(data = physeq_genome_filtered, assay_name = &quot;counts&quot;, tax_level = NULL, fix_formula = &quot;type&quot;, p_adj_method = &quot;holm&quot;, pseudo_sens = TRUE, prv_cut =0, lib_cut = 0, s0_perc = 0.05, group = NULL, struc_zero = FALSE, neg_lb = FALSE, alpha = 0.05, n_cl = 2, verbose = TRUE, global = FALSE, pairwise = FALSE, dunnet = FALSE, trend = FALSE, iter_control = list(tol = 1e-5, max_iter = 20, verbose = FALSE), em_control = list(tol = 1e-5, max_iter = 100), mdfdr_control = list(fwer_ctrl_method = &quot;holm&quot;, B = 100), trend_control = NULL) save(ancom_rand_output_cold_fmt2, file=&quot;data/ancom_rand_output_cold_fmt2.RData&quot;) load(&quot;data/ancom_rand_output_cold_fmt2.RData&quot;) ancom_rand_output_cold_fmt2$res %&gt;% dplyr::select(taxon, lfc_typeTreatment, p_typeTreatment) %&gt;% filter(p_typeTreatment &lt; 0.05) %&gt;% left_join(., genome_metadata, by=join_by(&quot;taxon&quot;==&quot;genome&quot;)) %&gt;% select(2,3,7,8,9) %&gt;% tt() .table td.tinytable_css_waismgwsafrbr5ng1f64, .table th.tinytable_css_waismgwsafrbr5ng1f64 { border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; } .table td.tinytable_css_klbp8sglktdjfglggcn4, .table th.tinytable_css_klbp8sglktdjfglggcn4 { border-bottom: solid #d3d8dc 0.1em; } lfc_typeTreatment p_typeTreatment order family genus 1.3855849 0.0064491737 o__Desulfovibrionales f__Desulfovibrionaceae g__Bilophila 1.5501028 0.0302768925 o__Gastranaerophilales f__Gastranaerophilaceae g__CALURL01 -1.8559130 0.0181780992 o__Campylobacterales f__Helicobacteraceae g__Helicobacter_J -1.1698110 0.0273494730 o__RF32 f__CAG-239 g__MGBC133411 1.5634295 0.0036684247 o__Bacteroidales f__Bacteroidaceae g__Bacteroides -1.0686552 0.0392169165 o__Lachnospirales f__Lachnospiraceae g__Ventrimonas -1.0674884 0.0273334492 o__Bacteroidales f__Bacteroidaceae g__ -1.3795549 0.0372333347 o__Bacteroidales f__Tannerellaceae g__Parabacteroides -2.7034396 0.0002097517 o__Bacteroidales f__Tannerellaceae g__Parabacteroides -2.5205420 0.0278166838 o__Lachnospirales f__Lachnospiraceae g__Roseburia 2.3748395 0.0280714402 o__Opitutales f__LL51 g__ -1.2676375 0.0347793181 o__Gastranaerophilales f__Gastranaerophilaceae g__Scatousia 1.2447065 0.0427108759 o__Lachnospirales f__Lachnospiraceae g__MGBC136627 1.2378143 0.0272406467 o__Lachnospirales f__Lachnospiraceae g__Hungatella 0.9938937 0.0207674374 o__Desulfovibrionales f__Desulfovibrionaceae g__Mailhella 1.4439872 0.0253614006 o__Lachnospirales f__Lachnospiraceae g__JAAYNV01 1.9838313 0.0186136368 o__Opitutales f__LL51 g__ 1.6083830 0.0344901406 o__Selenomonadales f__ g__ -1.0684249 0.0137847743 o__Oscillospirales f__Acutalibacteraceae g__ 1.3518756 0.0057750653 o__Bacteroidales f__Bacteroidaceae g__Bacteroides 2.7791170 0.0005632720 o__Bacteroidales f__Bacteroidaceae g__Bacteroides 1.0060962 0.0459743425 o__Peptococcales f__Peptococcaceae g__RGIG6463 -1.7125377 0.0265594584 o__Bacteroidales f__Rikenellaceae g__Alistipes 1.4090489 0.0134214239 o__Bacteroidales f__Bacteroidaceae g__Bacteroides 1.2710589 0.0221619926 o__Lachnospirales f__Lachnospiraceae g__Copromonas 1.4457660 0.0199937665 o__Christensenellales f__UBA3700 g__ 1.1457322 0.0367174756 o__Lachnospirales f__Lachnospiraceae g__ ancombc_rand_table_mag %&gt;% mutate( genome = factor(taxon, levels = ancombc_rand_table_mag$taxon), significance = ifelse(p_typeTreatment &lt; 0.05, phylum, NA) # Set non-significant to NA (not mapped in legend) ) %&gt;% ggplot() + # Plot significant points with legend geom_point(aes(x = lfc_typeTreatment, y = -log10(p_typeTreatment), color = significance), size = 3, alpha = 0.7, na.rm = TRUE) + # Plot non-significant points separately without legend geom_point(data = filter(ancombc_rand_table_mag, p_typeTreatment &gt;= 0.05), aes(x = lfc_typeTreatment, y = -log10(p_typeTreatment)), color = &quot;grey70&quot;, size = 3, alpha = 0.7, show.legend = FALSE) + scale_color_manual( values = tax_color, # Only keeps phylum colors in legend na.translate = FALSE # Removes NA (non-significant) from legend ) + geom_hline(yintercept = -log10(0.05), linetype = &quot;dashed&quot;) + geom_vline(xintercept = 0, linetype = &quot;dashed&quot;) + scale_y_continuous(limits = c(0, 4)) + xlab(&quot;log2FoldChange&quot;) + ylab(&quot;-log10(p-value)&quot;) + guides(color = guide_legend(title = &quot;Phylum&quot;)) + theme_minimal()+ annotate(&quot;text&quot;, x = min(ancombc_rand_table_mag$lfc_typeTreatment), y = 4, label = &quot;Cold-control&quot;, hjust = 0, size = 4, fontface = &quot;bold&quot;) + annotate(&quot;text&quot;, x = max(ancombc_rand_table_mag$lfc_typeTreatment), y = 4, label = &quot;Cold-intervention&quot;, hjust = 1, size = 4, fontface = &quot;bold&quot;) Phyla of the significant MAGs in intervention group ancombc_rand_table_mag%&gt;% filter(p_typeTreatment &lt; 0.05) %&gt;% filter(lfc_typeTreatment&gt;0) %&gt;% count(phylum, name = &quot;sample_count&quot;) %&gt;% arrange(desc(sample_count)) phylum sample_count 1 Bacillota_A 6 2 Bacteroidota 4 3 Desulfobacterota 2 4 Verrucomicrobiota 2 5 Bacillota_B 1 6 Bacillota_C 1 7 Cyanobacteriota 1 Phyla of the significant MAGs in cold control ancombc_rand_table_mag%&gt;% filter(p_typeTreatment &lt; 0.05) %&gt;% filter(lfc_typeTreatment&lt;0) %&gt;% count(phylum, name = &quot;sample_count&quot;) %&gt;% arrange(desc(sample_count)) phylum sample_count 1 Bacteroidota 4 2 Bacillota_A 3 3 Campylobacterota 1 4 Cyanobacteriota 1 5 Pseudomonadota 1 10.2.4.3 Functional differences MCI GIFTs_functions_community %&gt;% rowMeans() %&gt;% as_tibble(., rownames = &quot;sample&quot;) %&gt;% left_join(sample_metadata, by = join_by(sample == Tube_code)) %&gt;% filter(time_point==&quot;FMT2&quot;) %&gt;% group_by(type) %&gt;% summarise(MCI = mean(value), sd = sd(value)) # A tibble: 3 × 3 type MCI sd &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; 1 Control 0.352 0.0223 2 Hot_control 0.350 0.0293 3 Treatment 0.346 0.0255 MCI_FMT2 &lt;- GIFTs_functions_community %&gt;% rowMeans() %&gt;% as_tibble(., rownames = &quot;sample&quot;) %&gt;% left_join(sample_metadata, by = join_by(sample == Tube_code)) %&gt;% filter(time_point == &quot;FMT2&quot;) shapiro.test(MCI_FMT2$value) Shapiro-Wilk normality test data: MCI_FMT2$value W = 0.96248, p-value = 0.4203 res.aov &lt;- aov(value ~ type, data = MCI_FMT2) summary(res.aov) Df Sum Sq Mean Sq F value Pr(&gt;F) type 2 0.00017 0.0000852 0.127 0.881 Residuals 24 0.01604 0.0006682 Functional differences CC and CI significant_elements&lt;-element_gift %&gt;% filter(type %in% c(&quot;Control&quot;, &quot;Treatment&quot;) &amp; time_point == &quot;FMT2&quot;) %&gt;% select(-time_point, -type) %&gt;% filter(rowSums(across(where(is.numeric), ~ . != 0)) &gt; 0) %&gt;% select(Tube_code, where( ~ is.numeric(.) &amp;&amp; sum(.) &gt; 0)) %&gt;% left_join(sample_metadata[c(1, 7)], by = &quot;Tube_code&quot;) %&gt;% pivot_longer(-c(Tube_code, type), names_to = &quot;trait&quot;, values_to = &quot;value&quot;) %&gt;% group_by(trait) %&gt;% summarise(p_value = wilcox.test(value ~ type)$p.value) %&gt;% mutate(p_adjust = p.adjust(p_value, method = &quot;BH&quot;)) %&gt;% filter(p_adjust &lt; 0.05) %&gt;% remove_rownames() %&gt;% left_join(., uniqueGIFT_db, by=join_by(&quot;trait&quot;==&quot;Code_element&quot;)) element_gift_sig &lt;- element_gift %&gt;% select(Tube_code, all_of(intersect( significant_elements$trait, colnames(element_gift) ))) %&gt;% left_join(., sample_metadata[c(1, 7)], by = join_by(Tube_code == Tube_code)) %&gt;% filter(type!=&quot;Hot_control&quot;) difference_table &lt;- element_gift_sig %&gt;% select(-Tube_code) %&gt;% group_by(type) %&gt;% summarise(across(everything(), mean)) %&gt;% t() %&gt;% row_to_names(row_number = 1) %&gt;% as.data.frame() %&gt;% mutate_if(is.character, as.numeric) %&gt;% rownames_to_column(., &quot;Elements&quot;) %&gt;% left_join(.,uniqueGIFT_db[c(1,3,4)],by = join_by(Elements == Code_element)) %&gt;% arrange(Function) %&gt;% mutate(Difference=Control-Treatment)%&gt;% mutate(group_color = ifelse(Difference &lt;0, &quot;Control&quot;,&quot;Treatment&quot;)) difference_table %&gt;% ggplot(aes(x=forcats::fct_reorder(Function,Difference), y=Difference, fill=group_color)) + geom_col() + scale_fill_manual(values=c(&quot;#4477AA&quot;,&quot;#76b183&quot;)) + geom_hline(yintercept=0) + coord_flip()+ theme(axis.text = element_text(size = 10), axis.title = element_text(size = 12), legend.position = &quot;right&quot;, legend.title = element_blank(), panel.background = element_blank(), panel.grid.major = element_line(size = 0.15, linetype = &#39;solid&#39;, colour = &quot;grey&quot;))+ xlab(&quot;Function&quot;) + ylab(&quot;Mean difference&quot;) CI and WC element_gift %&gt;% filter(type %in% c(&quot;Hot_control&quot;, &quot;Treatment&quot;) &amp; time_point == &quot;FMT2&quot;) %&gt;% select(-time_point, -type) %&gt;% filter(rowSums(across(where(is.numeric), ~ . != 0)) &gt; 0) %&gt;% select(Tube_code, where(~ is.numeric(.) &amp;&amp; sum(.) &gt; 0)) %&gt;% left_join(sample_metadata[c(1, 7)], by = &quot;Tube_code&quot;) %&gt;% pivot_longer(-c(Tube_code,type), names_to = &quot;trait&quot;, values_to = &quot;value&quot;) %&gt;% group_by(trait) %&gt;% summarise(p_value = wilcox.test(value ~ type)$p.value) %&gt;% mutate(p_adjust=p.adjust(p_value, method=&quot;BH&quot;)) %&gt;% filter(p_adjust &lt; 0.05)%&gt;% remove_rownames() # A tibble: 0 × 3 # ℹ 3 variables: trait &lt;chr&gt;, p_value &lt;dbl&gt;, p_adjust &lt;dbl&gt; CC and WC element_gift %&gt;% filter(type %in% c(&quot;Hot_control&quot;, &quot;Control&quot;) &amp; time_point == &quot;FMT2&quot;) %&gt;% select(-time_point, -type) %&gt;% filter(rowSums(across(where(is.numeric), ~ . != 0)) &gt; 0) %&gt;% select(Tube_code, where(~ is.numeric(.) &amp;&amp; sum(.) &gt; 0)) %&gt;% left_join(sample_metadata[c(1, 7)], by = &quot;Tube_code&quot;) %&gt;% pivot_longer(-c(Tube_code,type), names_to = &quot;trait&quot;, values_to = &quot;value&quot;) %&gt;% group_by(trait) %&gt;% summarise(p_value = wilcox.test(value ~ type)$p.value) %&gt;% mutate(p_adjust=p.adjust(p_value, method=&quot;BH&quot;)) %&gt;% filter(p_adjust &lt; 0.05)%&gt;% remove_rownames() # A tibble: 0 × 3 # ℹ 3 variables: trait &lt;chr&gt;, p_value &lt;dbl&gt;, p_adjust &lt;dbl&gt; "],["physiological-measurements.html", "Chapter 11 Physiological measurements 11.1 Respirometry", " Chapter 11 Physiological measurements 11.1 Respirometry load(&quot;data/data_27022025.Rdata&quot;) respirometry_resp2 &lt;- read_excel(&quot;data/respirometry_resp2.xlsx&quot;) respirometry_resp2$individual &lt;- as.factor(respirometry_resp2$individual) respirometry_resp2$cage &lt;- as.factor(respirometry_resp2$cage) respirometry_resp2$time_point &lt;- as.factor(respirometry_resp2$time_point) respirometry_resp2$type &lt;- as.factor(respirometry_resp2$type) respirometry_resp2$population &lt;- as.factor(respirometry_resp2$population) respirometry_resp2$QC_normalized &lt;- as.numeric(respirometry_resp2$QC_normalized) respirometry_resp2$r2 &lt;- as.numeric(respirometry_resp2$r2) #Filter NA values respirometry_resp2&lt;-respirometry_resp2 %&gt;% filter(QC_normalized!=&quot;NA&quot;) 11.1.1 Acclimation oxygen consumption respirometry_resp2 %&gt;% filter(time_point==&quot;0&quot;)%&gt;% filter(individual!=&quot;AH1_2nd_8&quot;) %&gt;% filter(individual!=&quot;LI1_2nd_4&quot;) %&gt;% filter(individual!=&quot;LI1_2nd_3&quot;) %&gt;% #lizard doesn&#39;t stop moving during the whole measurement, increasing the value and making it and outlier filter(individual!=&quot;LI1_2nd_10&quot;) %&gt;% ggplot(aes(x = population, y = QC_normalized, color=population, fill=population, alpha=0.2)) + geom_boxplot()+ geom_jitter() + scale_color_manual(name=&quot;Population&quot;, breaks=c(&quot;Cold&quot;,&quot;Warm&quot;), labels=c(&quot;Cold&quot;,&quot;Warm&quot;), values=c(&#39;#008080&#39;, &quot;#d57d2c&quot;)) + scale_fill_manual(name=&quot;Population&quot;, breaks=c(&quot;Cold&quot;,&quot;Warm&quot;), labels=c(&quot;Cold&quot;,&quot;Warm&quot;), values=c(&#39;#00808050&#39;, &quot;#d57d2c50&quot;))+ #geom_text(aes(label = individual), hjust = 0, nudge_x = 0.05) + theme(axis.text.x = element_text(angle = 45, vjust = 0.5, hjust=1))+ stat_compare_means(size=3,vjust = 3, hjust=1 )+ theme(legend.position=&quot;none&quot;, panel.background = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank())+ theme_minimal()+ labs(x = &quot;Population&quot;, y= &quot;Normalized O2 consumption (ml/s/g)&quot;) 11.1.2 Time-point oxygen consumption respirometry_resp2 %&gt;% filter(weight!=5.19)%&gt;% filter(weight!=5.91)%&gt;% filter(weight!=5.03)%&gt;% filter(r2!=0.808)%&gt;% filter(QC_normalized!=0.000036) %&gt;% #r2 low filter(r2!=0.728) %&gt;% #r2 low ggplot(aes(x = time_point, y = QC_normalized, color=time_point, fill=time_point, alpha=0.2, label=cage)) + geom_boxplot()+ geom_jitter() + scale_color_manual(name=&quot;Time_point&quot;, breaks=c(&quot;0&quot;,&quot;1&quot;,&quot;2&quot;), labels=c(&quot;Acclimation&quot;,&quot;1 week post FMT&quot;, &quot;2 weeks post FMT&quot;), values=c(&#39;#BFA366&#39;, &quot;#dec14b&quot;, &quot;#6E5244&quot;)) + scale_fill_manual(name=&quot;Time_point&quot;, breaks=c(&quot;0&quot;,&quot;1&quot;,&quot;2&quot;), labels=c(&quot;Acclimation&quot;,&quot;1 week post FMT&quot;, &quot;2 weeks post FMT&quot;), values=c(&#39;#BFA36650&#39;, &quot;#dec14b50&quot;,&quot;#6E524450&quot;))+ geom_text()+ theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+ facet_wrap(~ factor(type))+ stat_compare_means(size=3)+ theme(legend.position=&quot;none&quot;)+ labs(x = &quot;Time_point&quot;, y= &quot;Normalized O2 consumption (ml/s/g)&quot;) respirometry_resp2 %&gt;% filter(weight!=5.19)%&gt;% filter(weight!=5.91)%&gt;% filter(weight!=5.03)%&gt;% filter(r2!=0.808)%&gt;% filter(QC_normalized!=0.000036) %&gt;% #r2 low filter(r2!=0.728) %&gt;% ggplot(aes(x = time_point, y = QC_normalized, color=time_point, fill=time_point, alpha=0.2)) + geom_boxplot()+ geom_jitter() + scale_color_manual(name=&quot;Time_point&quot;, breaks=c(&quot;0&quot;,&quot;1&quot;,&quot;2&quot;), labels=c(&quot;Acclimation&quot;,&quot;1 week post FMT&quot;, &quot;2 weeks post FMT&quot;), values=c(&#39;#BFA366&#39;, &quot;#dec14b&quot;, &quot;#6E5244&quot;)) + scale_fill_manual(name=&quot;Time_point&quot;, breaks=c(&quot;0&quot;,&quot;1&quot;,&quot;2&quot;), labels=c(&quot;Acclimation&quot;,&quot;1 week post FMT&quot;, &quot;2 weeks post FMT&quot;), values=c(&#39;#BFA36650&#39;, &quot;#dec14b50&quot;,&quot;#6E524450&quot;))+ theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+ facet_wrap(~ factor(type))+ stat_compare_means(size=3)+ theme(legend.position=&quot;none&quot;)+ labs(x = &quot;Time_point&quot;, y= &quot;Normalized O2 consumption (ml/s/g)&quot;)+ geom_signif(comparisons = list(c(&quot;0&quot;, &quot;1&quot;), c(&quot;0&quot;, &quot;2&quot;), c(&quot;1&quot;, &quot;2&quot;)), map_signif_level = TRUE) 11.1.3 Data modelling 11.1.3.1 CC vs CI Raw data modelling (LMM) #subset all the wrong measurements respirometry_resp2_subset&lt;-respirometry_resp2%&gt;% filter(type!=&quot;WC&quot;)%&gt;% filter(weight!=5.19)%&gt;% filter(weight!=5.91)%&gt;% filter(weight!=5.03)%&gt;% filter(r2!=0.808)%&gt;% filter(QC_normalized!=0.000036) %&gt;% #r2 low filter(r2!=0.728) %&gt;% filter(cage!=&quot;Cold_17&quot;) %&gt;% filter(cage!=&quot;Cold_3&quot;) %&gt;% filter(cage!=&quot;Cold_6&quot;) %&gt;% filter(cage!=&quot;Cold_9&quot;) %&gt;% filter(cage!=&quot;Hot_2&quot;) %&gt;% filter(cage!=&quot;Hot_8&quot;) #Create linear model formula model &lt;- lme(fixed = QC_normalized ~ time_point+type, data = respirometry_resp2_subset, random = ~ 1 | individual) #Print the model summary summary(model) Linear mixed-effects model fit by REML Data: respirometry_resp2_subset AIC BIC logLik -499.7762 -490.7972 255.8881 Random effects: Formula: ~1 | individual (Intercept) Residual StdDev: 2.828782e-05 8.566976e-05 Fixed effects: QC_normalized ~ time_point + type Value Std.Error DF t-value p-value (Intercept) 0.0004015990 3.245994e-05 21 12.372144 0.0000 time_point1 -0.0000856584 3.541372e-05 21 -2.418792 0.0247 time_point2 -0.0002059412 3.378535e-05 21 -6.095577 0.0000 typeCI 0.0000094826 3.334928e-05 12 0.284343 0.7810 Correlation: (Intr) tm_pn1 tm_pn2 time_point1 -0.530 time_point2 -0.478 0.472 typeCI -0.638 0.055 -0.063 Standardized Within-Group Residuals: Min Q1 Med Q3 Max -1.6356763 -0.5924021 -0.1745957 0.3513656 2.8648961 Number of Observations: 37 Number of Groups: 14 MuMIn::r.squaredGLMM(model) R2m R2c [1,] 0.4855379 0.536115 11.1.3.2 CI vs WC Raw data modelling (LMM) #Filter out WC from the dataframe and create a subset respirometry_resp2_subset&lt;-respirometry_resp2%&gt;% filter(weight!=5.19)%&gt;% filter(weight!=5.91)%&gt;% filter(weight!=5.03)%&gt;% filter(r2!=0.808)%&gt;% filter(QC_normalized!=0.000036) %&gt;% #r2 low filter(r2!=0.728) %&gt;% filter(cage!=&quot;Cold_17&quot;) %&gt;% filter(cage!=&quot;Cold_3&quot;) %&gt;% filter(cage!=&quot;Cold_6&quot;) %&gt;% filter(cage!=&quot;Cold_9&quot;) %&gt;% filter(cage!=&quot;Hot_2&quot;) %&gt;% filter(cage!=&quot;Hot_8&quot;) #Create linear model formula model &lt;- lme(fixed = QC_normalized ~ time_point+type, data = respirometry_resp2_subset, random = ~ 1 | individual) #Print the model summary summary(model) Linear mixed-effects model fit by REML Data: respirometry_resp2_subset AIC BIC logLik -765.5592 -752.0364 389.7796 Random effects: Formula: ~1 | individual (Intercept) Residual StdDev: 7.00926e-05 8.491172e-05 Fixed effects: QC_normalized ~ time_point + type Value Std.Error DF t-value p-value (Intercept) 0.0003725904 4.195910e-05 33 8.879849 0.0000 time_point1 -0.0000487464 2.909231e-05 33 -1.675576 0.1033 time_point2 -0.0001601635 2.806418e-05 33 -5.707045 0.0000 typeCI 0.0000122457 4.883159e-05 18 0.250774 0.8048 typeWC -0.0000129492 5.103162e-05 18 -0.253748 0.8026 Correlation: (Intr) tm_pn1 tm_pn2 typeCI time_point1 -0.347 time_point2 -0.314 0.517 typeCI -0.736 0.030 -0.038 typeWC -0.683 -0.036 -0.060 0.606 Standardized Within-Group Residuals: Min Q1 Med Q3 Max -1.5658463 -0.5182418 -0.1041003 0.5945025 2.3909153 Number of Observations: 56 Number of Groups: 21 MuMIn::r.squaredGLMM(model) R2m R2c [1,] 0.2849197 0.5747142 "],["404.html", "Page not found", " Page not found The page you requested cannot be found (perhaps it was moved or renamed). You may want to try searching to find the page's new location, or use the table of contents to find the page you are looking for. "]]
