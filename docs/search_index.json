[["index.html", "AlberdiLab | Martin-Bideguren et al. 2024 Study title to be added Chapter 1 Introduction 1.1 Prepare the R environment", " AlberdiLab | Martin-Bideguren et al. 2024 Study title to be added Garazi Martin-Bideguren1, Ostaizka Aizpurua2, Carlos Cabido3 and Antton Alberdi4 Last update: 2024-10-03 Chapter 1 Introduction This webbook contains all the code used for data analysis in study of the individual-level metagenomic data of Podarcis muralis and Podarcis liolepis lizards from different environments during an experimental setup. 1.1 Prepare the R environment 1.1.1 Environment To reproduce all the analyses locally, clone this repository in your computer using: RStudio &gt; New Project &gt; Version Control &gt; Git And indicating the following git repository: https://github.com/alberdilab/Podarcis_adaptation.git Once the R project has been created, follow the instructions and code chunks shown in this webbook. 1.1.2 Libraries The following R packages are required for the data analysis. # Base library(R.utils) library(knitr) library(tidyverse) library(devtools) library(tinytable) library(janitor) # For tree handling library(ape) library(phyloseq) library(phytools) # For plotting library(ggplot2) library(ggrepel) library(ggpubr) library(ggnewscale) library(gridExtra) library(ggtreeExtra) library(ggtree) library(ggh4x) library(rstatix) # For statistics library(spaa) library(vegan) library(Rtsne) library(geiger) library(hilldiv2) library(distillR) library(broom.mixed) library(corrplot) library(nlme) library(pairwiseAdonis) library(ANCOMBC) University of Copenhagen, garazi.bideguren@sund.ku.dk↩︎ University of Copenhagen, ostaizka.aizpurua@sund.ku.dk↩︎ Sociedad de Ciencias Aranzadi-Departamento de Herpetología, ccabido@aranzadi.eus↩︎ University of Copenhagen, antton.alberdi@sund.ku.dk↩︎ "],["prepare-data.html", "Chapter 2 Prepare data 2.1 Load data 2.2 Create working objects 2.3 Filtering 2.4 Load data statistics 2.5 Prepare color scheme 2.6 Wrap working objects", " Chapter 2 Prepare data 2.1 Load data Load the original data files outputted by the bioinformatic pipeline. 2.1.1 Sample metadata sample_metadata &lt;- read_tsv(&quot;data/metadata.tsv&quot;) 2.1.2 Read counts read_counts_raw &lt;- read_tsv(&quot;data/genome.count.tsv&quot;) %&gt;% rename(genome=1) #Transformation of read_counts to combine data from both sequence rounds merge_and_rename &lt;- function(read_counts_raw) { read_counts_raw %&gt;% # Gather the columns into long format pivot_longer(cols = -genome, names_to = &quot;col&quot;) %&gt;% # Extract prefix mutate(prefix = gsub(&quot;^(.*?)_.*&quot;, &quot;\\\\1&quot;, col)) %&gt;% # Group by prefix and genome, then summarize group_by(prefix, genome) %&gt;% summarize(value = sum(value)) %&gt;% # Spread the data back to wide format pivot_wider(names_from = prefix, values_from = value) } read_counts &lt;- merge_and_rename(read_counts_raw) 2.1.3 Genome base hits genome_hits_raw &lt;- read_tsv(&quot;data/genome.covered_bases.tsv&quot;) %&gt;% rename(genome=1) #Transformation of genome_hits to combine data from both sequence rounds merge_and_rename &lt;- function(genome_hits_raw) { genome_hits_raw %&gt;% # Gather the columns into long format pivot_longer(cols = -genome, names_to = &quot;col&quot;) %&gt;% # Extract prefix mutate(prefix = gsub(&quot;^(.*?)_.*&quot;, &quot;\\\\1&quot;, col)) %&gt;% # Group by prefix and genome, then summarize group_by(prefix, genome) %&gt;% summarize(value = sum(value)) %&gt;% # Spread the data back to wide format pivot_wider(names_from = prefix, values_from = value) } genome_hits &lt;- merge_and_rename(genome_hits_raw) 2.1.4 Genome taxonomy genome_taxonomy &lt;- read_tsv(&quot;data/gtdbtk.summary.tsv&quot;) %&gt;% select(mag_id = user_genome, classification) %&gt;% separate( classification, into = c(&quot;domain&quot;, &quot;phylum&quot;, &quot;class&quot;, &quot;order&quot;, &quot;family&quot;, &quot;genus&quot;, &quot;species&quot;), sep = &quot;;&quot;) %&gt;% rename(genome=1) 2.1.5 Genome quality genome_quality &lt;- read_tsv(&quot;data/quality_report.tsv&quot;) %&gt;% select( genome = Name, completeness = Completeness, contamination = Contamination, length = Genome_Size, gc = GC_Content ) genome_quality&lt;-genome_quality %&gt;% mutate (genome=str_remove_all(genome,&quot;.fa&quot;)) #Filter MAGs with over 70% completeness and less than 10% contamination genome_quality &lt;- genome_quality %&gt;% filter(completeness &gt; 70 &amp; contamination &lt; 10) 2.1.6 Genome tree genome_tree &lt;- read_tree(&quot;data/gtdbtk.backbone.bac120.classify.tree&quot;) genome_tree$tip.label &lt;- str_replace_all(genome_tree$tip.label,&quot;&#39;&quot;, &quot;&quot;) #remove single quotes in MAG names #Filter genome_taxonomy to keep MAGs with over 70% completeness and less than 10% contamination genome_taxonomy &lt;- genome_taxonomy %&gt;% semi_join(genome_quality, by = &quot;genome&quot;) genome_tree &lt;- keep.tip(genome_tree, tip=genome_taxonomy$genome) # keep only MAG tips 2.1.7 Genome annotations genome_annotations &lt;- read_tsv(&quot;data/annotations.tsv.xz&quot;) %&gt;% rename(gene=1, genome=2, contig=3) #Filter only the MAGs with over 70% completeness and less than 10% contamination genome_annotations &lt;- genome_annotations %&gt;% semi_join(genome_quality, by = &quot;genome&quot;) 2.2 Create working objects Transform the original data files into working objects for downstream analyses. 2.2.1 Merge genome taxonomy and quality genome_metadata &lt;- genome_taxonomy %&gt;% inner_join(genome_quality,by=join_by(genome==genome)) #join quality 2.2.2 Calculate genome coverage #Filter genome_hits for the MAGs with over 70% completeness and less than 10% contamination genome_hits &lt;- genome_hits %&gt;% semi_join(genome_quality, by = &quot;genome&quot;) genome_coverage &lt;- genome_hits %&gt;% mutate(across(where(is.numeric), ~ ./genome_metadata$length)) 2.3 Filtering 4 samples are removed from the analysis due to their low sequencing depth. #Counts_raw columns_to_exclude &lt;- c(&quot;AD16&quot;,&quot;AD23&quot;, &quot;AD25&quot;, &quot;AD91&quot;) # Columns to exclude read_counts &lt;- read_counts %&gt;% select(-columns_to_exclude) #Metadata sample_metadata &lt;- sample_metadata %&gt;% filter(Tube_code != &quot;AD16&quot;) %&gt;% filter(Tube_code != &quot;AD23&quot;) %&gt;% filter(Tube_code != &quot;AD25&quot;) %&gt;% filter(Tube_code != &quot;AD91&quot;) #Coverage_table columns_to_exclude &lt;- c(&quot;AD16&quot;, &quot;AD23&quot;, &quot;AD25&quot;, &quot;AD91&quot;) # Columns to exclude genome_coverage &lt;- genome_coverage %&gt;% select(-columns_to_exclude) ##Removal of samples of individual LI1_2nd_6 #Counts_raw columns_to_exclude &lt;- c(&quot;AFV13&quot;,&quot;AD06&quot;, &quot;AD31&quot;, &quot;AE03&quot;, &quot;AF12&quot;) # Columns to exclude read_counts &lt;- read_counts %&gt;% select(-columns_to_exclude) #Metadata sample_metadata &lt;- sample_metadata %&gt;% filter(Tube_code != &quot;AFV13&quot;) %&gt;% filter(Tube_code != &quot;AD06&quot;) %&gt;% filter(Tube_code != &quot;AD31&quot;) %&gt;% filter(Tube_code != &quot;AE03&quot;) %&gt;% filter(Tube_code != &quot;AF12&quot;) #Coverage_table columns_to_exclude &lt;- c(&quot;AFV13&quot;,&quot;AD06&quot;, &quot;AD31&quot;, &quot;AE03&quot;, &quot;AF12&quot;) # Columns to exclude genome_coverage &lt;- genome_coverage %&gt;% select(-columns_to_exclude) 2.3.1 Filter reads by coverage #Filter read_counts for the MAGs with over 70% completeness and less than 10% contamination read_counts &lt;- read_counts %&gt;% semi_join(genome_quality, by = &quot;genome&quot;) min_coverage=0.3 read_counts_filt &lt;- genome_coverage %&gt;% mutate(across(where(is.numeric), ~ ifelse(. &gt; min_coverage, 1, 0))) %&gt;% mutate(across(-1, ~ . * read_counts[[cur_column()]])) 2.3.2 Transform reads into genome counts readlength=150 genome_counts &lt;- read_counts %&gt;% mutate(across(where(is.numeric), ~ . / (genome_metadata$length / readlength) )) readlength=150 genome_counts_filt &lt;- read_counts_filt %&gt;% mutate(across(where(is.numeric), ~ . / (genome_metadata$length / readlength) )) 2.3.3 Distill annotations into GIFTs genome_gifts &lt;- distill(genome_annotations,GIFT_db,genomecol=2,annotcol=c(9,10,19)) 2.4 Load data statistics 2.4.1 Raw reads raw_reads &lt;- &quot;data/multiqc_general_stats_2.txt&quot; %&gt;% read_tsv() %&gt;% select( sample = Sample, raw_reads = `total_sequences` ) %&gt;% mutate(sample_prefix = str_extract(sample, &quot;^[^_]+&quot;)) %&gt;% group_by(sample_prefix) %&gt;% summarize(raw_reads = sum(raw_reads, na.rm = TRUE)) %&gt;% rename(sample = sample_prefix) %&gt;% mutate(sample = str_remove(sample, &quot;^fastp \\\\|\\\\s*&quot;)) 2.4.2 Quality-filtered reads fastp_reads &lt;- &quot;data/multiqc_general_stats.txt&quot; %&gt;% read_tsv() %&gt;% select( sample = Sample, trimmed_reads = `total_sequences` ) %&gt;% mutate(sample_prefix = str_extract(sample, &quot;^[^_]+&quot;)) %&gt;% group_by(sample_prefix) %&gt;% summarize(trimmed_reads = sum(trimmed_reads, na.rm = TRUE)) %&gt;% rename(sample = sample_prefix) %&gt;% filter(!str_detect(sample, &quot;nonlizard \\\\|&quot;)) %&gt;% filter(!str_detect(sample, &quot;lizard \\\\|&quot;)) %&gt;% filter(!str_detect(sample, &quot;refseq500 \\\\|&quot;)) %&gt;% mutate(sample = str_remove(sample, &quot;^fastp \\\\|\\\\s*&quot;)) 2.4.3 Host-mapped reads host_mapped &lt;- &quot;data/multiqc_general_stats.txt&quot; %&gt;% read_tsv() %&gt;% filter(str_detect(Sample, &quot;lizard&quot;)) %&gt;% select( sample = Sample, host_mapped = `reads_mapped`, mapping_total = `raw_total_sequences` ) %&gt;% mutate( host_unmapped = mapping_total - host_mapped ) %&gt;% filter(!is.na(host_mapped)) %&gt;% separate( col = sample, into = c(&quot;host_name&quot;, &quot;sample&quot;), sep = &quot; \\\\| &quot; ) %&gt;% rename(mapped = host_mapped, unmapped = host_unmapped) %&gt;% select(-mapping_total) %&gt;% pivot_longer(-host_name:-sample) %&gt;% mutate( name = str_glue(&quot;{name}_{host_name}&quot;) ) %&gt;% select(-host_name) %&gt;% pivot_wider() %&gt;% mutate(sample = str_extract(sample, &quot;^[^_]+&quot;)) %&gt;% group_by(sample) %&gt;% summarize( mapped_lizard = sum(mapped_lizard), unmapped_lizard = sum(unmapped_lizard) ) 2.4.4 Prokaryotic fraction singlem &lt;- &quot;data/singleM.tsv&quot; %&gt;% read_tsv() %&gt;% distinct() %&gt;% mutate( sample = sample %&gt;% str_remove_all(&quot;_1$&quot;), read_fraction = read_fraction %&gt;% str_remove(&quot;%&quot;) %&gt;% as.numeric(), read_fraction = read_fraction / 100 ) %&gt;% select( sample, singlem_prokaryotic_bases = bacterial_archaeal_bases, singlem_metagenome_size = metagenome_size, singlem_read_fraction = read_fraction, ) %&gt;% mutate(sample_prefix = str_extract(sample, &quot;^[^_]+&quot;)) %&gt;% group_by(sample_prefix) %&gt;% summarize( singlem_prokaryotic_bases = sum(singlem_prokaryotic_bases), singlem_metagenome_size = sum(singlem_metagenome_size), singlem_read_fraction = mean(singlem_read_fraction) ) %&gt;% rename(sample = sample_prefix) 2.4.5 MAG-mapped reads mag_mapping &lt;- read_tsv(&quot;data/contig.count.tsv.xz&quot;) %&gt;% pivot_longer(-sequence_id) %&gt;% summarise(value = sum(value), .by = &quot;name&quot;) %&gt;% rename(sample = name, mapped_mags = value) %&gt;% mutate(sample_prefix = str_extract(sample, &quot;^[^_]+&quot;)) %&gt;% group_by(sample_prefix) %&gt;% summarize( mapped_mags = sum(mapped_mags) ) %&gt;% rename(sample = sample_prefix) 2.4.6 Wrap data statistics data_stats &lt;- raw_reads %&gt;% left_join(fastp_reads) %&gt;% left_join(host_mapped) %&gt;% left_join(singlem) %&gt;% left_join(mag_mapping) data_stats&lt;- data_stats %&gt;% filter(!str_detect(sample, &quot;nonlizard \\\\|&quot;)) %&gt;% filter(!str_detect(sample, &quot;lizard \\\\|&quot;)) %&gt;% filter(!str_detect(sample, &quot;refseq500 \\\\|&quot;)) 2.5 Prepare color scheme AlberdiLab projects use unified color schemes developed for the Earth Hologenome Initiative, to facilitate figure interpretation. phylum_colors &lt;- read_tsv(&quot;https://raw.githubusercontent.com/earthhologenome/EHI_taxonomy_colour/main/ehi_phylum_colors.tsv&quot;) %&gt;% right_join(genome_metadata, by=join_by(phylum == phylum)) %&gt;% arrange(match(genome, genome_tree$tip.label)) %&gt;% select(phylum, colors) %&gt;% unique() %&gt;% arrange(phylum) %&gt;% pull(colors, name=phylum) 2.6 Wrap working objects All working objects are wrapped into a single Rdata object to facilitate downstream usage. save(sample_metadata, genome_metadata, read_counts, genome_counts, genome_counts_filt, genome_tree, genome_gifts, phylum_colors, data_stats, file = &quot;data/data.Rdata&quot;) "],["data-statistics.html", "Chapter 3 Data statistics 3.1 Sequencing reads statistics 3.2 DNA fractions 3.3 Recovered microbial fraction", " Chapter 3 Data statistics load(&quot;data/data.Rdata&quot;) 3.1 Sequencing reads statistics data_stats$raw_reads %&gt;% sum() [1] 4995505290 data_stats$raw_reads %&gt;% mean() [1] 28875753 data_stats$raw_reads %&gt;% sd() [1] 13447526 3.2 DNA fractions #Overall data_stats %&gt;% mutate(mapped_perc=mapped_mags/trimmed_reads) %&gt;% summarise(mean=mean(mapped_perc),sd=sd(mapped_perc)) # A tibble: 1 × 2 mean sd &lt;dbl&gt; &lt;dbl&gt; 1 0.438 0.207 data_stats %&gt;% mutate( low_quality = raw_reads - trimmed_reads, unmapped_reads = trimmed_reads - mapped_lizard - mapped_mags ) %&gt;% select(sample, low_quality, mapped_lizard, mapped_mags, unmapped_reads) %&gt;% pivot_longer(-sample) %&gt;% mutate(name=factor(name,levels=c(&quot;low_quality&quot;,&quot;mapped_lizard&quot;,&quot;unmapped_reads&quot;,&quot;mapped_mags&quot;))) %&gt;% left_join(., sample_metadata, by = join_by(sample == Tube_code)) %&gt;% filter(!is.na(time_point)) %&gt;% ggplot(aes(x = sample, y = value, fill = name)) + geom_bar(stat = &quot;identity&quot;, position = &quot;fill&quot;) + scale_fill_manual(name=&quot;Sequence type&quot;, breaks=c(&quot;low_quality&quot;,&quot;mapped_lizard&quot;,&quot;unmapped_reads&quot;,&quot;mapped_mags&quot;), labels=c(&quot;Low quality&quot;,&quot;Mapped to host&quot;,&quot;Unmapped&quot;,&quot;Mapped to MAGs&quot;), values=c(&quot;#CCCCCC&quot;, &quot;#bcdee1&quot;, &quot;#d8b8a3&quot;,&quot;#93655c&quot;))+ facet_grid(~time_point, scales = &quot;free&quot;, labeller = labeller(time_point=c(&quot;0_Wild&quot;=&quot;Wild&quot;, &quot;1_Acclimation&quot;=&quot;Acclimation&quot;, &quot;2_Antibiotics&quot;=&quot;Antibiotics&quot;, &quot;3_Transplant1&quot;=&quot;Transplant1&quot;, &quot;4_Transplant2&quot;=&quot;Transplant2&quot;, &quot;5_Post-FMT1&quot;=&quot;Post1&quot;, &quot;6_Post-FMT2&quot;=&quot;Post2&quot;))) + theme_minimal() + theme(axis.text.x = element_text(angle = 90, hjust = 1, size=0)) + labs(y=&quot;DNA sequence fraction&quot;,x=&quot;Samples&quot;) 3.3 Recovered microbial fraction data_stats %&gt;% mutate( unmapped_reads = trimmed_reads - mapped_lizard - mapped_mags, mag_proportion = mapped_mags / (mapped_mags + unmapped_reads), singlem_read_fraction = singlem_read_fraction ) %&gt;% select(sample, mag_proportion, singlem_read_fraction) %&gt;% mutate( mag_proportion = if_else(singlem_read_fraction == 0, 0, mag_proportion), singlem_read_fraction = if_else(singlem_read_fraction == 0, NA, singlem_read_fraction), singlem_read_fraction = if_else(singlem_read_fraction &lt; mag_proportion, NA, singlem_read_fraction), singlem_read_fraction = if_else(singlem_read_fraction &gt; 1, 1, singlem_read_fraction) ) %&gt;% pivot_longer(-sample, names_to = &quot;proportion&quot;, values_to = &quot;value&quot;) %&gt;% mutate( proportion = factor( proportion, levels = c(&quot;mag_proportion&quot;, &quot;singlem_read_fraction&quot;) ) ) %&gt;% left_join(., sample_metadata, by = join_by(sample == Tube_code)) %&gt;% filter(!is.na(time_point)) %&gt;% ggplot(aes(x = sample, y = value, color = proportion)) + geom_line(aes(group = sample), color = &quot;#f8a538&quot;) + geom_point() + scale_color_manual(name=&quot;Proportion&quot;, breaks=c(&quot;mag_proportion&quot;,&quot;singlem_read_fraction&quot;), labels=c(&quot;Recovered&quot;,&quot;Estimated&quot;), values=c(&quot;#52e1e8&quot;, &quot;#876b53&quot;))+ theme_minimal() + facet_grid(~time_point, scales = &quot;free&quot;, space=&quot;free&quot;, labeller = labeller(time_point=c(&quot;0_Wild&quot;=&quot;Wild&quot;, &quot;1_Acclimation&quot;=&quot;Acclimation&quot;, &quot;2_Antibiotics&quot;=&quot;Antibiotics&quot;, &quot;3_Transplant1&quot;=&quot;Transplant1&quot;, &quot;4_Transplant2&quot;=&quot;Transplant2&quot;, &quot;5_Post-FMT1&quot;=&quot;Post1&quot;, &quot;6_Post-FMT2&quot;=&quot;Post2&quot;)))+ labs(y = &quot;Samples&quot;, x = &quot;Prokaryotic fraction&quot;) + scale_y_continuous(limits = c(0, 1)) + theme( axis.text.y = element_text(size = 4), axis.text.x = element_text( angle = 90, vjust = 0.5, hjust = 1, size = 0), legend.position = &quot;right&quot; ) 3.3.1 Domain-adjusted mapping rate (DAMR) data_stats %&gt;% mutate( unmapped_reads = trimmed_reads - mapped_lizard - mapped_mags, mag_proportion = mapped_mags / (mapped_mags + unmapped_reads), singlem_read_fraction = singlem_read_fraction ) %&gt;% mutate(damr=pmin(1, mag_proportion/singlem_read_fraction)) %&gt;% left_join(sample_metadata, by = join_by(sample == Tube_code)) %&gt;% filter(!is.na(time_point)) %&gt;% select(sample,damr, time_point, species, type) %&gt;% #group_by(type) %&gt;% #summarise(mean=mean(damr),sd=sd(damr)) %&gt;% tt() tinytable_tguvz1uxhp95q8omwdwk .table td.tinytable_css_c730rasiigjn7ui9pv3o, .table th.tinytable_css_c730rasiigjn7ui9pv3o { border-bottom: solid 0.1em #d3d8dc; } sample damr time_point species type AC79 1.0000000 1_Acclimation Podarcis_muralis Control AC80 1.0000000 1_Acclimation Podarcis_muralis Treatment AC81 0.9813013 1_Acclimation Podarcis_muralis Treatment AC82 0.7490771 1_Acclimation Podarcis_muralis Treatment AC83 1.0000000 1_Acclimation Podarcis_muralis Control AC84 1.0000000 1_Acclimation Podarcis_muralis Control AC85 0.8363777 1_Acclimation Podarcis_muralis Control AC86 0.8800275 1_Acclimation Podarcis_muralis Control AC87 0.9672854 1_Acclimation Podarcis_muralis Treatment AC88 0.3142108 1_Acclimation Podarcis_muralis Control AC89 0.9338962 1_Acclimation Podarcis_muralis Treatment AC90 1.0000000 1_Acclimation Podarcis_muralis Control AC91 1.0000000 1_Acclimation Podarcis_muralis Control AC92 1.0000000 1_Acclimation Podarcis_muralis Control AC93 1.0000000 1_Acclimation Podarcis_muralis Treatment AC94 0.9159348 1_Acclimation Podarcis_muralis Treatment AC95 0.9239904 1_Acclimation Podarcis_muralis Treatment AC96 0.9425962 1_Acclimation Podarcis_muralis Treatment AC97 0.9394886 1_Acclimation Podarcis_liolepis Hot_control AC98 1.0000000 1_Acclimation Podarcis_liolepis Hot_control AC99 1.0000000 1_Acclimation Podarcis_liolepis Hot_control AD01 1.0000000 1_Acclimation Podarcis_liolepis Hot_control AD02 1.0000000 1_Acclimation Podarcis_liolepis Hot_control AD03 1.0000000 1_Acclimation Podarcis_liolepis Hot_control AD04 0.8896057 1_Acclimation Podarcis_liolepis Hot_control AD05 1.0000000 1_Acclimation Podarcis_liolepis Hot_control AD07 0.9515379 1_Acclimation Podarcis_liolepis Hot_control AD08 0.7045003 2_Antibiotics Podarcis_muralis Control AD09 1.0000000 2_Antibiotics Podarcis_muralis Control AD10 0.9598720 2_Antibiotics Podarcis_muralis Control AD11 0.6230176 2_Antibiotics Podarcis_muralis Control AD12 0.7487463 2_Antibiotics Podarcis_muralis Control AD13 1.0000000 2_Antibiotics Podarcis_muralis Control AD14 0.4536529 2_Antibiotics Podarcis_muralis Control AD15 1.0000000 2_Antibiotics Podarcis_muralis Control AD17 0.8774871 2_Antibiotics Podarcis_muralis Treatment AD18 0.4991585 2_Antibiotics Podarcis_muralis Treatment AD19 0.4060523 2_Antibiotics Podarcis_muralis Treatment AD20 0.5227482 2_Antibiotics Podarcis_muralis Treatment AD21 0.6551882 2_Antibiotics Podarcis_muralis Treatment AD22 0.9106725 2_Antibiotics Podarcis_muralis Treatment AD24 0.5972915 2_Antibiotics Podarcis_muralis Treatment AD26 0.9204825 2_Antibiotics Podarcis_liolepis Hot_control AD27 0.5215059 2_Antibiotics Podarcis_liolepis Hot_control AD28 0.8180607 2_Antibiotics Podarcis_liolepis Hot_control AD29 0.7175978 2_Antibiotics Podarcis_liolepis Hot_control AD30 0.9937574 2_Antibiotics Podarcis_liolepis Hot_control AD32 0.6710817 2_Antibiotics Podarcis_liolepis Hot_control AD33 0.6778368 2_Antibiotics Podarcis_liolepis Hot_control AD34 0.4642326 2_Antibiotics Podarcis_liolepis Hot_control AD36 0.8288365 3_Transplant1 Podarcis_muralis Control AD37 0.9530848 3_Transplant1 Podarcis_muralis Control AD38 0.9247925 3_Transplant1 Podarcis_muralis Control AD39 1.0000000 3_Transplant1 Podarcis_muralis Control AD40 0.9991552 3_Transplant1 Podarcis_muralis Control AD41 0.9550964 3_Transplant1 Podarcis_muralis Control AD42 1.0000000 3_Transplant1 Podarcis_muralis Control AD43 1.0000000 3_Transplant1 Podarcis_muralis Control AD44 0.9108807 3_Transplant1 Podarcis_muralis Control AD46 0.8708468 3_Transplant1 Podarcis_muralis Treatment AD47 0.8328653 3_Transplant1 Podarcis_muralis Treatment AD49 0.8940294 3_Transplant1 Podarcis_muralis Treatment AD50 0.8757711 3_Transplant1 Podarcis_muralis Treatment AD51 0.8479193 3_Transplant1 Podarcis_muralis Treatment AD52 0.8596870 3_Transplant1 Podarcis_muralis Treatment AD53 0.8528974 3_Transplant1 Podarcis_muralis Treatment AD54 1.0000000 3_Transplant1 Podarcis_liolepis Hot_control AD55 1.0000000 4_Transplant2 Podarcis_muralis Control AD56 0.9327538 4_Transplant2 Podarcis_muralis Control AD57 1.0000000 4_Transplant2 Podarcis_muralis Control AD58 1.0000000 4_Transplant2 Podarcis_muralis Control AD59 1.0000000 4_Transplant2 Podarcis_muralis Control AD60 0.7988844 4_Transplant2 Podarcis_muralis Control AD61 1.0000000 4_Transplant2 Podarcis_muralis Control AD62 1.0000000 4_Transplant2 Podarcis_muralis Control AD63 0.8992048 4_Transplant2 Podarcis_muralis Control AD65 1.0000000 4_Transplant2 Podarcis_muralis Treatment AD66 0.8821027 4_Transplant2 Podarcis_muralis Treatment AD68 0.8820274 4_Transplant2 Podarcis_muralis Treatment AD70 0.9590793 4_Transplant2 Podarcis_muralis Treatment AD71 0.8360540 4_Transplant2 Podarcis_muralis Treatment AD72 0.8835253 4_Transplant2 Podarcis_muralis Treatment AD73 1.0000000 4_Transplant2 Podarcis_liolepis Hot_control AD74 0.9017271 5_Post-FMT1 Podarcis_muralis Control AD75 1.0000000 5_Post-FMT1 Podarcis_muralis Treatment AD76 0.9862581 5_Post-FMT1 Podarcis_muralis Treatment AD77 0.8963376 5_Post-FMT1 Podarcis_muralis Treatment AD78 1.0000000 5_Post-FMT1 Podarcis_muralis Treatment AD79 1.0000000 5_Post-FMT1 Podarcis_muralis Control AD80 0.8808155 5_Post-FMT1 Podarcis_muralis Treatment AD81 1.0000000 5_Post-FMT1 Podarcis_muralis Control AD82 1.0000000 5_Post-FMT1 Podarcis_muralis Control AD83 1.0000000 5_Post-FMT1 Podarcis_muralis Treatment AD84 1.0000000 5_Post-FMT1 Podarcis_muralis Treatment AD85 1.0000000 5_Post-FMT1 Podarcis_muralis Control AD86 0.9889084 5_Post-FMT1 Podarcis_muralis Control AD87 1.0000000 5_Post-FMT1 Podarcis_muralis Control AD88 1.0000000 5_Post-FMT1 Podarcis_muralis Treatment AD89 0.9562489 5_Post-FMT1 Podarcis_muralis Control AD90 1.0000000 5_Post-FMT1 Podarcis_muralis Control AD93 1.0000000 5_Post-FMT1 Podarcis_liolepis Hot_control AD94 0.7947750 5_Post-FMT1 Podarcis_liolepis Hot_control AD95 0.9506977 5_Post-FMT1 Podarcis_liolepis Hot_control AD96 0.9171413 5_Post-FMT1 Podarcis_liolepis Hot_control AD97 0.9257685 5_Post-FMT1 Podarcis_liolepis Hot_control AD98 0.9048349 5_Post-FMT1 Podarcis_liolepis Hot_control AD99 0.9966152 5_Post-FMT1 Podarcis_liolepis Hot_control AE01 1.0000000 5_Post-FMT1 Podarcis_liolepis Hot_control AE02 1.0000000 5_Post-FMT1 Podarcis_liolepis Hot_control AE04 1.0000000 6_Post-FMT2 Podarcis_muralis Treatment AE05 1.0000000 6_Post-FMT2 Podarcis_muralis Treatment AE06 1.0000000 6_Post-FMT2 Podarcis_muralis Control AE07 0.7797794 6_Post-FMT2 Podarcis_muralis Control AE08 1.0000000 6_Post-FMT2 Podarcis_muralis Control AE09 1.0000000 6_Post-FMT2 Podarcis_muralis Control AE91 0.9259146 6_Post-FMT2 Podarcis_muralis Treatment AE92 1.0000000 6_Post-FMT2 Podarcis_muralis Control AE93 1.0000000 6_Post-FMT2 Podarcis_muralis Control AE94 0.9152960 6_Post-FMT2 Podarcis_muralis Treatment AE95 1.0000000 6_Post-FMT2 Podarcis_muralis Treatment AE96 0.7786112 6_Post-FMT2 Podarcis_muralis Treatment AE97 0.9365037 6_Post-FMT2 Podarcis_muralis Control AE98 1.0000000 6_Post-FMT2 Podarcis_muralis Control AE99 0.8513354 6_Post-FMT2 Podarcis_muralis Treatment AF01 0.9046369 6_Post-FMT2 Podarcis_muralis Treatment AF02 1.0000000 6_Post-FMT2 Podarcis_muralis Control AF03 0.9030087 6_Post-FMT2 Podarcis_muralis Treatment AF04 1.0000000 6_Post-FMT2 Podarcis_liolepis Hot_control AF05 1.0000000 6_Post-FMT2 Podarcis_liolepis Hot_control AF06 1.0000000 6_Post-FMT2 Podarcis_liolepis Hot_control AF07 0.9526443 6_Post-FMT2 Podarcis_liolepis Hot_control AF08 1.0000000 6_Post-FMT2 Podarcis_liolepis Hot_control AF09 1.0000000 6_Post-FMT2 Podarcis_liolepis Hot_control AF10 0.9716162 6_Post-FMT2 Podarcis_liolepis Hot_control AF11 0.9654152 6_Post-FMT2 Podarcis_liolepis Hot_control AF13 0.8818742 6_Post-FMT2 Podarcis_liolepis Hot_control AFU87 0.8810513 0_Wild Podarcis_muralis Control AFU88 0.8317800 0_Wild Podarcis_muralis Treatment AFU91 0.8923699 0_Wild Podarcis_muralis Treatment AFU92 0.8094776 0_Wild Podarcis_muralis Treatment AFU93 0.8517368 0_Wild Podarcis_muralis Control AFU94 0.8325385 0_Wild Podarcis_muralis Treatment AFU95 0.8419270 0_Wild Podarcis_muralis Treatment AFU96 0.8326820 0_Wild Podarcis_muralis Control AFU97 0.8107271 0_Wild Podarcis_muralis Treatment AFU98 0.7506522 0_Wild Podarcis_muralis Control AFU99 0.8582371 0_Wild Podarcis_muralis Treatment AFV01 0.9331539 0_Wild Podarcis_muralis Treatment AFV02 0.8316460 0_Wild Podarcis_muralis Treatment AFV03 0.8752591 0_Wild Podarcis_muralis Control AFV04 0.9180285 0_Wild Podarcis_muralis Control AFV05 1.0000000 0_Wild Podarcis_muralis Control AFV06 1.0000000 0_Wild Podarcis_muralis Control AFV07 0.8460805 0_Wild Podarcis_muralis Control AFV08 0.7497043 0_Wild Podarcis_liolepis Hot_control AFV09 0.5412999 0_Wild Podarcis_liolepis Hot_control AFV10 0.8002499 0_Wild Podarcis_liolepis Hot_control AFV11 0.8225298 0_Wild Podarcis_liolepis Hot_control AFV12 0.7925988 0_Wild Podarcis_liolepis Hot_control AFV14 0.8106269 0_Wild Podarcis_liolepis Hot_control AFV15 0.9691106 0_Wild Podarcis_liolepis Hot_control AFV16 0.8218990 0_Wild Podarcis_liolepis Hot_control AFV17 0.8091152 0_Wild Podarcis_liolepis Hot_control "],["mag-catalogue.html", "Chapter 4 MAG catalogue 4.1 Genome phylogeny 4.2 Genome quality 4.3 Functional overview 4.4 Functional ordination", " Chapter 4 MAG catalogue load(&quot;data/data.Rdata&quot;) 4.1 Genome phylogeny # Generate the phylum color heatmap phylum_heatmap &lt;- read_tsv(&quot;https://raw.githubusercontent.com/earthhologenome/EHI_taxonomy_colour/main/ehi_phylum_colors.tsv&quot;) %&gt;% right_join(genome_metadata, by=join_by(phylum == phylum)) %&gt;% arrange(match(genome, genome_tree$tip.label)) %&gt;% select(genome,phylum) %&gt;% mutate(phylum = factor(phylum, levels = unique(phylum))) %&gt;% column_to_rownames(var = &quot;genome&quot;) # Generate basal tree circular_tree &lt;- force.ultrametric(genome_tree, method=&quot;extend&quot;) %&gt;% # extend to ultrametric for the sake of visualisation ggtree(., layout=&quot;fan&quot;, open.angle=10, size=0.5) *************************************************************** * Note: * * force.ultrametric does not include a formal method to * * ultrametricize a tree &amp; should only be used to coerce * * a phylogeny that fails is.ultrametric due to rounding -- * * not as a substitute for formal rate-smoothing methods. * *************************************************************** # Add phylum ring circular_tree &lt;- gheatmap(circular_tree, phylum_heatmap, offset=0.55, width=0.1, colnames=FALSE) + scale_fill_manual(values=phylum_colors) + geom_tiplab2(size=1, hjust=-0.1) + theme(legend.position = &quot;none&quot;, plot.margin = margin(0, 0, 0, 0), panel.margin = margin(0, 0, 0, 0)) # Flush color scale to enable a new color scheme in the next ring circular_tree &lt;- circular_tree + new_scale_fill() # Add completeness ring circular_tree &lt;- circular_tree + new_scale_fill() + scale_fill_gradient(low = &quot;#d1f4ba&quot;, high = &quot;#f4baba&quot;) + geom_fruit( data=genome_metadata, geom=geom_bar, mapping = aes(x=completeness, y=genome, fill=contamination), offset = 0.55, orientation=&quot;y&quot;, stat=&quot;identity&quot;) # Add genome-size ring circular_tree &lt;- circular_tree + new_scale_fill() + scale_fill_manual(values = &quot;#cccccc&quot;) + geom_fruit( data=genome_metadata, geom=geom_bar, mapping = aes(x=length, y=genome), offset = 0.05, orientation=&quot;y&quot;, stat=&quot;identity&quot;) # Add text circular_tree &lt;- circular_tree + annotate(&#39;text&#39;, x=3.4, y=0, label=&#39; Phylum&#39;, family=&#39;ArialMT&#39;, size=3.5) + annotate(&#39;text&#39;, x=4.2, y=0, label=&#39; Genome quality&#39;, family=&#39;ArialMT&#39;, size=3.5) + annotate(&#39;text&#39;, x=4.7, y=0, label=&#39; Genome size&#39;, family=&#39;ArialMT&#39;, size=3.5) #Plot circular tree circular_tree %&gt;% open_tree(30) %&gt;% rotate_tree(90) 4.2 Genome quality genome_metadata$completeness %&gt;% mean() [1] 92.98658 genome_metadata$completeness %&gt;% sd() [1] 7.170467 genome_metadata$contamination %&gt;% mean() [1] 2.154888 genome_metadata$contamination %&gt;% sd() [1] 2.194372 #Generate quality biplot genome_biplot &lt;- genome_metadata %&gt;% select(c(genome,domain,phylum,completeness,contamination,length)) %&gt;% arrange(match(genome, rev(genome_tree$tip.label))) %&gt;% #sort MAGs according to phylogenetic tree ggplot(aes(x=completeness,y=contamination,size=length,color=phylum)) + geom_point(alpha=0.7) + ylim(c(10,0)) + scale_color_manual(values=phylum_colors) + labs(y= &quot;Contamination&quot;, x = &quot;Completeness&quot;) + theme_classic() + theme(legend.position = &quot;none&quot;) #Generate contamination boxplot genome_contamination &lt;- genome_metadata %&gt;% ggplot(aes(y=contamination)) + ylim(c(10,0)) + geom_boxplot(colour = &quot;#999999&quot;, fill=&quot;#cccccc&quot;) + theme_void() + theme(legend.position = &quot;none&quot;, axis.title.x = element_blank(), axis.title.y = element_blank(), axis.text.y=element_blank(), axis.ticks.y=element_blank(), axis.text.x=element_blank(), axis.ticks.x=element_blank(), plot.margin = unit(c(0, 0, 0.40, 0),&quot;inches&quot;)) #add bottom-margin (top, right, bottom, left) #Generate completeness boxplot genome_completeness &lt;- genome_metadata %&gt;% ggplot(aes(x=completeness)) + xlim(c(50,100)) + geom_boxplot(colour = &quot;#999999&quot;, fill=&quot;#cccccc&quot;) + theme_void() + theme(legend.position = &quot;none&quot;, axis.title.x = element_blank(), axis.title.y = element_blank(), axis.text.y=element_blank(), axis.ticks.y=element_blank(), axis.text.x=element_blank(), axis.ticks.x=element_blank(), plot.margin = unit(c(0, 0, 0, 0.50),&quot;inches&quot;)) #add left-margin (top, right, bottom, left) #Render composite figure grid.arrange(grobs = list(genome_completeness,genome_biplot,genome_contamination), layout_matrix = rbind(c(1,1,1,1,1,1,1,1,1,1,1,4), c(2,2,2,2,2,2,2,2,2,2,2,3), c(2,2,2,2,2,2,2,2,2,2,2,3), c(2,2,2,2,2,2,2,2,2,2,2,3), c(2,2,2,2,2,2,2,2,2,2,2,3), c(2,2,2,2,2,2,2,2,2,2,2,3), c(2,2,2,2,2,2,2,2,2,2,2,3), c(2,2,2,2,2,2,2,2,2,2,2,3), c(2,2,2,2,2,2,2,2,2,2,2,3), c(2,2,2,2,2,2,2,2,2,2,2,3), c(2,2,2,2,2,2,2,2,2,2,2,3), c(2,2,2,2,2,2,2,2,2,2,2,3))) 4.3 Functional overview # Aggregate basal GIFT into elements function_table &lt;- genome_gifts %&gt;% to.elements(., GIFT_db) # Generate basal tree function_tree &lt;- force.ultrametric(genome_tree, method=&quot;extend&quot;) %&gt;% ggtree(., size = 0.3) *************************************************************** * Note: * * force.ultrametric does not include a formal method to * * ultrametricize a tree &amp; should only be used to coerce * * a phylogeny that fails is.ultrametric due to rounding -- * * not as a substitute for formal rate-smoothing methods. * *************************************************************** #Add phylum colors next to the tree tips function_tree &lt;- gheatmap(function_tree, phylum_heatmap, offset=0, width=0.1, colnames=FALSE) + scale_fill_manual(values=phylum_colors) + labs(fill=&quot;Phylum&quot;) #Reset fill scale to use a different colour profile in the heatmap function_tree &lt;- function_tree + new_scale_fill() #Add functions heatmap function_tree &lt;- gheatmap(function_tree, function_table, offset=0.5, width=3.5, colnames=FALSE) + vexpand(.08) + coord_cartesian(clip = &quot;off&quot;) + scale_fill_gradient(low = &quot;#f4f4f4&quot;, high = &quot;steelblue&quot;, na.value=&quot;white&quot;) + labs(fill=&quot;GIFT&quot;) #Reset fill scale to use a different colour profile in the heatmap function_tree &lt;- function_tree + new_scale_fill() # Add completeness barplots function_tree &lt;- function_tree + geom_fruit(data=genome_metadata, geom=geom_bar, grid.params=list(axis=&quot;x&quot;, text.size=2, nbreak = 1), axis.params=list(vline=TRUE), mapping = aes(x=length, y=genome, fill=completeness), offset = 3.8, orientation=&quot;y&quot;, stat=&quot;identity&quot;) + scale_fill_gradient(low = &quot;#cf8888&quot;, high = &quot;#a2cc87&quot;) + labs(fill=&quot;Genome\\ncompleteness&quot;) function_tree 4.4 Functional ordination # Generate the tSNE ordination tSNE_function &lt;- Rtsne(X=function_table, dims = 2, check_duplicates = FALSE) # Plot the ordination function_ordination &lt;- tSNE_function$Y %&gt;% as.data.frame() %&gt;% mutate(genome=rownames(function_table)) %&gt;% inner_join(genome_metadata, by=&quot;genome&quot;) %&gt;% rename(tSNE1=&quot;V1&quot;, tSNE2=&quot;V2&quot;) %&gt;% select(genome,phylum,tSNE1,tSNE2, length) %&gt;% ggplot(aes(x = tSNE1, y = tSNE2, color = phylum, size=length))+ geom_point(shape=16, alpha=0.7) + scale_color_manual(values=phylum_colors) + theme_minimal() + labs(color=&quot;Phylum&quot;, size=&quot;Genome size&quot;) + guides(color = guide_legend(override.aes = list(size = 5))) # enlarge Phylum dots in legend function_ordination "],["community-composition.html", "Chapter 5 Community composition 5.1 Taxonomy overview 5.2 Taxonomy boxplot", " Chapter 5 Community composition load(&quot;data/data.Rdata&quot;) 5.1 Taxonomy overview 5.1.1 Stacked barplot # Merge data frames based on sample transplants_metadata&lt;-sample_metadata%&gt;% mutate(Tube_code=str_remove_all(Tube_code, &quot;_a&quot;)) transplants_metadata$newID &lt;- paste(transplants_metadata$Tube_code, &quot;_&quot;, transplants_metadata$individual) merged_data&lt;-genome_counts_filt %&gt;% mutate_at(vars(-genome),~./sum(.)) %&gt;% #apply TSS normalisation pivot_longer(-genome, names_to = &quot;sample&quot;, values_to = &quot;count&quot;) %&gt;% #reduce to minimum number of columns left_join(., genome_metadata, by = join_by(genome == genome)) %&gt;% #append genome metadata left_join(., transplants_metadata, by = join_by(sample == Tube_code)) %&gt;% #append sample metadata filter(count &gt; 0) #filter 0 counts ggplot(merged_data, aes(x=newID,y=count, fill=phylum, group=phylum)) + #grouping enables keeping the same sorting of taxonomic units geom_bar(stat=&quot;identity&quot;, colour=&quot;white&quot;, linewidth=0.1) + #plot stacked bars with white borders scale_fill_manual(values=phylum_colors) + facet_nested(. ~ time_point + type , scales=&quot;free&quot;) + #facet per day and treatment guides(fill = guide_legend(ncol = 1)) + labs(fill=&quot;Phylum&quot;,y = &quot;Relative abundance&quot;,x=&quot;Sample&quot;)+ theme( axis.text.x = element_text(angle = 45, hjust = 1, size=0)) 5.1.1.1 Wild samples merged_data %&gt;% filter(time_point==&quot;0_Wild&quot;) %&gt;% ggplot(aes(x=newID,y=count, fill=phylum, group=phylum)) + #grouping enables keeping the same sorting of taxonomic units geom_bar(stat=&quot;identity&quot;, colour=&quot;white&quot;, linewidth=0.1) + #plot stacked bars with white borders scale_fill_manual(values=phylum_colors) + facet_nested(. ~ Population, scales=&quot;free&quot;) + #facet per day and treatment guides(fill = guide_legend(ncol = 1)) + labs(fill=&quot;Phylum&quot;,y = &quot;Relative abundance&quot;,x=&quot;Sample&quot;)+ theme( axis.text.x = element_text(angle = 45, hjust = 1, size=0), strip.text.x = element_text(size = 12) ) 5.1.2 Phylum relative abundances phylum_summary &lt;- genome_counts_filt %&gt;% mutate_at(vars(-genome),~./sum(.)) %&gt;% #apply TSS normalisation pivot_longer(-genome, names_to = &quot;sample&quot;, values_to = &quot;count&quot;) %&gt;% left_join(sample_metadata, by = join_by(sample == Tube_code)) %&gt;% left_join(genome_metadata, by = join_by(genome == genome)) %&gt;% group_by(sample,phylum) %&gt;% summarise(relabun=sum(count)) phylum_summary %&gt;% group_by(phylum) %&gt;% summarise(total_mean=mean(relabun*100, na.rm=T), total_sd=sd(relabun*100, na.rm=T)) %&gt;% mutate(total=str_c(round(total_mean,2),&quot;±&quot;,round(total_sd,2))) %&gt;% arrange(-total_mean) %&gt;% dplyr::select(phylum,total) %&gt;% tt() tinytable_q3c5o95uv7zsfdj6nol5 .table td.tinytable_css_8vt4l9gcdjv9ewbjwn8c, .table th.tinytable_css_8vt4l9gcdjv9ewbjwn8c { border-bottom: solid 0.1em #d3d8dc; } phylum total p__Bacteroidota 38.75±19.94 p__Bacillota_A 24.77±15.73 p__Bacillota 11.96±14.79 p__Pseudomonadota 9.41±15.86 p__Campylobacterota 5.49±9.42 p__Verrucomicrobiota 2.78±6.7 p__Desulfobacterota 2.37±3.68 p__Chlamydiota 1.1±6.08 p__Fusobacteriota 1.06±2.86 p__Cyanobacteriota 0.93±1.66 p__Bacillota_C 0.48±0.67 p__Spirochaetota 0.41±1.25 p__Bacillota_B 0.26±0.5 p__Actinomycetota 0.13±0.65 p__Elusimicrobiota 0.11±0.63 5.1.2.1 Wild samples #Cold and wet population phylum_summary %&gt;% left_join(sample_metadata, by = join_by(sample == Tube_code)) %&gt;% group_by(phylum, Population) %&gt;% filter(Population==&quot;Cold_wet&quot;) %&gt;% filter(time_point==&quot;0_Wild&quot;) %&gt;% summarise(total_mean=mean(relabun*100, na.rm=T), total_sd=sd(relabun*100, na.rm=T)) %&gt;% mutate(total=str_c(round(total_mean,2),&quot;±&quot;,round(total_sd,2))) %&gt;% arrange(-total_mean) %&gt;% dplyr::select(phylum,total, Population) %&gt;% tt() tinytable_yrnvbd2msey45t7lkhya .table td.tinytable_css_7dvm8ni014quryjvfo6l, .table th.tinytable_css_7dvm8ni014quryjvfo6l { border-bottom: solid 0.1em #d3d8dc; } phylum total Population p__Bacteroidota 41.93±15.4 Cold_wet p__Bacillota_A 33.96±16.7 Cold_wet p__Bacillota 5.73±4.73 Cold_wet p__Campylobacterota 5.39±4.64 Cold_wet p__Verrucomicrobiota 4.36±3.06 Cold_wet p__Pseudomonadota 3.75±3.76 Cold_wet p__Desulfobacterota 2.31±1.6 Cold_wet p__Bacillota_C 0.85±0.82 Cold_wet p__Cyanobacteriota 0.64±0.83 Cold_wet p__Bacillota_B 0.5±0.77 Cold_wet p__Fusobacteriota 0.37±1.28 Cold_wet p__Spirochaetota 0.12±0.35 Cold_wet p__Actinomycetota 0.09±0.22 Cold_wet p__Chlamydiota 0±0 Cold_wet p__Elusimicrobiota 0±0 Cold_wet #Hot and dry population phylum_summary %&gt;% left_join(sample_metadata, by = join_by(sample == Tube_code)) %&gt;% group_by(phylum, Population) %&gt;% filter(Population==&quot;Hot_dry&quot;)%&gt;% filter(time_point==&quot;0_Wild&quot;) %&gt;% summarise(total_mean=mean(relabun*100, na.rm=T), total_sd=sd(relabun*100, na.rm=T)) %&gt;% mutate(total=str_c(round(total_mean,2),&quot;±&quot;,round(total_sd,2))) %&gt;% arrange(-total_mean) %&gt;% dplyr::select(phylum,total, Population) %&gt;% tt() tinytable_w4o4jsovto0ghxv4lhlk .table td.tinytable_css_c0k3fmh9qp6zeyy1uwzn, .table th.tinytable_css_c0k3fmh9qp6zeyy1uwzn { border-bottom: solid 0.1em #d3d8dc; } phylum total Population p__Bacillota_A 33.9±16.17 Hot_dry p__Bacteroidota 27.63±17.64 Hot_dry p__Campylobacterota 13.53±20.98 Hot_dry p__Pseudomonadota 10.92±9.94 Hot_dry p__Bacillota 6.09±7.66 Hot_dry p__Spirochaetota 2.66±2.78 Hot_dry p__Desulfobacterota 1.69±1.85 Hot_dry p__Fusobacteriota 1.34±1.73 Hot_dry p__Bacillota_B 0.76±0.73 Hot_dry p__Bacillota_C 0.73±0.5 Hot_dry p__Cyanobacteriota 0.52±0.65 Hot_dry p__Chlamydiota 0.12±0.18 Hot_dry p__Verrucomicrobiota 0.06±0.1 Hot_dry p__Elusimicrobiota 0.05±0.14 Hot_dry p__Actinomycetota 0±0 Hot_dry phylum_arrange &lt;- phylum_summary %&gt;% group_by(phylum) %&gt;% summarise(mean=mean(relabun)) %&gt;% arrange(-mean) %&gt;% select(phylum) %&gt;% pull() phylum_summary %&gt;% filter(phylum %in% phylum_arrange) %&gt;% mutate(phylum=factor(phylum,levels=rev(phylum_arrange))) %&gt;% ggplot(aes(x=relabun, y=phylum, group=phylum, color=phylum)) + scale_color_manual(values=phylum_colors[rev(phylum_arrange)]) + geom_jitter(alpha=0.5) + theme_minimal() + theme(legend.position=&quot;none&quot;) + labs(y=&quot;Phylum&quot;,x=&quot;Relative abundance&quot;) 5.2 Taxonomy boxplot 5.2.1 Family family_summary &lt;- genome_counts_filt %&gt;% mutate_at(vars(-genome),~./sum(.)) %&gt;% #apply TSS normalisation pivot_longer(-genome, names_to = &quot;sample&quot;, values_to = &quot;count&quot;) %&gt;% #reduce to minimum number of columns left_join(sample_metadata, by = join_by(sample == Tube_code)) %&gt;% #append sample metadata left_join(., genome_metadata, by = join_by(genome == genome)) %&gt;% #append genome metadata group_by(sample,family) %&gt;% summarise(relabun=sum(count)) family_summary %&gt;% group_by(family) %&gt;% summarise(mean=mean(relabun, na.rm=TRUE),sd=sd(relabun, na.rm=TRUE)) %&gt;% arrange(-mean) %&gt;% tt() tinytable_4sg0s6e27oxi9dc71iux .table td.tinytable_css_zxxzr952ohnixnp72roe, .table th.tinytable_css_zxxzr952ohnixnp72roe { border-bottom: solid 0.1em #d3d8dc; } family mean sd f__Bacteroidaceae 2.260146e-01 0.1384706235 f__Lachnospiraceae 1.410833e-01 0.1062953893 f__Tannerellaceae 1.045659e-01 0.0799894745 f__Helicobacteraceae 5.448546e-02 0.0937279764 f__Mycoplasmoidaceae 3.756572e-02 0.0767893776 f__Erysipelotrichaceae 3.536287e-02 0.0452140267 f__UBA3700 3.456595e-02 0.0565495010 f__Marinifilaceae 2.794365e-02 0.0272474083 f__Rikenellaceae 2.725202e-02 0.0471735191 f__Enterobacteriaceae 2.687327e-02 0.0929254305 f__Coprobacillaceae 2.627823e-02 0.0907456387 f__ 2.465083e-02 0.0781013121 f__Desulfovibrionaceae 2.373771e-02 0.0367718116 f__DTU072 2.183007e-02 0.0377159876 f__Ruminococcaceae 1.832093e-02 0.0428115194 f__Rhizobiaceae 1.579679e-02 0.0779688169 f__LL51 1.556592e-02 0.0616955422 f__UBA3830 1.512118e-02 0.0441855701 f__Akkermansiaceae 1.224165e-02 0.0317653885 f__Chlamydiaceae 1.096188e-02 0.0607502761 f__Fusobacteriaceae 1.055726e-02 0.0286383947 f__CAG-239 9.138683e-03 0.0152490206 f__Enterococcaceae 8.437601e-03 0.0473906561 f__Gastranaerophilaceae 7.848357e-03 0.0146292952 f__Oscillospiraceae 6.624721e-03 0.0075288565 f__UBA1997 6.613196e-03 0.0315103296 f__Streptococcaceae 6.600789e-03 0.0348230465 f__UBA1242 4.266475e-03 0.0147768596 f__Brevinemataceae 4.098862e-03 0.0125062564 f__Acutalibacteraceae 3.498766e-03 0.0111374416 f__RUG11792 2.921450e-03 0.0255676374 f__Clostridiaceae 2.855351e-03 0.0174153876 f__UBA660 2.600647e-03 0.0118148140 f__Peptococcaceae 2.556218e-03 0.0049947786 f__Acidaminococcaceae 1.980431e-03 0.0051045211 f__CAG-508 1.874529e-03 0.0065256902 f__MGBC116941 1.783700e-03 0.0077801927 f__Moraxellaceae 1.540093e-03 0.0099192011 f__RUG14156 1.428152e-03 0.0045670616 f__Staphylococcaceae 1.411833e-03 0.0051727635 f__Anaerovoracaceae 1.410739e-03 0.0027876311 f__Elusimicrobiaceae 1.088209e-03 0.0062780187 f__CAG-288 9.840222e-04 0.0061275213 f__Anaerotignaceae 9.320656e-04 0.0041174457 f__CALVMC01 7.793540e-04 0.0044385554 f__Eggerthellaceae 6.643755e-04 0.0021620275 f__Massilibacillaceae 6.322621e-04 0.0016561037 f__Mycobacteriaceae 6.168531e-04 0.0061497354 f__UBA1820 4.705627e-04 0.0013078764 f__CAG-274 4.686117e-04 0.0022415212 f__Arcobacteraceae 3.928587e-04 0.0050156837 f__Burkholderiaceae_C 3.835606e-04 0.0048969735 f__Muribaculaceae 3.508548e-04 0.0009525792 f__UBA932 3.295199e-04 0.0011408058 f__Hepatoplasmataceae 3.099135e-04 0.0039567109 f__Rhodobacteraceae 3.068016e-04 0.0039169801 f__Weeksellaceae 2.873650e-04 0.0032049404 f__Eubacteriaceae 1.707442e-04 0.0006844943 f__Sphingobacteriaceae 1.561202e-04 0.0012685229 f__Devosiaceae 1.544841e-04 0.0015368528 f__Pumilibacteraceae 1.324439e-04 0.0007783049 f__WRAU01 9.956857e-05 0.0012712064 f__Peptostreptococcaceae 2.371535e-05 0.0003027773 family_arrange &lt;- family_summary %&gt;% group_by(family) %&gt;% summarise(mean=sum(relabun)) %&gt;% arrange(-mean) %&gt;% select(family) %&gt;% pull() family_summary %&gt;% left_join(genome_metadata %&gt;% select(family,phylum) %&gt;% unique(),by=join_by(family==family)) %&gt;% left_join(sample_metadata,by=join_by(sample==Tube_code)) %&gt;% filter(family %in% family_arrange[1:20]) %&gt;% mutate(family=factor(family,levels=rev(family_arrange[1:20]))) %&gt;% filter(relabun &gt; 0) %&gt;% ggplot(aes(x=relabun, y=family, group=family, color=phylum)) + scale_color_manual(values=phylum_colors[-8]) + geom_jitter(alpha=0.5) + facet_grid(.~type)+ theme_minimal() + labs(y=&quot;Family&quot;, x=&quot;Relative abundance&quot;, color=&quot;Phylum&quot;) 5.2.2 Genus genus_summary &lt;- genome_counts_filt %&gt;% mutate_at(vars(-genome),~./sum(.)) %&gt;% #apply TSS nornalisation pivot_longer(-genome, names_to = &quot;sample&quot;, values_to = &quot;count&quot;) %&gt;% #reduce to minimum number of columns left_join(sample_metadata, by = join_by(sample == Tube_code)) %&gt;% #append sample metadata left_join(genome_metadata, by = join_by(genome == genome)) %&gt;% #append genome metadata group_by(sample,genus) %&gt;% summarise(relabun=sum(count)) %&gt;% filter(genus != &quot;g__&quot;) genus_summary %&gt;% group_by(genus) %&gt;% summarise(mean=mean(relabun, na.rm=TRUE),sd=sd(relabun, na.rm=TRUE)) %&gt;% arrange(-mean) %&gt;% tt() tinytable_f7uwntbzjxeheutguyj4 .table td.tinytable_css_lyemlc0i99x6qp7mvjlj, .table th.tinytable_css_lyemlc0i99x6qp7mvjlj { border-bottom: solid 0.1em #d3d8dc; } genus mean sd g__Bacteroides 1.374441e-01 0.0923562611 g__Parabacteroides 9.843371e-02 0.0803813676 g__Phocaeicola 7.109518e-02 0.0799972428 g__Helicobacter_J 3.115738e-02 0.0603033642 g__Mycoplasmoides 3.115302e-02 0.0765633496 g__Odoribacter 2.605667e-02 0.0268723184 g__Roseburia 2.425344e-02 0.0567044550 g__NHYM01 2.332808e-02 0.0810376677 g__Alistipes 2.224698e-02 0.0287419149 g__Coprobacillus 2.070109e-02 0.0894282233 g__Agrobacterium 1.579679e-02 0.0779688169 g__Akkermansia 1.224165e-02 0.0317653885 g__Fusobacterium_A 1.046073e-02 0.0286441117 g__Kineothrix 9.107908e-03 0.0416218616 g__Proteus 8.976683e-03 0.0694135711 g__Dielma 8.687357e-03 0.0090713197 g__CAG-95 8.238073e-03 0.0207930753 g__JAAYNV01 7.265789e-03 0.0179169564 g__Desulfovibrio 7.219276e-03 0.0214990147 g__UBA866 7.016767e-03 0.0295145125 g__Enterococcus 6.966137e-03 0.0463712943 g__Lactococcus 6.600789e-03 0.0348230465 g__Ureaplasma 6.412700e-03 0.0139267552 g__Parabacteroides_B 6.132159e-03 0.0101543965 g__Lacrimispora 6.028411e-03 0.0098068179 g__CALXRO01 5.977964e-03 0.0313982647 g__Citrobacter 5.896711e-03 0.0340533686 g__NSJ-61 5.745781e-03 0.0202234473 g__Breznakia 5.530147e-03 0.0240721461 g__Clostridium_AQ 5.522246e-03 0.0123487838 g__Bilophila 5.044501e-03 0.0089558435 g__Hungatella_A 4.964136e-03 0.0096921078 g__Escherichia 4.342538e-03 0.0270859242 g__Salmonella 4.319018e-03 0.0148769561 g__UMGS1251 4.312965e-03 0.0073601071 g__MGBC136627 4.305492e-03 0.0164533523 g__Hungatella 4.150386e-03 0.0194068227 g__Clostridium_Q 4.146767e-03 0.0052575243 g__Brevinema 4.098862e-03 0.0125062564 g__Thomasclavelia 4.046233e-03 0.0110779301 g__Scatousia 3.752075e-03 0.0104403539 g__Mailhella 3.745039e-03 0.0104110785 g__Copromonas 3.643508e-03 0.0050495456 g__Enterocloster 3.613702e-03 0.0047492729 g__Ventrimonas 3.566172e-03 0.0071931788 g__Fournierella 3.313097e-03 0.0063192740 g__Limenecus 3.230504e-03 0.0066725343 g__Mucinivorans 3.006847e-03 0.0379999623 g__Lawsonia 2.916613e-03 0.0103686789 g__MGBC133411 2.902785e-03 0.0074333461 g__Caccovivens 2.887473e-03 0.0112659902 g__Sarcina 2.855351e-03 0.0174153876 g__Eisenbergiella 2.796704e-03 0.0069384489 g__Bacteroides_G 2.781473e-03 0.0352463088 g__CAJLXD01 2.730769e-03 0.0088951735 g__Acetatifactor 2.654208e-03 0.0055286194 g__Blautia 2.598789e-03 0.0062369300 g__Velocimicrobium 2.235984e-03 0.0067748392 g__C-19 2.235603e-03 0.0048296119 g__CAZU01 2.189719e-03 0.0066369837 g__Negativibacillus 2.145239e-03 0.0056002700 g__Intestinimonas 2.003816e-03 0.0035552824 g__Rikenella 1.998193e-03 0.0037323264 g__Phascolarctobacterium 1.980431e-03 0.0051045211 g__Butyricimonas 1.886974e-03 0.0042483569 g__RGIG6463 1.855727e-03 0.0040258495 g__MGBC116941 1.783700e-03 0.0077801927 g__JALFVM01 1.712574e-03 0.0038669765 g__Oscillibacter 1.546231e-03 0.0025273862 g__Acinetobacter 1.540093e-03 0.0099192011 g__Pseudoflavonifractor 1.489286e-03 0.0027026675 g__Citrobacter_A 1.444197e-03 0.0061395639 g__Staphylococcus 1.411833e-03 0.0051727635 g__14-2 1.228249e-03 0.0098038984 g__RGIG4733 1.225656e-03 0.0038271024 g__Beduini 1.217163e-03 0.0025500013 g__Scatocola 1.162463e-03 0.0045748144 g__Enterococcus_A 1.123893e-03 0.0100947603 g__UBA1436 1.088209e-03 0.0062780187 g__Faecisoma 1.057958e-03 0.0056043491 g__RGIG9287 9.993630e-04 0.0094920364 g__CAG-345 9.840222e-04 0.0061275213 g__Lachnotalea 9.593025e-04 0.0033990676 g__Blautia_A 9.546974e-04 0.0029560949 g__Ruthenibacterium 8.602962e-04 0.0024818365 g__CAG-269 8.276280e-04 0.0048017072 g__Marseille-P3106 8.230475e-04 0.0017874580 g__WRHT01 6.666234e-04 0.0027445999 g__Eggerthella 6.643755e-04 0.0021620275 g__CHH4-2 6.371240e-04 0.0020328940 g__Corynebacterium 6.168531e-04 0.0061497354 g__Serratia_A 6.076344e-04 0.0077577570 g__Anaerotruncus 6.058602e-04 0.0016447558 g__RUG14156 5.735678e-04 0.0021869659 g__RGIG1896 5.683407e-04 0.0051791669 g__IOR16 5.574841e-04 0.0016418264 g__Faecimonas 5.146607e-04 0.0054508437 g__CAG-56 5.096368e-04 0.0016613952 g__MGBC140009 4.851579e-04 0.0024491799 g__CALURL01 4.805911e-04 0.0017020401 g__Merdimorpha 4.705627e-04 0.0013078764 g__RGIG8482 4.560993e-04 0.0030287706 g__Enterobacter 4.223379e-04 0.0042068345 g__Klebsiella 4.203682e-04 0.0049802041 g__Caccenecus 4.086273e-04 0.0018112589 g__Aliarcobacter 3.928587e-04 0.0050156837 g__Scatenecus 3.851876e-04 0.0018282510 g__Alcaligenes 3.835606e-04 0.0048969735 g__Plesiomonas 3.766988e-04 0.0027593254 g__JAHHSE01 3.529590e-04 0.0014998851 g__HGM05232 3.508548e-04 0.0009525792 g__Enterococcus_B 3.475714e-04 0.0022665993 g__Egerieousia 3.295199e-04 0.0011408058 g__Stoquefichus 3.137462e-04 0.0020871798 g__Hepatoplasma 3.099135e-04 0.0039567109 g__Paracoccus 3.068016e-04 0.0039169801 g__Moheibacter 2.873650e-04 0.0032049404 g__Scatomorpha 2.738230e-04 0.0010358302 g__Emergencia 2.601331e-04 0.0013298673 g__UBA7185 2.523935e-04 0.0014817660 g__Eubacterium 1.707442e-04 0.0006844943 g__Sphingobacterium 1.561202e-04 0.0012685229 g__Devosia 1.544841e-04 0.0015368528 g__Anaerosporobacter 1.507638e-04 0.0012978048 g__Caccomorpha 1.434035e-04 0.0010730603 g__UBA2658 1.355578e-04 0.0007332702 g__Protoclostridium 1.324439e-04 0.0007783049 g__Angelakisella 1.315171e-04 0.0009387427 g__Cetobacterium_A 9.652924e-05 0.0008876688 g__Rahnella 6.708891e-05 0.0008565338 g__Peptostreptococcus 2.371535e-05 0.0003027773 genus_arrange &lt;- genus_summary %&gt;% group_by(genus) %&gt;% summarise(mean=sum(relabun)) %&gt;% filter(genus != &quot;g__&quot;)%&gt;% arrange(-mean) %&gt;% select(genus) %&gt;% mutate(genus= sub(&quot;^g__&quot;, &quot;&quot;, genus)) %&gt;% pull() genus_summary %&gt;% left_join(genome_metadata %&gt;% select(genus,phylum) %&gt;% unique(),by=join_by(genus==genus)) %&gt;% left_join(sample_metadata,by=join_by(sample==Tube_code)) %&gt;% mutate(genus= sub(&quot;^g__&quot;, &quot;&quot;, genus)) %&gt;% filter(genus %in% genus_arrange[1:20]) %&gt;% mutate(genus=factor(genus,levels=rev(genus_arrange[1:20]))) %&gt;% filter(relabun &gt; 0) %&gt;% ggplot(aes(x=relabun, y=genus, group=genus, color=phylum)) + scale_color_manual(values=phylum_colors[-c(3,4,6,8)]) + geom_jitter(alpha=0.5) + facet_grid(.~type)+ theme_minimal() + labs(y=&quot;Family&quot;, x=&quot;Relative abundance&quot;, color=&quot;Phylum&quot;) "],["diversity-analysis.html", "Chapter 6 Diversity analysis 6.1 Alpha diversity 6.2 Beta diversity 6.3 Permanovas", " Chapter 6 Diversity analysis 6.1 Alpha diversity # Calculate Hill numbers richness &lt;- genome_counts_filt %&gt;% column_to_rownames(var = &quot;genome&quot;) %&gt;% dplyr::select(where(~ !all(. == 0))) %&gt;% hilldiv(., q = 0) %&gt;% t() %&gt;% as.data.frame() %&gt;% dplyr::rename(richness = 1) %&gt;% rownames_to_column(var = &quot;sample&quot;) neutral &lt;- genome_counts_filt %&gt;% column_to_rownames(var = &quot;genome&quot;) %&gt;% dplyr::select(where(~ !all(. == 0))) %&gt;% hilldiv(., q = 1) %&gt;% t() %&gt;% as.data.frame() %&gt;% dplyr::rename(neutral = 1) %&gt;% rownames_to_column(var = &quot;sample&quot;) phylogenetic &lt;- genome_counts_filt %&gt;% column_to_rownames(var = &quot;genome&quot;) %&gt;% dplyr::select(where(~ !all(. == 0))) %&gt;% hilldiv(., q = 1, tree = genome_tree) %&gt;% t() %&gt;% as.data.frame() %&gt;% dplyr::rename(phylogenetic = 1) %&gt;% rownames_to_column(var = &quot;sample&quot;) # Aggregate basal GIFT into elements dist &lt;- genome_gifts %&gt;% to.elements(., GIFT_db) %&gt;% traits2dist(., method = &quot;gower&quot;) functional &lt;- genome_counts_filt %&gt;% column_to_rownames(var = &quot;genome&quot;) %&gt;% dplyr::select(where(~ !all(. == 0))) %&gt;% hilldiv(., q = 1, dist = dist) %&gt;% t() %&gt;% as.data.frame() %&gt;% dplyr::rename(functional = 1) %&gt;% rownames_to_column(var = &quot;sample&quot;) %&gt;% mutate(functional = if_else(is.nan(functional), 1, functional)) # Merge all metrics alpha_div &lt;- richness %&gt;% full_join(neutral, by = join_by(sample == sample)) %&gt;% full_join(phylogenetic, by = join_by(sample == sample)) %&gt;% full_join(functional, by = join_by(sample == sample)) 6.1.1 Wild samples alpha_div %&gt;% pivot_longer(-sample, names_to = &quot;metric&quot;, values_to = &quot;value&quot;) %&gt;% left_join(., sample_metadata, by = join_by(sample == Tube_code)) %&gt;% filter(time_point==&quot;0_Wild&quot;) %&gt;% mutate(metric=factor(metric,levels=c(&quot;richness&quot;,&quot;neutral&quot;,&quot;phylogenetic&quot;,&quot;functional&quot;))) %&gt;% ggplot(aes(y = value, x = Population, group=Population, color=Population, fill=Population)) + geom_boxplot(outlier.shape = NA) + geom_jitter(alpha=0.5) + scale_color_manual(name=&quot;Population&quot;, breaks=c(&quot;Cold_wet&quot;,&quot;Hot_dry&quot;), labels=c(&quot;Cold&quot;,&quot;Hot&quot;), values=c(&#39;#008080&#39;, &quot;#d57d2c&quot;)) + scale_fill_manual(name=&quot;Population&quot;, breaks=c(&quot;Cold_wet&quot;,&quot;Hot_dry&quot;), labels=c(&quot;Cold&quot;,&quot;Hot&quot;), values=c(&#39;#00808050&#39;, &quot;#d57d2c50&quot;)) + facet_wrap(. ~ metric,scales = &quot;free&quot;) + coord_cartesian(xlim = c(1, NA)) + stat_compare_means(size=3, label.x=.58) + theme_classic() + theme( strip.background = element_blank(), panel.grid.minor.x = element_line(size = .1, color = &quot;grey&quot;), axis.title.x = element_blank(), axis.title.y = element_text(size=10), axis.text.x = element_text(angle = 45, hjust = 1), # Increase plot size plot.title = element_text(size = 10), axis.text = element_text(size = 8), axis.title = element_text(size = 8) ) + ylab(&quot;Alpha diversity&quot;) 6.1.2 Acclimation samples alpha_div %&gt;% pivot_longer(-sample, names_to = &quot;metric&quot;, values_to = &quot;value&quot;) %&gt;% left_join(., sample_metadata, by = join_by(sample == Tube_code)) %&gt;% filter(time_point==&quot;1_Acclimation&quot;) %&gt;% mutate(metric=factor(metric,levels=c(&quot;richness&quot;,&quot;neutral&quot;,&quot;phylogenetic&quot;,&quot;functional&quot;))) %&gt;% ggplot(aes(y = value, x = Population, group=Population, color=Population, fill=Population)) + geom_boxplot(outlier.shape = NA) + geom_jitter(alpha=0.5) + scale_color_manual(name=&quot;Population&quot;, breaks=c(&quot;Cold_wet&quot;,&quot;Hot_dry&quot;), labels=c(&quot;Cold&quot;,&quot;Hot&quot;), values=c(&#39;#008080&#39;, &quot;#d57d2c&quot;)) + scale_fill_manual(name=&quot;Population&quot;, breaks=c(&quot;Cold_wet&quot;,&quot;Hot_dry&quot;), labels=c(&quot;Cold&quot;,&quot;Hot&quot;), values=c(&#39;#00808050&#39;, &quot;#d57d2c50&quot;)) + facet_wrap(. ~ metric,scales = &quot;free&quot;) + coord_cartesian(xlim = c(1, NA)) + stat_compare_means(size=3, label.x=.58) + theme_classic() + theme( strip.background = element_blank(), panel.grid.minor.x = element_line(size = .1, color = &quot;grey&quot;), axis.title.x = element_blank(), axis.title.y = element_text(size=10), axis.text.x = element_text(angle = 45, hjust = 1), # Increase plot size plot.title = element_text(size = 10), axis.text = element_text(size = 8), axis.title = element_text(size = 8) ) + ylab(&quot;Alpha diversity&quot;) 6.1.3 Antibiotics samples alpha_div %&gt;% pivot_longer(-sample, names_to = &quot;metric&quot;, values_to = &quot;value&quot;) %&gt;% left_join(., sample_metadata, by = join_by(sample == Tube_code)) %&gt;% filter(time_point==&quot;2_Antibiotics&quot;) %&gt;% mutate(metric=factor(metric,levels=c(&quot;richness&quot;,&quot;neutral&quot;,&quot;phylogenetic&quot;,&quot;functional&quot;))) %&gt;% ggplot(aes(y = value, x = Population, group=Population, color=Population, fill=Population)) + geom_boxplot(outlier.shape = NA) + geom_jitter(alpha=0.5) + scale_color_manual(name=&quot;Population&quot;, breaks=c(&quot;Cold_wet&quot;,&quot;Hot_dry&quot;), labels=c(&quot;Cold&quot;,&quot;Hot&quot;), values=c(&#39;#008080&#39;, &quot;#d57d2c&quot;)) + scale_fill_manual(name=&quot;Population&quot;, breaks=c(&quot;Cold_wet&quot;,&quot;Hot_dry&quot;), labels=c(&quot;Cold&quot;,&quot;Hot&quot;), values=c(&#39;#00808050&#39;, &quot;#d57d2c50&quot;)) + facet_wrap(. ~ metric,scales = &quot;free&quot;) + coord_cartesian(xlim = c(1, NA)) + stat_compare_means(size=3, label.x=.58) + theme_classic() + theme( strip.background = element_blank(), panel.grid.minor.x = element_line(size = .1, color = &quot;grey&quot;), axis.title.x = element_blank(), axis.title.y = element_text(size=10), axis.text.x = element_text(angle = 45, hjust = 1), # Increase plot size plot.title = element_text(size = 10), axis.text = element_text(size = 8), axis.title = element_text(size = 8) ) + ylab(&quot;Alpha diversity&quot;) 6.1.4 Transplant_1 samples alpha_div %&gt;% pivot_longer(-sample, names_to = &quot;metric&quot;, values_to = &quot;value&quot;) %&gt;% left_join(., sample_metadata, by = join_by(sample == Tube_code)) %&gt;% filter(time_point==&quot;3_Transplant1&quot;) %&gt;% mutate(metric=factor(metric,levels=c(&quot;richness&quot;,&quot;neutral&quot;,&quot;phylogenetic&quot;,&quot;functional&quot;))) %&gt;% ggplot(aes(y = value, x = type, group=type, color=type, fill=type)) + geom_boxplot(outlier.shape = NA) + geom_jitter(alpha=0.5) + scale_color_manual(name=&quot;Type&quot;, breaks=c(&quot;Control&quot;,&quot;Hot_control&quot;, &quot;Treatment&quot;), labels=c(&quot;Cold-Cold&quot;,&quot;Hot-Hot&quot;, &quot;Cold-Hot&quot;), values=c(&quot;#4477AA&quot;,&quot;#d57d2c&quot;, &quot;#76b183&quot;)) + scale_fill_manual(name=&quot;Type&quot;, breaks=c(&quot;Control&quot;,&quot;Hot_control&quot;, &quot;Treatment&quot;), labels=c(&quot;Cold-Cold&quot;,&quot;Hot-Hot&quot;, &quot;Cold-Hot&quot;), values=c(&quot;#4477AA50&quot;,&quot;#d57d2c50&quot;,&quot;#76b18350&quot;)) + facet_wrap(. ~ metric,scales = &quot;free&quot;) + coord_cartesian(xlim = c(1, NA)) + stat_compare_means(size=3, label.x=.7) + theme_classic() + theme( strip.background = element_blank(), panel.grid.minor.x = element_line(size = .1, color = &quot;grey&quot;), axis.title.x = element_blank(), axis.title.y = element_text(size=10), axis.text.x = element_text(angle = 45, hjust = 1), # Increase plot size plot.title = element_text(size = 10), axis.text = element_text(size = 8), axis.title = element_text(size = 8) ) + ylab(&quot;Alpha diversity&quot;) 6.1.5 Transplant_2 samples alpha_div %&gt;% pivot_longer(-sample, names_to = &quot;metric&quot;, values_to = &quot;value&quot;) %&gt;% left_join(., sample_metadata, by = join_by(sample == Tube_code)) %&gt;% filter(time_point==&quot;4_Transplant2&quot;) %&gt;% mutate(metric=factor(metric,levels=c(&quot;richness&quot;,&quot;neutral&quot;,&quot;phylogenetic&quot;,&quot;functional&quot;))) %&gt;% ggplot(aes(y = value, x = type, group=type, color=type, fill=type)) + geom_boxplot(outlier.shape = NA) + geom_jitter(alpha=0.5) + scale_color_manual(name=&quot;Type&quot;, breaks=c(&quot;Control&quot;,&quot;Hot_control&quot;, &quot;Treatment&quot;), labels=c(&quot;Cold-Cold&quot;,&quot;Hot-Hot&quot;, &quot;Cold-Hot&quot;), values=c(&quot;#4477AA&quot;,&quot;#d57d2c&quot;, &quot;#76b183&quot;)) + scale_fill_manual(name=&quot;Type&quot;, breaks=c(&quot;Control&quot;,&quot;Hot_control&quot;, &quot;Treatment&quot;), labels=c(&quot;Cold-Cold&quot;,&quot;Hot-Hot&quot;, &quot;Cold-Hot&quot;), values=c(&quot;#4477AA50&quot;,&quot;#d57d2c50&quot;,&quot;#76b18350&quot;)) + facet_wrap(. ~ metric,scales = &quot;free&quot;) + coord_cartesian(xlim = c(1, NA)) + stat_compare_means(size=3, label.x=.7) + theme_classic() + theme( strip.background = element_blank(), panel.grid.minor.x = element_line(size = .1, color = &quot;grey&quot;), axis.title.x = element_blank(), axis.title.y = element_text(size=10), axis.text.x = element_text(angle = 45, hjust = 1), # Increase plot size plot.title = element_text(size = 10), axis.text = element_text(size = 8), axis.title = element_text(size = 8) ) + ylab(&quot;Alpha diversity&quot;) 6.1.6 Post-Transplant_1 samples alpha_div %&gt;% pivot_longer(-sample, names_to = &quot;metric&quot;, values_to = &quot;value&quot;) %&gt;% left_join(., sample_metadata, by = join_by(sample == Tube_code)) %&gt;% filter(time_point==&quot;5_Post-FMT1&quot;) %&gt;% mutate(metric=factor(metric,levels=c(&quot;richness&quot;,&quot;neutral&quot;,&quot;phylogenetic&quot;,&quot;functional&quot;))) %&gt;% ggplot(aes(y = value, x = type, group=type, color=type, fill=type)) + geom_boxplot(outlier.shape = NA) + geom_jitter(alpha=0.5) + scale_color_manual(name=&quot;Type&quot;, breaks=c(&quot;Control&quot;,&quot;Hot_control&quot;, &quot;Treatment&quot;), labels=c(&quot;Cold-Cold&quot;,&quot;Hot-Hot&quot;, &quot;Cold-Hot&quot;), values=c(&quot;#4477AA&quot;,&quot;#d57d2c&quot;, &quot;#76b183&quot;)) + scale_fill_manual(name=&quot;Type&quot;, breaks=c(&quot;Control&quot;,&quot;Hot_control&quot;, &quot;Treatment&quot;), labels=c(&quot;Cold-Cold&quot;,&quot;Hot-Hot&quot;, &quot;Cold-Hot&quot;), values=c(&quot;#4477AA50&quot;,&quot;#d57d2c50&quot;,&quot;#76b18350&quot;)) + facet_wrap(. ~ metric,scales = &quot;free&quot;) + coord_cartesian(xlim = c(1, NA)) + stat_compare_means(size=3, label.x=.7) + theme_classic() + theme( strip.background = element_blank(), panel.grid.minor.x = element_line(size = .1, color = &quot;grey&quot;), axis.title.x = element_blank(), axis.title.y = element_text(size=10), axis.text.x = element_text(angle = 45, hjust = 1), # Increase plot size plot.title = element_text(size = 10), axis.text = element_text(size = 8), axis.title = element_text(size = 8) ) + ylab(&quot;Alpha diversity&quot;) 6.1.7 Post-Transplant_2 samples alpha_div %&gt;% pivot_longer(-sample, names_to = &quot;metric&quot;, values_to = &quot;value&quot;) %&gt;% left_join(., sample_metadata, by = join_by(sample == Tube_code)) %&gt;% filter(time_point==&quot;6_Post-FMT2&quot;) %&gt;% mutate(metric=factor(metric,levels=c(&quot;richness&quot;,&quot;neutral&quot;,&quot;phylogenetic&quot;,&quot;functional&quot;))) %&gt;% ggplot(aes(y = value, x = type, group=type, color=type, fill=type)) + geom_boxplot(outlier.shape = NA) + geom_jitter(alpha=0.5) + scale_color_manual(name=&quot;Type&quot;, breaks=c(&quot;Control&quot;,&quot;Hot_control&quot;, &quot;Treatment&quot;), labels=c(&quot;Cold-control&quot;,&quot;Warm-control&quot;, &quot;Cold-intervention&quot;), values=c(&quot;#4477AA&quot;,&quot;#d57d2c&quot;, &quot;#76b183&quot;)) + scale_fill_manual(name=&quot;Type&quot;, breaks=c(&quot;Control&quot;,&quot;Hot_control&quot;, &quot;Treatment&quot;), labels=c(&quot;Cold-control&quot;,&quot;Warm-control&quot;, &quot;Cold-intervention&quot;), values=c(&quot;#4477AA50&quot;,&quot;#d57d2c50&quot;,&quot;#76b18350&quot;)) + facet_wrap(. ~ metric,scales = &quot;free&quot;) + coord_cartesian(xlim = c(1, NA)) + stat_compare_means(size=3, label.x=.7) + theme_classic() + theme( strip.background = element_blank(), panel.grid.minor.x = element_line(size = .1, color = &quot;grey&quot;), axis.title.x = element_blank(), axis.title.y = element_text(size=10), axis.text.x = element_text(angle = 45, hjust = 1), # Increase plot size plot.title = element_text(size = 10), axis.text = element_text(size = 8), axis.title = element_text(size = 8) ) + ylab(&quot;Alpha diversity&quot;) 6.2 Beta diversity beta_q0n &lt;- genome_counts_filt %&gt;% column_to_rownames(., &quot;genome&quot;) %&gt;% hillpair(., q = 0) beta_q1n &lt;- genome_counts_filt %&gt;% column_to_rownames(., &quot;genome&quot;) %&gt;% hillpair(., q = 1) beta_q1p &lt;- genome_counts_filt %&gt;% column_to_rownames(., &quot;genome&quot;) %&gt;% hillpair(., q = 1, tree = genome_tree) beta_q1f &lt;- genome_counts_filt %&gt;% column_to_rownames(., &quot;genome&quot;) %&gt;% hillpair(., q = 1, dist = dist) 6.3 Permanovas 6.3.0.1 Load required data meta &lt;- column_to_rownames(sample_metadata, &quot;Tube_code&quot;) 6.3.1 1. Are the wild populations similar? 6.3.1.1 Wild: P.muralis vs P.liolepis wild &lt;- meta %&gt;% filter(time_point == &quot;0_Wild&quot;) # Create a temporary modified version of genome_counts_filt temp_genome_counts &lt;- transform(genome_counts_filt, row.names = genome_counts_filt$genome) temp_genome_counts$genome &lt;- NULL wild.counts &lt;- temp_genome_counts[, which(colnames(temp_genome_counts) %in% rownames(wild))] identical(sort(colnames(wild.counts)), sort(as.character(rownames(wild)))) wild_nmds &lt;- sample_metadata %&gt;% filter(time_point == &quot;0_Wild&quot;) 6.3.1.2 Number of samples used [1] 27 beta_div_richness_wild&lt;-hillpair(data=wild.counts, q=0) beta_div_neutral_wild&lt;-hillpair(data=wild.counts, q=1) beta_div_phylo_wild&lt;-hillpair(data=wild.counts, q=1, tree=genome_tree) beta_div_func_wild&lt;-hillpair(data=wild.counts, q=1, dist=dist) 6.3.1.3 Richness Permutation test for homogeneity of multivariate dispersions Permutation: free Number of permutations: 999 Response: Distances Df Sum Sq Mean Sq F N.Perm Pr(&gt;F) Groups 1 0.000012 0.000012 0.0012 999 0.972 Residuals 25 0.257281 0.010291 Pairwise comparisons: (Observed p-value below diagonal, permuted p-value above diagonal) Podarcis_liolepis Podarcis_muralis Podarcis_liolepis 0.971 Podarcis_muralis 0.97302 Df SumOfSqs R2 F Pr(&gt;F) species 1 1.542719 0.2095041 6.625717 0.001 Residual 25 5.820951 0.7904959 NA NA Total 26 7.363669 1.0000000 NA NA 6.3.1.4 Neutral Permutation test for homogeneity of multivariate dispersions Permutation: free Number of permutations: 999 Response: Distances Df Sum Sq Mean Sq F N.Perm Pr(&gt;F) Groups 1 0.000048 0.0000476 0.0044 999 0.934 Residuals 25 0.270114 0.0108046 Pairwise comparisons: (Observed p-value below diagonal, permuted p-value above diagonal) Podarcis_liolepis Podarcis_muralis Podarcis_liolepis 0.933 Podarcis_muralis 0.94763 Df SumOfSqs R2 F Pr(&gt;F) species 1 1.918266 0.2608511 8.822682 0.001 Residual 25 5.435610 0.7391489 NA NA Total 26 7.353876 1.0000000 NA NA 6.3.1.5 Phylogenetic Permutation test for homogeneity of multivariate dispersions Permutation: free Number of permutations: 999 Response: Distances Df Sum Sq Mean Sq F N.Perm Pr(&gt;F) Groups 1 0.03585 0.035847 2.4912 999 0.131 Residuals 25 0.35973 0.014389 Pairwise comparisons: (Observed p-value below diagonal, permuted p-value above diagonal) Podarcis_liolepis Podarcis_muralis Podarcis_liolepis 0.141 Podarcis_muralis 0.12705 Df SumOfSqs R2 F Pr(&gt;F) species 1 0.3218613 0.2162815 6.899207 0.001 Residual 25 1.1662981 0.7837185 NA NA Total 26 1.4881594 1.0000000 NA NA 6.3.1.6 Functional Permutation test for homogeneity of multivariate dispersions Permutation: free Number of permutations: 999 Response: Distances Df Sum Sq Mean Sq F N.Perm Pr(&gt;F) Groups 1 0.018367 0.018367 1.5597 999 0.241 Residuals 25 0.294402 0.011776 Pairwise comparisons: (Observed p-value below diagonal, permuted p-value above diagonal) Podarcis_liolepis Podarcis_muralis Podarcis_liolepis 0.238 Podarcis_muralis 0.22328 Df SumOfSqs R2 F Pr(&gt;F) species 1 0.0858578 0.172879 5.225323 0.053 Residual 25 0.4107775 0.827121 NA NA Total 26 0.4966352 1.000000 NA NA beta_q0n_nmds_wild &lt;- beta_div_richness_wild$S %&gt;% metaMDS(.,trymax = 500, k=2, verbosity=FALSE, trace=FALSE) %&gt;% vegan::scores() %&gt;% as_tibble(., rownames = &quot;sample&quot;) %&gt;% left_join(wild_nmds, by = join_by(sample == Tube_code)) beta_q1n_nmds_wild &lt;- beta_div_neutral_wild$S %&gt;% metaMDS(.,trymax = 500, k=2, verbosity=FALSE, trace=FALSE) %&gt;% vegan::scores() %&gt;% as_tibble(., rownames = &quot;sample&quot;) %&gt;% left_join(wild_nmds, by = join_by(sample == Tube_code)) beta_q1p_nmds_wild &lt;- beta_div_phylo_wild$S %&gt;% metaMDS(.,trymax = 500, k=2, verbosity=FALSE) %&gt;% vegan::scores() %&gt;% as_tibble(., rownames = &quot;sample&quot;) %&gt;% left_join(wild_nmds, by = join_by(sample == Tube_code)) beta_q1f_nmds_wild &lt;- beta_div_func_wild$S %&gt;% metaMDS(.,trymax = 500, k=2, verbosity=FALSE) %&gt;% vegan::scores() %&gt;% as_tibble(., rownames = &quot;sample&quot;) %&gt;% left_join(wild_nmds, by = join_by(sample == Tube_code)) 6.3.2 2. Effect of acclimation accli &lt;- meta %&gt;% filter(time_point == &quot;1_Acclimation&quot;) # Create a temporary modified version of genome_counts_filt temp_genome_counts &lt;- transform(genome_counts_filt, row.names = genome_counts_filt$genome) temp_genome_counts$genome &lt;- NULL accli.counts &lt;- temp_genome_counts[, which(colnames(temp_genome_counts) %in% rownames(accli))] identical(sort(colnames(accli.counts)), sort(as.character(rownames(accli)))) accli_nmds &lt;- sample_metadata %&gt;% filter(time_point == &quot;1_Acclimation&quot;) 6.3.2.1 Number of samples used [1] 27 beta_div_richness_accli&lt;-hillpair(data=accli.counts, q=0) beta_div_neutral_accli&lt;-hillpair(data=accli.counts, q=1) beta_div_phylo_accli&lt;-hillpair(data=accli.counts, q=1, tree=genome_tree) beta_div_func_accli&lt;-hillpair(data=accli.counts, q=1, dist=dist) 6.3.2.2 Richness Permutation test for homogeneity of multivariate dispersions Permutation: free Number of permutations: 999 Response: Distances Df Sum Sq Mean Sq F N.Perm Pr(&gt;F) Groups 1 0.11796 0.117959 12.963 999 0.002 ** Residuals 25 0.22748 0.009099 --- Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 Pairwise comparisons: (Observed p-value below diagonal, permuted p-value above diagonal) Cold_wet Hot_dry Cold_wet 0.003 Hot_dry 0.0013711 Df SumOfSqs R2 F Pr(&gt;F) Population 1 1.639807 0.179834 5.481634 0.001 Residual 25 7.478640 0.820166 NA NA Total 26 9.118447 1.000000 NA NA 6.3.2.3 Neutral Permutation test for homogeneity of multivariate dispersions Permutation: free Number of permutations: 999 Response: Distances Df Sum Sq Mean Sq F N.Perm Pr(&gt;F) Groups 1 0.07844 0.078443 5.2384 999 0.032 * Residuals 25 0.37437 0.014975 --- Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 Pairwise comparisons: (Observed p-value below diagonal, permuted p-value above diagonal) Cold_wet Hot_dry Cold_wet 0.035 Hot_dry 0.030815 Df SumOfSqs R2 F Pr(&gt;F) Population 1 1.947003 0.2306127 7.493387 0.001 Residual 25 6.495736 0.7693873 NA NA Total 26 8.442739 1.0000000 NA NA 6.3.2.4 Phylogenetic Permutation test for homogeneity of multivariate dispersions Permutation: free Number of permutations: 999 Response: Distances Df Sum Sq Mean Sq F N.Perm Pr(&gt;F) Groups 1 0.06739 0.067395 2.9532 999 0.103 Residuals 25 0.57052 0.022821 Pairwise comparisons: (Observed p-value below diagonal, permuted p-value above diagonal) Cold_wet Hot_dry Cold_wet 0.11 Hot_dry 0.098068 Df SumOfSqs R2 F Pr(&gt;F) Population 1 0.2441653 0.1224638 3.488854 0.03 Residual 25 1.7496100 0.8775362 NA NA Total 26 1.9937754 1.0000000 NA NA 6.3.2.5 Functional Permutation test for homogeneity of multivariate dispersions Permutation: free Number of permutations: 999 Response: Distances Df Sum Sq Mean Sq F N.Perm Pr(&gt;F) Groups 1 0.02496 0.024955 0.6729 999 0.45 Residuals 25 0.92714 0.037085 Pairwise comparisons: (Observed p-value below diagonal, permuted p-value above diagonal) Cold_wet Hot_dry Cold_wet 0.431 Hot_dry 0.41979 Df SumOfSqs R2 F Pr(&gt;F) Population 1 0.0279454 0.0248037 0.6358634 0.447 Residual 25 1.0987171 0.9751963 NA NA Total 26 1.1266624 1.0000000 NA NA beta_q0n_nmds_accli &lt;- beta_div_richness_accli$S %&gt;% metaMDS(.,trymax = 500, k=2, verbosity=FALSE, trace=FALSE) %&gt;% vegan::scores() %&gt;% as_tibble(., rownames = &quot;sample&quot;) %&gt;% left_join(accli_nmds, by = join_by(sample == Tube_code)) beta_q1n_nmds_accli &lt;- beta_div_neutral_accli$S %&gt;% metaMDS(.,trymax = 500, k=2, verbosity=FALSE, trace=FALSE) %&gt;% vegan::scores() %&gt;% as_tibble(., rownames = &quot;sample&quot;) %&gt;% left_join(accli_nmds, by = join_by(sample == Tube_code)) beta_q1p_nmds_accli &lt;- beta_div_phylo_accli$S %&gt;% metaMDS(.,trymax = 500, k=2, verbosity=FALSE) %&gt;% vegan::scores() %&gt;% as_tibble(., rownames = &quot;sample&quot;) %&gt;% left_join(accli_nmds, by = join_by(sample == Tube_code)) beta_q1f_nmds_accli &lt;- beta_div_func_accli$S %&gt;% metaMDS(.,trymax = 500, k=2, verbosity=FALSE) %&gt;% vegan::scores() %&gt;% as_tibble(., rownames = &quot;sample&quot;) %&gt;% left_join(accli_nmds, by = join_by(sample == Tube_code)) 6.3.3 3. Comparison between Wild and Acclimation accli1 &lt;- meta %&gt;% filter(time_point == &quot;0_Wild&quot; | time_point == &quot;1_Acclimation&quot;) temp_genome_counts &lt;- transform(genome_counts_filt, row.names = genome_counts_filt$genome) temp_genome_counts$genome &lt;- NULL accli1.counts &lt;- temp_genome_counts[,which(colnames(temp_genome_counts) %in% rownames(accli1))] identical(sort(colnames(accli1.counts)),sort(as.character(rownames(accli1)))) accli1_nmds &lt;- sample_metadata %&gt;% filter(time_point == &quot;0_Wild&quot; | time_point == &quot;1_Acclimation&quot;) 6.3.3.1 Number of samples used [1] 54 beta_div_richness_accli1&lt;-hillpair(data=accli1.counts, q=0) beta_div_neutral_accli1&lt;-hillpair(data=accli1.counts, q=1) beta_div_phylo_accli1&lt;-hillpair(data=accli1.counts, q=1, tree=genome_tree) beta_div_func_accli1&lt;-hillpair(data=accli1.counts, q=1, dist=dist) 6.3.3.1.1 Richness Permutation test for homogeneity of multivariate dispersions Permutation: free Number of permutations: 999 Response: Distances Df Sum Sq Mean Sq F N.Perm Pr(&gt;F) Groups 1 0.05014 0.050145 6.2252 999 0.023 * Residuals 52 0.41886 0.008055 --- Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 Pairwise comparisons: (Observed p-value below diagonal, permuted p-value above diagonal) 0_Wild 1_Acclimation 0_Wild 0.018 1_Acclimation 0.015808 Df SumOfSqs R2 F Pr(&gt;F) time_point 1 0.6172653 0.0360987 2.320618 0.003 species 1 2.8279677 0.1653842 10.631785 0.003 time_point:species 1 0.3545578 0.0207351 1.332965 0.059 Residual 50 13.2995905 0.7777820 NA NA Total 53 17.0993812 1.0000000 NA NA 6.3.3.1.2 Neutral Permutation test for homogeneity of multivariate dispersions Permutation: free Number of permutations: 999 Response: Distances Df Sum Sq Mean Sq F N.Perm Pr(&gt;F) Groups 1 0.0199 0.0199035 2.1213 999 0.142 Residuals 52 0.4879 0.0093827 Pairwise comparisons: (Observed p-value below diagonal, permuted p-value above diagonal) 0_Wild 1_Acclimation 0_Wild 0.14 1_Acclimation 0.15128 Df SumOfSqs R2 F Pr(&gt;F) time_point 1 0.9050519 0.0541893 3.792749 0.001 species 1 3.3236300 0.1989999 13.928143 0.001 time_point:species 1 0.5416391 0.0324302 2.269815 0.004 Residual 50 11.9313461 0.7143805 NA NA Total 53 16.7016671 1.0000000 NA NA 6.3.3.1.3 Phylogenetic Permutation test for homogeneity of multivariate dispersions Permutation: free Number of permutations: 999 Response: Distances Df Sum Sq Mean Sq F N.Perm Pr(&gt;F) Groups 1 0.01334 0.013340 0.6524 999 0.423 Residuals 52 1.06332 0.020449 Pairwise comparisons: (Observed p-value below diagonal, permuted p-value above diagonal) 0_Wild 1_Acclimation 0_Wild 0.429 1_Acclimation 0.42294 Df SumOfSqs R2 F Pr(&gt;F) time_point 1 0.2890434 0.0766494 4.956318 0.003 species 1 0.3508889 0.0930498 6.016803 0.002 time_point:species 1 0.2151377 0.0570509 3.689034 0.008 Residual 50 2.9159082 0.7732498 NA NA Total 53 3.7709782 1.0000000 NA NA 6.3.3.1.4 Functional Permutation test for homogeneity of multivariate dispersions Permutation: free Number of permutations: 999 Response: Distances Df Sum Sq Mean Sq F N.Perm Pr(&gt;F) Groups 1 0.0123 0.012300 0.4817 999 0.5 Residuals 52 1.3277 0.025533 Pairwise comparisons: (Observed p-value below diagonal, permuted p-value above diagonal) 0_Wild 1_Acclimation 0_Wild 0.489 1_Acclimation 0.49073 Df SumOfSqs R2 F Pr(&gt;F) time_point 1 0.0448774 0.0269021 1.4865056 0.212 species 1 0.0973005 0.0583275 3.2229509 0.294 time_point:species 1 0.0165026 0.0098926 0.5466273 0.387 Residual 50 1.5094945 0.9048777 NA NA Total 53 1.6681751 1.0000000 NA NA beta_richness_nmds_accli1 &lt;- beta_div_richness_accli1$S %&gt;% metaMDS(.,trymax = 500, k=2, verbosity=FALSE) %&gt;% scores() %&gt;% as_tibble(., rownames = &quot;sample&quot;) %&gt;% left_join(accli1_nmds, by = c(&quot;sample&quot; = &quot;Tube_code&quot;)) beta_neutral_nmds_accli1 &lt;- beta_div_neutral_accli1$S %&gt;% metaMDS(.,trymax = 500, k=2, verbosity=FALSE) %&gt;% scores() %&gt;% as_tibble(., rownames = &quot;sample&quot;) %&gt;% left_join(accli1_nmds, by = c(&quot;sample&quot; = &quot;Tube_code&quot;)) beta_phylo_nmds_accli1 &lt;- beta_div_phylo_accli1$S %&gt;% metaMDS(.,trymax = 500, k=2, verbosity=FALSE) %&gt;% scores() %&gt;% as_tibble(., rownames = &quot;sample&quot;) %&gt;% left_join(accli1_nmds, by = join_by(sample == Tube_code)) beta_func_nmds_accli1 &lt;- beta_div_func_accli1$S %&gt;% metaMDS(.,trymax = 500, k=2, verbosity=FALSE) %&gt;% scores() %&gt;% as_tibble(., rownames = &quot;sample&quot;) %&gt;% left_join(accli1_nmds, by = join_by(sample == Tube_code)) 6.3.4 4. Do the antibiotics work? 6.3.4.1 Antibiotics treat1 &lt;- meta %&gt;% filter(time_point == &quot;2_Antibiotics&quot;) temp_genome_counts &lt;- transform(genome_counts_filt, row.names = genome_counts_filt$genome) temp_genome_counts$genome &lt;- NULL treat1.counts &lt;- temp_genome_counts[,which(colnames(temp_genome_counts) %in% rownames(treat1))] identical(sort(colnames(treat1.counts)),sort(as.character(rownames(treat1)))) treat1_nmds &lt;- sample_metadata %&gt;% filter(time_point == &quot;2_Antibiotics&quot;) 6.3.4.2 Number of samples used [1] 23 beta_div_richness_treat1&lt;-hillpair(data=treat1.counts, q=0) beta_div_neutral_treat1&lt;-hillpair(data=treat1.counts, q=1) beta_div_phylo_treat1&lt;-hillpair(data=treat1.counts, q=1, tree=genome_tree) beta_div_func_treat1&lt;-hillpair(data=treat1.counts, q=1, dist=dist) 6.3.4.2.1 Richness Permutation test for homogeneity of multivariate dispersions Permutation: free Number of permutations: 999 Response: Distances Df Sum Sq Mean Sq F N.Perm Pr(&gt;F) Groups 1 0.015319 0.0153186 6.8764 999 0.016 * Residuals 21 0.046782 0.0022277 --- Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 Pairwise comparisons: (Observed p-value below diagonal, permuted p-value above diagonal) Cold_wet Hot_dry Cold_wet 0.013 Hot_dry 0.015919 Df SumOfSqs R2 F Pr(&gt;F) Population 1 1.356644 0.1527052 3.784762 0.001 Residual 21 7.527429 0.8472948 NA NA Total 22 8.884073 1.0000000 NA NA 6.3.4.2.2 Neutral Permutation test for homogeneity of multivariate dispersions Permutation: free Number of permutations: 999 Response: Distances Df Sum Sq Mean Sq F N.Perm Pr(&gt;F) Groups 1 0.030536 0.0305358 3.8593 999 0.069 . Residuals 21 0.166158 0.0079123 --- Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 Pairwise comparisons: (Observed p-value below diagonal, permuted p-value above diagonal) Cold_wet Hot_dry Cold_wet 0.057 Hot_dry 0.062842 Df SumOfSqs R2 F Pr(&gt;F) Population 1 1.785669 0.2085055 5.532084 0.001 Residual 21 6.778468 0.7914945 NA NA Total 22 8.564137 1.0000000 NA NA 6.3.4.2.3 Phylogenetic Permutation test for homogeneity of multivariate dispersions Permutation: free Number of permutations: 999 Response: Distances Df Sum Sq Mean Sq F N.Perm Pr(&gt;F) Groups 1 0.012041 0.012041 0.9898 999 0.317 Residuals 21 0.255459 0.012165 Pairwise comparisons: (Observed p-value below diagonal, permuted p-value above diagonal) Cold_wet Hot_dry Cold_wet 0.327 Hot_dry 0.33111 Df SumOfSqs R2 F Pr(&gt;F) Population 1 0.8963254 0.1888758 4.889993 0.001 Residual 21 3.8492558 0.8111242 NA NA Total 22 4.7455811 1.0000000 NA NA 6.3.4.2.4 Functional Permutation test for homogeneity of multivariate dispersions Permutation: free Number of permutations: 999 Response: Distances Df Sum Sq Mean Sq F N.Perm Pr(&gt;F) Groups 1 0.01802 0.018021 0.4386 999 0.526 Residuals 21 0.86280 0.041086 Pairwise comparisons: (Observed p-value below diagonal, permuted p-value above diagonal) Cold_wet Hot_dry Cold_wet 0.524 Hot_dry 0.51499 Df SumOfSqs R2 F Pr(&gt;F) Population 1 0.0184663 0.0098404 0.2087022 0.732 Residual 21 1.8581156 0.9901596 NA NA Total 22 1.8765819 1.0000000 NA NA beta_richness_nmds_treat1 &lt;- beta_div_richness_treat1$S %&gt;% metaMDS(.,trymax = 500, k=2, verbosity=FALSE) %&gt;% scores() %&gt;% as_tibble(., rownames = &quot;sample&quot;) %&gt;% left_join(treat1_nmds, by = c(&quot;sample&quot; = &quot;Tube_code&quot;)) beta_neutral_nmds_treat1 &lt;- beta_div_neutral_treat1$S %&gt;% metaMDS(.,trymax = 500, k=2, verbosity=FALSE) %&gt;% scores() %&gt;% as_tibble(., rownames = &quot;sample&quot;) %&gt;% left_join(treat1_nmds, by = c(&quot;sample&quot; = &quot;Tube_code&quot;)) beta_phylo_nmds_treat1 &lt;- beta_div_phylo_treat1$S %&gt;% metaMDS(.,trymax = 500, k=2, verbosity=FALSE) %&gt;% scores() %&gt;% as_tibble(., rownames = &quot;sample&quot;) %&gt;% left_join(treat1_nmds, by = join_by(sample == Tube_code)) beta_func_nmds_treat1 &lt;- beta_div_func_treat1$S %&gt;% metaMDS(.,trymax = 500, k=2, verbosity=FALSE) %&gt;% scores() %&gt;% as_tibble(., rownames = &quot;sample&quot;) %&gt;% left_join(treat1_nmds, by = join_by(sample == Tube_code)) 6.3.4.3 Acclimation vs antibiotics treat &lt;- meta %&gt;% filter(time_point == &quot;1_Acclimation&quot; | time_point == &quot;2_Antibiotics&quot;) temp_genome_counts &lt;- transform(genome_counts_filt, row.names = genome_counts_filt$genome) temp_genome_counts$genome &lt;- NULL treat.counts &lt;- temp_genome_counts[,which(colnames(temp_genome_counts) %in% rownames(treat))] identical(sort(colnames(treat.counts)),sort(as.character(rownames(treat)))) treat_nmds &lt;- sample_metadata %&gt;% filter(time_point == &quot;1_Acclimation&quot; | time_point == &quot;2_Antibiotics&quot;) 6.3.4.4 Number of samples used [1] 50 beta_div_richness_treat&lt;-hillpair(data=treat.counts, q=0) beta_div_neutral_treat&lt;-hillpair(data=treat.counts, q=1) beta_div_phylo_treat&lt;-hillpair(data=treat.counts, q=1, tree=genome_tree) beta_div_func_treat&lt;-hillpair(data=treat.counts, q=1, dist=dist) 6.3.4.4.1 Richness Permutation test for homogeneity of multivariate dispersions Permutation: free Number of permutations: 999 Response: Distances Df Sum Sq Mean Sq F N.Perm Pr(&gt;F) Groups 1 0.025318 0.0253178 6.021 999 0.015 * Residuals 48 0.201837 0.0042049 --- Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 Pairwise comparisons: (Observed p-value below diagonal, permuted p-value above diagonal) 1_Acclimation 2_Antibiotics 1_Acclimation 0.016 2_Antibiotics 0.017817 Df SumOfSqs R2 F Pr(&gt;F) time_point 1 1.8885838 0.0949462 5.789315 0.001 Population 1 2.1171094 0.1064350 6.489843 0.001 time_point:Population 1 0.8793415 0.0442078 2.695557 0.003 Residual 46 15.0060684 0.7544111 NA NA Total 49 19.8911031 1.0000000 NA NA 6.3.4.4.2 Neutral Permutation test for homogeneity of multivariate dispersions Permutation: free Number of permutations: 999 Response: Distances Df Sum Sq Mean Sq F N.Perm Pr(&gt;F) Groups 1 0.039587 0.039587 6.8387 999 0.017 * Residuals 48 0.277854 0.005789 --- Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 Pairwise comparisons: (Observed p-value below diagonal, permuted p-value above diagonal) 1_Acclimation 2_Antibiotics 1_Acclimation 0.014 2_Antibiotics 0.011886 Df SumOfSqs R2 F Pr(&gt;F) time_point 1 2.0241808 0.1063620 7.014531 0.001 Population 1 2.8531033 0.1499183 9.887052 0.001 time_point:Population 1 0.8795688 0.0462175 3.048030 0.002 Residual 46 13.2742044 0.6975022 NA NA Total 49 19.0310573 1.0000000 NA NA 6.3.4.4.3 Phylogenetic Permutation test for homogeneity of multivariate dispersions Permutation: free Number of permutations: 999 Response: Distances Df Sum Sq Mean Sq F N.Perm Pr(&gt;F) Groups 1 0.58372 0.58372 35.413 999 0.001 *** Residuals 48 0.79119 0.01648 --- Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 Pairwise comparisons: (Observed p-value below diagonal, permuted p-value above diagonal) 1_Acclimation 2_Antibiotics 1_Acclimation 0.001 2_Antibiotics 2.9795e-07 Df SumOfSqs R2 F Pr(&gt;F) time_point 1 1.8065206 0.2113909 14.842282 0.001 Population 1 0.7903334 0.0924813 6.493340 0.001 time_point:Population 1 0.3501572 0.0409738 2.876874 0.036 Residual 46 5.5988658 0.6551540 NA NA Total 49 8.5458771 1.0000000 NA NA 6.3.4.4.4 Functional Permutation test for homogeneity of multivariate dispersions Permutation: free Number of permutations: 999 Response: Distances Df Sum Sq Mean Sq F N.Perm Pr(&gt;F) Groups 1 0.18591 0.185914 5.0679 999 0.027 * Residuals 48 1.76088 0.036685 --- Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 Pairwise comparisons: (Observed p-value below diagonal, permuted p-value above diagonal) 1_Acclimation 2_Antibiotics 1_Acclimation 0.024 2_Antibiotics 0.028989 Df SumOfSqs R2 F Pr(&gt;F) time_point 1 1.8020952 0.3750193 28.0355332 0.001 Population 1 0.0031247 0.0006503 0.0486115 0.001 time_point:Population 1 0.0432870 0.0090081 0.6734238 0.460 Residual 46 2.9568327 0.6153223 NA NA Total 49 4.8053396 1.0000000 NA NA beta_richness_nmds_treat &lt;- beta_div_richness_treat$S %&gt;% metaMDS(.,trymax = 500, k=2, verbosity=FALSE) %&gt;% scores() %&gt;% as_tibble(., rownames = &quot;sample&quot;) %&gt;% left_join(treat_nmds, by = c(&quot;sample&quot; = &quot;Tube_code&quot;)) beta_neutral_nmds_treat &lt;- beta_div_neutral_treat$S %&gt;% metaMDS(.,trymax = 500, k=2, verbosity=FALSE) %&gt;% scores() %&gt;% as_tibble(., rownames = &quot;sample&quot;) %&gt;% left_join(treat_nmds, by = c(&quot;sample&quot; = &quot;Tube_code&quot;)) beta_phylo_nmds_treat &lt;- beta_div_phylo_treat$S %&gt;% metaMDS(.,trymax = 500, k=2, verbosity=FALSE) %&gt;% scores() %&gt;% as_tibble(., rownames = &quot;sample&quot;) %&gt;% left_join(treat_nmds, by = join_by(sample == Tube_code)) beta_func_nmds_treat &lt;- beta_div_func_treat$S %&gt;% metaMDS(.,trymax = 500, k=2, verbosity=FALSE) %&gt;% scores() %&gt;% as_tibble(., rownames = &quot;sample&quot;) %&gt;% left_join(treat_nmds, by = join_by(sample == Tube_code)) 6.3.5 5. Does the FMT work? 6.3.5.1 Comparison between FMT2 vs Post-FMT2 #Create newID to identify duplicated samples transplants_metadata&lt;-sample_metadata%&gt;% mutate(Tube_code=str_remove_all(Tube_code, &quot;_a&quot;)) transplants_metadata$newID &lt;- paste(transplants_metadata$Tube_code, &quot;_&quot;, transplants_metadata$individual) transplant3&lt;-transplants_metadata%&gt;% filter(time_point == &quot;4_Transplant2&quot; | time_point == &quot;6_Post-FMT2&quot;)%&gt;% column_to_rownames(&quot;newID&quot;) transplant3_nmds &lt;- transplants_metadata %&gt;% filter(time_point == &quot;4_Transplant2&quot; | time_point == &quot;6_Post-FMT2&quot;) full_counts&lt;-temp_genome_counts %&gt;% t()%&gt;% as.data.frame()%&gt;% rownames_to_column(&quot;Tube_code&quot;)%&gt;% full_join(transplants_metadata,by = join_by(Tube_code == Tube_code)) transplant3_counts&lt;-full_counts %&gt;% filter(time_point == &quot;4_Transplant2&quot; | time_point == &quot;6_Post-FMT2&quot;) %&gt;% subset(select=-c(315:324)) %&gt;% column_to_rownames(&quot;newID&quot;)%&gt;% subset(select=-c(1))%&gt;% t() %&gt;% as.data.frame() %&gt;% mutate_if(is.character, as.numeric) identical(sort(colnames(transplant3_counts)),sort(as.character(rownames(transplant3)))) 6.3.5.2 Number of samples used [1] 49 beta_div_richness_transplant3&lt;-hillpair(data=transplant3_counts, q=0) beta_div_neutral_transplant3&lt;-hillpair(data=transplant3_counts, q=1) beta_div_phylo_transplant3&lt;-hillpair(data=transplant3_counts, q=1, tree=genome_tree) beta_div_func_transplant3&lt;-hillpair(data=transplant3_counts, q=1, dist=dist) #Arrange of metadata dataframe transplant3_arrange&lt;-transplant3[labels(beta_div_neutral_transplant3$S),] 6.3.5.2.1 Richness Df SumOfSqs R2 F Pr(&gt;F) species 1 1.180473 0.0855095 5.155229 0.033 time_point 1 0.860906 0.0623612 3.759652 0.001 type 1 1.459433 0.1057165 6.373471 0.003 Residual 45 10.304350 0.7464128 NA NA Total 48 13.805162 1.0000000 NA NA tinytable_f6ilco2m9pvfnsu155in .table td.tinytable_css_scty5uxamgp4k555exfc, .table th.tinytable_css_scty5uxamgp4k555exfc { border-bottom: solid 0.1em #d3d8dc; } pairs Df SumsOfSqs F.Model R2 p.value p.adjusted sig Control vs Treatment 1 1.4169018 5.739828 0.15622903 0.001 0.003 * Control vs Hot_control 1 2.0940966 8.509112 0.21005427 0.001 0.003 * Treatment vs Hot_control 1 0.3004618 1.265034 0.04179854 0.156 0.468 6.3.5.2.2 Neutral Df SumOfSqs R2 F Pr(&gt;F) species 1 1.2800927 0.0939787 6.068484 0.011 time_point 1 0.9350566 0.0686477 4.432785 0.001 type 1 1.9135997 0.1404879 9.071725 0.001 Residual 45 9.4923500 0.6968858 NA NA Total 48 13.6210990 1.0000000 NA NA tinytable_77hf71tb7q7wb2ax484j .table td.tinytable_css_l0uldcq9e2p6rj6yqoqr, .table th.tinytable_css_l0uldcq9e2p6rj6yqoqr { border-bottom: solid 0.1em #d3d8dc; } pairs Df SumsOfSqs F.Model R2 p.value p.adjusted sig Control vs Treatment 1 1.8758788 8.282671 0.21084796 0.001 0.003 * Control vs Hot_control 1 2.4396317 10.635546 0.24945256 0.001 0.003 * Treatment vs Hot_control 1 0.3158428 1.394345 0.04587515 0.114 0.342 6.3.5.2.3 Phylogenetic Df SumOfSqs R2 F Pr(&gt;F) species 1 0.1400466 0.0952654 5.873615 0.055 time_point 1 0.1138047 0.0774145 4.773017 0.002 type 1 0.1432667 0.0974558 6.008665 0.003 Residual 45 1.0729504 0.7298643 NA NA Total 48 1.4700683 1.0000000 NA NA tinytable_0fvxut8bnr5lpw9u08mw .table td.tinytable_css_1jbe8osz7my4eyccr302, .table th.tinytable_css_1jbe8osz7my4eyccr302 { border-bottom: solid 0.1em #d3d8dc; } pairs Df SumsOfSqs F.Model R2 p.value p.adjusted sig Control vs Treatment 1 0.14387705 5.735321 0.15612552 0.001 0.003 * Control vs Hot_control 1 0.22715701 9.044894 0.22036587 0.001 0.003 * Treatment vs Hot_control 1 0.04648319 1.704277 0.05550617 0.133 0.399 6.3.5.2.4 Functional Df SumOfSqs R2 F Pr(&gt;F) species 1 0.0092808 0.0077189 0.3741811 0.386 time_point 1 -0.0061674 -0.0051295 -0.2486581 0.880 type 1 0.0831052 0.0691191 3.3506286 0.254 Residual 45 1.1161295 0.9282915 NA NA Total 48 1.2023481 1.0000000 NA NA tinytable_wx81dq0dte1ad2wr76eq .table td.tinytable_css_b3zttqn6qjnzjg035823, .table th.tinytable_css_b3zttqn6qjnzjg035823 { border-bottom: solid 0.1em #d3d8dc; } pairs Df SumsOfSqs F.Model R2 p.value p.adjusted sig Control vs Treatment 1 0.078539743 4.59293783 0.129040706 0.075 0.225 Control vs Hot_control 1 0.052468954 2.13675422 0.062593948 0.195 0.585 Treatment vs Hot_control 1 -0.002340352 -0.07432315 -0.002569452 0.865 1.000 beta_richness_nmds_transplant3 &lt;- beta_div_richness_transplant3$S %&gt;% metaMDS(.,trymax = 500, k=2, verbosity=FALSE) %&gt;% scores() %&gt;% as_tibble(., rownames = &quot;sample&quot;) %&gt;% left_join(transplant3_nmds, by = join_by(sample == newID)) beta_neutral_nmds_transplant3 &lt;- beta_div_neutral_transplant3$S %&gt;% metaMDS(.,trymax = 500, k=2, verbosity=FALSE) %&gt;% scores() %&gt;% as_tibble(., rownames = &quot;sample&quot;) %&gt;% left_join(transplant3_nmds, by = join_by(sample == newID)) beta_phylo_nmds_transplant3 &lt;- beta_div_phylo_transplant3$S %&gt;% metaMDS(.,trymax = 500, k=2, verbosity=FALSE) %&gt;% scores() %&gt;% as_tibble(., rownames = &quot;sample&quot;) %&gt;% left_join(transplant3_nmds, by = join_by(sample == newID)) beta_func_nmds_transplant3 &lt;- beta_div_func_transplant3$S %&gt;% metaMDS(.,trymax = 500, k=2, verbosity=FALSE) %&gt;% scores() %&gt;% as_tibble(., rownames = &quot;sample&quot;) %&gt;% left_join(transplant3_nmds, by = join_by(sample == newID)) p0&lt;-beta_richness_nmds_transplant3 %&gt;% group_by(individual) %&gt;% mutate(x_cen = mean(NMDS1, na.rm = TRUE)) %&gt;% mutate(y_cen = mean(NMDS2, na.rm = TRUE)) %&gt;% ungroup() %&gt;% ggplot(., aes(x=NMDS1,y=NMDS2, color=type, shape=time_point)) + scale_color_manual(name=&quot;Type&quot;, breaks=c(&quot;Control&quot;, &quot;Hot_control&quot;, &quot;Treatment&quot;), labels=c(&quot;Cold-Cold&quot;, &quot;Hot-Hot&quot;, &quot;Cold-Hot&quot;), values=c(&quot;#4477AA&quot;,&quot;#d57d2c&quot;,&quot;#76b183&quot;)) + geom_point(size=2) + geom_segment(aes(x=x_cen, y=y_cen, xend=NMDS1, yend=NMDS2), alpha=0.2) + labs(y = &quot;NMDS2&quot;, x=&quot;NMDS1 \\n Richness beta diversity&quot;) + theme_classic() + theme(legend.position=&quot;none&quot;) p1&lt;-beta_neutral_nmds_transplant3 %&gt;% group_by(individual) %&gt;% mutate(x_cen = mean(NMDS1, na.rm = TRUE)) %&gt;% mutate(y_cen = mean(NMDS2, na.rm = TRUE)) %&gt;% ungroup() %&gt;% ggplot(., aes(x=NMDS1,y=NMDS2, color=type, shape=time_point)) + scale_color_manual(name=&quot;Type&quot;, breaks=c(&quot;Control&quot;, &quot;Hot_control&quot;, &quot;Treatment&quot;), labels=c(&quot;Cold-Cold&quot;, &quot;Hot-Hot&quot;, &quot;Cold-Hot&quot;), values=c(&quot;#4477AA&quot;,&quot;#d57d2c&quot;,&quot;#76b183&quot;)) + geom_point(size=2) + geom_segment(aes(x=x_cen, y=y_cen, xend=NMDS1, yend=NMDS2), alpha=0.2) + labs(y = &quot;NMDS2&quot;, x=&quot;NMDS1 \\n Neutral beta diversity&quot;) + theme_classic() + theme(legend.position=&quot;none&quot;) p2&lt;-beta_phylo_nmds_transplant3 %&gt;% group_by(individual) %&gt;% mutate(x_cen = mean(NMDS1, na.rm = TRUE)) %&gt;% mutate(y_cen = mean(NMDS2, na.rm = TRUE)) %&gt;% ungroup() %&gt;% ggplot(., aes(x=NMDS1,y=NMDS2, color=type, shape=time_point)) + scale_color_manual(name=&quot;Type&quot;, breaks=c(&quot;Control&quot;, &quot;Hot_control&quot;, &quot;Treatment&quot;), labels=c(&quot;Cold-Cold&quot;, &quot;Hot-Hot&quot;, &quot;Cold-Hot&quot;), values=c(&quot;#4477AA&quot;,&quot;#d57d2c&quot;,&quot;#76b183&quot;)) + geom_point(size=2) + geom_segment(aes(x=x_cen, y=y_cen, xend=NMDS1, yend=NMDS2), alpha=0.2) + labs(y= element_blank (), x=&quot;NMDS1 \\n Phylogenetic beta diversity&quot;) + theme_classic() + theme(legend.position=&quot;none&quot;) p3&lt;-beta_func_nmds_transplant3 %&gt;% group_by(individual) %&gt;% mutate(x_cen = mean(NMDS1, na.rm = TRUE)) %&gt;% mutate(y_cen = mean(NMDS2, na.rm = TRUE)) %&gt;% ungroup() %&gt;% ggplot(., aes(x=NMDS1,y=NMDS2, color=type, shape=time_point)) + scale_color_manual(name=&quot;Type&quot;, breaks=c(&quot;Control&quot;, &quot;Hot_control&quot;, &quot;Treatment&quot;), labels=c(&quot;Cold-Cold&quot;, &quot;Hot-Hot&quot;, &quot;Cold-Hot&quot;), values=c(&quot;#4477AA&quot;,&quot;#d57d2c&quot;,&quot;#76b183&quot;)) + geom_point(size=2) + geom_segment(aes(x=x_cen, y=y_cen, xend=NMDS1, yend=NMDS2), alpha=0.2) + labs(y= element_blank (), x=&quot;NMDS1 \\n Functional beta diversity&quot;) + theme_classic()+ theme(legend.position=&quot;none&quot;) 6.3.5.3 Comparison between the different experimental time points (Acclimation vs Transplant samples) The estimated time for calculating the 5151 pairwise combinations is 51 seconds. ggarrange( p1, p2, p3, ncol=3, nrow=1, common.legend = TRUE, legend=&quot;right&quot;) 6.3.5.4 Comparison of acclimation samples to transplant samples transplant7&lt;-transplants_metadata%&gt;% filter(time_point == &quot;4_Transplant2&quot; | time_point == &quot;1_Acclimation&quot;| time_point == &quot;3_Transplant1&quot;)%&gt;% column_to_rownames(&quot;newID&quot;) transplant7_nmds &lt;- transplants_metadata %&gt;% filter(time_point == &quot;4_Transplant2&quot; | time_point == &quot;1_Acclimation&quot;| time_point == &quot;3_Transplant1&quot;) transplant7_counts&lt;-full_counts %&gt;% filter(time_point == &quot;4_Transplant2&quot; | time_point == &quot;1_Acclimation&quot;| time_point == &quot;3_Transplant1&quot;) %&gt;% subset(select=-c(315:324)) %&gt;% column_to_rownames(&quot;newID&quot;)%&gt;% subset(select=-c(1))%&gt;% t() %&gt;% as.data.frame() %&gt;% mutate_if(is.character, as.numeric) transplant7_counts &lt;- transplant7_counts[, !names(transplant7_counts) %in% c(&quot;AD45 _ LI1_2nd_2&quot;, &quot;AD48 _ LI1_2nd_6&quot;)] identical(sort(colnames(transplant7_counts)),sort(as.character(rownames(transplant7)))) [1] TRUE 6.3.5.5 Number of samples used [1] 73 beta_div_richness_transplant7&lt;-hillpair(data=transplant7_counts, q=0) beta_div_neutral_transplant7&lt;-hillpair(data=transplant7_counts, q=1) beta_div_phylo_transplant7&lt;-hillpair(data=transplant7_counts, q=1, tree=genome_tree) beta_div_func_transplant7&lt;-hillpair(data=transplant7_counts, q=1, dist=dist) #Arrange of metadata dataframe transplant7_arrange&lt;-transplant7[labels(beta_div_neutral_transplant7$S),] transplant7_arrange &lt;- transplant7_arrange %&gt;% mutate(time_point = recode(time_point, &quot;3_Transplant1&quot; = &quot;Transplant&quot;, &quot;4_Transplant2&quot; = &quot;Transplant&quot;)) transplant7_arrange$type_time &lt;- interaction(transplant7_arrange$type, transplant7_arrange$time_point) 6.3.5.5.1 Richness Df SumOfSqs R2 F Pr(&gt;F) Population 1 2.3108184 0.1096208 9.6707812 0.082 time_point 2 1.1082036 0.0525710 2.3189174 0.001 type 1 1.4676332 0.0696217 6.1420489 0.046 Population:time_point 2 0.4228641 0.0200599 0.8848438 0.494 Residual 66 15.7705995 0.7481267 NA NA Total 72 21.0801189 1.0000000 NA NA tinytable_fz39izmkrz0cy09v02y4 .table td.tinytable_css_6o6l7s3jrd882raxkm3p, .table th.tinytable_css_6o6l7s3jrd882raxkm3p { border-bottom: solid 0.1em #d3d8dc; } pairs Df SumsOfSqs F.Model R2 p.value p.adjusted sig Control.1_Acclimation vs Treatment.1_Acclimation 1 0.36208146 1.0521088 0.06169963 0.302 1.000 Control.1_Acclimation vs Hot_control.1_Acclimation 1 1.28008774 4.6054436 0.22350616 0.001 0.015 . Control.1_Acclimation vs Control.Transplant 1 0.55038651 2.2107376 0.08124505 0.006 0.090 Control.1_Acclimation vs Treatment.Transplant 1 1.62289430 6.7106689 0.25123553 0.001 0.015 . Control.1_Acclimation vs Hot_control.Transplant 1 1.73215888 7.4315069 0.25250175 0.001 0.015 . Treatment.1_Acclimation vs Hot_control.1_Acclimation 1 1.36066298 5.0871520 0.24124415 0.001 0.015 . Treatment.1_Acclimation vs Control.Transplant 1 0.52860586 2.1820402 0.08027507 0.003 0.045 . Treatment.1_Acclimation vs Treatment.Transplant 1 1.76810026 7.5736721 0.27467042 0.001 0.015 . Treatment.1_Acclimation vs Hot_control.Transplant 1 1.87790626 8.3291875 0.27462613 0.001 0.015 . Hot_control.1_Acclimation vs Control.Transplant 1 1.75314247 8.7706781 0.25971282 0.001 0.015 . Hot_control.1_Acclimation vs Treatment.Transplant 1 0.27700454 1.5346880 0.07126586 0.076 1.000 Hot_control.1_Acclimation vs Hot_control.Transplant 1 0.26448976 1.4916174 0.06349573 0.094 1.000 Control.Transplant vs Treatment.Transplant 1 2.30884687 12.4299510 0.30002331 0.001 0.015 . Control.Transplant vs Hot_control.Transplant 1 2.50396161 13.6713271 0.30604256 0.001 0.015 . Treatment.Transplant vs Hot_control.Transplant 1 0.01688622 0.1023282 0.00392027 1.000 1.000 6.3.5.5.2 Neutral Df SumOfSqs R2 F Pr(&gt;F) Population 1 2.641095 0.1266245 12.453113 0.045 time_point 2 1.394944 0.0668791 3.288673 0.001 type 1 1.523725 0.0730534 7.184566 0.024 time_point:type 4 1.724614 0.0826848 2.032946 0.008 Residual 64 13.573319 0.6507583 NA NA Total 72 20.857698 1.0000000 NA NA tinytable_i37l6nqusgudsv7wmd6r .table td.tinytable_css_7fl2i92g60rs5zxxmh02, .table th.tinytable_css_7fl2i92g60rs5zxxmh02 { border-bottom: solid 0.1em #d3d8dc; } pairs Df SumsOfSqs F.Model R2 p.value p.adjusted sig Control.1_Acclimation vs Treatment.1_Acclimation 1 0.23160196 0.7712905 0.045988741 0.741 1.000 Control.1_Acclimation vs Hot_control.1_Acclimation 1 1.40153474 5.7562378 0.264578733 0.001 0.015 . Control.1_Acclimation vs Control.Transplant 1 0.56111203 2.5583085 0.092832565 0.001 0.015 . Control.1_Acclimation vs Treatment.Transplant 1 1.88709838 8.3257794 0.293929402 0.001 0.015 . Control.1_Acclimation vs Hot_control.Transplant 1 2.02585000 9.2317432 0.295588471 0.001 0.015 . Treatment.1_Acclimation vs Hot_control.1_Acclimation 1 1.63477039 6.8326887 0.299250291 0.001 0.015 . Treatment.1_Acclimation vs Control.Transplant 1 0.61335323 2.8313912 0.101733730 0.002 0.030 . Treatment.1_Acclimation vs Treatment.Transplant 1 2.10939140 9.4473664 0.320822116 0.001 0.015 . Treatment.1_Acclimation vs Hot_control.Transplant 1 2.24827218 10.3907678 0.320794118 0.001 0.015 . Hot_control.1_Acclimation vs Control.Transplant 1 1.87351542 10.3925002 0.293635661 0.001 0.015 . Hot_control.1_Acclimation vs Treatment.Transplant 1 0.34276062 1.9273510 0.087897118 0.048 0.720 Hot_control.1_Acclimation vs Hot_control.Transplant 1 0.31638309 1.8072337 0.075911118 0.064 0.960 Control.Transplant vs Treatment.Transplant 1 2.48701901 14.0199769 0.325894571 0.001 0.015 . Control.Transplant vs Hot_control.Transplant 1 2.75304261 15.6912860 0.336064549 0.001 0.015 . Treatment.Transplant vs Hot_control.Transplant 1 0.01764676 0.1022118 0.003915827 0.996 1.000 6.3.5.5.3 Phylogenetic Df SumOfSqs R2 F Pr(&gt;F) Population 1 0.3001462 0.0764583 6.402286 0.306 time_point 2 0.2984483 0.0760258 3.183035 0.003 type 1 0.1391084 0.0354361 2.967261 0.637 Residual 68 3.1879143 0.8120798 NA NA Total 72 3.9256172 1.0000000 NA NA tinytable_xtig5nqq9zd9crjunvtu .table td.tinytable_css_s9xz6r1kyq0ub3vak0ng, .table th.tinytable_css_s9xz6r1kyq0ub3vak0ng { border-bottom: solid 0.1em #d3d8dc; } pairs Df SumsOfSqs F.Model R2 p.value p.adjusted sig Control.1_Acclimation vs Treatment.1_Acclimation 1 0.04186923 0.43916424 0.026714511 0.738 1.000 Control.1_Acclimation vs Hot_control.1_Acclimation 1 0.15609416 2.55468892 0.137684276 0.034 0.510 Control.1_Acclimation vs Control.Transplant 1 0.03888650 0.83961027 0.032493148 0.447 1.000 Control.1_Acclimation vs Treatment.Transplant 1 0.28946588 4.58406811 0.186464994 0.001 0.015 . Control.1_Acclimation vs Hot_control.Transplant 1 0.31864880 5.37781508 0.196429666 0.001 0.015 . Treatment.1_Acclimation vs Hot_control.1_Acclimation 1 0.23108846 4.05218385 0.202081922 0.003 0.045 . Treatment.1_Acclimation vs Control.Transplant 1 0.11794420 2.69844074 0.097422117 0.055 0.825 Treatment.1_Acclimation vs Treatment.Transplant 1 0.37640156 6.28511923 0.239113210 0.001 0.015 . Treatment.1_Acclimation vs Hot_control.Transplant 1 0.40433696 7.18306079 0.246138020 0.001 0.015 . Hot_control.1_Acclimation vs Control.Transplant 1 0.11597038 5.32063275 0.175478948 0.001 0.015 . Hot_control.1_Acclimation vs Treatment.Transplant 1 0.03673004 1.13023077 0.053488804 0.338 1.000 Hot_control.1_Acclimation vs Hot_control.Transplant 1 0.04097680 1.30539166 0.056012432 0.250 1.000 Control.Transplant vs Treatment.Transplant 1 0.21736741 7.59281199 0.207494630 0.001 0.015 . Control.Transplant vs Hot_control.Transplant 1 0.25837791 9.19762187 0.228810100 0.001 0.015 . Treatment.Transplant vs Hot_control.Transplant 1 0.00180330 0.04804393 0.001844435 0.963 1.000 6.3.5.5.4 Functional Df SumOfSqs R2 F Pr(&gt;F) Population 1 0.0968624 0.0459940 4.124655 0.400 time_point 2 0.1660358 0.0788403 3.535121 0.041 type 1 0.2461830 0.1168973 10.483121 0.155 Residual 68 1.5968952 0.7582683 NA NA Total 72 2.1059764 1.0000000 NA NA tinytable_1tn6jhu5kuzebslcbcfg .table td.tinytable_css_gibvqoal85ym7t5est1x, .table th.tinytable_css_gibvqoal85ym7t5est1x { border-bottom: solid 0.1em #d3d8dc; } pairs Df SumsOfSqs F.Model R2 p.value p.adjusted sig Control.1_Acclimation vs Treatment.1_Acclimation 1 0.0904501448 1.65575459 0.0937798825 0.218 1.000 Control.1_Acclimation vs Hot_control.1_Acclimation 1 0.0857692246 1.63605364 0.0927675587 0.204 1.000 Control.1_Acclimation vs Control.Transplant 1 0.0705970944 2.02878350 0.0750601115 0.175 1.000 Control.1_Acclimation vs Treatment.Transplant 1 0.3221196060 7.21718333 0.2651701040 0.008 0.120 Control.1_Acclimation vs Hot_control.Transplant 1 0.3443779759 8.48534465 0.2783417653 0.004 0.060 Treatment.1_Acclimation vs Hot_control.1_Acclimation 1 0.0013738865 0.07238159 0.0045034760 0.657 1.000 Treatment.1_Acclimation vs Control.Transplant 1 -0.0041789330 -0.31199952 -0.0126376990 0.775 1.000 Treatment.1_Acclimation vs Treatment.Transplant 1 0.0789743467 4.41748338 0.1809147697 0.078 1.000 Treatment.1_Acclimation vs Hot_control.Transplant 1 0.0842190618 5.17868542 0.1905421598 0.055 0.825 Hot_control.1_Acclimation vs Control.Transplant 1 -0.0042784688 -0.35701715 -0.0144875787 0.780 1.000 Hot_control.1_Acclimation vs Treatment.Transplant 1 0.0825042562 5.11970349 0.2038122581 0.080 1.000 Hot_control.1_Acclimation vs Hot_control.Transplant 1 0.0889170506 6.06518379 0.2161106028 0.046 0.690 Control.Transplant vs Treatment.Transplant 1 0.1900996563 15.59722495 0.3497353247 0.007 0.105 Control.Transplant vs Hot_control.Transplant 1 0.2049565481 17.96453178 0.3668886666 0.003 0.045 . Treatment.Transplant vs Hot_control.Transplant 1 -0.0002132009 -0.01472772 -0.0005667719 0.666 1.000 beta_richness_nmds_transplant7 &lt;- beta_div_richness_transplant7$S %&gt;% metaMDS(.,trymax = 500, k=2, verbosity=FALSE) %&gt;% scores() %&gt;% as_tibble(., rownames = &quot;sample&quot;) %&gt;% left_join(transplant7_nmds, by = join_by(sample == newID)) beta_neutral_nmds_transplant7 &lt;- beta_div_neutral_transplant7$S %&gt;% metaMDS(.,trymax = 500, k=2, verbosity=FALSE) %&gt;% scores() %&gt;% as_tibble(., rownames = &quot;sample&quot;) %&gt;% left_join(transplant7_nmds, by = join_by(sample == newID)) beta_phylo_nmds_transplant7 &lt;- beta_div_phylo_transplant7$S %&gt;% metaMDS(.,trymax = 500, k=2, verbosity=FALSE) %&gt;% scores() %&gt;% as_tibble(., rownames = &quot;sample&quot;) %&gt;% left_join(transplant7_nmds, by = join_by(sample == newID)) beta_func_nmds_transplant7 &lt;- beta_div_func_transplant7$S %&gt;% metaMDS(.,trymax = 500, k=2, verbosity=FALSE) %&gt;% scores() %&gt;% as_tibble(., rownames = &quot;sample&quot;) %&gt;% left_join(transplant7_nmds, by = join_by(sample == newID)) p0&lt;-beta_richness_nmds_transplant7 %&gt;% group_by(type) %&gt;% mutate(x_cen = mean(NMDS1, na.rm = TRUE)) %&gt;% mutate(y_cen = mean(NMDS2, na.rm = TRUE)) %&gt;% ungroup() %&gt;% ggplot(., aes(x=NMDS1,y=NMDS2, color=type, shape=time_point)) + scale_color_manual(name=&quot;Type&quot;, breaks=c(&quot;Control&quot;, &quot;Hot_control&quot;, &quot;Treatment&quot;), labels=c(&quot;Cold-Cold&quot;, &quot;Hot-Hot&quot;, &quot;Cold-Hot&quot;), values=c(&quot;#4477AA&quot;,&quot;#d57d2c&quot;,&quot;#76b183&quot;)) + scale_shape_manual(name=&quot;time_point&quot;, breaks=c(&quot;1_Acclimation&quot;, &quot;3_Transplant1&quot;, &quot;4_Transplant2&quot;), labels=c(&quot;Acclimation&quot;, &quot;Transplant&quot;, &quot;Transplant&quot;), values=c(&quot;circle&quot;,&quot;square&quot;,&quot;square&quot;)) + geom_point(size=2) + geom_segment(aes(x=x_cen, y=y_cen, xend=NMDS1, yend=NMDS2), alpha=0.2) + labs(y = &quot;NMDS2&quot;, x=&quot;NMDS1 \\n Richness beta diversity&quot;) + theme_classic() + theme(legend.position=&quot;none&quot;) p1&lt;-beta_neutral_nmds_transplant7 %&gt;% group_by(type) %&gt;% mutate(x_cen = mean(NMDS1, na.rm = TRUE)) %&gt;% mutate(y_cen = mean(NMDS2, na.rm = TRUE)) %&gt;% ungroup() %&gt;% ggplot(., aes(x=NMDS1,y=NMDS2, color=type, shape=time_point)) + scale_color_manual(name=&quot;Type&quot;, breaks=c(&quot;Control&quot;, &quot;Hot_control&quot;, &quot;Treatment&quot;), labels=c(&quot;Cold-Cold&quot;, &quot;Hot-Hot&quot;, &quot;Cold-Hot&quot;), values=c(&quot;#4477AA&quot;,&quot;#d57d2c&quot;,&quot;#76b183&quot;)) + scale_shape_manual(name=&quot;time_point&quot;, breaks=c(&quot;1_Acclimation&quot;, &quot;3_Transplant1&quot;, &quot;4_Transplant2&quot;), labels=c(&quot;Acclimation&quot;, &quot;Transplant&quot;, &quot;Transplant&quot;), values=c(&quot;circle&quot;,&quot;square&quot;,&quot;square&quot;)) + geom_point(size=2) + geom_segment(aes(x=x_cen, y=y_cen, xend=NMDS1, yend=NMDS2), alpha=0.2) + labs(y = &quot;NMDS2&quot;, x=&quot;NMDS1 \\n Neutral beta diversity&quot;) + theme_classic() + theme(legend.position=&quot;none&quot;) p2&lt;-beta_phylo_nmds_transplant7 %&gt;% group_by(type) %&gt;% mutate(x_cen = mean(NMDS1, na.rm = TRUE)) %&gt;% mutate(y_cen = mean(NMDS2, na.rm = TRUE)) %&gt;% ungroup() %&gt;% ggplot(., aes(x=NMDS1,y=NMDS2, color=type, shape=time_point)) + scale_color_manual(name=&quot;Type&quot;, breaks=c(&quot;Control&quot;, &quot;Hot_control&quot;, &quot;Treatment&quot;), labels=c(&quot;Cold-Cold&quot;, &quot;Hot-Hot&quot;, &quot;Cold-Hot&quot;), values=c(&quot;#4477AA&quot;,&quot;#d57d2c&quot;,&quot;#76b183&quot;)) + scale_shape_manual(name=&quot;time_point&quot;, breaks=c(&quot;1_Acclimation&quot;, &quot;3_Transplant1&quot;, &quot;4_Transplant2&quot;), labels=c(&quot;Acclimation&quot;, &quot;Transplant&quot;, &quot;Transplant&quot;), values=c(&quot;circle&quot;,&quot;square&quot;,&quot;square&quot;)) + geom_point(size=2) + geom_segment(aes(x=x_cen, y=y_cen, xend=NMDS1, yend=NMDS2), alpha=0.2) + labs(y= element_blank (), x=&quot;NMDS1 \\n Phylogenetic beta diversity&quot;) + theme_classic() + theme(legend.position=&quot;none&quot;) p3&lt;-beta_func_nmds_transplant7 %&gt;% group_by(type) %&gt;% mutate(x_cen = mean(NMDS1, na.rm = TRUE)) %&gt;% mutate(y_cen = mean(NMDS2, na.rm = TRUE)) %&gt;% ungroup() %&gt;% ggplot(., aes(x=NMDS1,y=NMDS2, color=type, shape=time_point)) + scale_color_manual(name=&quot;Type&quot;, breaks=c(&quot;Control&quot;, &quot;Hot_control&quot;, &quot;Treatment&quot;), labels=c(&quot;Cold-Cold&quot;, &quot;Hot-Hot&quot;, &quot;Cold-Hot&quot;), values=c(&quot;#4477AA&quot;,&quot;#d57d2c&quot;,&quot;#76b183&quot;)) + scale_shape_manual(name=&quot;time_point&quot;, breaks=c(&quot;1_Acclimation&quot;, &quot;3_Transplant1&quot;, &quot;4_Transplant2&quot;), labels=c(&quot;Acclimation&quot;, &quot;Transplant&quot;, &quot;Transplant&quot;), values=c(&quot;circle&quot;,&quot;square&quot;,&quot;square&quot;)) + geom_point(size=2) + geom_segment(aes(x=x_cen, y=y_cen, xend=NMDS1, yend=NMDS2), alpha=0.2) + labs(y= element_blank (), x=&quot;NMDS1 \\n Functional beta diversity&quot;) + theme_classic()+ theme(legend.position=&quot;none&quot;) 6.3.5.6 Comparison between Acclimation vs Post-FMT1 post3 &lt;- meta %&gt;% filter(time_point == &quot;1_Acclimation&quot; | time_point == &quot;5_Post-FMT1&quot;) temp_genome_counts &lt;- transform(genome_counts_filt, row.names = genome_counts_filt$genome) temp_genome_counts$genome &lt;- NULL post3.counts &lt;- temp_genome_counts[,which(colnames(temp_genome_counts) %in% rownames(post3))] identical(sort(colnames(post3.counts)),sort(as.character(rownames(post3)))) post3_nmds &lt;- sample_metadata %&gt;% filter(time_point == &quot;1_Acclimation&quot; | time_point == &quot;5_Post-FMT1&quot;) 6.3.5.7 Number of samples used [1] 53 beta_div_richness_post3&lt;-hillpair(data=post3.counts, q=0) beta_div_neutral_post3&lt;-hillpair(data=post3.counts, q=1) beta_div_phylo_post3&lt;-hillpair(data=post3.counts, q=1, tree=genome_tree) beta_div_func_post3&lt;-hillpair(data=post3.counts, q=1, dist=dist) #Arrange of metadata dataframe post3_arrange&lt;-post3[labels(beta_div_neutral_post3$S),] post3_arrange$type_time &lt;- interaction(post3_arrange$type, post3_arrange$time_point) 6.3.5.7.1 Richness Permutation test for homogeneity of multivariate dispersions Permutation: free Number of permutations: 999 Response: Distances Df Sum Sq Mean Sq F N.Perm Pr(&gt;F) Groups 2 0.099607 0.049803 9.5441 999 0.002 ** Residuals 50 0.260911 0.005218 --- Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 Pairwise comparisons: (Observed p-value below diagonal, permuted p-value above diagonal) Control Hot_control Treatment Control 0.00300000 0.900 Hot_control 0.00102653 0.001 Treatment 0.88832670 0.00010131 Df SumOfSqs R2 F Pr(&gt;F) time_point 1 1.2059071 0.0649048 3.913237 0.001 Population 1 1.7615474 0.0948107 5.716321 0.001 time_point:Population 1 0.5122847 0.0275724 1.662393 0.004 Residual 49 15.0998916 0.8127121 NA NA Total 52 18.5796308 1.0000000 NA NA tinytable_sgoapw9llb0cbipsszly .table td.tinytable_css_nz2laevallylqu1bh6rb, .table th.tinytable_css_nz2laevallylqu1bh6rb { border-bottom: solid 0.1em #d3d8dc; } pairs Df SumsOfSqs F.Model R2 p.value p.adjusted sig Control.1_Acclimation vs Treatment.1_Acclimation 1 0.3620815 1.052109 0.06169963 0.344 1.000 Control.1_Acclimation vs Hot_control.1_Acclimation 1 1.2800877 4.605444 0.22350616 0.001 0.015 . Control.1_Acclimation vs Control.5_Post-FMT1 1 0.6845657 1.998114 0.11101796 0.004 0.060 Control.1_Acclimation vs Treatment.5_Post-FMT1 1 0.8437461 2.499232 0.14281954 0.001 0.015 . Control.1_Acclimation vs Hot_control.5_Post-FMT1 1 1.1208022 3.568670 0.18236649 0.001 0.015 . Treatment.1_Acclimation vs Hot_control.1_Acclimation 1 1.3606630 5.087152 0.24124415 0.001 0.015 . Treatment.1_Acclimation vs Control.5_Post-FMT1 1 0.7216200 2.172734 0.11956009 0.001 0.015 . Treatment.1_Acclimation vs Treatment.5_Post-FMT1 1 0.9551308 2.926054 0.16322910 0.001 0.015 . Treatment.1_Acclimation vs Hot_control.5_Post-FMT1 1 1.2263345 4.039487 0.20157637 0.001 0.015 . Hot_control.1_Acclimation vs Control.5_Post-FMT1 1 1.4319792 5.384836 0.25180628 0.001 0.015 . Hot_control.1_Acclimation vs Treatment.5_Post-FMT1 1 0.8172413 3.194690 0.17558364 0.001 0.015 . Hot_control.1_Acclimation vs Hot_control.5_Post-FMT1 1 0.5796135 2.441615 0.13239702 0.001 0.015 . Control.5_Post-FMT1 vs Treatment.5_Post-FMT1 1 0.5615418 1.729004 0.10335366 0.020 0.300 Control.5_Post-FMT1 vs Hot_control.5_Post-FMT1 1 0.8438429 2.793772 0.14865413 0.001 0.015 . Treatment.5_Post-FMT1 vs Hot_control.5_Post-FMT1 1 0.3734921 1.268929 0.07799710 0.106 1.000 6.3.5.7.2 Neutral Permutation test for homogeneity of multivariate dispersions Permutation: free Number of permutations: 999 Response: Distances Df Sum Sq Mean Sq F N.Perm Pr(&gt;F) Groups 1 0.00945 0.0094472 1.1428 999 0.316 Residuals 51 0.42161 0.0082669 Pairwise comparisons: (Observed p-value below diagonal, permuted p-value above diagonal) 1_Acclimation 5_Post-FMT1 1_Acclimation 0.325 5_Post-FMT1 0.2901 Df SumOfSqs R2 F Pr(&gt;F) time_point 1 1.7277808 0.0986354 6.486824 0.001 Population 1 2.0558578 0.1173647 7.718565 0.001 time_point:Population 1 0.6819354 0.0389303 2.560276 0.001 Residual 49 13.0512643 0.7450696 NA NA Total 52 17.5168383 1.0000000 NA NA tinytable_vgf7x6xa24armu9pzgsm .table td.tinytable_css_zpdcxglo9j0jrelndruh, .table th.tinytable_css_zpdcxglo9j0jrelndruh { border-bottom: solid 0.1em #d3d8dc; } pairs Df SumsOfSqs F.Model R2 p.value p.adjusted sig Control.1_Acclimation vs Treatment.1_Acclimation 1 0.2316020 0.7712905 0.04598874 0.720 1.000 Control.1_Acclimation vs Hot_control.1_Acclimation 1 1.4015347 5.7562378 0.26457873 0.001 0.015 . Control.1_Acclimation vs Control.5_Post-FMT1 1 0.8332162 2.9081103 0.15380227 0.001 0.015 . Control.1_Acclimation vs Treatment.5_Post-FMT1 1 1.1719595 4.0685514 0.21336447 0.002 0.030 . Control.1_Acclimation vs Hot_control.5_Post-FMT1 1 1.4260875 5.2413171 0.24675104 0.001 0.015 . Treatment.1_Acclimation vs Hot_control.1_Acclimation 1 1.6347704 6.8326887 0.29925029 0.001 0.015 . Treatment.1_Acclimation vs Control.5_Post-FMT1 1 0.9517634 3.3715700 0.17404733 0.001 0.015 . Treatment.1_Acclimation vs Treatment.5_Post-FMT1 1 1.3127773 4.6298256 0.23585668 0.001 0.015 . Treatment.1_Acclimation vs Hot_control.5_Post-FMT1 1 1.6713369 6.2395460 0.28056085 0.001 0.015 . Hot_control.1_Acclimation vs Control.5_Post-FMT1 1 1.5409781 6.8338056 0.29928456 0.001 0.015 . Hot_control.1_Acclimation vs Treatment.5_Post-FMT1 1 0.9133614 4.0964534 0.21451383 0.001 0.015 . Hot_control.1_Acclimation vs Hot_control.5_Post-FMT1 1 0.6954835 3.2951234 0.17077493 0.001 0.015 . Control.5_Post-FMT1 vs Treatment.5_Post-FMT1 1 0.6051778 2.2508491 0.13047758 0.020 0.300 Control.5_Post-FMT1 vs Hot_control.5_Post-FMT1 1 1.0528902 4.1436369 0.20570451 0.001 0.015 . Treatment.5_Post-FMT1 vs Hot_control.5_Post-FMT1 1 0.4150076 1.6372683 0.09840968 0.042 0.630 6.3.5.7.3 Phylogenetic Permutation test for homogeneity of multivariate dispersions Permutation: free Number of permutations: 999 Response: Distances Df Sum Sq Mean Sq F N.Perm Pr(&gt;F) Groups 1 0.05132 0.051320 2.6745 999 0.099 . Residuals 51 0.97861 0.019189 --- Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 Pairwise comparisons: (Observed p-value below diagonal, permuted p-value above diagonal) 1_Acclimation 5_Post-FMT1 1_Acclimation 0.097 5_Post-FMT1 0.10812 Df SumOfSqs R2 F Pr(&gt;F) time_point 1 0.4329638 0.1243360 7.717455 0.001 Population 1 0.2375991 0.0682323 4.235135 0.004 time_point:Population 1 0.0626513 0.0179918 1.116741 0.307 Residual 49 2.7489923 0.7894398 NA NA Total 52 3.4822065 1.0000000 NA NA tinytable_8asr0wghaq8j0z81mcq0 .table td.tinytable_css_qmvlwmw6c2xzmcm6xgss, .table th.tinytable_css_qmvlwmw6c2xzmcm6xgss { border-bottom: solid 0.1em #d3d8dc; } pairs Df SumsOfSqs F.Model R2 p.value p.adjusted sig Control.1_Acclimation vs Treatment.1_Acclimation 1 0.04186923 0.4391642 0.02671451 0.741 1.000 Control.1_Acclimation vs Hot_control.1_Acclimation 1 0.15609416 2.5546889 0.13768428 0.031 0.465 Control.1_Acclimation vs Control.5_Post-FMT1 1 0.19193367 2.9749922 0.15678490 0.018 0.270 Control.1_Acclimation vs Treatment.5_Post-FMT1 1 0.14627288 1.7907381 0.10665035 0.137 1.000 Control.1_Acclimation vs Hot_control.5_Post-FMT1 1 0.25061348 3.6146185 0.18428187 0.012 0.180 Treatment.1_Acclimation vs Hot_control.1_Acclimation 1 0.23108846 4.0521838 0.20208192 0.001 0.015 . Treatment.1_Acclimation vs Control.5_Post-FMT1 1 0.26358465 4.3608960 0.21417997 0.002 0.030 . Treatment.1_Acclimation vs Treatment.5_Post-FMT1 1 0.25319427 3.2738422 0.17915456 0.036 0.540 Treatment.1_Acclimation vs Hot_control.5_Post-FMT1 1 0.39050120 5.9837393 0.27218933 0.001 0.015 . Hot_control.1_Acclimation vs Control.5_Post-FMT1 1 0.14203376 5.4200212 0.25303529 0.002 0.030 . Hot_control.1_Acclimation vs Treatment.5_Post-FMT1 1 0.09666753 2.3682173 0.13635351 0.022 0.330 Hot_control.1_Acclimation vs Hot_control.5_Post-FMT1 1 0.09252600 2.9824958 0.15711821 0.009 0.135 Control.5_Post-FMT1 vs Treatment.5_Post-FMT1 1 0.01842535 0.4144162 0.02688498 0.781 1.000 Control.5_Post-FMT1 vs Hot_control.5_Post-FMT1 1 0.05987967 1.7387847 0.09802164 0.117 1.000 Treatment.5_Post-FMT1 vs Hot_control.5_Post-FMT1 1 0.03212966 0.6477782 0.04139746 0.719 1.000 6.3.5.7.4 Functional Permutation test for homogeneity of multivariate dispersions Permutation: free Number of permutations: 999 Response: Distances Df Sum Sq Mean Sq F N.Perm Pr(&gt;F) Groups 1 0.00541 0.0054137 0.2021 999 0.652 Residuals 51 1.36615 0.0267873 Pairwise comparisons: (Observed p-value below diagonal, permuted p-value above diagonal) 1_Acclimation 5_Post-FMT1 1_Acclimation 0.646 5_Post-FMT1 0.65494 Df SumOfSqs R2 F Pr(&gt;F) time_point 1 0.0571984 0.0294799 1.5128525 0.195 Population 1 0.0239890 0.0123639 0.6344904 0.873 time_point:Population 1 0.0064542 0.0033265 0.1707088 0.617 Residual 49 1.8526072 0.9548297 NA NA Total 52 1.9402488 1.0000000 NA NA tinytable_z8iwv66fhppivvqwz20x .table td.tinytable_css_adx7r89kyx5eko59y18d, .table th.tinytable_css_adx7r89kyx5eko59y18d { border-bottom: solid 0.1em #d3d8dc; } pairs Df SumsOfSqs F.Model R2 p.value p.adjusted sig Control.1_Acclimation vs Treatment.1_Acclimation 1 0.090450145 1.65575459 0.093779882 0.229 1.000 Control.1_Acclimation vs Hot_control.1_Acclimation 1 0.085769225 1.63605364 0.092767559 0.235 1.000 Control.1_Acclimation vs Control.5_Post-FMT1 1 0.030318564 0.53607587 0.032418566 0.526 1.000 Control.1_Acclimation vs Treatment.5_Post-FMT1 1 0.236457683 4.06299320 0.213135113 0.037 0.555 Control.1_Acclimation vs Hot_control.5_Post-FMT1 1 0.135603602 2.22854385 0.122255726 0.147 1.000 Treatment.1_Acclimation vs Hot_control.1_Acclimation 1 0.001373886 0.07238159 0.004503476 0.647 1.000 Treatment.1_Acclimation vs Control.5_Post-FMT1 1 0.002173211 0.09402475 0.005842215 0.647 1.000 Treatment.1_Acclimation vs Treatment.5_Post-FMT1 1 0.059119657 2.62461793 0.148917721 0.155 1.000 Treatment.1_Acclimation vs Hot_control.5_Post-FMT1 1 0.010911935 0.39816986 0.024281360 0.515 1.000 Hot_control.1_Acclimation vs Control.5_Post-FMT1 1 -0.002303582 -0.11016709 -0.006933181 0.728 1.000 Hot_control.1_Acclimation vs Treatment.5_Post-FMT1 1 0.058908140 2.91987617 0.162940644 0.173 1.000 Hot_control.1_Acclimation vs Hot_control.5_Post-FMT1 1 0.005904278 0.23427876 0.014431116 0.542 1.000 Control.5_Post-FMT1 vs Treatment.5_Post-FMT1 1 0.116146557 4.72479132 0.239535681 0.076 1.000 Control.5_Post-FMT1 vs Hot_control.5_Post-FMT1 1 0.050009298 1.70482607 0.096291602 0.231 1.000 Treatment.5_Post-FMT1 vs Hot_control.5_Post-FMT1 1 0.012358590 0.42381202 0.027477774 0.474 1.000 beta_richness_nmds_post3 &lt;- beta_div_richness_post3$S %&gt;% metaMDS(.,trymax = 500, k=2, verbosity=FALSE) %&gt;% scores() %&gt;% as_tibble(., rownames = &quot;sample&quot;) %&gt;% left_join(post3_nmds, by = c(&quot;sample&quot; = &quot;Tube_code&quot;)) beta_neutral_nmds_post3 &lt;- beta_div_neutral_post3$S %&gt;% metaMDS(.,trymax = 500, k=2, verbosity=FALSE) %&gt;% scores() %&gt;% as_tibble(., rownames = &quot;sample&quot;) %&gt;% left_join(post3_nmds, by = c(&quot;sample&quot; = &quot;Tube_code&quot;)) beta_phylo_nmds_post3 &lt;- beta_div_phylo_post3$S %&gt;% metaMDS(.,trymax = 500, k=2, verbosity=FALSE) %&gt;% scores() %&gt;% as_tibble(., rownames = &quot;sample&quot;) %&gt;% left_join(post3_nmds, by = join_by(sample == Tube_code)) beta_func_nmds_post3 &lt;- beta_div_func_post3$S %&gt;% metaMDS(.,trymax = 500, k=2, verbosity=FALSE) %&gt;% scores() %&gt;% as_tibble(., rownames = &quot;sample&quot;) %&gt;% left_join(post3_nmds, by = join_by(sample == Tube_code)) 6.3.5.8 Comparison between Acclimation vs Post-FMT2 post4 &lt;- meta %&gt;% filter(time_point == &quot;1_Acclimation&quot; | time_point == &quot;6_Post-FMT2&quot;) temp_genome_counts &lt;- transform(genome_counts_filt, row.names = genome_counts_filt$genome) temp_genome_counts$genome &lt;- NULL post4.counts &lt;- temp_genome_counts[,which(colnames(temp_genome_counts) %in% rownames(post4))] identical(sort(colnames(post4.counts)),sort(as.character(rownames(post4)))) post4_nmds &lt;- sample_metadata %&gt;% filter(time_point == &quot;1_Acclimation&quot; | time_point == &quot;6_Post-FMT2&quot;) 6.3.5.9 Number of samples used [1] 54 beta_div_richness_post4&lt;-hillpair(data=post4.counts, q=0) beta_div_neutral_post4&lt;-hillpair(data=post4.counts, q=1) beta_div_phylo_post4&lt;-hillpair(data=post4.counts, q=1, tree=genome_tree) beta_div_func_post4&lt;-hillpair(data=post4.counts, q=1, dist=dist) #Arrange of metadata dataframe post4_arrange&lt;-post4[labels(beta_div_neutral_post4$S),] post4_arrange$type_time &lt;- interaction(post4_arrange$type, post4_arrange$time_point) 6.3.5.9.1 Richness Permutation test for homogeneity of multivariate dispersions Permutation: free Number of permutations: 999 Response: Distances Df Sum Sq Mean Sq F N.Perm Pr(&gt;F) Groups 2 0.06809 0.034047 3.8471 999 0.026 * Residuals 51 0.45135 0.008850 --- Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 Pairwise comparisons: (Observed p-value below diagonal, permuted p-value above diagonal) Control Hot_control Treatment Control 0.0290000 0.897 Hot_control 0.0349385 0.003 Treatment 0.8855174 0.0047257 Df SumOfSqs R2 F Pr(&gt;F) time_point 1 0.8124061 0.0462232 2.847438 0.001 Population 1 2.0491994 0.1165926 7.182331 0.001 time_point:Population 1 0.4485668 0.0255219 1.572202 0.002 Residual 50 14.2655595 0.8116623 NA NA Total 53 17.5757317 1.0000000 NA NA tinytable_w0iayzicnronwq7e3b4k .table td.tinytable_css_v2snn5zyhx3vtdh6d53f, .table th.tinytable_css_v2snn5zyhx3vtdh6d53f { border-bottom: solid 0.1em #d3d8dc; } pairs Df SumsOfSqs F.Model R2 p.value p.adjusted sig Control.1_Acclimation vs Treatment.1_Acclimation 1 0.3620815 1.052109 0.06169963 0.319 1.000 Control.1_Acclimation vs Hot_control.1_Acclimation 1 1.2800877 4.605444 0.22350616 0.001 0.015 . Control.1_Acclimation vs Treatment.6_Post-FMT2 1 0.8430295 2.845779 0.15100353 0.001 0.015 . Control.1_Acclimation vs Control.6_Post-FMT2 1 0.5232174 1.683240 0.09518843 0.023 0.345 Control.1_Acclimation vs Hot_control.6_Post-FMT2 1 1.1217138 3.634271 0.18509835 0.001 0.015 . Treatment.1_Acclimation vs Hot_control.1_Acclimation 1 1.3606630 5.087152 0.24124415 0.001 0.015 . Treatment.1_Acclimation vs Treatment.6_Post-FMT2 1 0.9130048 3.195028 0.16645080 0.001 0.015 . Treatment.1_Acclimation vs Control.6_Post-FMT2 1 0.5959230 1.984036 0.11032208 0.001 0.015 . Treatment.1_Acclimation vs Hot_control.6_Post-FMT2 1 1.2747787 4.275366 0.21086503 0.001 0.015 . Hot_control.1_Acclimation vs Treatment.6_Post-FMT2 1 0.6397330 2.913695 0.15405213 0.002 0.030 . Hot_control.1_Acclimation vs Control.6_Post-FMT2 1 1.4575447 6.224524 0.28007456 0.001 0.015 . Hot_control.1_Acclimation vs Hot_control.6_Post-FMT2 1 0.3276169 1.412318 0.08111028 0.044 0.660 Treatment.6_Post-FMT2 vs Control.6_Post-FMT2 1 0.6463814 2.560441 0.13795154 0.001 0.015 . Treatment.6_Post-FMT2 vs Hot_control.6_Post-FMT2 1 0.4796256 1.916520 0.10696943 0.001 0.015 . Control.6_Post-FMT2 vs Hot_control.6_Post-FMT2 1 1.1305044 4.268317 0.21059061 0.001 0.015 . 6.3.5.9.2 Neutral Permutation test for homogeneity of multivariate dispersions Permutation: free Number of permutations: 999 Response: Distances Df Sum Sq Mean Sq F N.Perm Pr(&gt;F) Groups 1 0.01544 0.0154447 2.0972 999 0.147 Residuals 52 0.38294 0.0073643 Pairwise comparisons: (Observed p-value below diagonal, permuted p-value above diagonal) 1_Acclimation 6_Post-FMT2 1_Acclimation 0.146 6_Post-FMT2 0.15357 Df SumOfSqs R2 F Pr(&gt;F) time_point 1 1.0151664 0.0602602 3.909554 0.001 Population 1 2.2827471 0.1355037 8.791191 0.001 time_point:Population 1 0.5653146 0.0335570 2.177109 0.002 Residual 50 12.9831505 0.7706790 NA NA Total 53 16.8463787 1.0000000 NA NA tinytable_aj84p0edcht8ubcxq0h6 .table td.tinytable_css_a2h4ocq90yff0ssrat71, .table th.tinytable_css_a2h4ocq90yff0ssrat71 { border-bottom: solid 0.1em #d3d8dc; } pairs Df SumsOfSqs F.Model R2 p.value p.adjusted sig Control.1_Acclimation vs Treatment.1_Acclimation 1 0.2316020 0.7712905 0.04598874 0.737 1.000 Control.1_Acclimation vs Hot_control.1_Acclimation 1 1.4015347 5.7562378 0.26457873 0.001 0.015 . Control.1_Acclimation vs Treatment.6_Post-FMT2 1 1.1746426 4.5564741 0.22165640 0.001 0.015 . Control.1_Acclimation vs Control.6_Post-FMT2 1 0.5286441 1.9819408 0.11021840 0.003 0.045 . Control.1_Acclimation vs Hot_control.6_Post-FMT2 1 1.3443224 4.9104417 0.23483204 0.001 0.015 . Treatment.1_Acclimation vs Hot_control.1_Acclimation 1 1.6347704 6.8326887 0.29925029 0.001 0.015 . Treatment.1_Acclimation vs Treatment.6_Post-FMT2 1 1.3540292 5.3398081 0.25022756 0.001 0.015 . Treatment.1_Acclimation vs Control.6_Post-FMT2 1 0.6311089 2.4041625 0.13063146 0.002 0.030 . Treatment.1_Acclimation vs Hot_control.6_Post-FMT2 1 1.6125755 5.9825981 0.27215155 0.001 0.015 . Hot_control.1_Acclimation vs Treatment.6_Post-FMT2 1 0.6202327 3.1519868 0.16457754 0.001 0.015 . Hot_control.1_Acclimation vs Control.6_Post-FMT2 1 1.5701179 7.6327037 0.32297209 0.001 0.015 . Hot_control.1_Acclimation vs Hot_control.6_Post-FMT2 1 0.3634438 1.7083388 0.09647087 0.031 0.465 Treatment.6_Post-FMT2 vs Control.6_Post-FMT2 1 1.0227481 4.6483346 0.22511910 0.001 0.015 . Treatment.6_Post-FMT2 vs Hot_control.6_Post-FMT2 1 0.5010202 2.2065321 0.12119453 0.003 0.045 . Control.6_Post-FMT2 vs Hot_control.6_Post-FMT2 1 1.3619424 5.7710313 0.26507845 0.001 0.015 . 6.3.5.9.3 Phylogenetic Permutation test for homogeneity of multivariate dispersions Permutation: free Number of permutations: 999 Response: Distances Df Sum Sq Mean Sq F N.Perm Pr(&gt;F) Groups 1 0.06978 0.069777 5.0345 999 0.022 * Residuals 52 0.72071 0.013860 --- Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 Pairwise comparisons: (Observed p-value below diagonal, permuted p-value above diagonal) 1_Acclimation 6_Post-FMT2 1_Acclimation 0.022 6_Post-FMT2 0.029131 Df SumOfSqs R2 F Pr(&gt;F) time_point 1 0.4131659 0.1296152 8.500864 0.001 Population 1 0.2372445 0.0744265 4.881291 0.001 time_point:Population 1 0.1070826 0.0335931 2.203218 0.035 Residual 50 2.4301410 0.7623651 NA NA Total 53 3.1876340 1.0000000 NA NA tinytable_xzurbvfu1x27gryqetdx .table td.tinytable_css_c7yg6ovxuohvdcpm2kt5, .table th.tinytable_css_c7yg6ovxuohvdcpm2kt5 { border-bottom: solid 0.1em #d3d8dc; } pairs Df SumsOfSqs F.Model R2 p.value p.adjusted sig Control.1_Acclimation vs Treatment.1_Acclimation 1 0.04186923 0.4391642 0.02671451 0.709 1.000 Control.1_Acclimation vs Hot_control.1_Acclimation 1 0.15609416 2.5546889 0.13768428 0.033 0.495 Control.1_Acclimation vs Treatment.6_Post-FMT2 1 0.26322331 4.3060281 0.21205664 0.002 0.030 . Control.1_Acclimation vs Control.6_Post-FMT2 1 0.16047895 2.5405742 0.13702781 0.044 0.660 Control.1_Acclimation vs Hot_control.6_Post-FMT2 1 0.25529510 4.0109138 0.20043631 0.001 0.015 . Treatment.1_Acclimation vs Hot_control.1_Acclimation 1 0.23108846 4.0521838 0.20208192 0.004 0.060 Treatment.1_Acclimation vs Treatment.6_Post-FMT2 1 0.36496892 6.3966666 0.28560797 0.001 0.015 . Treatment.1_Acclimation vs Control.6_Post-FMT2 1 0.22628210 3.8292220 0.19311005 0.017 0.255 Treatment.1_Acclimation vs Hot_control.6_Post-FMT2 1 0.34830814 5.8463335 0.26761166 0.001 0.015 . Hot_control.1_Acclimation vs Treatment.6_Post-FMT2 1 0.10002871 4.3836237 0.21505615 0.002 0.030 . Hot_control.1_Acclimation vs Control.6_Post-FMT2 1 0.12577510 5.0601287 0.24027055 0.001 0.015 . Hot_control.1_Acclimation vs Hot_control.6_Post-FMT2 1 0.06334378 2.4997737 0.13512455 0.019 0.285 Treatment.6_Post-FMT2 vs Control.6_Post-FMT2 1 0.05927454 2.3820253 0.12958449 0.028 0.420 Treatment.6_Post-FMT2 vs Hot_control.6_Post-FMT2 1 0.06906280 2.7224602 0.14541146 0.003 0.045 . Control.6_Post-FMT2 vs Hot_control.6_Post-FMT2 1 0.11081709 4.0436561 0.20174244 0.003 0.045 . 6.3.5.9.4 Functional Permutation test for homogeneity of multivariate dispersions Permutation: free Number of permutations: 999 Response: Distances Df Sum Sq Mean Sq F N.Perm Pr(&gt;F) Groups 1 0.00538 0.0053768 0.1915 999 0.663 Residuals 52 1.46001 0.0280772 Pairwise comparisons: (Observed p-value below diagonal, permuted p-value above diagonal) 1_Acclimation 6_Post-FMT2 1_Acclimation 0.657 6_Post-FMT2 0.66348 Df SumOfSqs R2 F Pr(&gt;F) time_point 1 0.0451272 0.0242533 1.2655291 0.220 Population 1 0.0004181 0.0002247 0.0117261 0.272 time_point:Population 1 0.0321822 0.0172961 0.9025046 0.267 Residual 50 1.7829366 0.9582260 NA NA Total 53 1.8606640 1.0000000 NA NA tinytable_y2p2j9rsyk7vp12qar9g .table td.tinytable_css_2atyhshuymwy49vbupl1, .table th.tinytable_css_2atyhshuymwy49vbupl1 { border-bottom: solid 0.1em #d3d8dc; } pairs Df SumsOfSqs F.Model R2 p.value p.adjusted sig Control.1_Acclimation vs Treatment.1_Acclimation 1 9.045014e-02 1.65575459 0.0937798825 0.219 1 Control.1_Acclimation vs Hot_control.1_Acclimation 1 8.576922e-02 1.63605364 0.0927675587 0.232 1 Control.1_Acclimation vs Treatment.6_Post-FMT2 1 1.171666e-01 2.16526354 0.1191980254 0.172 1 Control.1_Acclimation vs Control.6_Post-FMT2 1 1.134013e-01 2.16495643 0.1191831338 0.205 1 Control.1_Acclimation vs Hot_control.6_Post-FMT2 1 6.533744e-02 0.94814395 0.0559438221 0.292 1 Treatment.1_Acclimation vs Hot_control.1_Acclimation 1 1.373886e-03 0.07238159 0.0045034760 0.624 1 Treatment.1_Acclimation vs Treatment.6_Post-FMT2 1 -4.929805e-04 -0.02385162 -0.0014929516 0.729 1 Treatment.1_Acclimation vs Control.6_Post-FMT2 1 2.443617e-03 0.12903840 0.0080003779 0.574 1 Treatment.1_Acclimation vs Hot_control.6_Post-FMT2 1 6.968380e-03 0.19647180 0.0121305310 0.587 1 Hot_control.1_Acclimation vs Treatment.6_Post-FMT2 1 3.866607e-04 0.02093980 0.0013070267 0.682 1 Hot_control.1_Acclimation vs Control.6_Post-FMT2 1 -5.633463e-05 -0.00336651 -0.0002104511 0.685 1 Hot_control.1_Acclimation vs Hot_control.6_Post-FMT2 1 2.011448e-03 0.06046867 0.0037650628 0.754 1 Treatment.6_Post-FMT2 vs Control.6_Post-FMT2 1 -8.527330e-03 -0.46290555 -0.0297935723 0.843 1 Treatment.6_Post-FMT2 vs Hot_control.6_Post-FMT2 1 -1.648721e-03 -0.04717131 -0.0029569243 0.908 1 Control.6_Post-FMT2 vs Hot_control.6_Post-FMT2 1 4.367477e-03 0.13147026 0.0081499244 0.706 1 beta_richness_nmds_post4 &lt;- beta_div_richness_post4$S %&gt;% metaMDS(.,trymax = 500, k=2, verbosity=FALSE) %&gt;% scores() %&gt;% as_tibble(., rownames = &quot;sample&quot;) %&gt;% left_join(post4_nmds, by = c(&quot;sample&quot; = &quot;Tube_code&quot;)) beta_neutral_nmds_post4 &lt;- beta_div_neutral_post4$S %&gt;% metaMDS(.,trymax = 500, k=2, verbosity=FALSE) %&gt;% scores() %&gt;% as_tibble(., rownames = &quot;sample&quot;) %&gt;% left_join(post4_nmds, by = c(&quot;sample&quot; = &quot;Tube_code&quot;)) beta_phylo_nmds_post4 &lt;- beta_div_phylo_post4$S %&gt;% metaMDS(.,trymax = 500, k=2, verbosity=FALSE) %&gt;% scores() %&gt;% as_tibble(., rownames = &quot;sample&quot;) %&gt;% left_join(post4_nmds, by = join_by(sample == Tube_code)) beta_func_nmds_post4 &lt;- beta_div_func_post4$S %&gt;% metaMDS(.,trymax = 500, k=2, verbosity=FALSE) %&gt;% scores() %&gt;% as_tibble(., rownames = &quot;sample&quot;) %&gt;% left_join(post4_nmds, by = join_by(sample == Tube_code)) 6.3.6 6. Are there differences between the control and the treatment group? 6.3.6.1 After 1 week –&gt; Post-FMT1 post1 &lt;- meta %&gt;% filter(time_point == &quot;5_Post-FMT1&quot;) post1.counts &lt;- temp_genome_counts[,which(colnames(temp_genome_counts) %in% rownames(post1))] identical(sort(colnames(post1.counts)),sort(as.character(rownames(post1)))) post1_nmds &lt;- sample_metadata %&gt;% filter(time_point == &quot;5_Post-FMT1&quot;) 6.3.6.2 Number of samples used [1] 26 beta_div_richness_post1&lt;-hillpair(data=post1.counts, q=0) beta_div_neutral_post1&lt;-hillpair(data=post1.counts, q=1) beta_div_phylo_post1&lt;-hillpair(data=post1.counts, q=1, tree=genome_tree) beta_div_func_post1&lt;-hillpair(data=post1.counts, q=1, dist=dist) #Arrange of metadata dataframe post1_arrange&lt;-post1[labels(beta_div_neutral_post1$S),] 6.3.6.2.1 Richness Permutation test for homogeneity of multivariate dispersions Permutation: free Number of permutations: 999 Response: Distances Df Sum Sq Mean Sq F N.Perm Pr(&gt;F) Groups 2 0.017675 0.0088373 2.3825 999 0.092 . Residuals 23 0.085312 0.0037092 --- Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 Pairwise comparisons: (Observed p-value below diagonal, permuted p-value above diagonal) Control Hot_control Treatment Control 0.0030000 0.656 Hot_control 0.0068795 0.206 Treatment 0.6248469 0.2084296 Df SumOfSqs R2 F Pr(&gt;F) species 1 0.6340254 0.0768024 2.065607 0.002 type 1 0.5615418 0.0680222 1.829461 0.012 Residual 23 7.0597099 0.8551754 NA NA Total 25 8.2552771 1.0000000 NA NA pairs Df SumsOfSqs F.Model R2 p.value p.adjusted sig 1 Control vs Treatment 1 0.5615418 1.729004 0.1033537 0.019 0.057 2 Control vs Hot_control 1 0.8438429 2.793772 0.1486541 0.002 0.006 * 3 Treatment vs Hot_control 1 0.3734921 1.268929 0.0779971 0.097 0.291 6.3.6.2.2 Neutral Permutation test for homogeneity of multivariate dispersions Permutation: free Number of permutations: 999 Response: Distances Df Sum Sq Mean Sq F N.Perm Pr(&gt;F) Groups 2 0.011001 0.0055005 0.6303 999 0.563 Residuals 23 0.200714 0.0087267 Pairwise comparisons: (Observed p-value below diagonal, permuted p-value above diagonal) Control Hot_control Treatment Control 0.22100 0.950 Hot_control 0.21166 0.453 Treatment 0.95468 0.43604 Df SumOfSqs R2 F Pr(&gt;F) species 1 0.7907904 0.1076445 3.056657 0.001 type 1 0.6051778 0.0823784 2.339205 0.012 Residual 23 5.9503501 0.8099772 NA NA Total 25 7.3463184 1.0000000 NA NA pairs Df SumsOfSqs F.Model R2 p.value p.adjusted sig 1 Control vs Treatment 1 0.6051778 2.250849 0.13047758 0.012 0.036 . 2 Control vs Hot_control 1 1.0528902 4.143637 0.20570451 0.001 0.003 * 3 Treatment vs Hot_control 1 0.4150076 1.637268 0.09840968 0.041 0.123 6.3.6.2.3 Phylogenetic Permutation test for homogeneity of multivariate dispersions Permutation: free Number of permutations: 999 Response: Distances Df Sum Sq Mean Sq F N.Perm Pr(&gt;F) Groups 2 0.00440 0.0021994 0.1369 999 0.907 Residuals 23 0.36941 0.0160614 Pairwise comparisons: (Observed p-value below diagonal, permuted p-value above diagonal) Control Hot_control Treatment Control 0.92600 0.688 Hot_control 0.91505 0.780 Treatment 0.63312 0.73046 Df SumOfSqs R2 F Pr(&gt;F) species 1 0.0560850 0.0531376 1.3149967 0.259 type 1 0.0184254 0.0174571 0.4320099 0.821 Residual 23 0.9809570 0.9294053 NA NA Total 25 1.0554673 1.0000000 NA NA pairs Df SumsOfSqs F.Model R2 p.value p.adjusted sig 1 Control vs Treatment 1 0.01842535 0.4144162 0.02688498 0.765 1.000 2 Control vs Hot_control 1 0.05987967 1.7387847 0.09802164 0.119 0.357 3 Treatment vs Hot_control 1 0.03212966 0.6477782 0.04139746 0.697 1.000 6.3.6.2.4 Functional Permutation test for homogeneity of multivariate dispersions Permutation: free Number of permutations: 999 Response: Distances Df Sum Sq Mean Sq F N.Perm Pr(&gt;F) Groups 2 0.00400 0.0020014 0.145 999 0.872 Residuals 23 0.31753 0.0138057 Pairwise comparisons: (Observed p-value below diagonal, permuted p-value above diagonal) Control Hot_control Treatment Control 0.60000 0.741 Hot_control 0.59817 0.827 Treatment 0.75141 0.83718 Df SumOfSqs R2 F Pr(&gt;F) species 1 0.0024979 0.0033024 0.0900845 0.656 type 1 0.1161466 0.1535542 4.1887855 0.086 Residual 23 0.6377435 0.8431434 NA NA Total 25 0.7563879 1.0000000 NA NA pairs Df SumsOfSqs F.Model R2 p.value p.adjusted sig 1 Control vs Treatment 1 0.11614656 4.724791 0.23953568 0.086 0.258 2 Control vs Hot_control 1 0.05000930 1.704826 0.09629160 0.219 0.657 3 Treatment vs Hot_control 1 0.01235859 0.423812 0.02747777 0.468 1.000 beta_richness_nmds_post1 &lt;- beta_div_richness_post1$S %&gt;% metaMDS(.,trymax = 500, k=2, verbosity=FALSE) %&gt;% scores() %&gt;% as_tibble(., rownames = &quot;sample&quot;) %&gt;% left_join(post1_nmds, by = join_by(sample == Tube_code)) beta_neutral_nmds_post1 &lt;- beta_div_neutral_post1$S %&gt;% metaMDS(.,trymax = 500, k=2, verbosity=FALSE) %&gt;% scores() %&gt;% as_tibble(., rownames = &quot;sample&quot;) %&gt;% left_join(post1_nmds, by = join_by(sample == Tube_code)) beta_phylogenetic_nmds_post1 &lt;- beta_div_phylo_post1$S %&gt;% metaMDS(.,trymax = 500, k=2, verbosity=FALSE) %&gt;% scores() %&gt;% as_tibble(., rownames = &quot;sample&quot;) %&gt;% left_join(post1_nmds, by = join_by(sample == Tube_code)) beta_functional_nmds_post1 &lt;- beta_div_func_post1$S %&gt;% metaMDS(.,trymax = 500, k=2, verbosity=FALSE) %&gt;% scores() %&gt;% as_tibble(., rownames = &quot;sample&quot;) %&gt;% left_join(post1_nmds, by = join_by(sample == Tube_code)) p0&lt;-beta_richness_nmds_post1 %&gt;% group_by(type) %&gt;% mutate(x_cen = mean(NMDS1, na.rm = TRUE)) %&gt;% mutate(y_cen = mean(NMDS2, na.rm = TRUE)) %&gt;% ungroup() %&gt;% ggplot(., aes(x=NMDS1,y=NMDS2, color=type)) + scale_color_manual(name=&quot;Type&quot;, breaks=c(&quot;Control&quot;, &quot;Hot_control&quot;, &quot;Treatment&quot;), labels=c(&quot;Cold-Cold&quot;, &quot;Hot-Hot&quot;, &quot;Cold-Hot&quot;), values=c(&quot;#4477AA&quot;,&quot;#d57d2c&quot;,&quot;#76b183&quot;)) + geom_point(size=2) + geom_segment(aes(x=x_cen, y=y_cen, xend=NMDS1, yend=NMDS2), alpha=0.2) + labs(y = &quot;NMDS2&quot;, x=&quot;NMDS1 \\n Richness beta diversity&quot;) + theme_classic() + theme(legend.position=&quot;none&quot;) p1&lt;-beta_neutral_nmds_post1 %&gt;% group_by(type) %&gt;% mutate(x_cen = mean(NMDS1, na.rm = TRUE)) %&gt;% mutate(y_cen = mean(NMDS2, na.rm = TRUE)) %&gt;% ungroup() %&gt;% ggplot(., aes(x=NMDS1,y=NMDS2, color=type)) + scale_color_manual(name=&quot;Type&quot;, breaks=c(&quot;Control&quot;, &quot;Hot_control&quot;, &quot;Treatment&quot;), labels=c(&quot;Cold-Cold&quot;, &quot;Hot-Hot&quot;, &quot;Cold-Hot&quot;), values=c(&quot;#4477AA&quot;,&quot;#d57d2c&quot;,&quot;#76b183&quot;)) + geom_point(size=2) + geom_segment(aes(x=x_cen, y=y_cen, xend=NMDS1, yend=NMDS2), alpha=0.2) + labs(y = &quot;NMDS2&quot;, x=&quot;NMDS1 \\n Neutral beta diversity&quot;) + theme_classic() + theme(legend.position=&quot;none&quot;) p2&lt;-beta_phylogenetic_nmds_post1 %&gt;% group_by(type) %&gt;% mutate(x_cen = mean(NMDS1, na.rm = TRUE)) %&gt;% mutate(y_cen = mean(NMDS2, na.rm = TRUE)) %&gt;% ungroup() %&gt;% ggplot(., aes(x=NMDS1,y=NMDS2, color=type)) + scale_color_manual(name=&quot;Type&quot;, breaks=c(&quot;Control&quot;, &quot;Hot_control&quot;, &quot;Treatment&quot;), labels=c(&quot;Cold-Cold&quot;, &quot;Hot-Hot&quot;, &quot;Cold-Hot&quot;), values=c(&quot;#4477AA&quot;,&quot;#d57d2c&quot;,&quot;#76b183&quot;)) + geom_point(size=2) + geom_segment(aes(x=x_cen, y=y_cen, xend=NMDS1, yend=NMDS2), alpha=0.2) + labs(y= element_blank (), x=&quot;NMDS1 \\n Phylogenetic beta diversity&quot;) + theme_classic() + theme(legend.position=&quot;none&quot;) p3&lt;-beta_functional_nmds_post1 %&gt;% group_by(type) %&gt;% mutate(x_cen = mean(NMDS1, na.rm = TRUE)) %&gt;% mutate(y_cen = mean(NMDS2, na.rm = TRUE)) %&gt;% ungroup() %&gt;% ggplot(., aes(x=NMDS1,y=NMDS2, color=type)) + scale_color_manual(name=&quot;Type&quot;, breaks=c(&quot;Control&quot;, &quot;Hot_control&quot;, &quot;Treatment&quot;), labels=c(&quot;Cold-Cold&quot;, &quot;Hot-Hot&quot;, &quot;Cold-Hot&quot;), values=c(&quot;#4477AA&quot;,&quot;#d57d2c&quot;,&quot;#76b183&quot;)) + geom_point(size=2) + geom_segment(aes(x=x_cen, y=y_cen, xend=NMDS1, yend=NMDS2), alpha=0.2) + labs(y= element_blank (), x=&quot;NMDS1 \\n Functional beta diversity&quot;) + theme_classic()+ theme(legend.position=&quot;none&quot;) ggarrange(p0, p1, p2, p3, ncol=2, nrow=2, common.legend = TRUE, legend=&quot;right&quot;) 6.3.6.3 After 2 weeks –&gt;Post-FMT2 post2 &lt;- meta %&gt;% filter(time_point == &quot;6_Post-FMT2&quot;) post2.counts &lt;- temp_genome_counts[,which(colnames(temp_genome_counts) %in% rownames(post2))] identical(sort(colnames(post2.counts)),sort(as.character(rownames(post2)))) post2_nmds &lt;- sample_metadata %&gt;% filter(time_point == &quot;6_Post-FMT2&quot;) 6.3.6.4 Number of samples used [1] 27 beta_div_richness_post2&lt;-hillpair(data=post2.counts, q=0) beta_div_neutral_post2&lt;-hillpair(data=post2.counts, q=1) beta_div_phylo_post2&lt;-hillpair(data=post2.counts, q=1, tree=genome_tree) beta_div_func_post2&lt;-hillpair(data=post2.counts, q=1, dist=dist) #Arrange of metadata dataframe post2_arrange&lt;-post2[labels(beta_div_neutral_post2$S),] 6.3.6.4.1 Richness Permutation test for homogeneity of multivariate dispersions Permutation: free Number of permutations: 999 Response: Distances Df Sum Sq Mean Sq F N.Perm Pr(&gt;F) Groups 2 0.002011 0.0010056 0.1982 999 0.835 Residuals 24 0.121775 0.0050740 Pairwise comparisons: (Observed p-value below diagonal, permuted p-value above diagonal) Control Hot_control Treatment Control 0.69700 0.817 Hot_control 0.67789 0.628 Treatment 0.79246 0.59820 Df SumOfSqs R2 F Pr(&gt;F) type 2 1.504341 0.1967776 2.939822 0.001 Residual 24 6.140538 0.8032224 NA NA Total 26 7.644879 1.0000000 NA NA tinytable_jxozp115n22x1m1yxrw3 .table td.tinytable_css_453v4m79fqyixyv0xrby, .table th.tinytable_css_453v4m79fqyixyv0xrby { border-bottom: solid 0.1em #d3d8dc; } pairs Df SumsOfSqs F.Model R2 p.value p.adjusted sig Treatment vs Control 1 0.6463814 2.560441 0.1379515 0.001 0.003 * Treatment vs Hot_control 1 0.4796256 1.916520 0.1069694 0.001 0.003 * Control vs Hot_control 1 1.1305044 4.268317 0.2105906 0.002 0.006 * 6.3.6.4.2 Neutral Permutation test for homogeneity of multivariate dispersions Permutation: free Number of permutations: 999 Response: Distances Df Sum Sq Mean Sq F N.Perm Pr(&gt;F) Groups 2 0.008262 0.0041311 0.8024 999 0.477 Residuals 24 0.123559 0.0051483 Pairwise comparisons: (Observed p-value below diagonal, permuted p-value above diagonal) Control Hot_control Treatment Control 0.45100 0.666 Hot_control 0.44675 0.247 Treatment 0.65989 0.25095 Df SumOfSqs R2 F Pr(&gt;F) type 2 1.923807 0.2603795 4.224537 0.001 Residual 24 5.464666 0.7396205 NA NA Total 26 7.388473 1.0000000 NA NA tinytable_upu6xn2q2wtehi9biaj9 .table td.tinytable_css_8gocm6djvzeyc6ngpki1, .table th.tinytable_css_8gocm6djvzeyc6ngpki1 { border-bottom: solid 0.1em #d3d8dc; } pairs Df SumsOfSqs F.Model R2 p.value p.adjusted sig Treatment vs Control 1 1.0227481 4.648335 0.2251191 0.001 0.003 * Treatment vs Hot_control 1 0.5010202 2.206532 0.1211945 0.001 0.003 * Control vs Hot_control 1 1.3619424 5.771031 0.2650785 0.001 0.003 * 6.3.6.4.3 Phylogenetic Permutation test for homogeneity of multivariate dispersions Permutation: free Number of permutations: 999 Response: Distances Df Sum Sq Mean Sq F N.Perm Pr(&gt;F) Groups 2 0.000407 0.0002034 0.0487 999 0.959 Residuals 24 0.100305 0.0041794 Pairwise comparisons: (Observed p-value below diagonal, permuted p-value above diagonal) Control Hot_control Treatment Control 0.92900 0.843 Hot_control 0.93765 0.772 Treatment 0.83933 0.76015 Df SumOfSqs R2 F Pr(&gt;F) type 2 0.1594363 0.2042241 3.079623 0.001 Residual 24 0.6212564 0.7957759 NA NA Total 26 0.7806927 1.0000000 NA NA tinytable_op97o9mzrubpxahcbwax .table td.tinytable_css_w392j0bj78snrtgo8jz9, .table th.tinytable_css_w392j0bj78snrtgo8jz9 { border-bottom: solid 0.1em #d3d8dc; } pairs Df SumsOfSqs F.Model R2 p.value p.adjusted sig Treatment vs Control 1 0.05927454 2.382025 0.1295845 0.026 0.078 Treatment vs Hot_control 1 0.06906280 2.722460 0.1454115 0.003 0.009 * Control vs Hot_control 1 0.11081709 4.043656 0.2017424 0.002 0.006 * 6.3.6.4.4 Functional Permutation test for homogeneity of multivariate dispersions Permutation: free Number of permutations: 999 Response: Distances Df Sum Sq Mean Sq F N.Perm Pr(&gt;F) Groups 2 0.01126 0.0056302 0.2861 999 0.784 Residuals 24 0.47233 0.0196806 Pairwise comparisons: (Observed p-value below diagonal, permuted p-value above diagonal) Control Hot_control Treatment Control 0.55200 0.672 Hot_control 0.48255 0.764 Treatment 0.60116 0.75643 Df SumOfSqs R2 F Pr(&gt;F) type 2 -0.0038724 -0.0056213 -0.0670788 0.924 Residual 24 0.6927468 1.0056213 NA NA Total 26 0.6888744 1.0000000 NA NA tinytable_og2g9c3e2ihq8vhhjv4j .table td.tinytable_css_yofz2byh2u8xjyd3pwkk, .table th.tinytable_css_yofz2byh2u8xjyd3pwkk { border-bottom: solid 0.1em #d3d8dc; } pairs Df SumsOfSqs F.Model R2 p.value p.adjusted sig Treatment vs Control 1 -0.008527330 -0.46290555 -0.029793572 0.849 1 Treatment vs Hot_control 1 -0.001648721 -0.04717131 -0.002956924 0.905 1 Control vs Hot_control 1 0.004367477 0.13147026 0.008149924 0.683 1 beta_richness_nmds_post2 &lt;- beta_div_richness_post2$S %&gt;% metaMDS(.,trymax = 500, k=2, verbosity=FALSE) %&gt;% scores() %&gt;% as_tibble(., rownames = &quot;sample&quot;) %&gt;% left_join(post2_nmds, by = join_by(sample == Tube_code)) beta_neutral_nmds_post2 &lt;- beta_div_neutral_post2$S %&gt;% metaMDS(.,trymax = 500, k=2, verbosity=FALSE) %&gt;% scores() %&gt;% as_tibble(., rownames = &quot;sample&quot;) %&gt;% left_join(post2_nmds, by = join_by(sample == Tube_code)) beta_phylogenetic_nmds_post2 &lt;- beta_div_phylo_post2$S %&gt;% metaMDS(.,trymax = 500, k=2, verbosity=FALSE) %&gt;% scores() %&gt;% as_tibble(., rownames = &quot;sample&quot;) %&gt;% left_join(post2_nmds, by = join_by(sample == Tube_code)) beta_functional_nmds_post2 &lt;- beta_div_func_post2$S %&gt;% metaMDS(.,trymax = 500, k=2, verbosity=FALSE) %&gt;% scores() %&gt;% as_tibble(., rownames = &quot;sample&quot;) %&gt;% left_join(post2_nmds, by = join_by(sample == Tube_code)) p0&lt;-beta_richness_nmds_post2 %&gt;% group_by(type) %&gt;% mutate(x_cen = mean(NMDS1, na.rm = TRUE)) %&gt;% mutate(y_cen = mean(NMDS2, na.rm = TRUE)) %&gt;% ungroup() %&gt;% ggplot(., aes(x=NMDS1,y=NMDS2, color=type)) + scale_color_manual(name=&quot;Type&quot;, breaks=c(&quot;Control&quot;, &quot;Hot_control&quot;, &quot;Treatment&quot;), labels=c(&quot;Cold-Cold&quot;, &quot;Hot-Hot&quot;, &quot;Cold-Hot&quot;), values=c(&quot;#4477AA&quot;,&quot;#d57d2c&quot;,&quot;#76b183&quot;)) + geom_point(size=2) + geom_segment(aes(x=x_cen, y=y_cen, xend=NMDS1, yend=NMDS2), alpha=0.2) + labs(y = &quot;NMDS2&quot;, x=&quot;NMDS1 \\n Richness beta diversity&quot;) + theme_classic() + theme(legend.position=&quot;none&quot;) p1&lt;-beta_neutral_nmds_post2 %&gt;% group_by(type) %&gt;% mutate(x_cen = mean(NMDS1, na.rm = TRUE)) %&gt;% mutate(y_cen = mean(NMDS2, na.rm = TRUE)) %&gt;% ungroup() %&gt;% ggplot(., aes(x=NMDS1,y=NMDS2, color=type)) + scale_color_manual(name=&quot;Type&quot;, breaks=c(&quot;Control&quot;, &quot;Hot_control&quot;, &quot;Treatment&quot;), labels=c(&quot;Cold-Cold&quot;, &quot;Hot-Hot&quot;, &quot;Cold-Hot&quot;), values=c(&quot;#4477AA&quot;,&quot;#d57d2c&quot;,&quot;#76b183&quot;)) + geom_point(size=2) + geom_segment(aes(x=x_cen, y=y_cen, xend=NMDS1, yend=NMDS2), alpha=0.2) + labs(y = &quot;NMDS2&quot;, x=&quot;NMDS1 \\n Neutral beta diversity&quot;) + theme_classic() + theme(legend.position=&quot;none&quot;) p2&lt;-beta_phylogenetic_nmds_post2 %&gt;% group_by(type) %&gt;% mutate(x_cen = mean(NMDS1, na.rm = TRUE)) %&gt;% mutate(y_cen = mean(NMDS2, na.rm = TRUE)) %&gt;% ungroup() %&gt;% ggplot(., aes(x=NMDS1,y=NMDS2, color=type)) + scale_color_manual(name=&quot;Type&quot;, breaks=c(&quot;Control&quot;, &quot;Hot_control&quot;, &quot;Treatment&quot;), labels=c(&quot;Cold-Cold&quot;, &quot;Hot-Hot&quot;, &quot;Cold-Hot&quot;), values=c(&quot;#4477AA&quot;,&quot;#d57d2c&quot;,&quot;#76b183&quot;)) + geom_point(size=2) + geom_segment(aes(x=x_cen, y=y_cen, xend=NMDS1, yend=NMDS2), alpha=0.2) + labs(y= element_blank (), x=&quot;NMDS1 \\n Phylogenetic beta diversity&quot;) + theme_classic() + theme(legend.position=&quot;none&quot;) p3&lt;-beta_functional_nmds_post2 %&gt;% group_by(type) %&gt;% mutate(x_cen = mean(NMDS1, na.rm = TRUE)) %&gt;% mutate(y_cen = mean(NMDS2, na.rm = TRUE)) %&gt;% ungroup() %&gt;% ggplot(., aes(x=NMDS1,y=NMDS2, color=type)) + scale_color_manual(name=&quot;Type&quot;, breaks=c(&quot;Control&quot;, &quot;Hot_control&quot;, &quot;Treatment&quot;), labels=c(&quot;Cold-Cold&quot;, &quot;Hot-Hot&quot;, &quot;Cold-Hot&quot;), values=c(&quot;#4477AA&quot;,&quot;#d57d2c&quot;,&quot;#76b183&quot;)) + geom_point(size=2) + geom_segment(aes(x=x_cen, y=y_cen, xend=NMDS1, yend=NMDS2), alpha=0.2) + labs(y= element_blank (), x=&quot;NMDS1 \\n Functional beta diversity&quot;) + theme_classic()+ theme(legend.position=&quot;none&quot;) ggarrange(p0, p1, p2, p3, ncol=2, nrow=2, common.legend = TRUE, legend=&quot;right&quot;) "],["functional-differences.html", "Chapter 7 Functional differences 7.1 Data preparation 7.2 Genomes GIFT profiles 7.3 Function level 7.4 Element level 7.5 Comparison of samples from the 0 Time_point (0_Wild) 7.6 Comparison of samples from the 1st Time_point (1_Acclimation) 7.7 Comparison of samples from the 5th Time_point (5_Post-FMT1) 7.8 Comparison of samples from the 6th Time_point (6_Post-FMT2) 7.9 Domain level", " Chapter 7 Functional differences load(&quot;data/data.Rdata&quot;) 7.1 Data preparation # Aggregate bundle-level GIFTs into the compound level GIFTs_elements &lt;- to.elements(genome_gifts, GIFT_db) GIFTs_elements_filtered &lt;- GIFTs_elements[rownames(GIFTs_elements) %in% genome_counts$genome, ] GIFTs_elements_filtered &lt;- as.data.frame(GIFTs_elements_filtered) %&gt;% select_if(~ !is.numeric(.) || sum(.) != 0) elements &lt;- GIFTs_elements_filtered %&gt;% as.data.frame() # Aggregate element-level GIFTs into the function level GIFTs_functions &lt;- to.functions(GIFTs_elements_filtered, GIFT_db) functions &lt;- GIFTs_functions %&gt;% as.data.frame() # Aggregate function-level GIFTs into overall Biosynthesis, Degradation and Structural GIFTs GIFTs_domains &lt;- to.domains(GIFTs_functions, GIFT_db) domains &lt;- GIFTs_domains %&gt;% as.data.frame() # Get community-weighed average GIFTs per sample GIFTs_elements_community &lt;- to.community(GIFTs_elements_filtered, genome_counts_filt %&gt;% column_to_rownames(., &quot;genome&quot;) %&gt;% tss(), GIFT_db) GIFTs_functions_community &lt;- to.community(GIFTs_functions, genome_counts_filt %&gt;% column_to_rownames(., &quot;genome&quot;) %&gt;% tss(), GIFT_db) GIFTs_domains_community &lt;- to.community(GIFTs_domains, genome_counts_filt %&gt;% column_to_rownames(., &quot;genome&quot;) %&gt;% tss(), GIFT_db) uniqueGIFT_db&lt;- unique(GIFT_db[c(2,4,5,6)]) %&gt;% unite(&quot;Function&quot;,Function:Element, sep= &quot;_&quot;, remove=FALSE) 7.2 Genomes GIFT profiles GIFTs_elements %&gt;% as_tibble(., rownames = &quot;MAG&quot;) %&gt;% reshape2::melt() %&gt;% rename(Code_element = variable, GIFT = value) %&gt;% inner_join(GIFT_db,by=&quot;Code_element&quot;) %&gt;% ggplot(., aes(x=Code_element, y=MAG, fill=GIFT, group=Code_function))+ geom_tile()+ scale_y_discrete(guide = guide_axis(check.overlap = TRUE))+ scale_x_discrete(guide = guide_axis(check.overlap = TRUE))+ scale_fill_gradientn(colours=rev(c(&quot;#d53e4f&quot;, &quot;#f46d43&quot;, &quot;#fdae61&quot;, &quot;#fee08b&quot;, &quot;#e6f598&quot;, &quot;#abdda4&quot;, &quot;#ddf1da&quot;)))+ facet_grid(. ~ Code_function, scales = &quot;free&quot;, space = &quot;free&quot;)+ theme_grey(base_size=8)+ theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1),strip.text.x = element_text(angle = 90)) 7.3 Function level GIFTs_functions_community %&gt;% as.data.frame() %&gt;% rownames_to_column(var=&quot;sample&quot;) %&gt;% filter(sample!=&quot;AD69&quot;) %&gt;% pivot_longer(!sample,names_to=&quot;trait&quot;,values_to=&quot;gift&quot;) %&gt;% left_join(sample_metadata, by = join_by(sample == Tube_code)) %&gt;% ggplot(aes(x=trait,y=time_point,fill=gift)) + geom_tile(colour=&quot;white&quot;, size=0.2)+ scale_fill_gradientn(colours=rev(c(&quot;#d53e4f&quot;, &quot;#f46d43&quot;, &quot;#fdae61&quot;, &quot;#fee08b&quot;, &quot;#e6f598&quot;, &quot;#abdda4&quot;, &quot;#ddf1da&quot;)))+ facet_grid(type ~ ., scales=&quot;free&quot;,space=&quot;free&quot;) 7.4 Element level GIFTs_elements_community_merged&lt;-GIFTs_elements_community %&gt;% as.data.frame() %&gt;% rownames_to_column(var=&quot;sample&quot;) %&gt;% filter(sample!=&quot;AD69&quot;) %&gt;% pivot_longer(!sample,names_to=&quot;trait&quot;,values_to=&quot;gift&quot;) %&gt;% left_join(sample_metadata, by = join_by(sample == Tube_code))%&gt;% mutate(functionid = substr(trait, 1, 3)) %&gt;% mutate(trait = case_when( trait %in% GIFT_db$Code_element ~ GIFT_db$Element[match(trait, GIFT_db$Code_element)], TRUE ~ trait )) %&gt;% mutate(functionid = case_when( functionid %in% GIFT_db$Code_function ~ GIFT_db$Function[match(functionid, GIFT_db$Code_function)], TRUE ~ functionid )) %&gt;% mutate(trait=factor(trait,levels=unique(GIFT_db$Element))) %&gt;% mutate(functionid=factor(functionid,levels=unique(GIFT_db$Function))) # Create an interaction variable for time_point and sample GIFTs_elements_community_merged$interaction_var &lt;- interaction(GIFTs_elements_community_merged$sample, GIFTs_elements_community_merged$time_point) ggplot(GIFTs_elements_community_merged,aes(x=interaction_var,y=trait,fill=gift)) + geom_tile(colour=&quot;white&quot;, linewidth=0.2)+ scale_fill_gradientn(colours=rev(c(&quot;#d53e4f&quot;, &quot;#f46d43&quot;, &quot;#fdae61&quot;, &quot;#fee08b&quot;, &quot;#e6f598&quot;, &quot;#abdda4&quot;, &quot;#ddf1da&quot;)))+ facet_grid(functionid ~ type, scales=&quot;free&quot;,space=&quot;free&quot;) + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1, size=5), strip.text.y = element_text(angle = 0)) + labs(y=&quot;Traits&quot;,x=&quot;Time_point&quot;,fill=&quot;GIFT&quot;)+ scale_x_discrete(labels = function(x) gsub(&quot;.*\\\\.&quot;, &quot;&quot;, x)) 7.5 Comparison of samples from the 0 Time_point (0_Wild) 7.5.1 GIFTs Functional community GIFTs_functions_community %&gt;% rowMeans() %&gt;% as_tibble(., rownames = &quot;sample&quot;) %&gt;% left_join(sample_metadata, by = join_by(sample == Tube_code)) %&gt;% filter(time_point==&quot;0_Wild&quot;) %&gt;% group_by(species) %&gt;% summarise(MCI = mean(value), sd = sd(value)) # A tibble: 2 × 3 species MCI sd &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; 1 Podarcis_liolepis 0.327 0.0244 2 Podarcis_muralis 0.346 0.0194 7.5.1.1 GIFT test visualisation GIFTs_functions_community %&gt;% as.data.frame() %&gt;% rownames_to_column(&quot;sample&quot;) %&gt;% left_join(sample_metadata, by = join_by(sample == Tube_code)) %&gt;% filter(time_point==&quot;0_Wild&quot;) %&gt;% select(c(1:21, 24)) %&gt;% pivot_longer(-c(sample,Population),names_to = &quot;trait&quot;, values_to = &quot;value&quot;) %&gt;% mutate(trait = case_when( trait %in% GIFT_db$Code_function ~ GIFT_db$Function[match(trait, GIFT_db$Code_function)], TRUE ~ trait )) %&gt;% mutate(trait=factor(trait,levels=unique(GIFT_db$Function))) %&gt;% ggplot(aes(x=value, y=Population, group=Population, fill=Population, color=Population)) + geom_boxplot() + scale_color_manual(name=&quot;Population&quot;, breaks=c(&quot;Cold_wet&quot;,&quot;Hot_dry&quot;), labels=c(&quot;Cold&quot;,&quot;Hot&quot;), values=c(&#39;#008080&#39;, &quot;#d57d2c&quot;)) + scale_fill_manual(name=&quot;Population&quot;, breaks=c(&quot;Cold_wet&quot;,&quot;Hot_dry&quot;), labels=c(&quot;Cold&quot;,&quot;Hot&quot;), values=c(&#39;#00808050&#39;, &quot;#d57d2c50&quot;)) + facet_grid(trait ~ ., space=&quot;free&quot;, scales=&quot;free&quot;) + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1), strip.text.y = element_text(angle = 0)) + labs(y=&quot;Traits&quot;,x=&quot;Metabolic capacity index&quot;) 7.5.2 GIFTs Domain community GIFTs_domains_community %&gt;% rowMeans() %&gt;% as_tibble(., rownames = &quot;sample&quot;) %&gt;% left_join(sample_metadata, by = join_by(sample == Tube_code)) %&gt;% filter(time_point==&quot;0_Wild&quot;) %&gt;% group_by(species) %&gt;% summarise(MCI = mean(value), sd = sd(value)) # A tibble: 2 × 3 species MCI sd &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; 1 Podarcis_liolepis 0.375 0.0315 2 Podarcis_muralis 0.390 0.0208 7.5.3 GIFTs Elements community GIFTs_elements_community %&gt;% rowMeans() %&gt;% as_tibble(., rownames = &quot;sample&quot;) %&gt;% left_join(sample_metadata, by = join_by(sample == Tube_code)) %&gt;% filter(time_point==&quot;0_Wild&quot;) %&gt;% group_by(species) %&gt;% summarise(MCI = mean(value), sd = sd(value)) # A tibble: 2 × 3 species MCI sd &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; 1 Podarcis_liolepis 0.313 0.0329 2 Podarcis_muralis 0.345 0.0233 sample_metadata_wild &lt;- sample_metadata%&gt;% filter(time_point == &quot;0_Wild&quot;) element_gift_wild &lt;- GIFTs_elements_community %&gt;% as.data.frame() %&gt;% rownames_to_column(., &quot;Tube_code&quot;) %&gt;% inner_join(., sample_metadata_wild[c(1,3)], by=&quot;Tube_code&quot;) # Find numeric columns numeric_cols &lt;- sapply(element_gift_wild, is.numeric) # Calculate column sums for numeric columns only col_sums_numeric &lt;- colSums(element_gift_wild[, numeric_cols]) # Identify numeric columns with sums not equal to zero nonzero_numeric_cols &lt;- names(col_sums_numeric)[col_sums_numeric != 0] # Remove numeric columns with sums not equal to zero filtered_data &lt;- element_gift_wild[, !numeric_cols | colnames(element_gift_wild) %in% nonzero_numeric_cols] significant_elements_wild &lt;- filtered_data %&gt;% pivot_longer(-c(Tube_code,species), names_to = &quot;trait&quot;, values_to = &quot;value&quot;) %&gt;% group_by(trait) %&gt;% summarise(p_value = wilcox.test(value ~ species, exact=FALSE)$p.value) %&gt;% mutate(p_adjust=p.adjust(p_value, method=&quot;BH&quot;)) %&gt;% filter(p_adjust &lt; 0.05) %&gt;% left_join(.,uniqueGIFT_db[c(1,3)],by = join_by(trait == Code_element)) element_gift_t &lt;- element_gift_wild %&gt;% dplyr::select(-c(species)) %&gt;% t() %&gt;% row_to_names(row_number = 1) %&gt;% as.data.frame() %&gt;% mutate_if(is.character, as.numeric) %&gt;% rownames_to_column(., &quot;trait&quot;) element_gift_filt &lt;- subset(element_gift_t, trait %in% significant_elements_wild$trait) %&gt;% t() %&gt;% row_to_names(row_number = 1) %&gt;% as.data.frame() %&gt;% mutate_if(is.character, as.numeric) %&gt;% rownames_to_column(., &quot;Tube_code&quot;)%&gt;% left_join(., sample_metadata_wild[c(1,3)], by = join_by(Tube_code == Tube_code)) element_gift_filt %&gt;% dplyr::select(-Tube_code)%&gt;% group_by(species) %&gt;% summarise(across(everything(), mean))%&gt;% t() %&gt;% row_to_names(row_number = 1) %&gt;% as.data.frame() %&gt;% mutate_if(is.character, as.numeric) %&gt;% rownames_to_column(., &quot;Elements&quot;) %&gt;% left_join(.,uniqueGIFT_db[c(1,3)],by = join_by(Elements == Code_element)) element_gift_names &lt;- element_gift_filt%&gt;% dplyr::select(-species)%&gt;% t() %&gt;% row_to_names(row_number = 1) %&gt;% as.data.frame() %&gt;% mutate_if(is.character, as.numeric) %&gt;% rownames_to_column(., &quot;Elements&quot;) %&gt;% left_join(.,uniqueGIFT_db[c(1,3)],by = join_by(Elements == Code_element))%&gt;% dplyr::select(-Elements)%&gt;% dplyr::select(Function, everything())%&gt;% t()%&gt;% row_to_names(row_number = 1) %&gt;% as.data.frame() %&gt;% mutate_if(is.character, as.numeric) %&gt;% rownames_to_column(., &quot;Tube_code&quot;)%&gt;% left_join(., sample_metadata_wild[c(1,4)], by = join_by(Tube_code == Tube_code)) colNames &lt;- names(element_gift_names)[2:30] #always check names(element_gift_names) first to know where your traits finish for(i in colNames){ plt &lt;- ggplot(element_gift_names, aes(x=Population, y=.data[[i]], color = Population)) + geom_boxplot(alpha = 0.2, outlier.shape = NA, width = 0.3, show.legend = FALSE) + geom_jitter(width = 0.1, show.legend = TRUE) + theme_minimal() + theme( axis.line = element_line(size = 0.5, linetype = &quot;solid&quot;, colour = &quot;black&quot;), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), panel.border = element_blank()) print(plt) } 7.6 Comparison of samples from the 1st Time_point (1_Acclimation) 7.6.1 GIFTs Functional community GIFTs_functions_community %&gt;% rowMeans() %&gt;% as_tibble(., rownames = &quot;sample&quot;) %&gt;% left_join(sample_metadata, by = join_by(sample == Tube_code)) %&gt;% filter(time_point==&quot;1_Acclimation&quot;) %&gt;% group_by(species) %&gt;% summarise(MCI = mean(value), sd = sd(value)) # A tibble: 2 × 3 species MCI sd &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; 1 Podarcis_liolepis 0.348 0.0158 2 Podarcis_muralis 0.331 0.0321 7.6.1.1 GIFT test visualisation GIFTs_functions_community %&gt;% as.data.frame() %&gt;% rownames_to_column(&quot;sample&quot;) %&gt;% left_join(sample_metadata, by = join_by(sample == Tube_code)) %&gt;% filter(time_point==&quot;1_Acclimation&quot;) %&gt;% select(c(1:21, 24)) %&gt;% pivot_longer(-c(sample,Population),names_to = &quot;trait&quot;, values_to = &quot;value&quot;) %&gt;% mutate(trait = case_when( trait %in% GIFT_db$Code_function ~ GIFT_db$Function[match(trait, GIFT_db$Code_function)], TRUE ~ trait )) %&gt;% mutate(trait=factor(trait,levels=unique(GIFT_db$Function))) %&gt;% ggplot(aes(x=value, y=Population, group=Population, fill=Population, color=Population)) + geom_boxplot() + scale_color_manual(name=&quot;Population&quot;, breaks=c(&quot;Cold_wet&quot;,&quot;Hot_dry&quot;), labels=c(&quot;Cold&quot;,&quot;Hot&quot;), values=c(&#39;#008080&#39;, &quot;#d57d2c&quot;)) + scale_fill_manual(name=&quot;Population&quot;, breaks=c(&quot;Cold_wet&quot;,&quot;Hot_dry&quot;), labels=c(&quot;Cold&quot;,&quot;Hot&quot;), values=c(&#39;#00808050&#39;, &quot;#d57d2c50&quot;)) + facet_grid(trait ~ ., space=&quot;free&quot;, scales=&quot;free&quot;) + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1), strip.text.y = element_text(angle = 0)) + labs(y=&quot;Traits&quot;,x=&quot;Metabolic capacity index&quot;) 7.6.2 GIFTs Domain community GIFTs_domains_community %&gt;% rowMeans() %&gt;% as_tibble(., rownames = &quot;sample&quot;) %&gt;% left_join(sample_metadata, by = join_by(sample == Tube_code)) %&gt;% filter(time_point==&quot;1_Acclimation&quot;) %&gt;% group_by(species) %&gt;% summarise(MCI = mean(value), sd = sd(value)) # A tibble: 2 × 3 species MCI sd &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; 1 Podarcis_liolepis 0.395 0.0211 2 Podarcis_muralis 0.370 0.0307 7.6.3 GIFTs Elements community GIFTs_elements_community %&gt;% rowMeans() %&gt;% as_tibble(., rownames = &quot;sample&quot;) %&gt;% left_join(sample_metadata, by = join_by(sample == Tube_code)) %&gt;% filter(time_point==&quot;1_Acclimation&quot;) %&gt;% group_by(species) %&gt;% summarise(MCI = mean(value), sd = sd(value)) # A tibble: 2 × 3 species MCI sd &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; 1 Podarcis_liolepis 0.350 0.0225 2 Podarcis_muralis 0.332 0.0316 sample_metadata_accli &lt;- sample_metadata%&gt;% filter(time_point == &quot;1_Acclimation&quot;) element_gift_accli &lt;- GIFTs_elements_community %&gt;% as.data.frame() %&gt;% rownames_to_column(., &quot;Tube_code&quot;) %&gt;% inner_join(., sample_metadata_accli[c(1,3)], by=&quot;Tube_code&quot;) # Find numeric columns numeric_cols &lt;- sapply(element_gift_accli, is.numeric) # Calculate column sums for numeric columns only col_sums_numeric &lt;- colSums(element_gift_accli[, numeric_cols]) # Identify numeric columns with sums not equal to zero nonzero_numeric_cols &lt;- names(col_sums_numeric)[col_sums_numeric != 0] # Remove numeric columns with sums not equal to zero filtered_data &lt;- element_gift_accli[, !numeric_cols | colnames(element_gift_accli) %in% nonzero_numeric_cols] significant_elements_accli &lt;- filtered_data %&gt;% pivot_longer(-c(Tube_code,species), names_to = &quot;trait&quot;, values_to = &quot;value&quot;) %&gt;% group_by(trait) %&gt;% summarise(p_value = wilcox.test(value ~ species, exact=FALSE)$p.value) %&gt;% mutate(p_adjust=p.adjust(p_value, method=&quot;BH&quot;)) %&gt;% filter(p_adjust &lt; 0.05) %&gt;% left_join(.,uniqueGIFT_db[c(1,3)],by = join_by(trait == Code_element)) element_gift_t &lt;- element_gift_accli %&gt;% dplyr::select(-c(species)) %&gt;% t() %&gt;% row_to_names(row_number = 1) %&gt;% as.data.frame() %&gt;% mutate_if(is.character, as.numeric) %&gt;% rownames_to_column(., &quot;trait&quot;) element_gift_filt &lt;- subset(element_gift_t, trait %in% significant_elements_accli$trait) %&gt;% t() %&gt;% row_to_names(row_number = 1) %&gt;% as.data.frame() %&gt;% mutate_if(is.character, as.numeric) %&gt;% rownames_to_column(., &quot;Tube_code&quot;)%&gt;% left_join(., sample_metadata_accli[c(1,3)], by = join_by(Tube_code == Tube_code)) element_gift_filt %&gt;% dplyr::select(-Tube_code)%&gt;% group_by(species) %&gt;% summarise(across(everything(), mean))%&gt;% t() %&gt;% row_to_names(row_number = 1) %&gt;% as.data.frame() %&gt;% mutate_if(is.character, as.numeric) %&gt;% rownames_to_column(., &quot;Elements&quot;) %&gt;% left_join(.,uniqueGIFT_db[c(1,3)],by = join_by(Elements == Code_element)) element_gift_names &lt;- element_gift_filt%&gt;% dplyr::select(-species)%&gt;% t() %&gt;% row_to_names(row_number = 1) %&gt;% as.data.frame() %&gt;% mutate_if(is.character, as.numeric) %&gt;% rownames_to_column(., &quot;Elements&quot;) %&gt;% left_join(.,uniqueGIFT_db[c(1,3)],by = join_by(Elements == Code_element))%&gt;% dplyr::select(-Elements)%&gt;% dplyr::select(Function, everything())%&gt;% t()%&gt;% row_to_names(row_number = 1) %&gt;% as.data.frame() %&gt;% mutate_if(is.character, as.numeric) %&gt;% rownames_to_column(., &quot;Tube_code&quot;)%&gt;% left_join(., sample_metadata_accli[c(1,4)], by = join_by(Tube_code == Tube_code)) colNames &lt;- names(element_gift_names)[2:14] #always check names(element_gift_names) first to know where your traits finish for(i in colNames){ plt &lt;- ggplot(element_gift_names, aes(x=Population, y=.data[[i]], color = Population)) + geom_boxplot(alpha = 0.2, outlier.shape = NA, width = 0.3, show.legend = FALSE) + geom_jitter(width = 0.1, show.legend = TRUE) + theme_minimal() + theme( axis.line = element_line(size = 0.5, linetype = &quot;solid&quot;, colour = &quot;black&quot;), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), panel.border = element_blank()) print(plt) } 7.7 Comparison of samples from the 5th Time_point (5_Post-FMT1) 7.7.1 GIFTs Functional community GIFTs_functions_community %&gt;% rowMeans() %&gt;% as_tibble(., rownames = &quot;sample&quot;) %&gt;% left_join(sample_metadata, by = join_by(sample == Tube_code)) %&gt;% filter(time_point==&quot;5_Post-FMT1&quot;) %&gt;% group_by(type) %&gt;% summarise(MCI = mean(value), sd = sd(value)) # A tibble: 3 × 3 type MCI sd &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; 1 Control 0.373 0.0247 2 Hot_control 0.372 0.0367 3 Treatment 0.353 0.0186 7.7.1.1 GIFT test visualisation GIFTs_functions_community %&gt;% as.data.frame() %&gt;% rownames_to_column(&quot;sample&quot;) %&gt;% left_join(sample_metadata, by = join_by(sample == Tube_code)) %&gt;% filter(time_point==&quot;5_Post-FMT1&quot;) %&gt;% select(c(1:21, 27)) %&gt;% pivot_longer(-c(sample,type),names_to = &quot;trait&quot;, values_to = &quot;value&quot;) %&gt;% mutate(trait = case_when( trait %in% GIFT_db$Code_function ~ GIFT_db$Function[match(trait, GIFT_db$Code_function)], TRUE ~ trait )) %&gt;% mutate(trait=factor(trait,levels=unique(GIFT_db$Function))) %&gt;% ggplot(aes(x=value, y=type, group=type, fill=type, color=type)) + geom_boxplot() + scale_color_manual(name=&quot;type&quot;, breaks=c(&quot;Control&quot;,&quot;Hot_control&quot;, &quot;Treatment&quot;), labels=c(&quot;Cold-Cold&quot;,&quot;Hot-Hot&quot;, &quot;Cold-Hot&quot;), values=c(&quot;#4477AA&quot;,&quot;#d57d2c&quot;,&quot;#76b183&quot;)) + scale_fill_manual(name=&quot;type&quot;, breaks=c(&quot;Control&quot;,&quot;Hot_control&quot;, &quot;Treatment&quot;), labels=c(&quot;Cold-Cold&quot;,&quot;Hot-Hot&quot;, &quot;Cold-Hot&quot;), values=c(&quot;#4477AA50&quot;,&quot;#d57d2c50&quot;,&quot;#76b18350&quot;)) + facet_grid(trait ~ ., space=&quot;free&quot;, scales=&quot;free&quot;) + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1), strip.text.y = element_text(angle = 0)) + labs(y=&quot;Traits&quot;,x=&quot;Metabolic capacity index&quot;) 7.7.2 GIFTs Domain community GIFTs_domains_community %&gt;% rowMeans() %&gt;% as_tibble(., rownames = &quot;sample&quot;) %&gt;% left_join(sample_metadata, by = join_by(sample == Tube_code)) %&gt;% filter(time_point==&quot;5_Post-FMT1&quot;) %&gt;% group_by(type) %&gt;% summarise(MCI = mean(value), sd = sd(value)) # A tibble: 3 × 3 type MCI sd &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; 1 Control 0.412 0.0213 2 Hot_control 0.415 0.0437 3 Treatment 0.391 0.0263 7.7.3 GIFTs Elements community GIFTs_elements_community %&gt;% rowMeans() %&gt;% as_tibble(., rownames = &quot;sample&quot;) %&gt;% left_join(sample_metadata, by = join_by(sample == Tube_code)) %&gt;% filter(time_point==&quot;5_Post-FMT1&quot;) %&gt;% group_by(type) %&gt;% summarise(MCI = mean(value), sd = sd(value)) # A tibble: 3 × 3 type MCI sd &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; 1 Control 0.380 0.0280 2 Hot_control 0.379 0.0372 3 Treatment 0.359 0.0214 sample_metadata_tm5 &lt;- sample_metadata%&gt;% filter(time_point == &quot;5_Post-FMT1&quot;)%&gt;% filter(type != &quot;Hot_control&quot;) element_gift_tm5 &lt;- GIFTs_elements_community %&gt;% as.data.frame() %&gt;% rownames_to_column(., &quot;Tube_code&quot;) %&gt;% inner_join(sample_metadata_tm5 %&gt;% select(1, 7), by = &quot;Tube_code&quot;) # Find numeric columns numeric_cols &lt;- sapply(element_gift_tm5, is.numeric) # Calculate column sums for numeric columns only col_sums_numeric &lt;- colSums(element_gift_tm5[, numeric_cols]) # Identify numeric columns with sums not equal to zero nonzero_numeric_cols &lt;- names(col_sums_numeric)[col_sums_numeric != 0] # Remove numeric columns with sums not equal to zero filtered_data &lt;- element_gift_tm5[, !numeric_cols | colnames(element_gift_tm5) %in% nonzero_numeric_cols] significant_elements_tm5 &lt;- filtered_data %&gt;% pivot_longer(-c(Tube_code,type), names_to = &quot;trait&quot;, values_to = &quot;value&quot;) %&gt;% group_by(trait) %&gt;% summarise(p_value = wilcox.test(value ~ type, exact=FALSE)$p.value) %&gt;% mutate(p_adjust=p.adjust(p_value, method=&quot;BH&quot;)) %&gt;% filter(p_value &lt; 0.05) %&gt;% #take into account that p_value is used and not p_adjust left_join(.,uniqueGIFT_db[c(1,3)],by = join_by(trait == Code_element)) element_gift_t &lt;- element_gift_tm5 %&gt;% dplyr::select(-c(type)) %&gt;% t() %&gt;% row_to_names(row_number = 1) %&gt;% as.data.frame() %&gt;% mutate_if(is.character, as.numeric) %&gt;% rownames_to_column(., &quot;trait&quot;) element_gift_filt &lt;- subset(element_gift_t, trait %in% significant_elements_tm5$trait) %&gt;% t() %&gt;% row_to_names(row_number = 1) %&gt;% as.data.frame() %&gt;% mutate_if(is.character, as.numeric) %&gt;% rownames_to_column(., &quot;Tube_code&quot;)%&gt;% left_join(., sample_metadata_tm5[c(1,7)], by = join_by(Tube_code == Tube_code)) element_gift_filt %&gt;% dplyr::select(-Tube_code)%&gt;% group_by(type) %&gt;% summarise(across(everything(), mean))%&gt;% t() %&gt;% row_to_names(row_number = 1) %&gt;% as.data.frame() %&gt;% mutate_if(is.character, as.numeric) %&gt;% rownames_to_column(., &quot;Elements&quot;) %&gt;% left_join(.,uniqueGIFT_db[c(1,3)],by = join_by(Elements == Code_element)) element_gift_names &lt;- element_gift_filt%&gt;% dplyr::select(-type)%&gt;% t() %&gt;% row_to_names(row_number = 1) %&gt;% as.data.frame() %&gt;% mutate_if(is.character, as.numeric) %&gt;% rownames_to_column(., &quot;Elements&quot;) %&gt;% left_join(.,uniqueGIFT_db[c(1,3)],by = join_by(Elements == Code_element))%&gt;% dplyr::select(-Elements)%&gt;% dplyr::select(Function, everything())%&gt;% t()%&gt;% row_to_names(row_number = 1) %&gt;% as.data.frame() %&gt;% mutate_if(is.character, as.numeric) %&gt;% rownames_to_column(., &quot;Tube_code&quot;)%&gt;% left_join(., sample_metadata_tm5[c(1,7)], by = join_by(Tube_code == Tube_code)) colNames &lt;- names(element_gift_names)[2:14] #always check names(element_gift_names) first to now where your traits finish for(i in colNames){ plt &lt;- ggplot(element_gift_names, aes(x=type, y=.data[[i]], color = type)) + geom_boxplot(alpha = 0.2, outlier.shape = NA, width = 0.3, show.legend = FALSE) + geom_jitter(width = 0.1, show.legend = TRUE) + theme_minimal() + theme( axis.line = element_line(size = 0.5, linetype = &quot;solid&quot;, colour = &quot;black&quot;), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), panel.border = element_blank()) print(plt) } 7.8 Comparison of samples from the 6th Time_point (6_Post-FMT2) 7.8.1 GIFTs Functional community GIFTs_functions_community %&gt;% rowMeans() %&gt;% as_tibble(., rownames = &quot;sample&quot;) %&gt;% left_join(sample_metadata, by = join_by(sample == Tube_code)) %&gt;% filter(time_point==&quot;6_Post-FMT2&quot;) %&gt;% group_by(type) %&gt;% summarise(MCI = mean(value), sd = sd(value)) # A tibble: 3 × 3 type MCI sd &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; 1 Control 0.352 0.0223 2 Hot_control 0.350 0.0293 3 Treatment 0.346 0.0255 MCI_tm6 &lt;- GIFTs_functions_community %&gt;% rowMeans() %&gt;% as_tibble(., rownames = &quot;sample&quot;) %&gt;% left_join(sample_metadata, by = join_by(sample == Tube_code)) %&gt;% filter(time_point==&quot;6_Post-FMT2&quot;) shapiro.test(MCI_tm6$value)#normality test Shapiro-Wilk normality test data: MCI_tm6$value W = 0.96248, p-value = 0.4203 res.aov&lt;-aov(value ~ type, data=MCI_tm6)#anova test summary(res.aov) Df Sum Sq Mean Sq F value Pr(&gt;F) type 2 0.00017 0.0000852 0.127 0.881 Residuals 24 0.01604 0.0006682 7.8.1.1 GIFT test visualisation GIFTs_functions_community %&gt;% as.data.frame() %&gt;% rownames_to_column(&quot;sample&quot;) %&gt;% left_join(sample_metadata, by = join_by(sample == Tube_code)) %&gt;% filter(time_point==&quot;6_Post-FMT2&quot;) %&gt;% select(c(1:21, 27)) %&gt;% pivot_longer(-c(sample,type),names_to = &quot;trait&quot;, values_to = &quot;value&quot;) %&gt;% mutate(trait = case_when( trait %in% GIFT_db$Code_function ~ GIFT_db$Function[match(trait, GIFT_db$Code_function)], TRUE ~ trait )) %&gt;% mutate(trait=factor(trait,levels=unique(GIFT_db$Function))) %&gt;% ggplot(aes(x=value, y=type, group=type, fill=type, color=type)) + geom_boxplot() + scale_color_manual(name=&quot;type&quot;, breaks=c(&quot;Control&quot;,&quot;Hot_control&quot;, &quot;Treatment&quot;), labels=c(&quot;Cold-Cold&quot;,&quot;Hot-Hot&quot;, &quot;Cold-Hot&quot;), values=c(&quot;#4477AA&quot;,&quot;#d57d2c&quot;,&quot;#76b183&quot;)) + scale_fill_manual(name=&quot;type&quot;, breaks=c(&quot;Control&quot;,&quot;Hot_control&quot;, &quot;Treatment&quot;), labels=c(&quot;Cold-Cold&quot;,&quot;Hot-Hot&quot;, &quot;Cold-Hot&quot;), values=c(&quot;#4477AA50&quot;,&quot;#d57d2c50&quot;,&quot;#76b18350&quot;)) + facet_grid(trait ~ ., space=&quot;free&quot;, scales=&quot;free&quot;) + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1), strip.text.y = element_text(angle = 0)) + labs(y=&quot;Traits&quot;,x=&quot;Metabolic capacity index&quot;) 7.8.2 GIFTs Domain community GIFTs_domains_community %&gt;% rowMeans() %&gt;% as_tibble(., rownames = &quot;sample&quot;) %&gt;% left_join(sample_metadata, by = join_by(sample == Tube_code)) %&gt;% filter(time_point==&quot;6_Post-FMT2&quot;) %&gt;% group_by(type) %&gt;% summarise(MCI = mean(value), sd = sd(value)) # A tibble: 3 × 3 type MCI sd &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; 1 Control 0.399 0.0171 2 Hot_control 0.388 0.0321 3 Treatment 0.392 0.0240 MCI_domains_tm6 &lt;- GIFTs_domains_community %&gt;% rowMeans() %&gt;% as_tibble(., rownames = &quot;sample&quot;) %&gt;% left_join(sample_metadata, by = join_by(sample == Tube_code)) %&gt;% filter(time_point==&quot;6_Post-FMT2&quot;) shapiro.test(MCI_domains_tm6$value)#normality test Shapiro-Wilk normality test data: MCI_domains_tm6$value W = 0.96598, p-value = 0.4998 res.aov&lt;-aov(value ~ type, data=MCI_domains_tm6)#anova test summary(res.aov) Df Sum Sq Mean Sq F value Pr(&gt;F) type 2 0.000611 0.0003055 0.482 0.623 Residuals 24 0.015199 0.0006333 7.8.3 GIFTs Elements community GIFTs_elements_community %&gt;% rowMeans() %&gt;% as_tibble(., rownames = &quot;sample&quot;) %&gt;% left_join(sample_metadata, by = join_by(sample == Tube_code)) %&gt;% filter(time_point==&quot;6_Post-FMT2&quot;) %&gt;% group_by(type) %&gt;% summarise(MCI = mean(value), sd = sd(value)) # A tibble: 3 × 3 type MCI sd &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; 1 Control 0.357 0.0215 2 Hot_control 0.347 0.0302 3 Treatment 0.350 0.0293 MCI_ele_tm6 &lt;- GIFTs_elements_community %&gt;% rowMeans() %&gt;% as_tibble(., rownames = &quot;sample&quot;) %&gt;% left_join(sample_metadata, by = join_by(sample == Tube_code)) %&gt;% filter(time_point==&quot;6_Post-FMT2&quot;) shapiro.test(MCI_ele_tm6$value) #normality test Shapiro-Wilk normality test data: MCI_ele_tm6$value W = 0.95139, p-value = 0.2316 res.aov&lt;-aov(value ~ type, data=MCI_ele_tm6) #anova test summary(res.aov) Df Sum Sq Mean Sq F value Pr(&gt;F) type 2 0.000488 0.0002438 0.328 0.724 Residuals 24 0.017851 0.0007438 7.8.3.1 CI vs CC sample_metadata_TM6 &lt;- sample_metadata%&gt;% filter(time_point == &quot;6_Post-FMT2&quot;)%&gt;% filter(type != &quot;Hot_control&quot;) element_gift_TM6 &lt;- GIFTs_elements_community %&gt;% as.data.frame() %&gt;% rownames_to_column(., &quot;Tube_code&quot;) %&gt;% inner_join(sample_metadata_TM6 %&gt;% select(1, 7), by = &quot;Tube_code&quot;) # Find numeric columns numeric_cols &lt;- sapply(element_gift_TM6, is.numeric) # Calculate column sums for numeric columns only col_sums_numeric &lt;- colSums(element_gift_TM6[, numeric_cols]) # Identify numeric columns with sums not equal to zero nonzero_numeric_cols &lt;- names(col_sums_numeric)[col_sums_numeric != 0] # Remove numeric columns with sums not equal to zero filtered_data &lt;- element_gift_TM6[, !numeric_cols | colnames(element_gift_TM6) %in% nonzero_numeric_cols] significant_elements_TM6 &lt;- filtered_data %&gt;% pivot_longer(-c(Tube_code,type), names_to = &quot;trait&quot;, values_to = &quot;value&quot;) %&gt;% group_by(trait) %&gt;% summarise(p_value = wilcox.test(value ~ type, exact=FALSE)$p.value) %&gt;% mutate(p_adjust=p.adjust(p_value, method=&quot;BH&quot;)) %&gt;% filter(p_value &lt; 0.05) %&gt;% #take into account that p_value is used and not p_adjust left_join(.,uniqueGIFT_db[c(1,3)],by = join_by(trait == Code_element)) element_gift_t &lt;- element_gift_TM6 %&gt;% dplyr::select(-c(type)) %&gt;% t() %&gt;% row_to_names(row_number = 1) %&gt;% as.data.frame() %&gt;% mutate_if(is.character, as.numeric) %&gt;% rownames_to_column(., &quot;trait&quot;) element_gift_filt &lt;- subset(element_gift_t, trait %in% significant_elements_TM6$trait) %&gt;% t() %&gt;% row_to_names(row_number = 1) %&gt;% as.data.frame() %&gt;% mutate_if(is.character, as.numeric) %&gt;% rownames_to_column(., &quot;Tube_code&quot;)%&gt;% left_join(., sample_metadata_TM6[c(1,7)], by = join_by(Tube_code == Tube_code)) element_gift_filt %&gt;% dplyr::select(-Tube_code)%&gt;% group_by(type) %&gt;% summarise(across(everything(), mean))%&gt;% t() %&gt;% row_to_names(row_number = 1) %&gt;% as.data.frame() %&gt;% mutate_if(is.character, as.numeric) %&gt;% rownames_to_column(., &quot;Elements&quot;) %&gt;% left_join(.,uniqueGIFT_db[c(1,3)],by = join_by(Elements == Code_element)) element_gift_names &lt;- element_gift_filt%&gt;% dplyr::select(-type)%&gt;% t() %&gt;% row_to_names(row_number = 1) %&gt;% as.data.frame() %&gt;% mutate_if(is.character, as.numeric) %&gt;% rownames_to_column(., &quot;Elements&quot;) %&gt;% left_join(.,uniqueGIFT_db[c(1,3)],by = join_by(Elements == Code_element))%&gt;% dplyr::select(-Elements)%&gt;% dplyr::select(Function, everything())%&gt;% t()%&gt;% row_to_names(row_number = 1) %&gt;% as.data.frame() %&gt;% mutate_if(is.character, as.numeric) %&gt;% rownames_to_column(., &quot;Tube_code&quot;)%&gt;% left_join(., sample_metadata_TM6[c(1,7)], by = join_by(Tube_code == Tube_code)) colNames &lt;- names(element_gift_names)[2:20] #always check names(element_gift_names) first to now where your traits finish for(i in colNames){ plt &lt;- ggplot(element_gift_names, aes(x=type, y=.data[[i]], color = type)) + geom_boxplot(alpha = 0.2, outlier.shape = NA, width = 0.3, show.legend = FALSE) + geom_jitter(width = 0.1, show.legend = TRUE) + theme_minimal() + theme( axis.line = element_line(size = 0.5, linetype = &quot;solid&quot;, colour = &quot;black&quot;), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), panel.border = element_blank()) print(plt) } 7.8.3.2 CI vs WC sample_metadata_TM8 &lt;- sample_metadata%&gt;% filter(time_point == &quot;6_Post-FMT2&quot;)%&gt;% filter(type != &quot;Control&quot;) element_gift_TM8 &lt;- GIFTs_elements_community %&gt;% as.data.frame() %&gt;% rownames_to_column(., &quot;Tube_code&quot;) %&gt;% inner_join(sample_metadata_TM8 %&gt;% select(1, 7), by = &quot;Tube_code&quot;) # Find numeric columns numeric_cols &lt;- sapply(element_gift_TM8, is.numeric) # Calculate column sums for numeric columns only col_sums_numeric &lt;- colSums(element_gift_TM8[, numeric_cols]) # Identify numeric columns with sums not equal to zero nonzero_numeric_cols &lt;- names(col_sums_numeric)[col_sums_numeric != 0] # Remove numeric columns with sums not equal to zero filtered_data &lt;- element_gift_TM8[, !numeric_cols | colnames(element_gift_TM8) %in% nonzero_numeric_cols] significant_elements_TM8 &lt;- filtered_data %&gt;% pivot_longer(-c(Tube_code,type), names_to = &quot;trait&quot;, values_to = &quot;value&quot;) %&gt;% group_by(trait) %&gt;% summarise(p_value = wilcox.test(value ~ type, exact=FALSE)$p.value) %&gt;% mutate(p_adjust=p.adjust(p_value, method=&quot;BH&quot;)) %&gt;% filter(p_value &lt; 0.05) %&gt;% #take into account that p_value is used and not p_adjust left_join(.,uniqueGIFT_db[c(1,3)],by = join_by(trait == Code_element)) element_gift_t &lt;- element_gift_TM8 %&gt;% dplyr::select(-c(type)) %&gt;% t() %&gt;% row_to_names(row_number = 1) %&gt;% as.data.frame() %&gt;% mutate_if(is.character, as.numeric) %&gt;% rownames_to_column(., &quot;trait&quot;) element_gift_filt &lt;- subset(element_gift_t, trait %in% significant_elements_TM8$trait) %&gt;% t() %&gt;% row_to_names(row_number = 1) %&gt;% as.data.frame() %&gt;% mutate_if(is.character, as.numeric) %&gt;% rownames_to_column(., &quot;Tube_code&quot;)%&gt;% left_join(., sample_metadata_TM8[c(1,7)], by = join_by(Tube_code == Tube_code)) element_gift_filt %&gt;% dplyr::select(-Tube_code)%&gt;% group_by(type) %&gt;% summarise(across(everything(), mean))%&gt;% t() %&gt;% row_to_names(row_number = 1) %&gt;% as.data.frame() %&gt;% mutate_if(is.character, as.numeric) %&gt;% rownames_to_column(., &quot;Elements&quot;) %&gt;% left_join(.,uniqueGIFT_db[c(1,3)],by = join_by(Elements == Code_element)) element_gift_names &lt;- element_gift_filt%&gt;% dplyr::select(-type)%&gt;% t() %&gt;% row_to_names(row_number = 1) %&gt;% as.data.frame() %&gt;% mutate_if(is.character, as.numeric) %&gt;% rownames_to_column(., &quot;Elements&quot;) %&gt;% left_join(.,uniqueGIFT_db[c(1,3)],by = join_by(Elements == Code_element))%&gt;% dplyr::select(-Elements)%&gt;% dplyr::select(Function, everything())%&gt;% t()%&gt;% row_to_names(row_number = 1) %&gt;% as.data.frame() %&gt;% mutate_if(is.character, as.numeric) %&gt;% rownames_to_column(., &quot;Tube_code&quot;)%&gt;% left_join(., sample_metadata_TM8[c(1,7)], by = join_by(Tube_code == Tube_code)) colNames &lt;- names(element_gift_names)[2:13] #always check names(element_gift_names) first to now where your traits finish for(i in colNames){ plt &lt;- ggplot(element_gift_names, aes(x=type, y=.data[[i]], color = type)) + geom_boxplot(alpha = 0.2, outlier.shape = NA, width = 0.3, show.legend = FALSE) + geom_jitter(width = 0.1, show.legend = TRUE) + theme_minimal() + theme( axis.line = element_line(size = 0.5, linetype = &quot;solid&quot;, colour = &quot;black&quot;), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), panel.border = element_blank()) print(plt) } 7.9 Domain level 7.9.1 Comparison of samples from the 0 Time_point (0_Wild) #Merge the functional domains with the metadata merge_gift_wild&lt;- GIFTs_domains_community %&gt;% as.data.frame() %&gt;% rownames_to_column(., &quot;Tube_code&quot;) %&gt;% inner_join(., sample_metadata_wild, by=&quot;Tube_code&quot;) #Biosynthesis p1 &lt;-merge_gift_wild %&gt;% ggplot(aes(x=species,y=Biosynthesis,color=species,fill=species))+ geom_jitter(width = 0.2, size = 1.5, show.legend = FALSE)+ geom_boxplot(alpha=0.2,outlier.shape = NA, width = 0.5, show.legend = FALSE, coef=0)+ stat_compare_means() + theme(axis.text.x = element_text(vjust = 0.5, size=10), axis.text.y = element_text(size=10), axis.title=element_text(size=12,face=&quot;bold&quot;), axis.text = element_text(face=&quot;bold&quot;, size=18), panel.background = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.line = element_line(size = 0.5, linetype = &quot;solid&quot;, colour = &quot;black&quot;), legend.text = element_text(size=10), legend.title = element_text(size=12), legend.position=&quot;none&quot;, legend.key.size = unit(1, &#39;cm&#39;), strip.text.x = element_text(size = 12, color = &quot;black&quot;, face = &quot;bold&quot;))+ labs( x = &quot;Species&quot;) #Degradation p2 &lt;-merge_gift_wild %&gt;% ggplot(aes(x=species,y=Degradation,color=species,fill=species))+ geom_jitter(width = 0.2, size = 1.45, show.legend = FALSE)+ geom_boxplot(alpha=0.2,outlier.shape = NA, width = 0.5, show.legend = FALSE, coef=0)+ stat_compare_means() + theme(axis.text.x = element_text(vjust = 0.5, size=10), axis.text.y = element_text(size=10), axis.title=element_text(size=12,face=&quot;bold&quot;), panel.background = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.line = element_line(size = 0.5, linetype = &quot;solid&quot;, colour = &quot;black&quot;), legend.text = element_text(size=10), legend.title = element_text(size=12), legend.position=&quot;none&quot;, legend.key.size = unit(1, &#39;cm&#39;), strip.text.x = element_text(size = 12, color = &quot;black&quot;, face = &quot;bold&quot;))+ labs( x = &quot;Species&quot;) #Structure p3 &lt;-merge_gift_wild %&gt;% ggplot(aes(x=species,y=Structure,color=species,fill=species))+ geom_jitter(width = 0.2, size = 1.5, show.legend = FALSE)+ geom_boxplot(alpha=0.2,outlier.shape = NA, width = 0.5, show.legend = FALSE, coef=0)+ stat_compare_means() + theme(axis.text.x = element_text(vjust = 3, size=10), axis.text.y = element_text(size=10), axis.title=element_text(size=12,face=&quot;bold&quot;), axis.text = element_text(face=&quot;bold&quot;, size=18), panel.background = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.line = element_line(size = 0.5, linetype = &quot;solid&quot;, colour = &quot;black&quot;), legend.text = element_text(size=10), legend.title = element_text(size=12), legend.position=&quot;none&quot;, legend.key.size = unit(1, &#39;cm&#39;), strip.text.x = element_text(size = 12, color = &quot;black&quot;, face = &quot;bold&quot;))+ labs( x = &quot;Species&quot;) #Overall p4 &lt;-merge_gift_wild %&gt;% ggplot(aes(x=species,y=Overall,color=species,fill=species))+ geom_jitter(width = 0.2, size = 1.5, show.legend = FALSE)+ geom_boxplot(alpha=0.2,outlier.shape = NA, width = 0.5, show.legend = FALSE, coef=0)+ stat_compare_means() + theme(axis.text.x = element_text(vjust = 0.5, size=10), axis.text.y = element_text(size=10), axis.title=element_text(size=12,face=&quot;bold&quot;), axis.text = element_text(face=&quot;bold&quot;, size=18), panel.background = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.line = element_line(size = 0.5, linetype = &quot;solid&quot;, colour = &quot;black&quot;), legend.text = element_text(size=10), legend.title = element_text(size=12), legend.position=&quot;none&quot;, legend.key.size = unit(1, &#39;cm&#39;), strip.text.x = element_text(size = 12, color = &quot;black&quot;, face = &quot;bold&quot;))+ labs( x = &quot;Species&quot;) 7.9.2 Comparison of samples from the 1st Time_point (1_Acclimation) #Merge the functional domains with the metadata merge_gift_accli&lt;- GIFTs_domains_community %&gt;% as.data.frame() %&gt;% rownames_to_column(., &quot;Tube_code&quot;) %&gt;% inner_join(., sample_metadata_accli, by=&quot;Tube_code&quot;) #Biosynthesis p1 &lt;-merge_gift_accli %&gt;% ggplot(aes(x=species,y=Biosynthesis,color=species,fill=species))+ geom_jitter(width = 0.2, size = 1.5, show.legend = FALSE)+ geom_boxplot(alpha=0.2,outlier.shape = NA, width = 0.5, show.legend = FALSE, coef=0)+ stat_compare_means() + theme(axis.text.x = element_text(vjust = 0.5, size=10), axis.text.y = element_text(size=10), axis.title=element_text(size=12,face=&quot;bold&quot;), axis.text = element_text(face=&quot;bold&quot;, size=18), panel.background = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.line = element_line(size = 0.5, linetype = &quot;solid&quot;, colour = &quot;black&quot;), legend.text = element_text(size=10), legend.title = element_text(size=12), legend.position=&quot;none&quot;, legend.key.size = unit(1, &#39;cm&#39;), strip.text.x = element_text(size = 12, color = &quot;black&quot;, face = &quot;bold&quot;))+ labs( x = &quot;Species&quot;) #Degradation p2 &lt;-merge_gift_accli %&gt;% ggplot(aes(x=species,y=Degradation,color=species,fill=species))+ geom_jitter(width = 0.2, size = 1.45, show.legend = FALSE)+ geom_boxplot(alpha=0.2,outlier.shape = NA, width = 0.5, show.legend = FALSE, coef=0)+ stat_compare_means() + theme(axis.text.x = element_text(vjust = 0.5, size=10), axis.text.y = element_text(size=10), axis.title=element_text(size=12,face=&quot;bold&quot;), panel.background = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.line = element_line(size = 0.5, linetype = &quot;solid&quot;, colour = &quot;black&quot;), legend.text = element_text(size=10), legend.title = element_text(size=12), legend.position=&quot;none&quot;, legend.key.size = unit(1, &#39;cm&#39;), strip.text.x = element_text(size = 12, color = &quot;black&quot;, face = &quot;bold&quot;))+ labs( x = &quot;Species&quot;) #Structure p3 &lt;-merge_gift_accli %&gt;% ggplot(aes(x=species,y=Structure,color=species,fill=species))+ geom_jitter(width = 0.2, size = 1.5, show.legend = FALSE)+ geom_boxplot(alpha=0.2,outlier.shape = NA, width = 0.5, show.legend = FALSE, coef=0)+ stat_compare_means() + theme(axis.text.x = element_text(vjust = 3, size=10), axis.text.y = element_text(size=10), axis.title=element_text(size=12,face=&quot;bold&quot;), axis.text = element_text(face=&quot;bold&quot;, size=18), panel.background = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.line = element_line(size = 0.5, linetype = &quot;solid&quot;, colour = &quot;black&quot;), legend.text = element_text(size=10), legend.title = element_text(size=12), legend.position=&quot;none&quot;, legend.key.size = unit(1, &#39;cm&#39;), strip.text.x = element_text(size = 12, color = &quot;black&quot;, face = &quot;bold&quot;))+ labs( x = &quot;Species&quot;) #Overall p4 &lt;-merge_gift_accli %&gt;% ggplot(aes(x=species,y=Overall,color=species,fill=species))+ geom_jitter(width = 0.2, size = 1.5, show.legend = FALSE)+ geom_boxplot(alpha=0.2,outlier.shape = NA, width = 0.5, show.legend = FALSE, coef=0)+ stat_compare_means() + theme(axis.text.x = element_text(vjust = 0.5, size=10), axis.text.y = element_text(size=10), axis.title=element_text(size=12,face=&quot;bold&quot;), axis.text = element_text(face=&quot;bold&quot;, size=18), panel.background = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.line = element_line(size = 0.5, linetype = &quot;solid&quot;, colour = &quot;black&quot;), legend.text = element_text(size=10), legend.title = element_text(size=12), legend.position=&quot;none&quot;, legend.key.size = unit(1, &#39;cm&#39;), strip.text.x = element_text(size = 12, color = &quot;black&quot;, face = &quot;bold&quot;))+ labs( x = &quot;Species&quot;) 7.9.3 Comparison of samples from the 5th Time_point (5_Post-FMT1) #Merge the functional domains with the metadata merge_gift_tm5&lt;- GIFTs_domains_community %&gt;% as.data.frame() %&gt;% rownames_to_column(., &quot;Tube_code&quot;) %&gt;% inner_join(., sample_metadata_tm5, by=&quot;Tube_code&quot;) #Biosynthesis p1 &lt;-merge_gift_tm5 %&gt;% ggplot(aes(x=type,y=Biosynthesis,color=type,fill=type))+ geom_jitter(width = 0.2, size = 1.5, show.legend = FALSE)+ geom_boxplot(alpha=0.2,outlier.shape = NA, width = 0.5, show.legend = FALSE, coef=0)+ stat_compare_means() + theme(axis.text.x = element_text(vjust = 0.5, size=10), axis.text.y = element_text(size=10), axis.title=element_text(size=12,face=&quot;bold&quot;), axis.text = element_text(face=&quot;bold&quot;, size=18), panel.background = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.line = element_line(size = 0.5, linetype = &quot;solid&quot;, colour = &quot;black&quot;), legend.text = element_text(size=10), legend.title = element_text(size=12), legend.position=&quot;none&quot;, legend.key.size = unit(1, &#39;cm&#39;), strip.text.x = element_text(size = 12, color = &quot;black&quot;, face = &quot;bold&quot;))+ labs( x = &quot;Species&quot;) #Degradation p2 &lt;-merge_gift_tm5 %&gt;% ggplot(aes(x=type,y=Degradation,color=type,fill=type))+ geom_jitter(width = 0.2, size = 1.45, show.legend = FALSE)+ geom_boxplot(alpha=0.2,outlier.shape = NA, width = 0.5, show.legend = FALSE, coef=0)+ stat_compare_means() + theme(axis.text.x = element_text(vjust = 0.5, size=10), axis.text.y = element_text(size=10), axis.title=element_text(size=12,face=&quot;bold&quot;), panel.background = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.line = element_line(size = 0.5, linetype = &quot;solid&quot;, colour = &quot;black&quot;), legend.text = element_text(size=10), legend.title = element_text(size=12), legend.position=&quot;none&quot;, legend.key.size = unit(1, &#39;cm&#39;), strip.text.x = element_text(size = 12, color = &quot;black&quot;, face = &quot;bold&quot;))+ labs( x = &quot;Species&quot;) #Structure p3 &lt;-merge_gift_tm5 %&gt;% ggplot(aes(x=type,y=Structure,color=type,fill=type))+ geom_jitter(width = 0.2, size = 1.5, show.legend = FALSE)+ geom_boxplot(alpha=0.2,outlier.shape = NA, width = 0.5, show.legend = FALSE, coef=0)+ stat_compare_means() + theme(axis.text.x = element_text(vjust = 3, size=10), axis.text.y = element_text(size=10), axis.title=element_text(size=12,face=&quot;bold&quot;), axis.text = element_text(face=&quot;bold&quot;, size=18), panel.background = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.line = element_line(size = 0.5, linetype = &quot;solid&quot;, colour = &quot;black&quot;), legend.text = element_text(size=10), legend.title = element_text(size=12), legend.position=&quot;none&quot;, legend.key.size = unit(1, &#39;cm&#39;), strip.text.x = element_text(size = 12, color = &quot;black&quot;, face = &quot;bold&quot;))+ labs( x = &quot;Species&quot;) #Overall p4 &lt;-merge_gift_tm5 %&gt;% ggplot(aes(x=type,y=Overall,color=type,fill=type))+ geom_jitter(width = 0.2, size = 1.5, show.legend = FALSE)+ geom_boxplot(alpha=0.2,outlier.shape = NA, width = 0.5, show.legend = FALSE, coef=0)+ stat_compare_means() + theme(axis.text.x = element_text(vjust = 0.5, size=10), axis.text.y = element_text(size=10), axis.title=element_text(size=12,face=&quot;bold&quot;), axis.text = element_text(face=&quot;bold&quot;, size=18), panel.background = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.line = element_line(size = 0.5, linetype = &quot;solid&quot;, colour = &quot;black&quot;), legend.text = element_text(size=10), legend.title = element_text(size=12), legend.position=&quot;none&quot;, legend.key.size = unit(1, &#39;cm&#39;), strip.text.x = element_text(size = 12, color = &quot;black&quot;, face = &quot;bold&quot;))+ labs( x = &quot;Species&quot;) 7.9.4 Comparison of samples from the 6th Time_point (6_Post-FMT2) 7.9.4.1 CI vs CC #Merge the functional domains with the metadata merge_gift_TM6 &lt;- GIFTs_domains_community %&gt;% as.data.frame() %&gt;% rownames_to_column(., &quot;Tube_code&quot;) %&gt;% inner_join(., sample_metadata_TM6, by=&quot;Tube_code&quot;) #Biosynthesis p1 &lt;-merge_gift_TM6 %&gt;% ggplot(aes(x=type,y=Biosynthesis,color=type,fill=type))+ geom_jitter(width = 0.2, size = 1.5, show.legend = FALSE)+ geom_boxplot(alpha=0.2,outlier.shape = NA, width = 0.5, show.legend = FALSE, coef=0)+ stat_compare_means() + theme(axis.text.x = element_text(vjust = 0.5, size=10), axis.text.y = element_text(size=10), axis.title=element_text(size=12,face=&quot;bold&quot;), axis.text = element_text(face=&quot;bold&quot;, size=18), panel.background = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.line = element_line(size = 0.5, linetype = &quot;solid&quot;, colour = &quot;black&quot;), legend.text = element_text(size=10), legend.title = element_text(size=12), legend.position=&quot;none&quot;, legend.key.size = unit(1, &#39;cm&#39;), strip.text.x = element_text(size = 12, color = &quot;black&quot;, face = &quot;bold&quot;))+ labs( x = &quot;Type&quot;) #Degradation p2 &lt;-merge_gift_TM6 %&gt;% ggplot(aes(x=type,y=Degradation,color=type,fill=type))+ geom_jitter(width = 0.2, size = 1.5, show.legend = FALSE)+ geom_boxplot(alpha=0.2,outlier.shape = NA, width = 0.5, show.legend = FALSE, coef=0)+ stat_compare_means() + theme(axis.text.x = element_text(vjust = 0.5, size=10), axis.text.y = element_text(size=10), axis.title=element_text(size=12,face=&quot;bold&quot;), axis.text = element_text(face=&quot;bold&quot;, size=18), panel.background = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.line = element_line(size = 0.5, linetype = &quot;solid&quot;, colour = &quot;black&quot;), legend.text = element_text(size=10), legend.title = element_text(size=12), legend.position=&quot;none&quot;, legend.key.size = unit(1, &#39;cm&#39;), strip.text.x = element_text(size = 12, color = &quot;black&quot;, face = &quot;bold&quot;))+ labs( x = &quot;type&quot;) #Structure p3 &lt;-merge_gift_TM6 %&gt;% ggplot(aes(x=type,y=Structure,color=type,fill=type))+ geom_jitter(width = 0.2, size = 1.5, show.legend = FALSE)+ geom_boxplot(alpha=0.2,outlier.shape = NA, width = 0.5, show.legend = FALSE, coef=0)+ stat_compare_means() + theme(axis.text.x = element_text(vjust = 3, size=10), axis.text.y = element_text(size=10), axis.title=element_text(size=12,face=&quot;bold&quot;), axis.text = element_text(face=&quot;bold&quot;, size=18), panel.background = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.line = element_line(size = 0.5, linetype = &quot;solid&quot;, colour = &quot;black&quot;), legend.text = element_text(size=10), legend.title = element_text(size=12), legend.position=&quot;none&quot;, legend.key.size = unit(1, &#39;cm&#39;), strip.text.x = element_text(size = 12, color = &quot;black&quot;, face = &quot;bold&quot;))+ labs( x = &quot;type&quot;) #Overall p4 &lt;-merge_gift_TM6 %&gt;% ggplot(aes(x=type,y=Overall,color=type,fill=type))+ geom_jitter(width = 0.2, size = 1.5, show.legend = FALSE)+ geom_boxplot(alpha=0.2,outlier.shape = NA, width = 0.5, show.legend = FALSE, coef=0)+ stat_compare_means() + theme(axis.text.x = element_text(vjust = 0.5, size=10), axis.text.y = element_text(size=10), axis.title=element_text(size=12,face=&quot;bold&quot;), axis.text = element_text(face=&quot;bold&quot;, size=18), panel.background = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.line = element_line(size = 0.5, linetype = &quot;solid&quot;, colour = &quot;black&quot;), legend.text = element_text(size=10), legend.title = element_text(size=12), legend.position=&quot;none&quot;, legend.key.size = unit(1, &#39;cm&#39;), strip.text.x = element_text(size = 12, color = &quot;black&quot;, face = &quot;bold&quot;))+ labs( x = &quot;type&quot;) 7.9.4.2 CI vs WC #Merge the functional domains with the metadata merge_gift_TM8 &lt;- GIFTs_domains_community %&gt;% as.data.frame() %&gt;% rownames_to_column(., &quot;Tube_code&quot;) %&gt;% inner_join(., sample_metadata_TM8, by=&quot;Tube_code&quot;) #Biosynthesis p1 &lt;-merge_gift_TM8 %&gt;% ggplot(aes(x=type,y=Biosynthesis,color=type,fill=type))+ geom_jitter(width = 0.2, size = 1.5, show.legend = FALSE)+ geom_boxplot(alpha=0.2,outlier.shape = NA, width = 0.5, show.legend = FALSE, coef=0)+ stat_compare_means() + theme(axis.text.x = element_text(vjust = 0.5, size=10), axis.text.y = element_text(size=10), axis.title=element_text(size=12,face=&quot;bold&quot;), axis.text = element_text(face=&quot;bold&quot;, size=18), panel.background = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.line = element_line(size = 0.5, linetype = &quot;solid&quot;, colour = &quot;black&quot;), legend.text = element_text(size=10), legend.title = element_text(size=12), legend.position=&quot;none&quot;, legend.key.size = unit(1, &#39;cm&#39;), strip.text.x = element_text(size = 12, color = &quot;black&quot;, face = &quot;bold&quot;))+ labs( x = &quot;Type&quot;) #Degradation p2 &lt;-merge_gift_TM8 %&gt;% ggplot(aes(x=type,y=Degradation,color=type,fill=type))+ geom_jitter(width = 0.2, size = 1.5, show.legend = FALSE)+ geom_boxplot(alpha=0.2,outlier.shape = NA, width = 0.5, show.legend = FALSE, coef=0)+ stat_compare_means() + theme(axis.text.x = element_text(vjust = 0.5, size=10), axis.text.y = element_text(size=10), axis.title=element_text(size=12,face=&quot;bold&quot;), axis.text = element_text(face=&quot;bold&quot;, size=18), panel.background = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.line = element_line(size = 0.5, linetype = &quot;solid&quot;, colour = &quot;black&quot;), legend.text = element_text(size=10), legend.title = element_text(size=12), legend.position=&quot;none&quot;, legend.key.size = unit(1, &#39;cm&#39;), strip.text.x = element_text(size = 12, color = &quot;black&quot;, face = &quot;bold&quot;))+ labs( x = &quot;type&quot;) #Structure p3 &lt;-merge_gift_TM8 %&gt;% ggplot(aes(x=type,y=Structure,color=type,fill=type))+ geom_jitter(width = 0.2, size = 1.5, show.legend = FALSE)+ geom_boxplot(alpha=0.2,outlier.shape = NA, width = 0.5, show.legend = FALSE, coef=0)+ stat_compare_means() + theme(axis.text.x = element_text(vjust = 3, size=10), axis.text.y = element_text(size=10), axis.title=element_text(size=12,face=&quot;bold&quot;), axis.text = element_text(face=&quot;bold&quot;, size=18), panel.background = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.line = element_line(size = 0.5, linetype = &quot;solid&quot;, colour = &quot;black&quot;), legend.text = element_text(size=10), legend.title = element_text(size=12), legend.position=&quot;none&quot;, legend.key.size = unit(1, &#39;cm&#39;), strip.text.x = element_text(size = 12, color = &quot;black&quot;, face = &quot;bold&quot;))+ labs( x = &quot;type&quot;) #Overall p4 &lt;-merge_gift_TM8 %&gt;% ggplot(aes(x=type,y=Overall,color=type,fill=type))+ geom_jitter(width = 0.2, size = 1.5, show.legend = FALSE)+ geom_boxplot(alpha=0.2,outlier.shape = NA, width = 0.5, show.legend = FALSE, coef=0)+ stat_compare_means() + theme(axis.text.x = element_text(vjust = 0.5, size=10), axis.text.y = element_text(size=10), axis.title=element_text(size=12,face=&quot;bold&quot;), axis.text = element_text(face=&quot;bold&quot;, size=18), panel.background = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.line = element_line(size = 0.5, linetype = &quot;solid&quot;, colour = &quot;black&quot;), legend.text = element_text(size=10), legend.title = element_text(size=12), legend.position=&quot;none&quot;, legend.key.size = unit(1, &#39;cm&#39;), strip.text.x = element_text(size = 12, color = &quot;black&quot;, face = &quot;bold&quot;))+ labs( x = &quot;type&quot;) "],["differential-abundance-analysis.html", "Chapter 8 Differential abundance analysis 8.1 CC acclimation vs post2 8.2 WC acclimation vs post2 8.3 CI acclimation vs post2 8.4 Community level plots 8.5 Wilcoxon comparison", " Chapter 8 Differential abundance analysis 8.1 CC acclimation vs post2 8.1.1 Enrichment analysis: Ancombc2 8.1.1.1 MAG level 8.2 WC acclimation vs post2 8.2.1 Enrichment analysis: Ancombc2 8.2.1.1 MAG level 8.3 CI acclimation vs post2 8.3.1 Enrichment analysis: Ancombc2 8.3.1.1 MAG level 8.4 Community level plots accli_post2&lt;-sample_metadata%&gt;% filter(time_point == &quot;1_Acclimation&quot;|time_point == &quot;6_Post-FMT2&quot;) accli_post2$newID&lt;-paste(accli_post2$type, &quot;_&quot;, accli_post2$time_point) GIFTs_functions_community %&gt;% as.data.frame() %&gt;% rownames_to_column(&quot;sample&quot;) %&gt;% left_join(accli_post2, by = join_by(sample == Tube_code)) %&gt;% filter(time_point == &quot;1_Acclimation&quot;|time_point == &quot;6_Post-FMT2&quot;) %&gt;% select(c(1:21, 27,30)) %&gt;% pivot_longer(-c(sample,type,time_point),names_to = &quot;trait&quot;, values_to = &quot;value&quot;) %&gt;% mutate(trait = case_when( trait %in% GIFT_db$Code_function ~ GIFT_db$Function[match(trait, GIFT_db$Code_function)], TRUE ~ trait )) %&gt;% mutate(trait=factor(trait,levels=unique(GIFT_db$Function))) %&gt;% ggplot(aes(x=value, y=time_point, group=time_point, fill=type, color=type)) + geom_boxplot() + scale_color_manual(name=&quot;type&quot;, breaks=c(&quot;Control&quot;,&quot;Hot_control&quot;, &quot;Treatment&quot;), labels=c(&quot;Cold-Cold&quot;,&quot;Hot-Hot&quot;, &quot;Cold-Hot&quot;), values=c(&quot;#4477AA&quot;,&quot;#d57d2c&quot;,&quot;#76b183&quot;)) + scale_fill_manual(name=&quot;type&quot;, breaks=c(&quot;Control&quot;,&quot;Hot_control&quot;, &quot;Treatment&quot;), labels=c(&quot;Cold-Cold&quot;,&quot;Hot-Hot&quot;, &quot;Cold-Hot&quot;), values=c(&quot;#4477AA50&quot;,&quot;#d57d2c50&quot;,&quot;#76b18350&quot;)) + facet_grid(trait ~ type, space=&quot;free&quot;, scales=&quot;free&quot;) + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1), strip.text.y = element_text(angle = 0)) + labs(y=&quot;Traits&quot;,x=&quot;Metabolic capacity index&quot;) GIFTs_elements_community_merged&lt;-GIFTs_elements_community %&gt;% as.data.frame() %&gt;% rownames_to_column(var=&quot;sample&quot;) %&gt;% filter(sample!=&quot;AD69&quot;) %&gt;% pivot_longer(!sample,names_to=&quot;trait&quot;,values_to=&quot;gift&quot;) %&gt;% left_join(sample_metadata, by = join_by(sample == Tube_code))%&gt;% filter(time_point==&quot;1_Acclimation&quot;|time_point == &quot;6_Post-FMT2&quot;)%&gt;% mutate(functionid = substr(trait, 1, 3)) %&gt;% mutate(trait = case_when( trait %in% GIFT_db$Code_element ~ GIFT_db$Element[match(trait, GIFT_db$Code_element)], TRUE ~ trait )) %&gt;% mutate(functionid = case_when( functionid %in% GIFT_db$Code_function ~ GIFT_db$Function[match(functionid, GIFT_db$Code_function)], TRUE ~ functionid )) %&gt;% mutate(trait=factor(trait,levels=unique(GIFT_db$Element))) %&gt;% mutate(functionid=factor(functionid,levels=unique(GIFT_db$Function))) # Create an interaction variable for time_point and sample GIFTs_elements_community_merged$interaction_var &lt;- interaction(GIFTs_elements_community_merged$sample, GIFTs_elements_community_merged$time_point) ggplot(GIFTs_elements_community_merged,aes(x=interaction_var,y=trait,fill=gift)) + geom_tile(colour=&quot;white&quot;, linewidth=0.2)+ scale_fill_gradientn(colours=rev(c(&quot;#d53e4f&quot;, &quot;#f46d43&quot;, &quot;#fdae61&quot;, &quot;#fee08b&quot;, &quot;#e6f598&quot;, &quot;#abdda4&quot;, &quot;#ddf1da&quot;)))+ facet_grid(functionid ~ type, scales=&quot;free&quot;,space=&quot;free&quot;) + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1, size=5), strip.text.y = element_text(angle = 0)) + labs(y=&quot;Traits&quot;,x=&quot;Time_point&quot;,fill=&quot;GIFT&quot;)+ scale_x_discrete(labels = function(x) gsub(&quot;.*\\\\.&quot;, &quot;&quot;, x)) 8.5 Wilcoxon comparison 8.5.1 Community elements differences: in CC acclimation vs post2 difference_table_CC %&gt;% filter(group_color==&quot;Acclimation&quot;) [1] Elements Acclimation Post2 Function Element Difference group_color &lt;0 rows&gt; (or 0-length row.names) 8.5.2 Community elements differences: in CI acclimation vs post2 difference_table_CI %&gt;% filter(group_color==&quot;Acclimation&quot;) 8.5.3 Community elements differences: in WC acclimation vs post2 difference_table_WC %&gt;% filter(group_color==&quot;Acclimation&quot;) "],["404.html", "Page not found", " Page not found The page you requested cannot be found (perhaps it was moved or renamed). You may want to try searching to find the page's new location, or use the table of contents to find the page you are looking for. "]]
